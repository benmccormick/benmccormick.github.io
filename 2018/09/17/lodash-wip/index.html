<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#rgb(42, 194, 240)"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'minion-3','Garamond',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'minion-3','Garamond',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.2rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.2rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:14px;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style data-href="/styles.fb0554890bf668508f80.css">.markdown pre{display:block;background:#343d46;color:#d8dee9;padding:.8rem}.markdown pre code:after{content:unset}.token.comment,.token.quote{color:#a7adba}.token.addition,.token.attr,.token.selector-tag,.token.string{color:#99c794}.token.doctag,.token.meta .token.meta-string,.token.regexp{color:#89ddf3}.token.built_in,.token.function{color:#5fb3b3}.token.name,.token.section,.token.selector-class,.token.selector-id,.token.title{color:#69c}.token.attribute,.token.class .token.title,.token.template-variable,.token.type,.token.variable{color:#fac863}.token.bullet,.token.link,.token.meta,.token.meta .token.keyword,.token.selector-attr,.token.selector-pseudo,.token.subst,.token.symbol{color:#f9ae58}.token.boolean,.token.deletion,.token.literal,.token.number{color:#f07178}.token.keyword{color:#c594c5}.token.formula{background:#a7adba}.token.emphasis{font-style:italic}.token.strong{font-weight:700}.gatsby-resp-image-wrapper{max-width:75%;display:block;margin:40px auto 20px}.bordered-img{border:3px solid #rgb(42,194,240)}.img-group{display:flex;justify-content:space-between}.img-group img{padding:0;height:auto}.inline-img{width:45%;display:inline-block;float:right;padding:2rem}#bd-label{font-family:mr-eaves-xl-modern,Helvetica Neue,Arial,sans-serif;font-weight:700}#bd-label.large-label{font-size:20px}#bd-email{padding-left:5px}#bd-email,#bd-submit{font-family:mr-eaves-xl-modern,Helvetica Neue,Arial,sans-serif;font-size:14px}#bd-submit{background:#f1684e;color:#fff;border-radius:4px;border:none}@media (max-width:960px){#bd-email,#bd-submit{font-size:10px}#bd-label{font-size:12px}}.large-row #bd-email,.large-row #bd-submit{font-size:30px}@media (max-width:700px){.large-row #bd-email,.large-row #bd-submit{font-size:18px}}.bd-subscribe-form{margin:30px 0 50px;display:block}.bd-subscribe-row{display:grid;grid-template-columns:60% 35%;grid-column-gap:5%;grid-template-rows:1fr;margin-top:10px}@media (max-width:960px){.bd-subscribe-row{grid-template-columns:1fr;grid-row-gap:10%;grid-template-rows:1fr 1fr}}.twitter-tweet,twitterwidget{margin-left:auto;margin-right:auto}.carbon-wrap{display:grid;grid-template-columns:1fr 1fr;grid-column-gap:10px;grid-template-rows:1fr;margin-bottom:30px;align-items:center;padding-left:5px}@media (max-width:960px){.carbon-wrap{grid-template-columns:1fr;grid-template-rows:110px 1fr;grid-row-gap:10px;justify-items:center}}.carbon-wrap img{margin-bottom:0}.carbon-text{padding:5px 5px 5px 0;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:#999;position:absolute;right:5px;bottom:0}.columns{display:grid;grid-template-columns:665px 270px;grid-template-rows:1fr;grid-column-gap:25px}@media (max-width:960px){.columns{display:grid;grid-template-columns:70% 28%;grid-column-gap:2%}}@media (max-width:700px){.columns{display:flex;flex-direction:column;align-items:center}.no-mobile{display:none}}@media (max-width:321px){html{font-size:100%!important}}body{color:#474747}a{color:#f1684e;text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}.footnote-backref,.footnote-ref{text-decoration:none;padding-left:3px}blockquote{border-left:5px solid #2ac2f0;background:#eee;font-weight:400;font-size:.9rem;padding:1.5rem 2rem;margin:0 0 1rem}blockquote p{margin-bottom:.667em}h3{color:#2ac2f0}h4{font-size:110%}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnotes{font-size:80%}.footnotes li>*{display:inline;margin-bottom:0}strong{color:#639f6e}em{color:#9a74aa}.markdown iframe{margin:0 auto}</style><meta name="generator" content="Gatsby 2.24.11"/><style id="glamor-styles">.css-tcc0st,[data-css-tcc0st]{color:#999999;font-size:16px;font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;}.css-tcc0st:hover,[data-css-tcc0st]:hover{color:#F1684E;}.css-1gs5qio,[data-css-1gs5qio]{font-size:16px;font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;}.css-b0r4rv,[data-css-b0r4rv]{font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;font-size:0.75rem;background:#F1684E;color:rgba(256,256,256,1);display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;flex-direction:row;justify-content:flex-start;align-items:center;border-radius:0.25rem;padding:0.125rem 0.35rem;width:12rem;height:2rem;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-pack:start;-webkit-justify-content:flex-start;-webkit-box-align:center;-webkit-align-items:center;}.css-b0r4rv:hover,[data-css-b0r4rv]:hover{text-decoration:none;}@media all and (max-width: 960px){.css-b0r4rv,[data-css-b0r4rv]{height:1.6rem;width:7rem;font-size:0.55rem;}}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["tcc0st","1gs5qio","b0r4rv"]
        // ]]>
        </script><title data-react-helmet="true">Lodash WIP | benmccormick.org</title><meta data-react-helmet="true" name="description" content="Ben McCormick&#x27;s blog on JavaScript and Web Development"/><meta data-react-helmet="true" name="keywords" content=""/><script data-react-helmet="true" type="application/ld+json">{
                  "@context": "http://schema.org"
                  "@type": "BlogPosting",
                  "headline": "Lodash WIP",
                  "genre": "Software Development",
                  "keywords": "",
                  "url": "http://benmccormick.org//2018/09/17/lodash-wip/",
                  "image": "http://benmccormick.org/logo.png",
                  "datePublished": "2018-09-17",
                  
                  "articleBody": "<h1>Diving Into lodash - Merging and Cloning Objects</h1>
<p>When working with data, it’s common to have to merge data from multiple objects to create a new object, create a copy of an existing object, or update an existing object with properties form another object.  <a href=\"https://lodash.com/\">lodash</a> makes these operations easy.  Let’s take a look at what it provides.</p>
<h3>Merging Objects</h3>
<p>In my last post I mentioned an example application where we want to merge 2 contact records:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> contact1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>
    lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Smith'</span><span class=\"token punctuation\">,</span>
    phone<span class=\"token punctuation\">:</span> <span class=\"token string\">'919.222.7855'</span><span class=\"token punctuation\">,</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">let</span> contact2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>
    phone<span class=\"token punctuation\">:</span> <span class=\"token string\">'919.965.9999'</span><span class=\"token punctuation\">,</span>
    email<span class=\"token punctuation\">:</span> <span class=\"token string\">'john.smith@gmail.com'</span><span class=\"token punctuation\">,</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>
<p>There I talked about <code class=\"language-text\">_.assign</code> as an alternative to the native <code class=\"language-text\">Object.assign</code>.  <code class=\"language-text\">_.assign</code> is lodash’s most basic “merging” function.  <code class=\"language-text\">_.assign</code>, like <code class=\"language-text\">Object.assign</code> takes 2 or more arguments: a destination object, and 1 or more source objects. It then returns the destination object.  When there are conflicts, the rightmost object “wins”.  Using it looks like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//merge contact2 into contact1</span>
_<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>contact1<span class=\"token punctuation\">,</span> contact2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token comment\">/*
// contact1
{
    firstName: 'John',
    lastName: 'Smith',
    phone: '919.965.9999',
    email: 'john.smith@gmail.com',

}
*/</span>

<span class=\"token comment\">//merge contact1 and contact 2 into a new object</span>

<span class=\"token keyword\">let</span> newContact <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> contact1<span class=\"token punctuation\">,</span> contact2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>

<span class=\"token comment\">/*
// newContact
{
    firstName: 'John',
    lastName: 'Smith',
    phone: '919.965.9999',
    email: 'john.smith@gmail.com',

}
*/</span></code></pre></div>
<p><code class=\"language-text\">_.assign</code> is great as a compatible stand-in for Object.assign.  But lodash provides several other variant methods for merging that give a clear unambiguous syntax for a variety of use cases.</p>
<p><code class=\"language-text\">_.assignIn</code>  is a variant of <code class=\"language-text\">_.assign</code> that adds both enumerable “own” properties and enumerable “inherited” properties from the source objects to the destination object.  This is in contrast to <code class=\"language-text\">_.assign</code> and <code class=\"language-text\">Object.assign</code> which only add enumerable “own” properties.</p>
<p>In JavaScript inheritance works through a “prototype object”.  Both through ES6’s class syntax and older function-based syntaxes for Object Oriented programming in JavaScript, objects that inherit from another object have the <em>parent</em> object defined as their “prototype”.  <code class=\"language-text\">_.assignIn</code> will pull enumerable properties off of each source’s prototype object (and its prototype object, and so on up the chain), and add them directly to the destination object.</p>
<p><code class=\"language-text\">_.assignWith</code> is another <code class=\"language-text\">_.assign</code> variant that allows lodash to handle more complicated merges. In our example above, merging our 2 contacts causes us to lose contact1’s phone number.  But in a real application that is probably not what we would want.  <code class=\"language-text\">_.assignWith</code> will allow us to preserve both phone numbers by merging them into an array.  <code class=\"language-text\">_.assignWith</code> takes the same arguments as <code class=\"language-text\">_.assign</code> but adds an optional final <code class=\"language-text\">customizer</code> argument.  <code class=\"language-text\">_.assignWith</code> expects <code class=\"language-text\">customizer</code> to be a function that takes 5 arguments: (objValue, srcValue, key, object, source). When merging values, customizer is run to determine what the destination value should be.  So our example above can become:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//merge contact2 into contact1</span>
_<span class=\"token punctuation\">.</span><span class=\"token function\">assignWith</span><span class=\"token punctuation\">(</span>contact1<span class=\"token punctuation\">,</span> contact2<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">dest<span class=\"token punctuation\">,</span> src<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">let</span> bothDefined <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isUndefined</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">isUndefined</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'phone'</span> <span class=\"token operator\">||</span> key <span class=\"token operator\">===</span> <span class=\"token string\">'email'</span> <span class=\"token operator\">&amp;&amp;</span> bothDefined<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">flatten</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>src<span class=\"token punctuation\">,</span> dest<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">isUndefined</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> dest <span class=\"token punctuation\">:</span> src<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token comment\">/*
// contact1
{
    firstName: 'John',
    lastName: 'Smith',
    phone: ['919.965.9999', '919.222.7855'],
    email: 'john.smith@gmail.com',

}
*/</span></code></pre></div>
<p>The customizer argument can be used for more things, including implementing a “safe” merge where an error is thrown on any conflict, or averaging 2 numeric values that are being merged.  There is also a <code class=\"language-text\">_.assignInWith</code> that combines <code class=\"language-text\">_.assignIn</code> and <code class=\"language-text\">_.assignWith</code>.</p>
<p><code class=\"language-text\">_.defaults</code> is another variation on <code class=\"language-text\">_.assign</code>.  <code class=\"language-text\">_.assign</code> works “left to right”, starting with the destination and then adding properties on top of that from each source in the list of arguments, with objects to the right “winning” when their are conflicts.  So we get <code class=\"language-text\">{ foo: 10</code>} in the following expression:</p>
<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">_.assign({foo: 0}, {foo: 5}, {foo: 10});</code></pre></div>
<p>Sometimes we might want to reverse that flow, with the destination object “winning” any conflicts.  This is specifically helpful if we want to fill in an existing object with the “defaults” for fields that are not defined.</p>
<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">let obj1 = {
    foo: 0
};
let obj2 = {
    foo: 5,
    bar: 10
};

_.defaults(obj1, obj2);
// {foo: 0, bar: 10}</code></pre></div>
<h3>Deep Merging</h3>
<p>All of the methods we’ve looked at so far work on the top level key-value pairs of their source and destination objects.  But sometimes we need to merge nested objects.  lodash provides 3 methods for this use case: <code class=\"language-text\">_.merge</code>, <code class=\"language-text\">_.mergeWith</code> and <code class=\"language-text\">_.defaultsDeep</code>.</p>
<p><code class=\"language-text\">_.merge</code> is similar to <code class=\"language-text\">_.assign</code>.  It takes a destination object, and multiple source objects and merges them together.  Unlike <code class=\"language-text\">_.assign</code> it is a deep merge.  So when we nest objects and arrays, we can merge like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> contact1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>
    lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Smith'</span><span class=\"token punctuation\">,</span>
    address<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>
        street<span class=\"token punctuation\">:</span> <span class=\"token string\">'1 Main St'</span><span class=\"token punctuation\">,</span>
        state<span class=\"token punctuation\">:</span> <span class=\"token string\">'NC'</span><span class=\"token punctuation\">,</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">let</span> contact2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>
    phone<span class=\"token punctuation\">:</span> <span class=\"token string\">'919.965.9999'</span><span class=\"token punctuation\">,</span>
    address<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>
        street<span class=\"token punctuation\">:</span> <span class=\"token string\">'1 Main St'</span><span class=\"token punctuation\">,</span>
        city<span class=\"token punctuation\">:</span> <span class=\"token string\">'Durham'</span><span class=\"token punctuation\">,</span>
        state<span class=\"token punctuation\">:</span> <span class=\"token string\">'North Carolina'</span><span class=\"token punctuation\">,</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

_<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>contact1<span class=\"token punctuation\">,</span> contact2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token comment\">/*
{
    firstName: 'John',
    lastName: 'Smith',
    phone: '919.965.9999',
    address: {
        street: '1 Main St',
        city: 'Durham',
        state: 'NC',
    }
}
*/</span></code></pre></div>
<p>Now that we’ve seen <code class=\"language-text\">_.merge</code>, it’s hopefully not surprising that <code class=\"language-text\">_.mergeWith</code> is similar to <code class=\"language-text\">_.assignWith</code>, with deep merging possibilities.  <code class=\"language-text\">_.mergeWith</code> has the same API as <code class=\"language-text\">_.assignWith</code>, with the only change being an extra argument, <code class=\"language-text\">stack</code>, passed to the customizer function.  <code class=\"language-text\">stack</code> is an internal lodash data structure that allows you to keep track of the traversal as you move through nested deep merges. Finally, <code class=\"language-text\">_.defaultsDeep</code> has the same API as <code class=\"language-text\">_.defaults</code> but performs a deep merge.</p>
<p>There’s one last merging function in lodash, and it is a bit of an oddball.  <code class=\"language-text\">_.mixin</code> is a legacy function from when lodash began as a fork of underscore, and it is a bit of an oddball in terms of syntax.  <code class=\"language-text\">_.mixin</code> has only one required argument, a source object.  It does not take multiple sources.  Instead, you can optionally pass a destination object as a first object, and an options object as a 3rd object.  The original intention of <code class=\"language-text\">_.mixin</code> was providing a way to extend the <code class=\"language-text\">underscore</code>/<code class=\"language-text\">lodash</code> object, and so the default destination is <code class=\"language-text\">_</code> itself.  I’ll discuss that and the options argument more when I write about chaining lodash functions, but for now the important thing to know is that the main distinction between <code class=\"language-text\">_.mixin</code> and <code class=\"language-text\">_.assign</code> when merging a single source to a single destination is that <code class=\"language-text\">_.mixin</code> will add functions from the source object onto both the destination object and its prototype.</p>
<h3>Cloning Objects</h3>
<p>Like merging, cloning objects is an important operation in many programs.  Because JavaScript objects are <a href=\"http://benmccormick.org/2016/06/04/what-are-mutable-and-immutable-data-structures-2/\">mutable</a> by default, passing them around can often be unsafe if we don’t know how they’re going to be used.  If we want to pass information to a function, but don’t want to allow it to mutate “our copy”, we can clone it.</p>
<p>After learning about lodash’s merge operations we already have everything we need to shallow clone an object using the methods above.  We can write our own shallow clone function like this:</p>
<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const shallowClone = obj =&gt; _.extend({}, obj);</code></pre></div>
<p>But lodash is all about simplifying common operations, so it provides its own <code class=\"language-text\">_.clone</code> function.  This function is a bit more powerful than our simple example above.  In addition to handling plain objects, it can also handle arrays, numbers, strings, Buffers and more.  It essentially tries to do something intelligent with anything you throw at it, though it will return empty objects for non-cloneable objects like functions and DOM nodes.</p>
<p>Simple cloning is great, but we sometimes want to do something more complicated.  Let’s consider the following order record:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> order <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
    id<span class=\"token punctuation\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span>
    productIds<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">12345</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6789</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>
    shippingAddress<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
    billingInfo<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
    total<span class=\"token punctuation\">:</span> <span class=\"token string\">'56.85'</span><span class=\"token punctuation\">,</span>
    orderDate<span class=\"token punctuation\">:</span> <span class=\"token string\">'09/21/2015'</span>
<span class=\"token punctuation\">}</span></code></pre></div>
<p>If we want to allow a client to repeat their order, we might want to clone this object to make sure we capture all of the order metadata correctly.  The problem is that there are some fields we don’t want to capture, specifically id and orderDate.  We could explicitly list the fields we want to copy, but then we’d have to update the code anytime we added a new field.</p>
<p><code class=\"language-text\">_.cloneWith</code> helps solve this problem.  Like <code class=\"language-text\">_.assignWith</code> <code class=\"language-text\">_.cloneWith</code> takes a customizer function that allows us to choose how to handle an individual key. We can either return a value to use as the cloned value, or undefined.  Returning undefined causes the method to revert to the base code.  So we can handle our clone like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">mergeFunc</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">,</span> stack</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">case</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span>
        <span class=\"token keyword\">return</span> <span class=\"token function\">generateNewId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token keyword\">case</span> <span class=\"token string\">'date'</span><span class=\"token punctuation\">:</span>
        <span class=\"token keyword\">return</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MM/DD/YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>
        <span class=\"token keyword\">return</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">let</span> newOrder <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">cloneWith</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">,</span> mergeFunc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>
<p>The final 2 clone methods lodash provides are <code class=\"language-text\">_.cloneDeep</code> and <code class=\"language-text\">_.cloneDeepWith</code>.  If you’ve been paying attention up till now, these 2 should be self explanatory.  They work the same as <code class=\"language-text\">_.clone</code> and <code class=\"language-text\">_.cloneWith</code> but also clones nested objects.</p>
<p>It may seem weird that lodash has 12 different functions for cloning and merging objects, but hopefully I’ve been able to show how that can be helpful.  Use the right tool for the job!</p>
<h3>Subscribe</h3>
<p>Thanks for taking the time to read this post!  JavaScript development is one of the main topics of this blog, so if you enjoyed the post, please consider subscribing by using the <a href=\"http://feedpress.me/benmccormick\">feed</a>, <a href=\"http://twitter.com/benmccormickorg\">Twitter</a> or my <a href=\"http://eepurl.com/WFYon\">mailing list</a>. You also might want to check out the [first post in this series][firstpost].</p>
<p>[firstpost]:</p>",
                    "author": {
                      "@type": "Person",
                      "name": "Ben McCormick"
                      "email": "mailto:ben@benmccormick.org",
                      "image": "/profile_pic.jpg",
                      "jobTitle": "Software Engineer",
                      "alumniOf": "Duke",
                      "birthPlace": "Pittsburgh, PA",
                      "gender": "male",
                      "url": "http://benmccormick.org",
                	    "sameAs" : [
                        "https://www.linkedin.com/in/benmccormick",
                        "http://twitter.com/_benmccormick",
                      ]
                   }
                }</script><link as="script" rel="preload" href="/webpack-runtime-2bd08aed7bf56a5666cd.js"/><link as="script" rel="preload" href="/framework-b9c8a743f16333774f01.js"/><link as="script" rel="preload" href="/app-697c3c7f72ea0da9d76d.js"/><link as="script" rel="preload" href="/styles-c2fe8482057191dca484.js"/><link as="script" rel="preload" href="/commons-21f4e25ecc2e24f91620.js"/><link as="script" rel="preload" href="/0f79b8bbf0fab14a39499e780028e06819c14582-f3391f4010222e7ff094.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-1b003c6fb4f366346b15.js"/><link as="fetch" rel="preload" href="/page-data/2018/09/17/lodash-wip/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="landing-page" style="background:#FCFCFC"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1f3kluc">.css-1f3kluc{width:100%;max-width:1000px;margin:0 auto;padding:2.4rem 20px;}</style><div class="css-1f3kluc em100y90"><style data-emotion-css="13vv67v">.css-13vv67v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-bottom:2rem;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-13vv67v e1b8f8ar0"><style data-emotion-css="txnzm6">.css-txnzm6{margin:0 20px 0 0;padding-bottom:0;}.css-txnzm6 a{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-txnzm6 a:hover{-webkit-text-decoration:none;text-decoration:none;}</style><h3 class="css-txnzm6 e1b8f8ar2"><a name="title" href="/">Ben McCormick</a></h3><style data-emotion-css="177tisd">.css-177tisd{color:#999999;}</style><div class="css-177tisd e1b8f8ar3"><a class="css-tcc0st" href="/archive/">Blog</a><style data-emotion-css="12jh0su">.css-12jh0su{padding:0 0.5rem;}@media all and (max-width:400px){.css-12jh0su{padding:0 0.25rem;}}</style><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="/subscribe/">Subscribe</a><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="/speaking/">Speaking</a><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="http://twitter.com/_benmccormick">Twitter</a><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="/about/">About</a></div></div><article class="markdown"><div class="post-title-area"><style data-emotion-css="92repi">.css-92repi{display:block;max-width:100%;}</style><h1 class="css-92repi e15djruj0">Lodash WIP</h1></div><div class="columns"><style data-emotion-css="qsg3oo">.css-qsg3oo{max-width:100%;}.css-qsg3oo li{padding-left:10px;}.css-qsg3oo .reading-img img{width:150px;float:right;margin:0px 10px 20px 10px;}.css-qsg3oo img.full-width{max-height:none;}.css-qsg3oo img.half-width{max-height:none;width:50%;}</style><div class="css-qsg3oo e15djruj2"><h1>Diving Into lodash - Merging and Cloning Objects</h1>
<p>When working with data, it’s common to have to merge data from multiple objects to create a new object, create a copy of an existing object, or update an existing object with properties form another object.  <a href="https://lodash.com/">lodash</a> makes these operations easy.  Let’s take a look at what it provides.</p>
<h3>Merging Objects</h3>
<p>In my last post I mentioned an example application where we want to merge 2 contact records:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> contact1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">'Smith'</span><span class="token punctuation">,</span>
    phone<span class="token punctuation">:</span> <span class="token string">'919.222.7855'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> contact2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    phone<span class="token punctuation">:</span> <span class="token string">'919.965.9999'</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token string">'john.smith@gmail.com'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>There I talked about <code class="language-text">_.assign</code> as an alternative to the native <code class="language-text">Object.assign</code>.  <code class="language-text">_.assign</code> is lodash’s most basic “merging” function.  <code class="language-text">_.assign</code>, like <code class="language-text">Object.assign</code> takes 2 or more arguments: a destination object, and 1 or more source objects. It then returns the destination object.  When there are conflicts, the rightmost object “wins”.  Using it looks like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">//merge contact2 into contact1</span>
_<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>contact1<span class="token punctuation">,</span> contact2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
// contact1
{
    firstName: 'John',
    lastName: 'Smith',
    phone: '919.965.9999',
    email: 'john.smith@gmail.com',

}
*/</span>

<span class="token comment">//merge contact1 and contact 2 into a new object</span>

<span class="token keyword">let</span> newContact <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> contact1<span class="token punctuation">,</span> contact2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
// newContact
{
    firstName: 'John',
    lastName: 'Smith',
    phone: '919.965.9999',
    email: 'john.smith@gmail.com',

}
*/</span></code></pre></div>
<p><code class="language-text">_.assign</code> is great as a compatible stand-in for Object.assign.  But lodash provides several other variant methods for merging that give a clear unambiguous syntax for a variety of use cases.</p>
<p><code class="language-text">_.assignIn</code>  is a variant of <code class="language-text">_.assign</code> that adds both enumerable “own” properties and enumerable “inherited” properties from the source objects to the destination object.  This is in contrast to <code class="language-text">_.assign</code> and <code class="language-text">Object.assign</code> which only add enumerable “own” properties.</p>
<p>In JavaScript inheritance works through a “prototype object”.  Both through ES6’s class syntax and older function-based syntaxes for Object Oriented programming in JavaScript, objects that inherit from another object have the <em>parent</em> object defined as their “prototype”.  <code class="language-text">_.assignIn</code> will pull enumerable properties off of each source’s prototype object (and its prototype object, and so on up the chain), and add them directly to the destination object.</p>
<p><code class="language-text">_.assignWith</code> is another <code class="language-text">_.assign</code> variant that allows lodash to handle more complicated merges. In our example above, merging our 2 contacts causes us to lose contact1’s phone number.  But in a real application that is probably not what we would want.  <code class="language-text">_.assignWith</code> will allow us to preserve both phone numbers by merging them into an array.  <code class="language-text">_.assignWith</code> takes the same arguments as <code class="language-text">_.assign</code> but adds an optional final <code class="language-text">customizer</code> argument.  <code class="language-text">_.assignWith</code> expects <code class="language-text">customizer</code> to be a function that takes 5 arguments: (objValue, srcValue, key, object, source). When merging values, customizer is run to determine what the destination value should be.  So our example above can become:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">//merge contact2 into contact1</span>
_<span class="token punctuation">.</span><span class="token function">assignWith</span><span class="token punctuation">(</span>contact1<span class="token punctuation">,</span> contact2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">dest<span class="token punctuation">,</span> src<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> bothDefined <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">isUndefined</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span> <span class="token operator">||</span> _<span class="token punctuation">.</span><span class="token function">isUndefined</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'phone'</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">'email'</span> <span class="token operator">&amp;&amp;</span> bothDefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">[</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">isUndefined</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token operator">?</span> dest <span class="token punctuation">:</span> src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
// contact1
{
    firstName: 'John',
    lastName: 'Smith',
    phone: ['919.965.9999', '919.222.7855'],
    email: 'john.smith@gmail.com',

}
*/</span></code></pre></div>
<p>The customizer argument can be used for more things, including implementing a “safe” merge where an error is thrown on any conflict, or averaging 2 numeric values that are being merged.  There is also a <code class="language-text">_.assignInWith</code> that combines <code class="language-text">_.assignIn</code> and <code class="language-text">_.assignWith</code>.</p>
<p><code class="language-text">_.defaults</code> is another variation on <code class="language-text">_.assign</code>.  <code class="language-text">_.assign</code> works “left to right”, starting with the destination and then adding properties on top of that from each source in the list of arguments, with objects to the right “winning” when their are conflicts.  So we get <code class="language-text">{ foo: 10</code>} in the following expression:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">_.assign({foo: 0}, {foo: 5}, {foo: 10});</code></pre></div>
<p>Sometimes we might want to reverse that flow, with the destination object “winning” any conflicts.  This is specifically helpful if we want to fill in an existing object with the “defaults” for fields that are not defined.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">let obj1 = {
    foo: 0
};
let obj2 = {
    foo: 5,
    bar: 10
};

_.defaults(obj1, obj2);
// {foo: 0, bar: 10}</code></pre></div>
<h3>Deep Merging</h3>
<p>All of the methods we’ve looked at so far work on the top level key-value pairs of their source and destination objects.  But sometimes we need to merge nested objects.  lodash provides 3 methods for this use case: <code class="language-text">_.merge</code>, <code class="language-text">_.mergeWith</code> and <code class="language-text">_.defaultsDeep</code>.</p>
<p><code class="language-text">_.merge</code> is similar to <code class="language-text">_.assign</code>.  It takes a destination object, and multiple source objects and merges them together.  Unlike <code class="language-text">_.assign</code> it is a deep merge.  So when we nest objects and arrays, we can merge like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> contact1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">'Smith'</span><span class="token punctuation">,</span>
    address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        street<span class="token punctuation">:</span> <span class="token string">'1 Main St'</span><span class="token punctuation">,</span>
        state<span class="token punctuation">:</span> <span class="token string">'NC'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> contact2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    phone<span class="token punctuation">:</span> <span class="token string">'919.965.9999'</span><span class="token punctuation">,</span>
    address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        street<span class="token punctuation">:</span> <span class="token string">'1 Main St'</span><span class="token punctuation">,</span>
        city<span class="token punctuation">:</span> <span class="token string">'Durham'</span><span class="token punctuation">,</span>
        state<span class="token punctuation">:</span> <span class="token string">'North Carolina'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

_<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>contact1<span class="token punctuation">,</span> contact2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
{
    firstName: 'John',
    lastName: 'Smith',
    phone: '919.965.9999',
    address: {
        street: '1 Main St',
        city: 'Durham',
        state: 'NC',
    }
}
*/</span></code></pre></div>
<p>Now that we’ve seen <code class="language-text">_.merge</code>, it’s hopefully not surprising that <code class="language-text">_.mergeWith</code> is similar to <code class="language-text">_.assignWith</code>, with deep merging possibilities.  <code class="language-text">_.mergeWith</code> has the same API as <code class="language-text">_.assignWith</code>, with the only change being an extra argument, <code class="language-text">stack</code>, passed to the customizer function.  <code class="language-text">stack</code> is an internal lodash data structure that allows you to keep track of the traversal as you move through nested deep merges. Finally, <code class="language-text">_.defaultsDeep</code> has the same API as <code class="language-text">_.defaults</code> but performs a deep merge.</p>
<p>There’s one last merging function in lodash, and it is a bit of an oddball.  <code class="language-text">_.mixin</code> is a legacy function from when lodash began as a fork of underscore, and it is a bit of an oddball in terms of syntax.  <code class="language-text">_.mixin</code> has only one required argument, a source object.  It does not take multiple sources.  Instead, you can optionally pass a destination object as a first object, and an options object as a 3rd object.  The original intention of <code class="language-text">_.mixin</code> was providing a way to extend the <code class="language-text">underscore</code>/<code class="language-text">lodash</code> object, and so the default destination is <code class="language-text">_</code> itself.  I’ll discuss that and the options argument more when I write about chaining lodash functions, but for now the important thing to know is that the main distinction between <code class="language-text">_.mixin</code> and <code class="language-text">_.assign</code> when merging a single source to a single destination is that <code class="language-text">_.mixin</code> will add functions from the source object onto both the destination object and its prototype.</p>
<h3>Cloning Objects</h3>
<p>Like merging, cloning objects is an important operation in many programs.  Because JavaScript objects are <a href="http://benmccormick.org/2016/06/04/what-are-mutable-and-immutable-data-structures-2/">mutable</a> by default, passing them around can often be unsafe if we don’t know how they’re going to be used.  If we want to pass information to a function, but don’t want to allow it to mutate “our copy”, we can clone it.</p>
<p>After learning about lodash’s merge operations we already have everything we need to shallow clone an object using the methods above.  We can write our own shallow clone function like this:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const shallowClone = obj =&gt; _.extend({}, obj);</code></pre></div>
<p>But lodash is all about simplifying common operations, so it provides its own <code class="language-text">_.clone</code> function.  This function is a bit more powerful than our simple example above.  In addition to handling plain objects, it can also handle arrays, numbers, strings, Buffers and more.  It essentially tries to do something intelligent with anything you throw at it, though it will return empty objects for non-cloneable objects like functions and DOM nodes.</p>
<p>Simple cloning is great, but we sometimes want to do something more complicated.  Let’s consider the following order record:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
    productIds<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">12345</span><span class="token punctuation">,</span> <span class="token number">6789</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    shippingAddress<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    billingInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    total<span class="token punctuation">:</span> <span class="token string">'56.85'</span><span class="token punctuation">,</span>
    orderDate<span class="token punctuation">:</span> <span class="token string">'09/21/2015'</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If we want to allow a client to repeat their order, we might want to clone this object to make sure we capture all of the order metadata correctly.  The problem is that there are some fields we don’t want to capture, specifically id and orderDate.  We could explicitly list the fields we want to copy, but then we’d have to update the code anytime we added a new field.</p>
<p><code class="language-text">_.cloneWith</code> helps solve this problem.  Like <code class="language-text">_.assignWith</code> <code class="language-text">_.cloneWith</code> takes a customizer function that allows us to choose how to handle an individual key. We can either return a value to use as the cloned value, or undefined.  Returning undefined causes the method to revert to the base code.  So we can handle our clone like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">mergeFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> object<span class="token punctuation">,</span> stack</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'id'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token function">generateNewId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'date'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'MM/DD/YYYY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> newOrder <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneWith</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> mergeFunc<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The final 2 clone methods lodash provides are <code class="language-text">_.cloneDeep</code> and <code class="language-text">_.cloneDeepWith</code>.  If you’ve been paying attention up till now, these 2 should be self explanatory.  They work the same as <code class="language-text">_.clone</code> and <code class="language-text">_.cloneWith</code> but also clones nested objects.</p>
<p>It may seem weird that lodash has 12 different functions for cloning and merging objects, but hopefully I’ve been able to show how that can be helpful.  Use the right tool for the job!</p>
<h3>Subscribe</h3>
<p>Thanks for taking the time to read this post!  JavaScript development is one of the main topics of this blog, so if you enjoyed the post, please consider subscribing by using the <a href="http://feedpress.me/benmccormick">feed</a>, <a href="http://twitter.com/benmccormickorg">Twitter</a> or my <a href="http://eepurl.com/WFYon">mailing list</a>. You also might want to check out the [first post in this series][firstpost].</p>
<p>[firstpost]:</p></div><style data-emotion-css="rd3zyi">.css-rd3zyi{padding-left:2rem;overflow:hidden;}</style><div class="no-mobile css-rd3zyi e15djruj3"><style data-emotion-css="1y23a7j">.css-1y23a7j{overflow:hidden;margin:0;}.css-1y23a7j #mc_embed_signup form{margin-bottom:20px;}@media all and (max-width:700px){.css-1y23a7j{padding-right:0;width:100% !important;padding:0 10px;}.css-1y23a7j .mc-field-group{width:100% !important;}.css-1y23a7j .mc-field-group input{width:100% !important;font-size:0.8em;height:2.4em;}}</style><div class="css-1y23a7j e1qbom70"><form action="https://buttondown.email/api/emails/embed-subscribe/benmccormick" method="post" target="popupwindow" class="embeddable-buttondown-form"><label for="bd-email" id="bd-label">Subscribe to the Newsletter</label><input type="hidden" value="1" name="embed"/><div class="bd-subscribe-row"><input type="email" name="email" id="bd-email" placeholder="Your Email"/><input type="submit" value="Subscribe" id="bd-submit"/></div></form></div><style data-emotion-css="wtijjp">.css-wtijjp{width:100%;overflow:hidden;margin:0 0 1rem 0;font-size:14px;position:relative;font-family:"mr-eaves-xl-modern","Helvetica Neue",Arial,sans-serif;background:rgba(99,159,110,0.25);border:1px solid rgba(90,150,100,0.5);padding:4px;min-height:100px;opacity:0;-webkit-transition:opacity ease 3s;transition:opacity ease 3s;}@media all and (max-width:700px){.css-wtijjp{display:none;}}</style><div class="css-wtijjp etmlefq0"></div><style data-emotion-css="1ui09x8">.css-1ui09x8{font-size:14px;background-color:RGBA(191,237,253,0.5);border:1px solid #68d4fa;padding:0.5rem;}.css-1ui09x8 > h4{font-size:20px;margin-bottom:6px;}.css-1ui09x8 > h6{font-size:18px;margin-bottom:6px;margin-top:12px;}</style><div class="css-1ui09x8 e15djruj1"><h4>Article Info</h4><h6>Author</h6><a href="/about">Ben McCormick</a><h6>Publish Date</h6>September 17th 2018<h6>Category</h6><a class="css-b0r4rv" href="/category/software-productivity"><style data-emotion-css="e7v39i">.css-e7v39i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;margin-right:0.1rem;}@media all and (max-width:960px){.css-e7v39i{margin-right:0;}}</style><div class="css-e7v39i e1nsgn8x1"><style data-emotion-css="1l0yf4i">.css-1l0yf4i{display:block;width:0.8rem;height:0.8rem;margin-right:0.5rem;}.css-1l0yf4i *{fill:rgba(256,256,256,1);}.css-1l0yf4i > i{height:0.16000000000000003rem;}</style><span color="rgba(256,256,256,1)" class="css-1l0yf4i efpzdjd0"><i><svg viewBox="0 0 15 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>project</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="project" fill="#000000"><path d="M10,12 L13,12 L13,2 L10,2 L10,12 L10,12 Z M6,10 L9,10 L9,2 L6,2 L6,10 L6,10 Z M2,14 L5,14 L5,2 L2,2 L2,14 L2,14 Z M1,15 L14,15 L14,1 L1,1 L1,15 L1,15 Z M14,0 L1,0 C0.448,0 0,0.448 0,1 L0,15 C0,15.552 0.448,16 1,16 L14,16 C14.552,16 15,15.552 15,15 L15,1 C15,0.448 14.552,0 14,0 L14,0 L14,0 Z" id="Shape"></path></g></g></svg></i></span></div><style data-emotion-css="1bs7qd7">.css-1bs7qd7:hover{-webkit-text-decoration:none;text-decoration:none;}</style><div class="css-1bs7qd7 e1nsgn8x0">Software Productivity</div></a></div></div></div></article></div><style data-emotion-css="1tfasoy">.css-1tfasoy{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:3em 0 1em 0;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:RGBA(191,237,253,0.5);border-top:1px solid #68d4fa;}</style><div class="css-1tfasoy e7oz9l30"><style data-emotion-css="7bdmpt">.css-7bdmpt{width:100%;min-height:200px;max-width:960px;margin:0 auto;padding:0 1.2rem;display:grid;grid-template-columns:45% 45%;grid-column-gap:10%;grid-row-gap:30px;}@media all and (max-width:450px){.css-7bdmpt{grid-template-columns:100%;}}</style><div class="css-7bdmpt e7oz9l31"><div><h2 class="css-0 e7oz9l33">Content</h2><style data-emotion-css="1xfqzqa">.css-1xfqzqa{display:grid;grid-template-columns:1fr;grid-auto-rows:1fr;grid-row-gap:20px;}</style><div class="css-1xfqzqa e7oz9l32"><a class="css-1gs5qio" href="/archive/">Blog Archive</a><a class="css-1gs5qio" href="/reviews-archive/">Book Reviews</a><a class="css-1gs5qio" href="https://buttondown.email/benmccormick">Newsletter Archives</a><a class="css-1gs5qio" href="/speaking/">Speaking</a></div></div><div><h2 class="css-0 e7oz9l33">Meta</h2><div class="css-1xfqzqa e7oz9l32"><a class="css-1gs5qio" href="/subscribe/">Subscribe To The Newsletter</a><a class="css-1gs5qio" href="/built-with/">Built With</a><a class="css-1gs5qio" href="http://twitter.com/_benmccormick">Personal Twitter</a><a class="css-1gs5qio" href="http://twitter.com/benmccormickorg">Blog Twitter</a><a class="css-1gs5qio" href="/about/">About Me</a></div></div><style data-emotion-css="i3iawv">.css-i3iawv{font-family:"mr-eaves-xl-modern","Helvetica Neue",Arial,sans-serif;font-size:14px;overflow:visible;white-space:nowrap;}</style><div class="css-i3iawv e7oz9l34">Copyright © 2012-2019 · Ben McCormick</div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script>
          (function(d) {
            var config = {
              kitId: 'msd6bqv',
              scriptTimeout: 300,
              async: true
            },
            h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/wf-loading/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
          })(document);
        </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2018/09/17/lodash-wip/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-300fa9a4ae17d88dc319.js"],"app":["/app-697c3c7f72ea0da9d76d.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-88fe3adecdf1a0d66674.js"],"component---src-pages-index-js":["/component---src-pages-index-js-436b19848b0d2d669b8b.js"],"component---src-pages-links-archive-js":["/component---src-pages-links-archive-js-926f4ebdf6b269c92862.js"],"component---src-pages-lions-archive-js":["/component---src-pages-lions-archive-js-9f8b57f681f05b3b54a4.js"],"component---src-pages-reviews-archive-js":["/component---src-pages-reviews-archive-js-fbe69f5b992bdd7d60fd.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-1b003c6fb4f366346b15.js"],"component---src-templates-category-page-js":["/component---src-templates-category-page-js-648946968191d9aa2002.js"],"component---src-templates-topic-page-js":["/component---src-templates-topic-page-js-63e70d2f176c96313fe6.js"]};/*]]>*/</script><script src="/polyfill-300fa9a4ae17d88dc319.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-1b003c6fb4f366346b15.js" async=""></script><script src="/0f79b8bbf0fab14a39499e780028e06819c14582-f3391f4010222e7ff094.js" async=""></script><script src="/commons-21f4e25ecc2e24f91620.js" async=""></script><script src="/styles-c2fe8482057191dca484.js" async=""></script><script src="/app-697c3c7f72ea0da9d76d.js" async=""></script><script src="/framework-b9c8a743f16333774f01.js" async=""></script><script src="/webpack-runtime-2bd08aed7bf56a5666cd.js" async=""></script></body></html>