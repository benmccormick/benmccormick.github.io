<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#rgb(42, 194, 240)"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'minion-3','Garamond',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'minion-3','Garamond',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:'mr-eaves-xl-modern',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.2rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.2rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:14px;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style data-href="/component---src-templates-blog-post-js.d5c164db07d2a4f14ec9.css">.markdown pre{display:block;background:#343d46;color:#d8dee9;padding:.8rem}.markdown pre code:after{content:unset}.token.comment,.token.quote{color:#a7adba}.token.addition,.token.attr,.token.selector-tag,.token.string{color:#99c794}.token.doctag,.token.meta .token.meta-string,.token.regexp{color:#89ddf3}.token.built_in,.token.function{color:#5fb3b3}.token.name,.token.section,.token.selector-class,.token.selector-id,.token.title{color:#69c}.token.attribute,.token.class .token.title,.token.template-variable,.token.type,.token.variable{color:#fac863}.token.bullet,.token.link,.token.meta,.token.meta .token.keyword,.token.selector-attr,.token.selector-pseudo,.token.subst,.token.symbol{color:#f9ae58}.token.boolean,.token.deletion,.token.literal,.token.number{color:#f07178}.token.keyword{color:#c594c5}.token.formula{background:#a7adba}.token.emphasis{font-style:italic}.token.strong{font-weight:700}.gatsby-resp-image-wrapper{max-width:75%;display:block;margin:40px auto 20px}.bordered-img{border:3px solid #rgb(42,194,240)}.img-group{display:flex;justify-content:space-between}.img-group img{padding:0;height:auto}.inline-img{width:45%;display:inline-block;float:right;padding:2rem}#bd-label{font-family:mr-eaves-xl-modern,Helvetica Neue,Arial,sans-serif;font-weight:700}#bd-label.large-label{font-size:20px}#bd-email{padding-left:5px}#bd-email,#bd-submit{font-family:mr-eaves-xl-modern,Helvetica Neue,Arial,sans-serif;font-size:14px}#bd-submit{background:#f1684e;color:#fff;border-radius:4px;border:none}@media (max-width:960px){#bd-email,#bd-submit{font-size:10px}#bd-label{font-size:12px}}.large-row #bd-email,.large-row #bd-submit{font-size:30px}@media (max-width:700px){.large-row #bd-email,.large-row #bd-submit{font-size:18px}}.bd-subscribe-form{margin:30px 0 50px;display:block}.bd-subscribe-row{display:grid;grid-template-columns:60% 35%;grid-column-gap:5%;grid-template-rows:1fr;margin-top:10px}@media (max-width:960px){.bd-subscribe-row{grid-template-columns:1fr;grid-row-gap:10%;grid-template-rows:1fr 1fr}}.twitter-tweet,twitterwidget{margin-left:auto;margin-right:auto}.sidebar-group{display:flex;flex-direction:row;justify-content:flex-start;align-items:center;padding:8px 0}.sidebar{padding-left:2rem}.subscribe-container{display:flex;justify-content:flex-end;flex-wrap:wrap}.subscribe-email{padding:0 .1rem;margin:0 .2rem 0 0;font-size:.7rem;height:1.5rem;width:6rem}.subscribe-button{color:#fff;background:#rgb(42,194,240);border-radius:4px;font-size:1rem;line-height:1rem;height:1.5rem;width:1.5rem;max-width:2rem;flex-grow:0;border:0;margin:0;cursor:pointer}.rss{padding-bottom:10px}.rss a{display:flex}.rss-icon{display:block;width:17px;margin-right:.5em;height:50px}.rss-icon *{fill:#f1684e}.twitter-item{display:flex;align-items:center;margin-bottom:15px}.twitter-item iframe{margin:0 0 0 10px}</style><style data-href="/0.fff3f37ab39dd41df440.css">a{color:#f1684e;text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}.footnote-backref,.footnote-ref{text-decoration:none;padding-left:3px}blockquote{border-left:5px solid #2ac2f0;background:#eee;font-weight:400;font-size:.9rem;padding:1.5rem 2rem;margin:0 0 1rem}blockquote p{margin-bottom:.667em}h3{color:#2ac2f0}h4{font-size:110%}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnotes{font-size:80%}.footnotes li>*{display:inline;margin-bottom:0}strong{color:#639f6e}em{color:#9a74aa}.markdown iframe{margin:0 auto}.carbon-wrap{display:grid;grid-template-columns:1fr 1fr;grid-column-gap:10px;grid-template-rows:1fr;margin-bottom:30px;align-items:center;padding-left:5px}@media (max-width:960px){.carbon-wrap{grid-template-columns:1fr;grid-template-rows:110px 1fr;grid-row-gap:10px;justify-items:center}}.carbon-wrap img{margin-bottom:0}.carbon-text{padding:5px 5px 5px 0;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:#999;position:absolute;right:5px;bottom:0}.columns{display:grid;grid-template-columns:665px 270px;grid-template-rows:1fr;grid-column-gap:25px}@media (max-width:960px){.columns{display:grid;grid-template-columns:70% 28%;grid-column-gap:2%}}@media (max-width:700px){.columns{display:flex;flex-direction:column;align-items:center}.no-mobile{display:none}}@media (max-width:321px){html{font-size:100%!important}}</style><meta name="generator" content="Gatsby 2.0.75"/><style id="glamor-styles">.css-tcc0st,[data-css-tcc0st]{color:#999999;font-size:16px;font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;}.css-tcc0st:hover,[data-css-tcc0st]:hover{color:#F1684E;}.css-1gs5qio,[data-css-1gs5qio]{font-size:16px;font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;}.css-117pqo3,[data-css-117pqo3]{font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;font-size:120%;margin:0 1px 0.8rem 1px;color:initial;background:#FFFFFF;transition:all 0.5s ease;display:grid;grid-template-columns:67% 28%;grid-column-gap:5%;grid-template-rows:5rem 1fr;box-shadow:0 1px 2px 0 rgba(43, 59, 93, 0.29);padding:0 0.5rem 0.5rem 0.5rem;-webkit-transition:all 0.5s ease;-moz-transition:all 0.5s ease;-ms-grid-template-columns:67% 28%;-ms-grid-column-gap:5%;-ms-grid-template-rows:5rem 1fr;}.css-117pqo3:hover,[data-css-117pqo3]:hover{text-decoration:none;box-shadow:0 10px 30px 0 rgba(0, 0, 0, 0.29);}@media all and (max-width: 700px){.css-117pqo3,[data-css-117pqo3]{grid-template-columns:100%;grid-template-rows:auto auto auto auto;grid-row-gap:0.5rem;padding:0.5rem;margin-bottom:2rem;-ms-grid-template-columns:100%;-ms-grid-template-rows:auto auto auto auto;-ms-grid-row-gap:0.5rem;}}.css-1os3d5z,[data-css-1os3d5z]{font-family:"mr-eaves-xl-modern", "Helvetica Neue", Arial, sans-serif;font-size:0.75rem;background:rgb(42, 194, 240);color:#333;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;flex-direction:row;justify-content:flex-start;align-items:center;border-radius:0.25rem;padding:0.125rem 0.35rem;width:12rem;height:2rem;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-pack:start;-webkit-justify-content:flex-start;-webkit-box-align:center;-webkit-align-items:center;}.css-1os3d5z:hover,[data-css-1os3d5z]:hover{text-decoration:none;}@media all and (max-width: 960px){.css-1os3d5z,[data-css-1os3d5z]{height:1.6rem;width:7rem;font-size:0.55rem;}}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["tcc0st","1gs5qio","117pqo3","1os3d5z"]
        // ]]>
        </script><title data-react-helmet="true">A Codemod Survival Guide | benmccormick.org</title><meta data-react-helmet="true" name="description" content="Ben McCormick&#x27;s blog on JavaScript and Web Development"/><meta data-react-helmet="true" name="keywords" content="jscodeshift, javascript"/><script data-react-helmet="true" type="application/ld+json">{
                  "@context": "http://schema.org"
                  "@type": "BlogPosting",
                  "headline": "A Codemod Survival Guide",
                  "genre": "Software Development",
                  "keywords": "jscodeshift, javascript",
                  "url": "http://benmccormick.org//2018/06/18/codemod-survival/",
                  "image": "http://benmccormick.org/logo.png",
                  "datePublished": "2018-06-18",
                  
                  "articleBody": "<p>Do you like making repetitive syntax updates across many files?  Enjoy the thrill of painstakingly combing through 1000 line diffs that all look the same to see if you made any typos?  Relish that feeling of doubt in the back of your head as you wonder whether you actually caught all instances of the syntax you needed to update when you switched to the next major version of a library?  If so, you should probably stop reading now, because you won’t like codemods at all.  For the rest of us, codemods are a tool for assisting in large refactoring; they save you time and reduce typos.</p>
<p>Codemods originated at Facebook, first with a tool named <a href=\"https://github.com/facebook/codemod\">codemod</a> that served as a helper for regex or python based refactoring, allowing you to make iterative changes with pretty diffs, then with <a href=\"https://github.com/facebook/jscodeshift\">jscodeshift</a> a tool for doing more advanced JavaScript refactors that work directly against a data model representation of the code, rather than relying on regex or direct programmatic changes to text.  jscodeshift is extremely powerful, but I found it intimidating to approach.  Once I took the plunge though, it wasn’t that hard to start writing codemods.  So here are a few quick tips for anyone else who might be interested.</p>
<h4>1. Start with a goal in mind</h4>
<p>It’s always helpful to dive into a new technology by trying to solve a concrete problem.  That’s especially useful for codemods, because the ideas behind them can seem abstract and poorly documented until you begin focusing on a specific issue.  In my case I was originally motivated to look at codemods when updating an application from using MobX version 3 to MobX version 5.  In MobX3, when you write code without using decorators, a typical model class will look something like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extendObservable<span class=\"token punctuation\">,</span> computed<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Example</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
            foo<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
            bar<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
            currentData<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
            otherData<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
            setFoo<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">,</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
            setBar<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">,</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>

        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token function\">unrelatedMethod</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> key<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>I was updating an app with dozens of these model classes.  Unfortunately, in Mobx5, the syntax for these classes has changed, and it now needs to be rewritten like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extendObservable<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Example</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
            foo<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
            bar<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
            <span class=\"token keyword\">get</span> <span class=\"token function\">currentData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
            <span class=\"token keyword\">get</span> <span class=\"token function\">otherData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">return</span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
            setFoo<span class=\"token punctuation\">:</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
            setBar<span class=\"token punctuation\">:</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>

        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
            setFoo<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
            setBar<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">)</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token function\">unrelatedMethod</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> key<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>Computeds must be shifted to gets, action functions have to be pulled out of their wrapper function calls, but the wrapper and action names have to be moved down to a new second object.  This is really finicky to do by hand or with a text editor macro, because it’s a lot more complicated than just find and replace.  I’d usually be converting from arrow functions that might or might not have blocks and return statements currently, and I’d have to move the actions down to the new object correctly even though some of the models had 10+ action functions.   Facing several hours worth of finicky manual or script assisted refactoring work was enough to convince me it was time to learn about codemods.</p>
<h4>2. Create a small example and learn about its AST</h4>
<p>My first productive step towards creating a Mobx3to5 codemod for my codebase was creating the example code above.  I iterated on it a bit as I found new things I cared about; I didn’t realize at first that computeds needed to be changed as well as actions, and I eventually realized I needed to handle 2 types of arrow function syntax. But the initial version I wrote got me going.  Having a stripped down example of the code I cared about without the baggage of my real codebase was valuable, and being able to update it to include all the cases I cared about during testing was even better.</p>
<p>Once I created the example, I was able to understand better what I was trying to do by examining its AST.  An AST (Abstract Syntax Tree) is a representation of a JavaScript file’s source code as a tree data structure.  For instance here’s a portion of the AST for a basic Hello World program:</p>
<div class=\"gatsby-highlight\" data-language=\"json\">
      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>
  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Program\"</span><span class=\"token punctuation\">,</span>
  <span class=\"token property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">,</span>
  <span class=\"token property\">\"body\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>
    <span class=\"token punctuation\">{</span>
      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ExpressionStatement\"</span><span class=\"token punctuation\">,</span>
      <span class=\"token property\">\"expression\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CallExpression\"</span><span class=\"token punctuation\">,</span>
        <span class=\"token property\">\"callee\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MemberExpression\"</span><span class=\"token punctuation\">,</span>
          <span class=\"token property\">\"object\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"console\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span>
          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
          <span class=\"token property\">\"property\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"log\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span>
          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
          <span class=\"token property\">\"computed\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
          <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MemberExpression\"</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
        <span class=\"token property\">\"arguments\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>
          <span class=\"token punctuation\">{</span>
            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Literal\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"rawValue\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"raw\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"'Hello World'\"</span><span class=\"token punctuation\">,</span>
            <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Literal\"</span>
          <span class=\"token punctuation\">}</span>
        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>
        <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CallExpression\"</span>
      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
      <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ExpressionStatement\"</span>
    <span class=\"token punctuation\">}</span>
  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>This is a simplified example that looks only at the semantic structure of the syntax.  The full version also contains information about the indenting and exact text of the code, and comes out to about 600 lines when represented as formatted JSON.   All of this from <code class=\"language-text\">console.log(&#39;Hello World&#39;);</code>.  Fortunately there’s a nice tool for exploring ASTs.</p>
<p><a href=\"http://astexplorer.net/\">AST Explorer</a> is a site that lets you enter some JavaScript code, and then visualize the AST that represents the code.  When I put my example code above, in, I was able to see that the computed expressions in my original code showed as a <code class=\"language-text\">CallExpression</code> with an <code class=\"language-text\">ArrowFunctionExpression</code> as an argument.</p>
<p><a
    class=\"gatsby-resp-image-link\"
    href=\"/static/566c7da27d68ddf6d09c7859481c3a91/d5dfd/computed-ast.png\"
    style=\"display: block\"
    target=\"_blank\"
    rel=\"noopener\"
  >
    <span
    class=\"gatsby-resp-image-wrapper\"
    style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\"
  >
    <span
      class=\"gatsby-resp-image-background-image\"
      style=\"padding-bottom: 52.06143896523848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABj0lEQVQoz32Sy47TMBRA8/8LVkjzFbBgx0gsGXXJBhhVQ1HiOG/bafNumh5uMpkhI0EtXdm6j+P78ipb47KaIBwwbqKqoWpg6CdUoPn6sONx/4Tv+0RRhFKKOI4JgoBIh6hQobXGWkue53h931KdDL+e9kRhyNClXKeK+XT9gHUOI85FUSwyBxljyBKBaZ+fSqOShNJZnPh6bRNJ6A/S6Bvq93dC/4HSHmiamrqqlp9nx7dSYouEQCsOiSUpZt1x8fXaVupjosgNaWIo8yN9PdK0Z2bbC3C+X8WdcMWBTH9AxV8wxT0ntxPbnGHbLuWdh4G+6xiGnulyWXSzbZvh8l6BR7enjN+h4ztO5j2N+yj2Eq+ua+lhJX1xtN3I9vwfeMQZnyL5RJzek+WfpU27tYcSNF0mye7MZZq4Xq+L/Av4Cl1vX4UEUSZly9CMfCKD8cbxbVa3gH8zlMmbXCBm0T1P+Lm/3nkFbkE3gesdRDFa1mVeo5dVWkoeN8BtlreAxhr2QYwSaJKmi+Syo7PtD7qx9vy8Vq9QAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"
    ></span>
    <img
        class=\"gatsby-resp-image-image\"
        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"
        alt=\"AST explorer screenshot showing the CallExpression syntax\"
        title=\"\"
        src=\"/static/566c7da27d68ddf6d09c7859481c3a91/d766e/computed-ast.png\"
        srcset=\"/static/566c7da27d68ddf6d09c7859481c3a91/a6b6e/computed-ast.png 143w,
/static/566c7da27d68ddf6d09c7859481c3a91/8e488/computed-ast.png 285w,
/static/566c7da27d68ddf6d09c7859481c3a91/d766e/computed-ast.png 570w,
/static/566c7da27d68ddf6d09c7859481c3a91/13239/computed-ast.png 855w,
/static/566c7da27d68ddf6d09c7859481c3a91/cab6d/computed-ast.png 1140w,
/static/566c7da27d68ddf6d09c7859481c3a91/d5dfd/computed-ast.png 1237w\"
        sizes=\"(max-width: 570px) 100vw, 570px\"
      />
  </span>
  </a></p>
<p>When I put the result code I wanted in, I could see that I would need to switch the property that contained the callexpression to have a type <code class=\"language-text\">get</code> and would need to replace the call expression with a function expression.</p>
<h4>3. Start with a small edit</h4>
<p>As a starting point, I decided I wanted to write a script that could find MobX classes and just add the second object argument to extendObservable, with a dummy property.  So this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
    foo<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
    bar<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
    currentData<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
    otherData<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
    setFoo<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">,</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
    setBar<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">,</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>

<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>
      </div>
<p>would become this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
    foo<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
    bar<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>
    currentData<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
    otherData<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
    setFoo<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">,</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
    setBar<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">,</span> val <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>

<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> foo<span class=\"token punctuation\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>
      </div>
<p>To do this, I took an existing script that I found in <a href=\"https://github.com/jhgg/js-transforms\">this repo of small codemod examples</a> and modified it to lookup <code class=\"language-text\">extendObservable</code> calls and add a second argument.  I filtered it to only include calls with 2 arguments, in case I ran the code a second time<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> api<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span>jscodeshift<span class=\"token punctuation\">;</span>

    <span class=\"token keyword\">return</span> <span class=\"token function\">j</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">)</span>
        <span class=\"token comment\">// We're looking for a CallExpression for extend observable</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>CallExpression<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
            callee<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>
                name<span class=\"token punctuation\">:</span> <span class=\"token string\">'extendObservable'</span>
            <span class=\"token punctuation\">}</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>
        <span class=\"token comment\">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">\"ObjectExpression\"</span><span class=\"token punctuation\">)</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
            <span class=\"token comment\">// Now we want to</span>
            <span class=\"token comment\">// 1. Add a 3rd argument object</span>
            <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>
            args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">objectExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">property</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init'</span><span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">identifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">literal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
            <span class=\"token comment\">// TODO: 2. Move action declarations to that argument</span>
            <span class=\"token comment\">// TODO: 3. Convert action statements to plain functions</span>
            <span class=\"token comment\">// TODO: 4. Convert computeds to get statements</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">toSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>
      </div>
<p>This is a working script to achieve my simple goal.  To break it down:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">j</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>CallExpression<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
            callee<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>
                name<span class=\"token punctuation\">:</span> <span class=\"token string\">'extendObservable'</span>
            <span class=\"token punctuation\">}</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>
      </div>
<p>jscodeshift provides a jQuery style api for traversing a tree.  Here we’re looking for <code class=\"language-text\">CallExpression</code>s that have the name <code class=\"language-text\">extendObservable</code>.  We now have a collection of these expressions, and we can filter it down to only the expressions that have 2 arguments.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">\"ObjectExpression\"</span><span class=\"token punctuation\">)</span></code></pre>
      </div>
<p>Next we want to go through each callExpression and transform it.  In this case by finding it’s arguments list and pushing a new one, using the jsCodeshift API to simply generate the AST objects neededed to represent <code class=\"language-text\">{foo: bar}</code>.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
            <span class=\"token comment\">// Now we want to</span>
            <span class=\"token comment\">// 1. Add a 3rd argument object</span>
            <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>
            args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">objectExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">property</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init'</span><span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">identifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">literal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
            <span class=\"token comment\">// TODO: 2. Move action declarations to that argument</span>
            <span class=\"token comment\">// TODO: 3. Convert action statements to plain functions</span>
            <span class=\"token comment\">// TODO: 4. Convert computeds to get statements</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>
      </div>
<p>Finally, we call <code class=\"language-text\">.toSource()</code> to write the tranformed AST back to the file.</p>
<h4>4. Test your edit</h4>
<p>Because this type of coding lends itself to experimentation, it’s important to develop a good feedback loop while working on your codemod.  If you have a simple example you’re off to a good start.  The next step is to find a good way to run your script and see the output.  Simply running your test is a bit frustrating, because jscodeshift is destructive.  It overwrites your file in place, and doesn’t save a copy.  You can get around this though by adding <code class=\"language-text\">--dry --print</code> flags to your command line call</p>
<p><code class=\"language-text\">jscodeshift -t my-codemod.js example.js</code></p>
<p>will run the transform defined in <code class=\"language-text\">my-codemod.js</code> against <code class=\"language-text\">example.js</code> and modify it in place.</p>
<p><code class=\"language-text\">jscodeshift --dry --print -t my-codemod.js example.js</code></p>
<p>will print the transformed file to the console and not update example.js.</p>
<p>For simple codemods and small example files, this is a nice way to iterate quickly.  For more extensive codemods with multiple test cases, I’m excited to try out jscodeshift’s Jest support<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.  It has helper methods for working with transforms, and a workflow of Jest watch checking the output of several inputs against several expected outputs would be lovely.</p>
<h4>5. Iterate</h4>
<p>After I got that first edit working, it was simply a matter of working through my list.  I needed to remove the experimental <code class=\"language-text\">foo:bar</code> and then</p>
<ol>
<li>Move action declarations to the new argument object</li>
<li>Convert action declarations to plain functions in the existing object</li>
<li>Convert computeds to get statements</li>
</ol>
<p>I was able to take those one at a time, and my final script looked something like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> api<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span>jscodeshift<span class=\"token punctuation\">;</span>

    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">buildDecoratorPropertiesFromCurrentObject</span> <span class=\"token operator\">=</span> currentObj <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>

        <span class=\"token keyword\">let</span> decoratorProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
        currentObj<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>prop <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CallExpression'</span> <span class=\"token operator\">&amp;&amp;</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'computed'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
                prop<span class=\"token punctuation\">.</span>kind <span class=\"token operator\">=</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">;</span>
                <span class=\"token keyword\">let</span> fnBody <span class=\"token operator\">=</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fnBody<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowFunctionExpression'</span> <span class=\"token operator\">&amp;&amp;</span> fnBody<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>type <span class=\"token operator\">!==</span> <span class=\"token string\">'BlockStatement'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
                    prop<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">functionExpression</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> fnBody<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">,</span>
                        j<span class=\"token punctuation\">.</span><span class=\"token function\">blockStatement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">returnStatement</span><span class=\"token punctuation\">(</span>fnBody<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
                        <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>
                    prop<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">functionExpression</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> fnBody<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">,</span> fnBody<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
                <span class=\"token punctuation\">}</span>
            <span class=\"token punctuation\">}</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">let</span> dataProps <span class=\"token operator\">=</span> currentObj<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>prop <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CallExpression'</span> <span class=\"token operator\">&amp;&amp;</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'computed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        dataProps<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>prop <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CallExpression'</span> <span class=\"token operator\">&amp;&amp;</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'action'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
                <span class=\"token comment\">// copy action to the decorator area first...</span>
                <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>
                <span class=\"token keyword\">let</span> dupProp <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> prop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
                dupProp<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> dupProp<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
                dupProp<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> args<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
                decoratorProps<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>dupProp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>

                <span class=\"token comment\">// then flatten things out</span>
                prop<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
            <span class=\"token punctuation\">}</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>dataProps<span class=\"token punctuation\">,</span> decoratorProps<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>
    <span class=\"token keyword\">return</span> <span class=\"token function\">j</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">)</span>
        <span class=\"token comment\">// We're looking for a CallExpression for extend observable</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>CallExpression<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
            callee<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>
                name<span class=\"token punctuation\">:</span> <span class=\"token string\">'extendObservable'</span>
            <span class=\"token punctuation\">}</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>
        <span class=\"token comment\">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">\"ObjectExpression\"</span><span class=\"token punctuation\">)</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
            <span class=\"token comment\">// Now we want to</span>
            <span class=\"token comment\">// 1. Add a 3rd argument</span>
            <span class=\"token comment\">// 2. Move action declarations to that argument</span>
            <span class=\"token comment\">// 3. Convert action statements to plain functions</span>
            <span class=\"token comment\">// 4. Convert computeds to get statements, or just move them down to the second object?</span>
            <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>
            <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>dataProps<span class=\"token punctuation\">,</span> decoratorProps<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">buildDecoratorPropertiesFromCurrentObject</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
            args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>properties <span class=\"token operator\">=</span> dataProps<span class=\"token punctuation\">;</span>
            args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">objectExpression</span><span class=\"token punctuation\">(</span>decoratorProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>
        <span class=\"token punctuation\">.</span><span class=\"token function\">toSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>
      </div>
<p>That looks rather crazy, but the <code class=\"language-text\">buildDecoratorPropertiesFromCurrentObject</code> is mostly straightforward data manipulation, looking for some patterns in the data, and replacing them with a different pattern.  Everything else is just the same base code from our initial example.</p>
<h4>6. Use version control and code reviews!</h4>
<p>Actually running a finished transform against a codebase is crazy easy.  Just give it a base folder, and <code class=\"language-text\">jscodeshift</code> will run your script against all JavaScript files in the directory.  This is definitely a “With great power comes great responsibility” tool though.  Before running jscodeshift across a large code base, make sure you are using version control and that you’ve checked in any other changes.  Because the script will update many files at once, you want to be able to isolate the change and review it carefully afterwards, to make sure that you see what is different, and that those changes look right.  In my case, I got to be <em>done</em> with my script twice, because the first time I thought it was ready to execute across all of the app files, things still went wrong.  It was easy to fix though, since I was able to just checkout my changes and try again.</p>
<h3>Resources</h3>
<p>If you have a change that you want to make to your codebase, but have been holding off because you think it would take forever, I definitely encourage you to check codemods out.  They’re not as scary as you think!  Here are some more resources to get started:</p>
<ul>
<li><a href=\"https://github.com/facebook/jscodeshift\">facebook/jscodeshift</a></li>
<li><a href=\"http://astexplorer.net/\">AST Explorer</a></li>
<li><a href=\"https://medium.com/@andrew_levine/writing-your-very-first-codemod-with-jscodeshift-7a24c4ede31b\">Writing Your First codemod with jscodeshift</a></li>
<li><a href=\"https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb\">Effective JavaScript Codemods</a></li>
</ul>
<div class=\"footnotes\">
<hr>
<ol>
<li id=\"fn-1\">
<p>This is one of many assumptions I made that won’t be true for MobX classes generally.  I was writing a script to convert my app to MobX5 compatible syntax, not write a general case update tool.  In the end there were a few examples that violated my assumptions in the codebase, and I had to update 2 files by hand.</p>
<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>
</li>
<li id=\"fn-2\">
<p>jscodeshift was created by Christoph Pojer who is also one of the primary maintainers of Jest.</p>
<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>
</li>
</ol>
</div>",
                    "author": {
                      "@type": "Person",
                      "name": "Ben McCormick"
                      "email": "mailto:ben@benmccormick.org",
                      "image": "/profile_pic.jpg",
                      "jobTitle": "Software Engineer",
                      "alumniOf": "Duke",
                      "birthPlace": "Pittsburgh, PA",
                      "gender": "male",
                      "url": "http://benmccormick.org",
                	    "sameAs" : [
                        "https://www.linkedin.com/in/benmccormick",
                        "http://twitter.com/_benmccormick",
                      ]
                   }
                }</script><link as="script" rel="preload" href="/component---src-templates-blog-post-js-0dca53a9cdcfd4dd0a1c.js"/><link as="script" rel="preload" href="/app-2c200c44da36b1866c0c.js"/><link as="script" rel="preload" href="/3-8c41f1f1f59c64c849f0.js"/><link as="script" rel="preload" href="/1-e4d06a6dd68c66d49449.js"/><link as="script" rel="preload" href="/2-fd0cb3257c78159b6c0c.js"/><link as="script" rel="preload" href="/0-00a9c90a209c474a63a8.js"/><link as="script" rel="preload" href="/webpack-runtime-1dd6259b1f4658a6c1c9.js"/><link as="fetch" rel="preload" href="/static/d/452/path---2018-06-18-codemod-survival-ad-1-43b-zdoAvpUSJ5m5bfOSQ9hogq1CUB4.json" crossOrigin="use-credentials"/></head><body class="landing-page" style="background:#FCFCFC"><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><style data-emotion-css="msngs2">.css-msngs2{width:100%;max-width:960px;margin:0 auto;padding:2.4rem 1.2rem;}</style><div class="css-msngs2 em100y90"><style data-emotion-css="13vv67v">.css-13vv67v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-bottom:2rem;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-13vv67v e1b8f8ar0"><style data-emotion-css="txnzm6">.css-txnzm6{margin:0 20px 0 0;padding-bottom:0;}.css-txnzm6 a{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-txnzm6 a:hover{-webkit-text-decoration:none;text-decoration:none;}</style><h3 class="css-txnzm6 e1b8f8ar2"><a name="title" href="/">Ben McCormick</a></h3><style data-emotion-css="177tisd">.css-177tisd{color:#999999;}</style><div class="css-177tisd e1b8f8ar3"><a class="css-tcc0st" href="/archive/">Blog</a><style data-emotion-css="12jh0su">.css-12jh0su{padding:0 0.5rem;}@media all and (max-width:400px){.css-12jh0su{padding:0 0.25rem;}}</style><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="/subscribe/">Subscribe</a><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="/speaking/">Speaking</a><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="http://twitter.com/_benmccormick">Twitter</a><span class="css-12jh0su e1b8f8ar1"></span><a class="css-tcc0st" href="/about/">About</a></div></div><article class="markdown"><div class="post-title-area"><style data-emotion-css="92repi">.css-92repi{display:block;max-width:100%;}</style><h1 class="css-92repi e15djruj1">A Codemod Survival Guide</h1></div><div class="columns"><style data-emotion-css="qsg3oo">.css-qsg3oo{max-width:100%;}.css-qsg3oo li{padding-left:10px;}.css-qsg3oo .reading-img img{width:150px;float:right;margin:0px 10px 20px 10px;}.css-qsg3oo img.full-width{max-height:none;}.css-qsg3oo img.half-width{max-height:none;width:50%;}</style><div class="css-qsg3oo e15djruj3"><p>Do you like making repetitive syntax updates across many files?  Enjoy the thrill of painstakingly combing through 1000 line diffs that all look the same to see if you made any typos?  Relish that feeling of doubt in the back of your head as you wonder whether you actually caught all instances of the syntax you needed to update when you switched to the next major version of a library?  If so, you should probably stop reading now, because you won’t like codemods at all.  For the rest of us, codemods are a tool for assisting in large refactoring; they save you time and reduce typos.</p>
<p>Codemods originated at Facebook, first with a tool named <a href="https://github.com/facebook/codemod">codemod</a> that served as a helper for regex or python based refactoring, allowing you to make iterative changes with pretty diffs, then with <a href="https://github.com/facebook/jscodeshift">jscodeshift</a> a tool for doing more advanced JavaScript refactors that work directly against a data model representation of the code, rather than relying on regex or direct programmatic changes to text.  jscodeshift is extremely powerful, but I found it intimidating to approach.  Once I took the plunge though, it wasn’t that hard to start writing codemods.  So here are a few quick tips for anyone else who might be interested.</p>
<h4>1. Start with a goal in mind</h4>
<p>It’s always helpful to dive into a new technology by trying to solve a concrete problem.  That’s especially useful for codemods, because the ideas behind them can seem abstract and poorly documented until you begin focusing on a specific issue.  In my case I was originally motivated to look at codemods when updating an application from using MobX version 3 to MobX version 5.  In MobX3, when you write code without using decorators, a typical model class will look something like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> extendObservable<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> action<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            currentData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            otherData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">)</span><span class="token punctuation">,</span>
            setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">unrelatedMethod</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>I was updating an app with dozens of these model classes.  Unfortunately, in Mobx5, the syntax for these classes has changed, and it now needs to be rewritten like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> extendObservable<span class="token punctuation">,</span> action<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token keyword">get</span> <span class="token function">currentData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">get</span> <span class="token function">otherData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            setFoo<span class="token punctuation">:</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            setBar<span class="token punctuation">:</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">unrelatedMethod</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Computeds must be shifted to gets, action functions have to be pulled out of their wrapper function calls, but the wrapper and action names have to be moved down to a new second object.  This is really finicky to do by hand or with a text editor macro, because it’s a lot more complicated than just find and replace.  I’d usually be converting from arrow functions that might or might not have blocks and return statements currently, and I’d have to move the actions down to the new object correctly even though some of the models had 10+ action functions.   Facing several hours worth of finicky manual or script assisted refactoring work was enough to convince me it was time to learn about codemods.</p>
<h4>2. Create a small example and learn about its AST</h4>
<p>My first productive step towards creating a Mobx3to5 codemod for my codebase was creating the example code above.  I iterated on it a bit as I found new things I cared about; I didn’t realize at first that computeds needed to be changed as well as actions, and I eventually realized I needed to handle 2 types of arrow function syntax. But the initial version I wrote got me going.  Having a stripped down example of the code I cared about without the baggage of my real codebase was valuable, and being able to update it to include all the cases I cared about during testing was even better.</p>
<p>Once I created the example, I was able to understand better what I was trying to do by examining its AST.  An AST (Abstract Syntax Tree) is a representation of a JavaScript file’s source code as a tree data structure.  For instance here’s a portion of the AST for a basic Hello World program:</p>
<div class="gatsby-highlight" data-language="json">
      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Program"</span><span class="token punctuation">,</span>
  <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ExpressionStatement"</span><span class="token punctuation">,</span>
      <span class="token property">"expression"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"CallExpression"</span><span class="token punctuation">,</span>
        <span class="token property">"callee"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"MemberExpression"</span><span class="token punctuation">,</span>
          <span class="token property">"object"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"console"</span><span class="token punctuation">,</span>
            <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"property"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"log"</span><span class="token punctuation">,</span>
            <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"computed"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"MemberExpression"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Literal"</span><span class="token punctuation">,</span>
            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span>
            <span class="token property">"rawValue"</span><span class="token operator">:</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span>
            <span class="token property">"raw"</span><span class="token operator">:</span> <span class="token string">"'Hello World'"</span><span class="token punctuation">,</span>
            <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"Literal"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"CallExpression"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"ExpressionStatement"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>This is a simplified example that looks only at the semantic structure of the syntax.  The full version also contains information about the indenting and exact text of the code, and comes out to about 600 lines when represented as formatted JSON.   All of this from <code class="language-text">console.log(&#39;Hello World&#39;);</code>.  Fortunately there’s a nice tool for exploring ASTs.</p>
<p><a href="http://astexplorer.net/">AST Explorer</a> is a site that lets you enter some JavaScript code, and then visualize the AST that represents the code.  When I put my example code above, in, I was able to see that the computed expressions in my original code showed as a <code class="language-text">CallExpression</code> with an <code class="language-text">ArrowFunctionExpression</code> as an argument.</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/566c7da27d68ddf6d09c7859481c3a91/d5dfd/computed-ast.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 52.06143896523848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABj0lEQVQoz32Sy47TMBRA8/8LVkjzFbBgx0gsGXXJBhhVQ1HiOG/bafNumh5uMpkhI0EtXdm6j+P78ipb47KaIBwwbqKqoWpg6CdUoPn6sONx/4Tv+0RRhFKKOI4JgoBIh6hQobXGWkue53h931KdDL+e9kRhyNClXKeK+XT9gHUOI85FUSwyBxljyBKBaZ+fSqOShNJZnPh6bRNJ6A/S6Bvq93dC/4HSHmiamrqqlp9nx7dSYouEQCsOiSUpZt1x8fXaVupjosgNaWIo8yN9PdK0Z2bbC3C+X8WdcMWBTH9AxV8wxT0ntxPbnGHbLuWdh4G+6xiGnulyWXSzbZvh8l6BR7enjN+h4ztO5j2N+yj2Eq+ua+lhJX1xtN3I9vwfeMQZnyL5RJzek+WfpU27tYcSNF0mye7MZZq4Xq+L/Av4Cl1vX4UEUSZly9CMfCKD8cbxbVa3gH8zlMmbXCBm0T1P+Lm/3nkFbkE3gesdRDFa1mVeo5dVWkoeN8BtlreAxhr2QYwSaJKmi+Syo7PtD7qx9vy8Vq9QAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="AST explorer screenshot showing the CallExpression syntax"
        title=""
        src="/static/566c7da27d68ddf6d09c7859481c3a91/d766e/computed-ast.png"
        srcset="/static/566c7da27d68ddf6d09c7859481c3a91/a6b6e/computed-ast.png 143w,
/static/566c7da27d68ddf6d09c7859481c3a91/8e488/computed-ast.png 285w,
/static/566c7da27d68ddf6d09c7859481c3a91/d766e/computed-ast.png 570w,
/static/566c7da27d68ddf6d09c7859481c3a91/13239/computed-ast.png 855w,
/static/566c7da27d68ddf6d09c7859481c3a91/cab6d/computed-ast.png 1140w,
/static/566c7da27d68ddf6d09c7859481c3a91/d5dfd/computed-ast.png 1237w"
        sizes="(max-width: 570px) 100vw, 570px"
      />
  </span>
  </a></p>
<p>When I put the result code I wanted in, I could see that I would need to switch the property that contained the callexpression to have a type <code class="language-text">get</code> and would need to replace the call expression with a function expression.</p>
<h4>3. Start with a small edit</h4>
<p>As a starting point, I decided I wanted to write a script that could find MobX classes and just add the second object argument to extendObservable, with a dummy property.  So this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    currentData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    otherData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">)</span><span class="token punctuation">,</span>
    setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>would become this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    currentData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    otherData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">)</span><span class="token punctuation">,</span>
    setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>To do this, I took an existing script that I found in <a href="https://github.com/jhgg/js-transforms">this repo of small codemod examples</a> and modified it to lookup <code class="language-text">extendObservable</code> calls and add a second argument.  I filtered it to only include calls with 2 arguments, in case I ran the code a second time<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>file<span class="token punctuation">,</span> api<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">j</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span>
        <span class="token comment">// We're looking for a CallExpression for extend observable</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>CallExpression<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            callee<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'extendObservable'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=></span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"ObjectExpression"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Now we want to</span>
            <span class="token comment">// 1. Add a 3rd argument object</span>
            <span class="token keyword">let</span> args <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
            args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span>j<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span>j<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// TODO: 2. Move action declarations to that argument</span>
            <span class="token comment">// TODO: 3. Convert action statements to plain functions</span>
            <span class="token comment">// TODO: 4. Convert computeds to get statements</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>This is a working script to achieve my simple goal.  To break it down:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token function">j</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>CallExpression<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            callee<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'extendObservable'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>jscodeshift provides a jQuery style api for traversing a tree.  Here we’re looking for <code class="language-text">CallExpression</code>s that have the name <code class="language-text">extendObservable</code>.  We now have a collection of these expressions, and we can filter it down to only the expressions that have 2 arguments.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=></span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"ObjectExpression"</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>Next we want to go through each callExpression and transform it.  In this case by finding it’s arguments list and pushing a new one, using the jsCodeshift API to simply generate the AST objects neededed to represent <code class="language-text">{foo: bar}</code>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Now we want to</span>
            <span class="token comment">// 1. Add a 3rd argument object</span>
            <span class="token keyword">let</span> args <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
            args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span>j<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span>j<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// TODO: 2. Move action declarations to that argument</span>
            <span class="token comment">// TODO: 3. Convert action statements to plain functions</span>
            <span class="token comment">// TODO: 4. Convert computeds to get statements</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>Finally, we call <code class="language-text">.toSource()</code> to write the tranformed AST back to the file.</p>
<h4>4. Test your edit</h4>
<p>Because this type of coding lends itself to experimentation, it’s important to develop a good feedback loop while working on your codemod.  If you have a simple example you’re off to a good start.  The next step is to find a good way to run your script and see the output.  Simply running your test is a bit frustrating, because jscodeshift is destructive.  It overwrites your file in place, and doesn’t save a copy.  You can get around this though by adding <code class="language-text">--dry --print</code> flags to your command line call</p>
<p><code class="language-text">jscodeshift -t my-codemod.js example.js</code></p>
<p>will run the transform defined in <code class="language-text">my-codemod.js</code> against <code class="language-text">example.js</code> and modify it in place.</p>
<p><code class="language-text">jscodeshift --dry --print -t my-codemod.js example.js</code></p>
<p>will print the transformed file to the console and not update example.js.</p>
<p>For simple codemods and small example files, this is a nice way to iterate quickly.  For more extensive codemods with multiple test cases, I’m excited to try out jscodeshift’s Jest support<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>.  It has helper methods for working with transforms, and a workflow of Jest watch checking the output of several inputs against several expected outputs would be lovely.</p>
<h4>5. Iterate</h4>
<p>After I got that first edit working, it was simply a matter of working through my list.  I needed to remove the experimental <code class="language-text">foo:bar</code> and then</p>
<ol>
<li>Move action declarations to the new argument object</li>
<li>Convert action declarations to plain functions in the existing object</li>
<li>Convert computeds to get statements</li>
</ol>
<p>I was able to take those one at a time, and my final script looked something like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>file<span class="token punctuation">,</span> api<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">buildDecoratorPropertiesFromCurrentObject</span> <span class="token operator">=</span> currentObj <span class="token operator">=></span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> decoratorProps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        currentObj<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prop <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'CallExpression'</span> <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'computed'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                prop<span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'get'</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> fnBody <span class="token operator">=</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>fnBody<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'ArrowFunctionExpression'</span> <span class="token operator">&amp;&amp;</span> fnBody<span class="token punctuation">.</span>body<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'BlockStatement'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    prop<span class="token punctuation">.</span>value <span class="token operator">=</span> j<span class="token punctuation">.</span><span class="token function">functionExpression</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fnBody<span class="token punctuation">.</span>params<span class="token punctuation">,</span>
                        j<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span>j<span class="token punctuation">.</span><span class="token function">returnStatement</span><span class="token punctuation">(</span>fnBody<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    prop<span class="token punctuation">.</span>value <span class="token operator">=</span> j<span class="token punctuation">.</span><span class="token function">functionExpression</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fnBody<span class="token punctuation">.</span>params<span class="token punctuation">,</span> fnBody<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> dataProps <span class="token operator">=</span> currentObj<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>prop <span class="token operator">=></span> <span class="token operator">!</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'CallExpression'</span> <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'computed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataProps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prop <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'CallExpression'</span> <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'action'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// copy action to the decorator area first...</span>
                <span class="token keyword">let</span> args <span class="token operator">=</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
                <span class="token keyword">let</span> dupProp <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
                dupProp<span class="token punctuation">.</span>value <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> dupProp<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                dupProp<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                decoratorProps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dupProp<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// then flatten things out</span>
                prop<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>dataProps<span class="token punctuation">,</span> decoratorProps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">j</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span>
        <span class="token comment">// We're looking for a CallExpression for extend observable</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>CallExpression<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            callee<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'extendObservable'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=></span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"ObjectExpression"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Now we want to</span>
            <span class="token comment">// 1. Add a 3rd argument</span>
            <span class="token comment">// 2. Move action declarations to that argument</span>
            <span class="token comment">// 3. Convert action statements to plain functions</span>
            <span class="token comment">// 4. Convert computeds to get statements, or just move them down to the second object?</span>
            <span class="token keyword">let</span> args <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
            <span class="token keyword">let</span> <span class="token punctuation">[</span>dataProps<span class="token punctuation">,</span> decoratorProps<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">buildDecoratorPropertiesFromCurrentObject</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> dataProps<span class="token punctuation">;</span>
            args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span>decoratorProps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>That looks rather crazy, but the <code class="language-text">buildDecoratorPropertiesFromCurrentObject</code> is mostly straightforward data manipulation, looking for some patterns in the data, and replacing them with a different pattern.  Everything else is just the same base code from our initial example.</p>
<h4>6. Use version control and code reviews!</h4>
<p>Actually running a finished transform against a codebase is crazy easy.  Just give it a base folder, and <code class="language-text">jscodeshift</code> will run your script against all JavaScript files in the directory.  This is definitely a “With great power comes great responsibility” tool though.  Before running jscodeshift across a large code base, make sure you are using version control and that you’ve checked in any other changes.  Because the script will update many files at once, you want to be able to isolate the change and review it carefully afterwards, to make sure that you see what is different, and that those changes look right.  In my case, I got to be <em>done</em> with my script twice, because the first time I thought it was ready to execute across all of the app files, things still went wrong.  It was easy to fix though, since I was able to just checkout my changes and try again.</p>
<h3>Resources</h3>
<p>If you have a change that you want to make to your codebase, but have been holding off because you think it would take forever, I definitely encourage you to check codemods out.  They’re not as scary as you think!  Here are some more resources to get started:</p>
<ul>
<li><a href="https://github.com/facebook/jscodeshift">facebook/jscodeshift</a></li>
<li><a href="http://astexplorer.net/">AST Explorer</a></li>
<li><a href="https://medium.com/@andrew_levine/writing-your-very-first-codemod-with-jscodeshift-7a24c4ede31b">Writing Your First codemod with jscodeshift</a></li>
<li><a href="https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb">Effective JavaScript Codemods</a></li>
</ul>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>This is one of many assumptions I made that won’t be true for MobX classes generally.  I was writing a script to convert my app to MobX5 compatible syntax, not write a general case update tool.  In the end there were a few examples that violated my assumptions in the codebase, and I had to update 2 files by hand.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>jscodeshift was created by Christoph Pojer who is also one of the primary maintainers of Jest.</p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
</ol>
</div></div><style data-emotion-css="rd3zyi">.css-rd3zyi{padding-left:2rem;overflow:hidden;}</style><div class="no-mobile css-rd3zyi e15djruj4"><style data-emotion-css="1y23a7j">.css-1y23a7j{overflow:hidden;margin:0;}.css-1y23a7j #mc_embed_signup form{margin-bottom:20px;}@media all and (max-width:700px){.css-1y23a7j{padding-right:0;width:100% !important;padding:0 10px;}.css-1y23a7j .mc-field-group{width:100% !important;}.css-1y23a7j .mc-field-group input{width:100% !important;font-size:0.8em;height:2.4em;}}</style><div class="css-1y23a7j e1qbom70"><form action="https://buttondown.email/api/emails/embed-subscribe/benmccormick" method="post" target="popupwindow" class="embeddable-buttondown-form"><label for="bd-email" id="bd-label">Subscribe to the Newsletter</label><input type="hidden" value="1" name="embed"/><div class="bd-subscribe-row"><input type="email" name="email" id="bd-email" placeholder="Your Email"/><input type="submit" value="Subscribe" id="bd-submit"/></div></form></div><style data-emotion-css="wtijjp">.css-wtijjp{width:100%;overflow:hidden;margin:0 0 1rem 0;font-size:14px;position:relative;font-family:"mr-eaves-xl-modern","Helvetica Neue",Arial,sans-serif;background:rgba(99,159,110,0.25);border:1px solid rgba(90,150,100,0.5);padding:4px;min-height:100px;opacity:0;-webkit-transition:opacity ease 3s;transition:opacity ease 3s;}@media all and (max-width:700px){.css-wtijjp{display:none;}}</style><div class="css-wtijjp etmlefq0"></div><style data-emotion-css="1ui09x8">.css-1ui09x8{font-size:14px;background-color:RGBA(191,237,253,0.5);border:1px solid #68d4fa;padding:0.5rem;}.css-1ui09x8 > h4{font-size:20px;margin-bottom:6px;}.css-1ui09x8 > h6{font-size:18px;margin-bottom:6px;margin-top:12px;}</style><div class="css-1ui09x8 e15djruj2"><h4>Article Info</h4><h6>Author</h6><a href="/about">Ben McCormick</a><h6>Publish Date</h6>June 18th 2018<h6>Category</h6><a class="css-1os3d5z" href="/category/javascript"><style data-emotion-css="e7v39i">.css-e7v39i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;margin-right:0.1rem;}@media all and (max-width:960px){.css-e7v39i{margin-right:0;}}</style><div class="css-e7v39i e1nsgn8x1"><style data-emotion-css="e7cou1">.css-e7cou1{display:block;width:0.8rem;height:0.8rem;margin-right:0.5rem;}.css-e7cou1 *{fill:#333;}.css-e7cou1 > i{height:0.16000000000000003rem;}</style><span color="#333" class="css-e7cou1 efpzdjd0"><i><svg viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>code</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="code" fill="#000000"><path d="M9.5,3 L8,4.5 L11.5,8 L8,11.5 L9.5,13 L14,8 L9.5,3 L9.5,3 Z M4.5,3 L0,8 L4.5,13 L6,11.5 L2.5,8 L6,4.5 L4.5,3 L4.5,3 Z" id="Shape"></path></g></g></svg></i></span></div><style data-emotion-css="1bs7qd7">.css-1bs7qd7:hover{-webkit-text-decoration:none;text-decoration:none;}</style><div class="css-1bs7qd7 e1nsgn8x0">JavaScript Language</div></a></div></div></div><style data-emotion-css="15g2oxy">.css-15g2oxy{margin-top:1rem;}</style><div class="css-15g2oxy"><div><hr/><div class=""><style data-emotion-css="q2y3yl">.css-q2y3yl{color:inherit;}</style><h2 class="css-q2y3yl ebu0o1j0">You Might Also Like These Articles</h2><style data-emotion-css="ozdz9y">.css-ozdz9y{margin-left:0;padding-left:0;}</style><ul class="css-ozdz9y ebu0o1j1"><a class="css-117pqo3" href="/2017/07/19/ten-things-javascript/"><style data-emotion-css="7l9f5z">.css-7l9f5z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:0;}.css-7l9f5z > *{margin-right:10px;}@media all and (max-width:700px){.css-7l9f5z{font-size:80%;}}</style><h1 class="css-7l9f5z e1rsqce73">Ten Things A Serious JavaScript Developer Should Learn</h1><style data-emotion-css="1hu5gkk">.css-1hu5gkk{white-space:nowrap;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:18px;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;opacity:0.6;}@media all and (max-width:700px){.css-1hu5gkk{display:none;}}</style><span class="no-mobile css-1hu5gkk e1rsqce72">Jul 19th 2017</span><style data-emotion-css="1b3ljqu">.css-1b3ljqu{font-family:"minion-3",Garamond,serif;opacity:0.6;font-size:18px;margin:0;}@media all and (max-width:700px){.css-1b3ljqu{font-size:70%;}}</style><p class="css-1b3ljqu e1rsqce71">Some of the important things to pick up in the JS world</p><style data-emotion-css="ke41ql">.css-ke41ql{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;}@media all and (max-width:700px){.css-ke41ql{-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;margin-top:1em;}}</style><div class="css-ke41ql e1rsqce70"><a class="css-1os3d5z" href="/category/javascript"><div class="css-e7v39i e1nsgn8x1"><span color="#333" class="css-e7cou1 efpzdjd0"><i><svg viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>code</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="code" fill="#000000"><path d="M9.5,3 L8,4.5 L11.5,8 L8,11.5 L9.5,13 L14,8 L9.5,3 L9.5,3 Z M4.5,3 L0,8 L4.5,13 L6,11.5 L2.5,8 L6,4.5 L4.5,3 L4.5,3 Z" id="Shape"></path></g></g></svg></i></span></div><div class="css-1bs7qd7 e1nsgn8x0">JavaScript Language</div></a></div></a><a class="css-117pqo3" href="/2017/07/10/how-to-follow-the-javascript-roadmap/"><h1 class="css-7l9f5z e1rsqce73">How to follow the JavaScript roadmap</h1><span class="no-mobile css-1hu5gkk e1rsqce72">Jul 10th 2017</span><p class="css-1b3ljqu e1rsqce71">Keeping up with the language&#x27;s progress</p><div class="css-ke41ql e1rsqce70"><a class="css-1os3d5z" href="/category/javascript"><div class="css-e7v39i e1nsgn8x1"><span color="#333" class="css-e7cou1 efpzdjd0"><i><svg viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>code</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="code" fill="#000000"><path d="M9.5,3 L8,4.5 L11.5,8 L8,11.5 L9.5,13 L14,8 L9.5,3 L9.5,3 Z M4.5,3 L0,8 L4.5,13 L6,11.5 L2.5,8 L6,4.5 L4.5,3 L4.5,3 Z" id="Shape"></path></g></g></svg></i></span></div><div class="css-1bs7qd7 e1nsgn8x0">JavaScript Language</div></a></div></a><a class="css-117pqo3" href="/2018/03/16/proposals-in-production/"><h1 class="css-7l9f5z e1rsqce73">JavaScript Proposals In Production</h1><span class="no-mobile css-1hu5gkk e1rsqce72">Mar 16th 2018</span><p class="css-1b3ljqu e1rsqce71">The problems with using proposed JavaScript features in production</p><div class="css-ke41ql e1rsqce70"><a class="css-1os3d5z" href="/category/javascript"><div class="css-e7v39i e1nsgn8x1"><span color="#333" class="css-e7cou1 efpzdjd0"><i><svg viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>code</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="code" fill="#000000"><path d="M9.5,3 L8,4.5 L11.5,8 L8,11.5 L9.5,13 L14,8 L9.5,3 L9.5,3 Z M4.5,3 L0,8 L4.5,13 L6,11.5 L2.5,8 L6,4.5 L4.5,3 L4.5,3 Z" id="Shape"></path></g></g></svg></i></span></div><div class="css-1bs7qd7 e1nsgn8x0">JavaScript Language</div></a></div></a></ul></div></div></div></article></div><style data-emotion-css="1tfasoy">.css-1tfasoy{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:3em 0 1em 0;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:RGBA(191,237,253,0.5);border-top:1px solid #68d4fa;}</style><div class="css-1tfasoy e7oz9l30"><style data-emotion-css="7bdmpt">.css-7bdmpt{width:100%;min-height:200px;max-width:960px;margin:0 auto;padding:0 1.2rem;display:grid;grid-template-columns:45% 45%;grid-column-gap:10%;grid-row-gap:30px;}@media all and (max-width:450px){.css-7bdmpt{grid-template-columns:100%;}}</style><div class="css-7bdmpt e7oz9l31"><div><h2 class="css-0 e7oz9l33">Content</h2><style data-emotion-css="1xfqzqa">.css-1xfqzqa{display:grid;grid-template-columns:1fr;grid-auto-rows:1fr;grid-row-gap:20px;}</style><div class="css-1xfqzqa e7oz9l32"><a class="css-1gs5qio" href="/archive/">Blog Archive</a><a class="css-1gs5qio" href="/reviews-archive/">Book Reviews</a><a class="css-1gs5qio" href="https://buttondown.email/benmccormick">Newsletter Archives</a><a class="css-1gs5qio" href="/speaking/">Speaking</a></div></div><div><h2 class="css-0 e7oz9l33">Meta</h2><div class="css-1xfqzqa e7oz9l32"><a class="css-1gs5qio" href="/subscribe/">Subscribe To The Newsletter</a><a class="css-1gs5qio" href="/built-with/">Built With</a><a class="css-1gs5qio" href="http://twitter.com/_benmccormick">Personal Twitter</a><a class="css-1gs5qio" href="http://twitter.com/benmccormickorg">Blog Twitter</a><a class="css-1gs5qio" href="/about/">About Me</a></div></div><style data-emotion-css="i3iawv">.css-i3iawv{font-family:"mr-eaves-xl-modern","Helvetica Neue",Arial,sans-serif;font-size:14px;overflow:visible;white-space:nowrap;}</style><div class="css-i3iawv e7oz9l34">Copyright © 2012-2019 · Ben McCormick</div></div></div></div></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script>
          (function(d) {
            var config = {
              kitId: 'msd6bqv',
              scriptTimeout: 300,
              async: true
            },
            h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/wf-loading/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
          })(document);
        </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"2018-06-18-codemod-survival-ad1","path":"/2018/06/18/codemod-survival/"};window.dataPath="452/path---2018-06-18-codemod-survival-ad-1-43b-zdoAvpUSJ5m5bfOSQ9hogq1CUB4";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-2c200c44da36b1866c0c.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-6c3cb25c69a33194b725.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.d5c164db07d2a4f14ec9.css","/component---src-templates-blog-post-js-0dca53a9cdcfd4dd0a1c.js"],"component---src-templates-category-page-js":["/component---src-templates-category-page-js-bbe4cfbd87046e3a284b.js"],"component---src-templates-topic-page-js":["/component---src-templates-topic-page-js-54d7a930249c9bead6dc.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-b233b14132501dcc18da.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b1b790160efb6e7b754f.js"],"component---src-pages-links-archive-js":["/component---src-pages-links-archive-js-8404a10ddcf65ffbf936.js"],"component---src-pages-reviews-archive-js":["/component---src-pages-reviews-archive-js-5b7cfc3e3751ab86a145.js"]};/*]]>*/</script><script src="/webpack-runtime-1dd6259b1f4658a6c1c9.js" async=""></script><script src="/0-00a9c90a209c474a63a8.js" async=""></script><script src="/2-fd0cb3257c78159b6c0c.js" async=""></script><script src="/1-e4d06a6dd68c66d49449.js" async=""></script><script src="/3-8c41f1f1f59c64c849f0.js" async=""></script><script src="/app-2c200c44da36b1866c0c.js" async=""></script><script src="/component---src-templates-blog-post-js-0dca53a9cdcfd4dd0a1c.js" async=""></script></body></html>