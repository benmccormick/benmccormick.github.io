<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#57a3e8"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'Garamond','Baskerville','Baskerville Old Face','Hoefler Text','Times New Roman',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Garamond','Baskerville','Baskerville Old Face','Hoefler Text','Times New Roman',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.2rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.2rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:14px;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style type="text/css" data-href="/0.2ece98f91135ba82c235.css">a{color:#e2777a;text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}.footnote-backref,.footnote-ref{text-decoration:none;padding-left:3px}blockquote{border-left:5px solid #57a3e8;background:#eee;font-weight:400;font-size:.9rem;padding:1.5rem 2rem;margin:0 0 1rem}blockquote p{margin-bottom:.667em}h3{color:#57a3e8}h4{font-size:110%}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnotes{font-size:80%}.footnotes li>*{display:inline;margin-bottom:0}
#carbonads{height:300px;font-size:14px;width:150px;position:relative;border:3px solid #f0f0f0;padding:7px}.carbon-wrap{width:130px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}.carbon-text{padding:5px 10px;max-height:120px;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:hsla(0,0%,39%,.7);position:absolute;right:5px;bottom:0}.post-title-area{padding:1em 0}
.columns{display:grid;grid-template-columns:600px 1fr;grid-template-rows:1fr;grid-column-gap:50px}@media (max-width:700px){.columns{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center}.no-mobile{display:none}}@media (max-width:321px){html{font-size:100%!important}}

/*# sourceMappingURL=0.2ece98f91135ba82c235.css.map*/</style><style type="text/css" data-href="/component---src-templates-blog-post-js.3c9ce09e7c656a74de5d.css">.markdown pre{display:block;background:#343d46;color:#d8dee9;padding:.8rem}.markdown pre code:after{content:unset}.token.comment,.token.quote{color:#a7adba}.token.addition,.token.attr,.token.selector-tag,.token.string{color:#99c794}.token.doctag,.token.meta .token.meta-string,.token.regexp{color:#89ddf3}.token.built_in,.token.function{color:#5fb3b3}.token.name,.token.section,.token.selector-class,.token.selector-id,.token.title{color:#69c}.token.attribute,.token.class .token.title,.token.template-variable,.token.type,.token.variable{color:#fac863}.token.bullet,.token.link,.token.meta,.token.meta .token.keyword,.token.selector-attr,.token.selector-pseudo,.token.subst,.token.symbol{color:#f9ae58}.token.boolean,.token.deletion,.token.literal,.token.number{color:#f07178}.token.keyword{color:#c594c5}.token.formula{background:#a7adba}.token.emphasis{font-style:italic}.token.strong{font-weight:700}
.gatsby-resp-image-wrapper{max-width:75%;display:block;margin:40px auto 20px}.bordered-img{border:3px solid #57a3e8}.img-group{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.img-group img{padding:0;height:auto}.inline-img{display:inline-block;float:right;padding:2rem}
.subscribe-page-group{width:400px;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.subscribe-page-group input{border-radius:3px;max-width:350px;width:80vw;border:1px solid #ccc;margin-right:10px;height:30px}.mc-field-group label{font-size:.9em;font-weight:600}.subscribe-button-large{font-family:-apple-system,system-ui,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:0 10px;margin:10px 0;cursor:pointer;width:40vw}.subscribe-button-large:hover{background:#3e8acf}.twitter-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.twitter-row>div{padding-right:20px;min-width:300px}
.twitter-tweet,twitterwidget{margin-left:auto;margin-right:auto}
.sidebar-group{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.sidebar{padding-left:2rem}.subscribe-container{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;-ms-flex-wrap:wrap;flex-wrap:wrap}.subscribe-email{padding:0 .1rem;margin:0 .2rem 0 0;font-size:.7rem;height:1.5rem;width:6rem}.subscribe-button{color:#fff;background:#57a3e8;border-radius:4px;font-size:1rem;line-height:1rem;height:1.5rem;width:1.5rem;max-width:2rem;-ms-flex-positive:0;flex-grow:0;border:0;margin:0;cursor:pointer}.rss{padding-bottom:10px}.rss a{display:-ms-flexbox;display:flex}.rss-icon{display:block;width:17px;margin-right:.5em;height:50px}.rss-icon *{fill:#e2777a}.twitter-item{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;margin-bottom:15px}.twitter-item iframe{margin:0 0 0 10px}

/*# sourceMappingURL=component---src-templates-blog-post-js.3c9ce09e7c656a74de5d.css.map*/</style><style id="glamor-styles">.css-1a7irg3,[data-css-1a7irg3]{color:rgba(100,100,100, 0.7);font-size:16px;font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}.css-1a7irg3:hover,[data-css-1a7irg3]:hover{color:#E2777A;}.css-bhw7gr,[data-css-bhw7gr]{font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:120%;margin:0 1px 0.8rem 1px;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;justify-content:space-between;align-items:center;border:3px dashed #E2777A;padding:15px;color:initial;transition:background 0.5s ease, color 0.5s ease;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-webkit-transition:background 0.5s ease, color 0.5s ease;-moz-transition:background 0.5s ease, color 0.5s ease;}.css-bhw7gr:hover,[data-css-bhw7gr]:hover{background:#E2777A;color:white;text-decoration:none;}.css-4u7z7f,[data-css-4u7z7f]{max-width:960px;margin:0 auto;padding:2.4rem 1.2rem;}.css-1rrcu7t,[data-css-1rrcu7t]{display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;padding-bottom:2rem;flex-direction:row;justify-content:space-between;flex-wrap:wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-lines:multiple;-webkit-flex-wrap:wrap;}.css-nj9d06,[data-css-nj9d06]{margin:0 20px 0 0;padding-bottom:0;}.css-nj9d06 a,[data-css-nj9d06] a{box-shadow:none;text-decoration:none;color:inherit;}.css-nj9d06 a:hover,[data-css-nj9d06] a:hover{text-decoration:none;}.css-1iige26,[data-css-1iige26]{color:rgba(100,100,100, 0.7);}.css-1821md7,[data-css-1821md7]{padding:0 0.5rem;}@media all and (max-width: 400px){.css-1821md7,[data-css-1821md7]{padding:0 0.25rem;}}.css-d0z96,[data-css-d0z96]{display:block;max-width:100%;}.css-1kurdub,[data-css-1kurdub]{display:block;font-family:Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:16px;color:rgba(100,100,100, 0.8);margin-top:0.8rem;margin-bottom:0.8rem;}.css-n40tvx,[data-css-n40tvx]{max-width:100%;}.css-n40tvx li,[data-css-n40tvx] li{padding-left:10px;}.css-n40tvx .reading-img img,[data-css-n40tvx] .reading-img img{width:150px;float:right;margin:0px 10px 20px 10px;}.css-n40tvx img.full-width,[data-css-n40tvx] img.full-width{max-height:none;}.css-n40tvx img.half-width,[data-css-n40tvx] img.half-width{max-height:none;width:50%;}.css-y3ugfx,[data-css-y3ugfx]{padding-left:2rem;}.css-1aluta2,[data-css-1aluta2]{height:300px;width:150px;overflow:hidden;margin:0 0 1rem 0;}@media all and (max-width: 700px){.css-1aluta2,[data-css-1aluta2]{display:none;}}.css-m9l7q0,[data-css-m9l7q0]{overflow:hidden;margin:0;}.css-m9l7q0 #mc_embed_signup form,[data-css-m9l7q0] #mc_embed_signup form{margin-bottom:20px;}@media all and (max-width: 700px){.css-m9l7q0,[data-css-m9l7q0]{padding-right:0;width:100% !important;padding:0 10px;}.css-m9l7q0 .mc-field-group,[data-css-m9l7q0] .mc-field-group{width:100% !important;}.css-m9l7q0 .mc-field-group input,[data-css-m9l7q0] .mc-field-group input{width:100% !important;font-size:0.8em;height:2.4em;}}.css-h2hkv8,[data-css-h2hkv8]{margin:0;font-size:0.79057rem;line-height:1.6rem;letter-spacing:-0.25px;}.css-4w3jde,[data-css-4w3jde]{color:inherit;}.css-33c833,[data-css-33c833]{margin-left:0;padding-left:0;}.css-vjg5fh,[data-css-vjg5fh]{max-width:60vw;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;align-items:centglamor.er;-webkit-box-align:centglamor.er;-webkit-align-items:centglamor.er;}@media all and (max-width: 700px){.css-vjg5fh,[data-css-vjg5fh]{max-width:100vw;}}.css-1m362nd,[data-css-1m362nd]{display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;align-items:center;-webkit-box-align:center;-webkit-align-items:center;}.css-1m362nd> *,[data-css-1m362nd]> *{margin-right:10px;}.css-1182rq7,[data-css-1182rq7]{font-family:Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:18px;margin:0;}.css-17c7pi4,[data-css-17c7pi4]{white-space:nowrap;font-size:18px;}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["1a7irg3","bhw7gr","4u7z7f","1rrcu7t","nj9d06","1iige26","1821md7","d0z96","1kurdub","n40tvx","y3ugfx","1aluta2","m9l7q0","h2hkv8","4w3jde","33c833","vjg5fh","1m362nd","1182rq7","17c7pi4"]
        // ]]>
        </script><title data-react-helmet="true">MobX Patterns: State Machines &amp; Flags | benmccormick.org</title><meta data-react-helmet="true" name="description" content="Ben McCormick&#x27;s blog on JavaScript and Web Development"/><meta data-react-helmet="true" name="keywords" content="mobx computed state machines"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:site" content="@benmccormickorg"/><meta data-react-helmet="true" name="twitter:creator" content="@ben336"/><meta data-react-helmet="true" name="twitter:title" content="MobX Patterns: State Machines &amp; Flags"/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="twitter:image" content="http://benmccormick.org/logo.png"/><script data-react-helmet="true" type="application/ld+json">{
                  "@context": "http://schema.org"
                  "@type": "BlogPosting",
                  "headline": "MobX Patterns: State Machines & Flags",
                  "genre": "Software Development",
                  "keywords": "mobx computed state machines",
                  "url": "http://benmccormick.org//2018/05/14/mobx-state-machines-and-flags/",
                  "image": "http://benmccormick.org/logo.png",
                  "datePublished": "2018-05-14",
                  
                  "articleBody": "<p>A few weeks ago, I was listening to the <a href=\"https://changelog.com/reactpodcast\">React Podcast</a>, specifically their <a href=\"https://changelog.com/reactpodcast/5\">episode on State Machines</a> with <a href=\"https://twitter.com/davidkpiano\">David Khourshid</a>.  About 20 minutes into the podcast, there was a discussion on the benefits of using enums over flags to model the state of objects that can change across multiple dimensions.  It reminded me of one of the nice patterns that <a href=\"https://mobx.js.org/\">MobX</a> makes possible, and I thought I’d share it here.</p>
<h3>Background</h3>
<p>To set the stage here, the podcast discussion centered around modeling an async process like a promise. One possible way given was to use a mix of flags and if statements like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// loading object</span>
<span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleLoader</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>
      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hasError <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token comment\">//fetch data from server and return it here</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token keyword\">async</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hasError <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hasError <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isLoading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>using one of these objects might look like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span>hasError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
  <span class=\"token comment\">// show error state</span>
<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span>isLoading<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
  <span class=\"token comment\">// show loading state</span>
<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>
  <span class=\"token comment\">// show data State</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>In the podcast David Khourshid criticized this as a haphazard way to manage state, that doesn’t show the whole picture.  Because we can’t easily see how the various flags combine, it’s tough to keep track of all possible states.  For instance, in the above example, did we really want to show the error state if we had an error, but have called <code class=\"language-text\">load()</code> again and both <code class=\"language-text\">hasError</code> and <code class=\"language-text\">isLoading</code> are now true?  Maybe that was the intention, but maybe that was just a state that was missed during the original construction of the program.  It’s hard to tell.  </p>
<p>As an alternative to full blown state machine modeling, David advocated for an easy first step of swapping out flags for enums.  In that case the code above might look like:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">STATES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
  <span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'initial'</span><span class=\"token punctuation\">,</span>
  <span class=\"token constant\">LOADING</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>
  <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>
  <span class=\"token constant\">LOADED</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'loaded'</span>
<span class=\"token punctuation\">}</span>
<span class=\"token comment\">// loading object</span>
<span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleLoader</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">;</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token comment\">//fetch data from server and return it here</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token keyword\">async</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span><span class=\"token constant\">LOADING</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">LOADED</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">;</span>
      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">LOADING</span>
        <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">LOADED</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>with usage like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ERROR</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show error state</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOADING</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show loading state</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOADED</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show data State</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">:</span>
  <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show blank state</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>We can see just from using an enum, we’ve cleared some ambiguity: now it is clear that we should be showing a loading state when we’re loading data, even if a previous load resulted in an error.  And we’ve also been forced to remember another state distinction that was missed originally, the difference between a successful load and the initial state before load is called.  This type of Enum-based approach is really helpful for modeling complex systems and especially async process state. But it’s not perfect.  While ENUMs are great for listing out every possible state, sometimes we just need to know if an object is in a particular state.  For instance, we might have a special help-prompt component that should only show if our data is in an error state, but is otherwise divorced from the details of the data.  In that case <code class=\"language-text\">loader.hasError</code> is simpler and  cleaner than <code class=\"language-text\">loader.state === STATES.ERROR</code>.  It’s a straight forward named expression that doesn’t require importing a constant from another file or matching up to a string value.  Enums add some verbosity and ceremony to code that can otherwise be very simple.  Fortunately MobX allows us to have our cake and eat it too.</p>
<h3>MobX</h3>
<p>MobX is a state management solution created by <a href=\"https://twitter.com/mweststrate\">Michael Weststrate</a>.  It grew out of the React community but can be used with other frameworks or on it’s own.  One of its nicest features are its intelligently updated <a href=\"https://mobx.js.org/refguide/computed-decorator.html\">computed properties</a>.  With MobX we can write our loader object like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>extendObservable<span class=\"token punctuation\">,</span> computed<span class=\"token punctuation\">,</span> action <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>
<span class=\"token keyword\">const</span> <span class=\"token constant\">STATES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
  <span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'initial'</span><span class=\"token punctuation\">,</span>
  <span class=\"token constant\">LOADING</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>
  <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>
  <span class=\"token constant\">LOADED</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'loaded'</span>
<span class=\"token punctuation\">}</span>
<span class=\"token comment\">// loading object</span>
<span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleLoader</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span><span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">LOADING</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ERROR</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">;</span>
      <span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
          state<span class=\"token punctuation\">:</span> <span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">,</span>
          isLoading<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">LOADING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
          hasError<span class=\"token punctuation\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
          updateState<span class=\"token punctuation\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span>state <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>
      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token comment\">//fetch data from server and return it here</span>
    <span class=\"token punctuation\">}</span>

    <span class=\"token keyword\">async</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span><span class=\"token constant\">LOADING</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">LOADED</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">;</span>
      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOADING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOADED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateState</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>Now we have both our state enum, and we can check specific properties.  So both of the below examples work:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ENUM example</span>
<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ERROR</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show error state</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOADING</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show loading state</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOADED</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show data State</span>
  <span class=\"token keyword\">case</span> <span class=\"token constant\">STATES</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INITIAL</span><span class=\"token punctuation\">:</span>
  <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>
  <span class=\"token comment\">// show blank state</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//Flags example</span>
<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span>hasError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
  <span class=\"token comment\">// show help component</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>And because MobX takes care of the details of efficiently updating our flags based on state, we know everything will stay in sync and remain performant, without a bunch of ugly code to make sure of that.</p>",
                    "author": {
                      "@type": "Person",
                      "name": "Ben McCormick"
                      "email": "mailto:ben@benmccormick.org",
                      "image": "/profile_pic.jpg",
                      "jobTitle": "Software Engineer",
                      "alumniOf": "Duke",
                      "birthPlace": "Pittsburgh, PA",
                      "gender": "male",
                      "url": "http://benmccormick.org",
                	    "sameAs" : [
                        "https://www.linkedin.com/in/benmccormick",
                        "http://twitter.com/ben336",
                      ]
                   }
                }</script><link as="script" rel="preload" href="/component---src-templates-blog-post-js-3ba9702bf081d153a495.js"/><link as="script" rel="preload" href="/0-2892df2ac865792c1e8c.js"/><link as="script" rel="preload" href="/1-3c4c5867085a3472389c.js"/><link as="script" rel="preload" href="/app-a122d914cf5d49401320.js"/><link as="script" rel="preload" href="/webpack-runtime-1aa3eee3caeb56f28d87.js"/><link rel="preload" href="/static/d/path---2018-05-14-mobx-state-machines-and-flags-372-cdb-hEhR2i7kBn32X0Avq9v5tqOTTk.json" as="fetch" crossOrigin="use-credentials"/><link as="style" rel="preload" href="/component---src-templates-blog-post-js.3c9ce09e7c656a74de5d.css"/><link as="style" rel="preload" href="/0.2ece98f91135ba82c235.css"/></head><body class="landing-page" style="background:#FCFCFC;padding:0 10px"><div id="___gatsby"><div class="css-4u7z7f" data-reactroot=""><div class="css-1rrcu7t"><h3 class="css-nj9d06"><a name="title" href="/">benmccormick.org</a></h3><div class="css-1iige26"><a class="css-1a7irg3" href="/archive/">Blog</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/subscribe/">Subscribe</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/speaking/">Speaking</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="http://twitter.com/ben336">Twitter</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/about/">About</a></div></div><div class="markdown"><div class="post-title-area"><h1 class="css-d0z96">MobX Patterns: State Machines &amp; Flags</h1><h5 class="css-1kurdub">Originally Posted <!-- -->May 14th 2018</h5></div><div class="columns"><div class="css-n40tvx"><p>A few weeks ago, I was listening to the <a href="https://changelog.com/reactpodcast">React Podcast</a>, specifically their <a href="https://changelog.com/reactpodcast/5">episode on State Machines</a> with <a href="https://twitter.com/davidkpiano">David Khourshid</a>.  About 20 minutes into the podcast, there was a discussion on the benefits of using enums over flags to model the state of objects that can change across multiple dimensions.  It reminded me of one of the nice patterns that <a href="https://mobx.js.org/">MobX</a> makes possible, and I thought I’d share it here.</p>
<h3>Background</h3>
<p>To set the stage here, the podcast discussion centered around modeling an async process like a promise. One possible way given was to use a mix of flags and if statements like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// loading object</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleLoader</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//fetch data from server and return it here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>using one of these objects might look like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show error state</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show loading state</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// show data State</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>In the podcast David Khourshid criticized this as a haphazard way to manage state, that doesn’t show the whole picture.  Because we can’t easily see how the various flags combine, it’s tough to keep track of all possible states.  For instance, in the above example, did we really want to show the error state if we had an error, but have called <code class="language-text">load()</code> again and both <code class="language-text">hasError</code> and <code class="language-text">isLoading</code> are now true?  Maybe that was the intention, but maybe that was just a state that was missed during the original construction of the program.  It’s hard to tell.  </p>
<p>As an alternative to full blown state machine modeling, David advocated for an easy first step of swapping out flags for enums.  In that case the code above might look like:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">STATES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INITIAL</span><span class="token punctuation">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADING</span><span class="token punctuation">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
  <span class="token constant">ERROR</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADED</span><span class="token punctuation">:</span> <span class="token string">'loaded'</span>
<span class="token punctuation">}</span>
<span class="token comment">// loading object</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleLoader</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">INITIAL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//fetch data from server and return it here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token constant">LOADING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token constant">LOADED</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">LOADING</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">LOADED</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">ERROR</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>with usage like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">switch</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">:</span>
  <span class="token comment">// show error state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADING</span><span class="token punctuation">:</span>
  <span class="token comment">// show loading state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADED</span><span class="token punctuation">:</span>
  <span class="token comment">// show data State</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">INITIAL</span><span class="token punctuation">:</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
  <span class="token comment">// show blank state</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>We can see just from using an enum, we’ve cleared some ambiguity: now it is clear that we should be showing a loading state when we’re loading data, even if a previous load resulted in an error.  And we’ve also been forced to remember another state distinction that was missed originally, the difference between a successful load and the initial state before load is called.  This type of Enum-based approach is really helpful for modeling complex systems and especially async process state. But it’s not perfect.  While ENUMs are great for listing out every possible state, sometimes we just need to know if an object is in a particular state.  For instance, we might have a special help-prompt component that should only show if our data is in an error state, but is otherwise divorced from the details of the data.  In that case <code class="language-text">loader.hasError</code> is simpler and  cleaner than <code class="language-text">loader.state === STATES.ERROR</code>.  It’s a straight forward named expression that doesn’t require importing a constant from another file or matching up to a string value.  Enums add some verbosity and ceremony to code that can otherwise be very simple.  Fortunately MobX allows us to have our cake and eat it too.</p>
<h3>MobX</h3>
<p>MobX is a state management solution created by <a href="https://twitter.com/mweststrate">Michael Weststrate</a>.  It grew out of the React community but can be used with other frameworks or on it’s own.  One of its nicest features are its intelligently updated <a href="https://mobx.js.org/refguide/computed-decorator.html">computed properties</a>.  With MobX we can write our loader object like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>extendObservable<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">STATES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INITIAL</span><span class="token punctuation">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADING</span><span class="token punctuation">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
  <span class="token constant">ERROR</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADED</span><span class="token punctuation">:</span> <span class="token string">'loaded'</span>
<span class="token punctuation">}</span>
<span class="token comment">// loading object</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleLoader</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token constant">INITIAL</span><span class="token punctuation">,</span> <span class="token constant">LOADING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">;</span>
      <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          state<span class="token punctuation">:</span> <span class="token constant">INITIAL</span><span class="token punctuation">,</span>
          isLoading<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">LOADING</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          hasError<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">ERROR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          updateState<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span>state <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//fetch data from server and return it here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token constant">LOADING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token constant">LOADED</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateState</span><span class="token punctuation">(</span><span class="token constant">LOADING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateState</span><span class="token punctuation">(</span><span class="token constant">LOADED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateState</span><span class="token punctuation">(</span><span class="token constant">ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Now we have both our state enum, and we can check specific properties.  So both of the below examples work:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ENUM example</span>
<span class="token keyword">switch</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">:</span>
  <span class="token comment">// show error state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADING</span><span class="token punctuation">:</span>
  <span class="token comment">// show loading state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADED</span><span class="token punctuation">:</span>
  <span class="token comment">// show data State</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">INITIAL</span><span class="token punctuation">:</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
  <span class="token comment">// show blank state</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">//Flags example</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show help component</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>And because MobX takes care of the details of efficiently updating our flags based on state, we know everything will stay in sync and remain performant, without a bunch of ugly code to make sure of that.</p></div><div class="css-y3ugfx no-mobile"><div class="css-1aluta2"></div><div class="css-m9l7q0"><div id="mc_embed_signup"><h6 class="css-h2hkv8">Subscribe via email</h6><form action="//benmccormick.us8.list-manage.com/subscribe/post?u=115446b80fd9d930ba091cc27&amp;id=f5b9f5acf2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group sidebar-group"><input type="email" name="EMAIL" class="subscribe-email required email" id="mce-EMAIL" placeholder="Email Address" value=""/><input type="submit" value="&gt;" name="subscribe" id="mc-embedded-subscribe" class="subscribe-button button"/></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position:absolute;left:-5000px" aria-hidden="true"><input type="text" name="b_115446b80fd9d930ba091cc27_f5b9f5acf2" tabindex="-1" value=""/></div><div class="clear"></div></div></form></div></div></div></div><div><hr/><div class=""><h3 class="css-4w3jde">You Might Also Like These Articles</h3><ul class="css-33c833"><a class="css-bhw7gr" href="/2017/01/09/mobx-first-impressions/"><div class="css-vjg5fh"><div><div class="css-1m362nd">MobX: First Impressions</div><p class="css-1182rq7">First impression of managing data with MobX</p></div></div><span class="css-17c7pi4 no-mobile">Jan 9th 2017</span></a><a class="css-bhw7gr" href="/2017/07/19/ten-things-javascript/"><div class="css-vjg5fh"><div><div class="css-1m362nd">Ten Things A Serious JavaScript Developer Should Learn</div><p class="css-1182rq7">Some of the important things to pick up in the JS world</p></div></div><span class="css-17c7pi4 no-mobile">Jul 19th 2017</span></a><a class="css-bhw7gr" href="/2017/07/10/how-to-follow-the-javascript-roadmap/"><div class="css-vjg5fh"><div><div class="css-1m362nd">How to follow the JavaScript roadmap</div><p class="css-1182rq7">Keeping up with the language&#x27;s progress</p></div></div><span class="css-17c7pi4 no-mobile">Jul 10th 2017</span></a></ul></div></div></div></div></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script>
          window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"2018-05-14-mobx-state-machines-and-flags-372","path":"/2018/05/14/mobx-state-machines-and-flags/"};window.dataPath="path---2018-05-14-mobx-state-machines-and-flags-372-cdb-hEhR2i7kBn32X0Avq9v5tqOTTk";/*]]>*/</script><script src="/webpack-runtime-1aa3eee3caeb56f28d87.js" async=""></script><script src="/app-a122d914cf5d49401320.js" async=""></script><script src="/1-3c4c5867085a3472389c.js" async=""></script><script src="/0-2892df2ac865792c1e8c.js" async=""></script><script src="/component---src-templates-blog-post-js-3ba9702bf081d153a495.js" async=""></script></body></html>