<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="##0193e8"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.4 'Work Sans','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Work Sans','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;color:inherit;font-family:'Inter','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;color:inherit;font-family:'Inter','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;color:inherit;font-family:'Inter','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;color:inherit;font-family:'Inter','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;color:inherit;font-family:'Inter','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;color:inherit;font-family:'Inter','Helvetica Neue','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}ul{margin-left:1.4rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.4rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.05rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;font-size:1rem;line-height:1.4rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}blockquote{margin-left:1.4rem;margin-right:1.4rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.05rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.05rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.05rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.4rem;margin-bottom:calc(1.05rem / 2);margin-top:calc(1.05rem / 2);}li > ul{margin-left:1.4rem;margin-bottom:calc(1.05rem / 2);margin-top:calc(1.05rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.05rem / 2);}code{font-size:0.85rem;line-height:1.4rem;}kbd{font-size:0.85rem;line-height:1.4rem;}samp{font-size:0.85rem;line-height:1.4rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.93333rem;padding-right:0.93333rem;padding-top:0.7rem;padding-bottom:calc(0.7rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:12px;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}h1,h2,h3,h4,h5,h6{line-height:1.2;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><meta data-react-helmet="true" name="keywords" content="react architecture mistakes confessions"/><meta data-react-helmet="true" name="description" content="Ben McCormick&#x27;s blog on JavaScript and Web Development"/><meta name="generator" content="Gatsby 4.6.0"/><style data-href="/styles.21962497ee016fa624a6.css" data-identity="gatsby-global-css">.markdown pre{background:#343d46;color:#d8dee9;display:block;padding:.8rem}.markdown pre code:after{content:unset}.token.comment,.token.quote{color:#a7adba}.token.addition,.token.attr,.token.selector-tag,.token.string{color:#99c794}.token.doctag,.token.meta .token.meta-string,.token.regexp{color:#89ddf3}.token.built_in,.token.function{color:#5fb3b3}.token.name,.token.section,.token.selector-class,.token.selector-id,.token.title{color:#69c}.token.attribute,.token.class .token.title,.token.template-variable,.token.type,.token.variable{color:#fac863}.token.bullet,.token.link,.token.meta,.token.meta .token.keyword,.token.selector-attr,.token.selector-pseudo,.token.subst,.token.symbol{color:#f9ae58}.token.boolean,.token.deletion,.token.literal,.token.number{color:#f07178}.token.keyword{color:#c594c5}.token.formula{background:#a7adba}.token.emphasis{font-style:italic}.token.strong{font-weight:700}.gatsby-resp-image-wrapper{display:block;margin:40px auto 20px;max-width:75%}.bordered-img{border:3px solid ##0193e8}.img-group{display:flex;justify-content:space-between}.img-group img{height:auto;padding:0}.inline-img{display:inline-block;float:right;padding:2rem;width:45%}.revue-row{grid-gap:5px;align-items:center;display:grid;flex-direction:row;grid-template-columns:1fr;width:100%}.revue-form-footer{color:#777;font-size:10px}.revue-label{font-family:Inter,Helvetica Neue,Arial,sans-serif;font-size:20px;font-weight:700}#member_email{padding-left:5px}#member_email,#member_submit{font-family:Inter,Helvetica Neue,Arial,sans-serif;font-size:14px}#member_submit{background:#f1684e;border:none;border-radius:4px;color:#fff}@media (max-width:960px){#bd-email,#bd-submit{font-size:10px}#bd-label{font-size:12px}}.large-row #bd-email,.large-row #bd-submit{font-size:20px}@media (max-width:700px){.large-row #bd-email,.large-row #bd-submit{font-size:18px}}.bd-subscribe-form{display:block;margin:30px 0 50px}.bd-subscribe-row{grid-column-gap:5%;display:grid;grid-template-columns:60% 35%;grid-template-rows:1fr;margin-top:10px}@media (max-width:960px){.bd-subscribe-row{grid-row-gap:10%;grid-template-columns:1fr;grid-template-rows:1fr 1fr}}.twitter-tweet,twitterwidget{margin-left:auto;margin-right:auto}.carbon-wrap{grid-column-gap:10px;align-items:center;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;margin-bottom:30px;padding-left:5px}@media (max-width:960px){.carbon-wrap{grid-row-gap:10px;grid-template-columns:1fr;grid-template-rows:110px 1fr;justify-items:center}}.carbon-wrap img{margin-bottom:0}.carbon-text{display:inline-block;line-height:1.3;overflow:hidden;padding:5px 5px 5px 0}.carbon-poweredby{bottom:0;color:#777;position:absolute;right:5px}.columns{grid-column-gap:25px;display:grid;grid-template-columns:665px 270px;grid-template-rows:1fr}@media (max-width:960px){.columns{grid-column-gap:2%;display:grid;grid-template-columns:70% 28%}}@media (max-width:700px){.columns{align-items:center;display:flex;flex-direction:column}.no-mobile{display:none}}@media (max-width:321px){html{font-size:100%!important}}body{color:#474747}a{color:#f1684e;cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}.footnote-backref,.footnote-ref{padding-left:3px;text-decoration:none}blockquote{background:#eee;border-left:5px solid #0193e8;font-size:.9rem;font-weight:400;margin:0 0 1rem;padding:1.5rem 2rem}blockquote p{margin-bottom:.667em}h3{color:#0193e8}h4{font-size:110%}.explanation{background:#eee;border-radius:10px;font-size:.85em;margin:20px auto;padding:10px}.footnotes{font-size:80%}.footnotes li>*{display:inline;margin-bottom:0}strong{color:#222}em{color:#666}.markdown iframe{margin:0 auto}</style><style id="glamor-styles">.css-1yerfx4,[data-css-1yerfx4]{color:#777777;font-size:16px;font-family:"Inter", "Helvetica Neue", "Helvetica", Arial, sans-serif;}.css-1yerfx4:hover,[data-css-1yerfx4]:hover{color:#F1684E;}.css-pe78rs,[data-css-pe78rs]{font-size:16px;font-family:"Inter", "Helvetica Neue", "Helvetica", Arial, sans-serif;}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["1yerfx4","pe78rs"]
        // ]]>
        </script><title data-react-helmet="true">React Architecture Confessions | benmccormick.org</title><script data-react-helmet="true" type="application/ld+json">{
                  "@context": "http://schema.org"
                  "@type": "BlogPosting",
                  "headline": "React Architecture Confessions",
                  "genre": "Software Development",
                  "keywords": "react architecture mistakes confessions",
                  "url": "http://benmccormick.org//2018/02/07/react-confessions/",
                  "image": "http://benmccormick.org/logo.png",
                  "datePublished": "2018-02-7",
                  
                  "articleBody": "<p>I’ve been reading through <a href=\"http://amzn.to/2mKoejo\">Clean Architecture</a> by Robert “Uncle Bob” Martin this month<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>, and while it is great it has had the unpleasant effect of reminding me of all of the mistakes I’ve made over the past few years while learning and using <a href=\"https://reactjs.org/\">React</a>.  I’ve absolutely loved using React at work, and it has made so many things easier.  But it’s a very unopinionated tool when it comes to structuring applications, and I made a lot of mistakes as I was using it to build some small side projects, and then transitioned a major production app to React from Backbone/Marionette.  These mistakes are all architectural; how I broke out components, communicated between components, and managed data and dependencies within components.</p>
<p>I thought it would be useful to lay out the architecture mistakes I made as I was learning React, both as a solid reflection exercise for myself, and a warning to those of you who are just starting down the “component based UI” road.</p>
<h3>My Mistakes</h3>
<h4>1. Including API calls directly in components</h4>
<p><strong>What I did wrong</strong>: This is an embarrassing one, but essentially in several places I had components directly fetching data from the server in their constructors or mount calls, and using that information to determine what to render.</p>
<p><strong>Why I did it</strong>: This was to some extent a lack of planning.  I had all my core “business objects” modeled in some sort of separate object oriented way (either as Backbone or MobX objects) and was able to coordinate syncing them to the server outside of the component layer.  But some data in the system hadn’t been modeled in that way, and when I encountered a need for those components (such as some types of system configurations) instead of stepping back and coming up with a design for modeling those configurations on the front end, I instead sometimes fell back to an ad-hoc API call.   This was also sometimes a result of lazily copying legacy code that had bad patterns while converting components to React, and other developers copying bad patterns when trying to figure out the new React code.</p>
<p><strong>What I should have done instead</strong>: This could be a whole series of blog posts in itself, but essentially I should have been observing a few principles that would have set off alarm bells.</p>
<ol>
<li>Components in a system of any size shouldn’t know about the server. UI Components are about as “low level detail” as it gets in a UI architecture, and should be passed the data they need from a higher level portion of the system.</li>
<li>If the front end code needs data from the server, it is worth the time to properly model that data in terms of whatever data layer the front end is using.</li>
</ol>
<h4>2. Breaking the “props as the component interface” abstraction</h4>
<p><strong>What I did wrong</strong>: One of the best things about React is the clear interfaces components provide with their list of props.  If properly documented with PropTypes or a type system like Flow or Typescript, it’s easy to look at any React component and tell what data it expects to receive, and therefore how other code is expected to interact with it.  99% of the time, good React components act as a function of <code class=\"language-text\">(props, state) => UI</code>.  It is however, possible to get access to a component instance, and call functions on them.  There are  rare situations where this is the right way to do things, for instance <a href=\"https://stackoverflow.com/questions/28889826/react-set-focus-on-input-after-render\">focusing an input</a>.</p>
<p>When I first started creating React components though, I overused that pattern, and accessed the interface directly to access or change its internal state.  I’d have components like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SpecialInput</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>
  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
      <span class=\"token literal-property property\">inputValue</span><span class=\"token operator\">:</span> <span class=\"token string\">'abc'</span>
    <span class=\"token punctuation\">}</span>
  <span class=\"token punctuation\">}</span>
  <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">;</span>
  <span class=\"token punctuation\">}</span>
  <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">inputValue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>inputValue<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
  <span class=\"token punctuation\">}</span>
  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input
      className<span class=\"token operator\">=</span><span class=\"token string\">'fancy-input'</span>
      defaultValue<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">}</span>
      onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">inputValue</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>inputValue<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>
    <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>
  <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre></div>
<p>that I would access from parent container like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">
<span class=\"token keyword\">class</span> <span class=\"token class-name\">InputUser</span>

  <span class=\"token function\">methodThatGotCalledOnSomeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>
  <span class=\"token punctuation\">}</span>

  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>
      <span class=\"token operator\">&lt;</span>SpecialInput ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>input <span class=\"token operator\">=</span> el<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>
    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
  <span class=\"token punctuation\">}</span></code></pre></div>
<p><strong>Why I did it</strong>:  Early on I was using this pattern in a way that copied other frameworks I was familiar with.  A parent component would need the state of it’s child component, so it would maintain a reference to the child and query the child about the state.  When I converted Backbone components to React, sometimes I was basically just copy and pasting existing code, and making it work.</p>
<p><strong>What I should have done instead</strong>:  React doesn’t really encourage parents pulling state from their children.  Instead, if there is state that needs to be shared between components, it should be moved up to the parent component and then the state and an updater function should be passed down to the child component.  So my example above would look like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SpecialInput</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>
  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input
      className<span class=\"token operator\">=</span><span class=\"token string\">'fancy-input'</span>
      defaultValue<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span>
      onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">updateValue</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>
    <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>
  <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre></div>
<p>that I would access from parent container like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">
<span class=\"token keyword\">class</span> <span class=\"token class-name\">InputUser</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>
  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
   <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
      <span class=\"token literal-property property\">inputValue</span><span class=\"token operator\">:</span> <span class=\"token string\">'abc'</span>
    <span class=\"token punctuation\">}</span>
  <span class=\"token punctuation\">}</span>

  <span class=\"token function\">methodThatGotCalledOnSomeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">)</span>
  <span class=\"token punctuation\">}</span>

  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>
        <span class=\"token operator\">&lt;</span>SpecialInput
             value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">}</span>
             updateValue<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">inputValue</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>inputValue<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>
          <span class=\"token operator\">/</span><span class=\"token operator\">></span>
    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>

  <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre></div>
<h4>3. Interacting with 3rd party components directly</h4>
<p><strong>What I did wrong</strong>: My first year and a half using React, when I was using 3rd party UI components like <a href=\"https://github.com/facebookarchive/fixed-data-table\">react-fixed-data-table</a> I would always use them directly in my components, and take full advantage of their APIs.</p>
<p><strong>Why I did it</strong>: Because every React library in the world has documentation showing how to use its components directly in code for a variety of different use cases, and nobody ever tells you to put an abstraction around their code</p>
<p><strong>What I should have done instead</strong>: I should have wrapped the 3rd party libraries in one or more wrapper components.  This has a few advantages:</p>
<ol>
<li>When we’re using a UI component like a table in a new place in our App, if I’ve created a wrapper component that has presets for most common settings, I only need to configure the things that are meaningful to this new use case in my app</li>
<li>Targeted wrapper components like a <code class=\"language-text\">SortableTable</code> component or a <code class=\"language-text\">DropdownWithAutoComplete</code> component are easy to understand to a new reader of the code.  Instead of digging through configuration props, they can read the component name and understand the purpose of that component then focus on the data being passed to it</li>
<li>When making updates to a library it is much easier to test that the changes are safe if the uses of the library are limited to a few focused components, rather than being spread across a whole application</li>
<li>Similarly, if we need to switch to a new library, that is much easier with a limited footprint</li>
<li>It can be easier to create reliable automatic tests using a wrapper component, since you have more control of things like how mocking works and when the component interface changes than you do for 3rd party code</li>
</ol>
<h4>4. Importing other parts of the system directly into display components</h4>
<p><strong>What I did wrong</strong>: The main application I work on uses a messaging system to allow communication between different parts of the system.  It’s a legacy piece from when it existed as a Backbone application, and isn’t a very React-y way of doing things, but that isn’t really a problem.  This situation would be the same for a logging component or a data store.  What isn’t great is that when I need to use the messaging system, I always import it directly into the component file.</p>
<p><strong>Why I did it</strong>: Direct imports are convenient, the messaging system is a core part of my system, and it seemed like a normal way of accessing it.  I also wasn’t aware of any better way to do it.</p>
<p><strong>What I should have done instead</strong>:  The disadvantage of direct imports is that they’re harder to test.  If I had passed my messaging system as a prop to whatever component needed it, it would be much easier to test that it was called in the way I expected, without having to mock out the whole messaging system library.  I also could abstract away the whole power of the messaging system, and only provide the specific functionality needed by a component.  When I first began working on this system though, I didn’t know a practical way to do this.  The messenger system was often used by deeply nested components, and it seemed bad to pass it down a whole component tree.</p>
<p>The answer is to use the <a href=\"https://www.robinwieruch.de/react-provider-pattern-context/\">Provider pattern</a>.  The provider pattern is a way to use React’s context API to provide top level properties from a high level parent component to deeply nested child components.  It is a perfect pattern for providing important high level pieces of your application to low level components without tightly coupling them, while maintaining testability.<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></p>
<h4>5. Changing too many things at once</h4>
<p><strong>What I did wrong</strong>: When my team began converting our application from Backbone to React, it was tempting to try and change many things at once.  All the React examples you see online are using Babel/ES6, Webpack, Redux, React Router and tons of other shiny but complicated things.  Trying to implement it all in an existing project<sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup> can be overwhelming and lead to <a href=\"http://mikehadlow.blogspot.com/2014/12/the-lava-layer-anti-pattern.html\">lava layers</a>.  We actually started out with good discipline and converted files to use ES6 first, then added Webpack, then slowly started to convert UI components to React.  Unfortunately as we continued to convert React, we began replacing our Backbone data models with MobX, and began using CSS Modules in some places.  When our team size was reduced last year, we were left in a situation where the same functions were performed in different ways throughout the codebase.</p>
<p><strong>Why I did it</strong>: It’s easy to see things that could be better in a web application and immediately want to fix them!  Especially if parts of that change seem easier than other changes you’re working on</p>
<p><strong>What I should have done instead</strong>: I wrote about this <a href=\"https://benmccormick.org/2018/01/07/large-improvements-small-team/\">at length</a> last month, but there really is no substitute for taking things one at a time.  While it’s tempting to think that it will be easier to convert to React if you’re using other “react-y” tools and libraries, your code will ultimately be more maintainable if it is consistent throughout an application.  The only reliable way to do that is to make changes completely before you start making other changes.  It isn’t sexy, and it will leave you at least a little ways off the bleeding edge, but it’s the way to build large, reliable systems and keep them up to date.</p>
<div class=\"footnotes\">
<hr>
<ol>
<li id=\"fn-1\">At the time of writing this, it was super on sale on <a href=\"http://amzn.to/2mKoejo\">Amazon</a><a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>
<li id=\"fn-2\">Note that the Context API that the provider pattern is based on is changing, so I’d isolating out any provider code you write into a reusable component so that it is easy to update later<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>
<li id=\"fn-3\">Or even a new project for that matter!<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a></li>
</ol>
</div>",
                    "author": {
                      "@type": "Person",
                      "name": "Ben McCormick"
                      "email": "mailto:ben@benmccormick.org",
                      "image": "/profile_pic.jpg",
                      "jobTitle": "Software Engineer",
                      "alumniOf": "Duke",
                      "birthPlace": "Pittsburgh, PA",
                      "gender": "male",
                      "url": "http://benmccormick.org",
                	    "sameAs" : [
                        "https://www.linkedin.com/in/benmccormick",
                        "http://twitter.com/_benmccormick",
                      ]
                   }
                }</script><link href="https://fonts.googleapis.com/css?family=Inter|Work+Sans&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-27bb7198da2874802a78.js"/><link as="script" rel="preload" href="/framework-33fd2a29159c65f5ba17.js"/><link as="script" rel="preload" href="/app-adfb23151c91a243bacb.js"/><link as="script" rel="preload" href="/commons-62528db37e44861acd08.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-4516b2a8ec63c40e3c81.js"/><link as="fetch" rel="preload" href="/page-data/2018/02/07/react-confessions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="landing-page" style="background:#FCFCFC"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css hkr7jf">.css-hkr7jf{width:100%;max-width:1000px;margin:0 auto;padding:2.1rem 20px;}</style><div class="css-hkr7jf em100y90"><style data-emotion="css 1isguim">.css-1isguim{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-bottom:2rem;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-1isguim e1b8f8ar3"><style data-emotion="css txnzm6">.css-txnzm6{margin:0 20px 0 0;padding-bottom:0;}.css-txnzm6 a{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-txnzm6 a:hover{-webkit-text-decoration:none;text-decoration:none;}</style><h3 class="css-txnzm6 e1b8f8ar1"><a name="title" href="/">Ben McCormick</a></h3><style data-emotion="css 15ui8t3">.css-15ui8t3{color:#777777;}</style><div class="css-15ui8t3 e1b8f8ar0"><a class="css-1yerfx4" href="/archive/">Blog</a><style data-emotion="css 12jh0su">.css-12jh0su{padding:0 0.5rem;}@media all and (max-width: 400px){.css-12jh0su{padding:0 0.25rem;}}</style><span class="css-12jh0su e1b8f8ar2"></span><a class="css-1yerfx4" href="/subscribe/">Subscribe</a><span class="css-12jh0su e1b8f8ar2"></span><a class="css-1yerfx4" href="/speaking/">Speaking</a><span class="css-12jh0su e1b8f8ar2"></span><a class="css-1yerfx4" href="http://twitter.com/_benmccormick">Twitter</a><span class="css-12jh0su e1b8f8ar2"></span><a class="css-1yerfx4" href="/about/">About</a></div></div><article class="markdown"><div class="post-title-area"><style data-emotion="css 1wdikty">.css-1wdikty{display:block;max-width:100%;}</style><h1 class="css-1wdikty e15djruj3">React Architecture Confessions</h1></div><div class="columns"><style data-emotion="css qsg3oo">.css-qsg3oo{max-width:100%;}.css-qsg3oo li{padding-left:10px;}.css-qsg3oo .reading-img img{width:150px;float:right;margin:0px 10px 20px 10px;}.css-qsg3oo img.full-width{max-height:none;}.css-qsg3oo img.half-width{max-height:none;width:50%;}</style><div class="css-qsg3oo e15djruj1"><p>I’ve been reading through <a href="http://amzn.to/2mKoejo">Clean Architecture</a> by Robert “Uncle Bob” Martin this month<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>, and while it is great it has had the unpleasant effect of reminding me of all of the mistakes I’ve made over the past few years while learning and using <a href="https://reactjs.org/">React</a>.  I’ve absolutely loved using React at work, and it has made so many things easier.  But it’s a very unopinionated tool when it comes to structuring applications, and I made a lot of mistakes as I was using it to build some small side projects, and then transitioned a major production app to React from Backbone/Marionette.  These mistakes are all architectural; how I broke out components, communicated between components, and managed data and dependencies within components.</p>
<p>I thought it would be useful to lay out the architecture mistakes I made as I was learning React, both as a solid reflection exercise for myself, and a warning to those of you who are just starting down the “component based UI” road.</p>
<h3>My Mistakes</h3>
<h4>1. Including API calls directly in components</h4>
<p><strong>What I did wrong</strong>: This is an embarrassing one, but essentially in several places I had components directly fetching data from the server in their constructors or mount calls, and using that information to determine what to render.</p>
<p><strong>Why I did it</strong>: This was to some extent a lack of planning.  I had all my core “business objects” modeled in some sort of separate object oriented way (either as Backbone or MobX objects) and was able to coordinate syncing them to the server outside of the component layer.  But some data in the system hadn’t been modeled in that way, and when I encountered a need for those components (such as some types of system configurations) instead of stepping back and coming up with a design for modeling those configurations on the front end, I instead sometimes fell back to an ad-hoc API call.   This was also sometimes a result of lazily copying legacy code that had bad patterns while converting components to React, and other developers copying bad patterns when trying to figure out the new React code.</p>
<p><strong>What I should have done instead</strong>: This could be a whole series of blog posts in itself, but essentially I should have been observing a few principles that would have set off alarm bells.</p>
<ol>
<li>Components in a system of any size shouldn’t know about the server. UI Components are about as “low level detail” as it gets in a UI architecture, and should be passed the data they need from a higher level portion of the system.</li>
<li>If the front end code needs data from the server, it is worth the time to properly model that data in terms of whatever data layer the front end is using.</li>
</ol>
<h4>2. Breaking the “props as the component interface” abstraction</h4>
<p><strong>What I did wrong</strong>: One of the best things about React is the clear interfaces components provide with their list of props.  If properly documented with PropTypes or a type system like Flow or Typescript, it’s easy to look at any React component and tell what data it expects to receive, and therefore how other code is expected to interact with it.  99% of the time, good React components act as a function of <code class="language-text">(props, state) => UI</code>.  It is however, possible to get access to a component instance, and call functions on them.  There are  rare situations where this is the right way to do things, for instance <a href="https://stackoverflow.com/questions/28889826/react-set-focus-on-input-after-render">focusing an input</a>.</p>
<p>When I first started creating React components though, I overused that pattern, and accessed the interface directly to access or change its internal state.  I’d have components like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">SpecialInput</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">inputValue</span><span class="token operator">:</span> <span class="token string">'abc'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token parameter">inputValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input
      className<span class="token operator">=</span><span class="token string">'fancy-input'</span>
      defaultValue<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">}</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">inputValue</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>that I would access from parent container like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">
<span class="token keyword">class</span> <span class="token class-name">InputUser</span>

  <span class="token function">methodThatGotCalledOnSomeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doSomethingWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>SpecialInput ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">el</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>input <span class="token operator">=</span> el<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p><strong>Why I did it</strong>:  Early on I was using this pattern in a way that copied other frameworks I was familiar with.  A parent component would need the state of it’s child component, so it would maintain a reference to the child and query the child about the state.  When I converted Backbone components to React, sometimes I was basically just copy and pasting existing code, and making it work.</p>
<p><strong>What I should have done instead</strong>:  React doesn’t really encourage parents pulling state from their children.  Instead, if there is state that needs to be shared between components, it should be moved up to the parent component and then the state and an updater function should be passed down to the child component.  So my example above would look like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">SpecialInput</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input
      className<span class="token operator">=</span><span class="token string">'fancy-input'</span>
      defaultValue<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>value<span class="token punctuation">}</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">updateValue</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>that I would access from parent container like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">
<span class="token keyword">class</span> <span class="token class-name">InputUser</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">inputValue</span><span class="token operator">:</span> <span class="token string">'abc'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">methodThatGotCalledOnSomeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doSomethingWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>SpecialInput
             value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">}</span>
             updateValue<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">inputValue</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h4>3. Interacting with 3rd party components directly</h4>
<p><strong>What I did wrong</strong>: My first year and a half using React, when I was using 3rd party UI components like <a href="https://github.com/facebookarchive/fixed-data-table">react-fixed-data-table</a> I would always use them directly in my components, and take full advantage of their APIs.</p>
<p><strong>Why I did it</strong>: Because every React library in the world has documentation showing how to use its components directly in code for a variety of different use cases, and nobody ever tells you to put an abstraction around their code</p>
<p><strong>What I should have done instead</strong>: I should have wrapped the 3rd party libraries in one or more wrapper components.  This has a few advantages:</p>
<ol>
<li>When we’re using a UI component like a table in a new place in our App, if I’ve created a wrapper component that has presets for most common settings, I only need to configure the things that are meaningful to this new use case in my app</li>
<li>Targeted wrapper components like a <code class="language-text">SortableTable</code> component or a <code class="language-text">DropdownWithAutoComplete</code> component are easy to understand to a new reader of the code.  Instead of digging through configuration props, they can read the component name and understand the purpose of that component then focus on the data being passed to it</li>
<li>When making updates to a library it is much easier to test that the changes are safe if the uses of the library are limited to a few focused components, rather than being spread across a whole application</li>
<li>Similarly, if we need to switch to a new library, that is much easier with a limited footprint</li>
<li>It can be easier to create reliable automatic tests using a wrapper component, since you have more control of things like how mocking works and when the component interface changes than you do for 3rd party code</li>
</ol>
<h4>4. Importing other parts of the system directly into display components</h4>
<p><strong>What I did wrong</strong>: The main application I work on uses a messaging system to allow communication between different parts of the system.  It’s a legacy piece from when it existed as a Backbone application, and isn’t a very React-y way of doing things, but that isn’t really a problem.  This situation would be the same for a logging component or a data store.  What isn’t great is that when I need to use the messaging system, I always import it directly into the component file.</p>
<p><strong>Why I did it</strong>: Direct imports are convenient, the messaging system is a core part of my system, and it seemed like a normal way of accessing it.  I also wasn’t aware of any better way to do it.</p>
<p><strong>What I should have done instead</strong>:  The disadvantage of direct imports is that they’re harder to test.  If I had passed my messaging system as a prop to whatever component needed it, it would be much easier to test that it was called in the way I expected, without having to mock out the whole messaging system library.  I also could abstract away the whole power of the messaging system, and only provide the specific functionality needed by a component.  When I first began working on this system though, I didn’t know a practical way to do this.  The messenger system was often used by deeply nested components, and it seemed bad to pass it down a whole component tree.</p>
<p>The answer is to use the <a href="https://www.robinwieruch.de/react-provider-pattern-context/">Provider pattern</a>.  The provider pattern is a way to use React’s context API to provide top level properties from a high level parent component to deeply nested child components.  It is a perfect pattern for providing important high level pieces of your application to low level components without tightly coupling them, while maintaining testability.<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup></p>
<h4>5. Changing too many things at once</h4>
<p><strong>What I did wrong</strong>: When my team began converting our application from Backbone to React, it was tempting to try and change many things at once.  All the React examples you see online are using Babel/ES6, Webpack, Redux, React Router and tons of other shiny but complicated things.  Trying to implement it all in an existing project<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup> can be overwhelming and lead to <a href="http://mikehadlow.blogspot.com/2014/12/the-lava-layer-anti-pattern.html">lava layers</a>.  We actually started out with good discipline and converted files to use ES6 first, then added Webpack, then slowly started to convert UI components to React.  Unfortunately as we continued to convert React, we began replacing our Backbone data models with MobX, and began using CSS Modules in some places.  When our team size was reduced last year, we were left in a situation where the same functions were performed in different ways throughout the codebase.</p>
<p><strong>Why I did it</strong>: It’s easy to see things that could be better in a web application and immediately want to fix them!  Especially if parts of that change seem easier than other changes you’re working on</p>
<p><strong>What I should have done instead</strong>: I wrote about this <a href="https://benmccormick.org/2018/01/07/large-improvements-small-team/">at length</a> last month, but there really is no substitute for taking things one at a time.  While it’s tempting to think that it will be easier to convert to React if you’re using other “react-y” tools and libraries, your code will ultimately be more maintainable if it is consistent throughout an application.  The only reliable way to do that is to make changes completely before you start making other changes.  It isn’t sexy, and it will leave you at least a little ways off the bleeding edge, but it’s the way to build large, reliable systems and keep them up to date.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">At the time of writing this, it was super on sale on <a href="http://amzn.to/2mKoejo">Amazon</a><a href="#fnref-1" class="footnote-backref">↩</a></li>
<li id="fn-2">Note that the Context API that the provider pattern is based on is changing, so I’d isolating out any provider code you write into a reusable component so that it is easy to update later<a href="#fnref-2" class="footnote-backref">↩</a></li>
<li id="fn-3">Or even a new project for that matter!<a href="#fnref-3" class="footnote-backref">↩</a></li>
</ol>
</div></div><style data-emotion="css nrqgw7">.css-nrqgw7{padding-left:2rem;overflow:hidden;}</style><div class="no-mobile css-nrqgw7 e15djruj0"><style data-emotion="css 1y23a7j">.css-1y23a7j{overflow:hidden;margin:0;}.css-1y23a7j #mc_embed_signup form{margin-bottom:20px;}@media all and (max-width: 700px){.css-1y23a7j{padding-right:0;width:100%!important;padding:0 10px;}.css-1y23a7j .mc-field-group{width:100%!important;}.css-1y23a7j .mc-field-group input{width:100%!important;font-size:0.8em;height:2.4em;}}</style><div class="css-1y23a7j e1qbom70"><div id="revue-embed"><form action="http://herdinglions.benmccormick.org/add_subscriber" method="post" id="revue-form" name="revue-form" target="_blank"><div class="revue-row"><div>Subscribe To My Newsletter</div><input type="email" class="revue-form-field" placeholder="Your email address..." name="member[email]" id="member_email"/><input type="submit" value="Subscribe" name="member[subscribe]" id="member_submit"/><div class="revue-form-footer">By subscribing, you agree with Revue’s<!-- --> <a target="_blank" href="https://www.getrevue.co/terms">Terms of Service</a> <!-- -->and<!-- --> <a target="_blank" href="https://www.getrevue.co/privacy">Privacy Policy</a>.</div></div></form></div></div><style data-emotion="css 1cdsqjf">.css-1cdsqjf{width:100%;overflow:hidden;margin:0 0 1rem 0;font-size:14px;position:relative;font-family:"Inter","Helvetica Neue","Helvetica",Arial,sans-serif;background:rgba(99, 159, 110, 0.25);border:1px solid rgba(90, 150, 100, 0.5);padding:4px;min-height:100px;opacity:0;-webkit-transition:opacity ease 3s;transition:opacity ease 3s;}@media all and (max-width: 700px){.css-1cdsqjf{display:none;}}</style><div class="css-1cdsqjf etmlefq0"></div><style data-emotion="css fbgm9t">.css-fbgm9t{font-size:13px;background-color:rgba(150, 178, 198, 0.4);border:1px solid rgb(150, 178, 198);padding:0.5rem;}.css-fbgm9t>h4{font-size:20px;margin-bottom:6px;}.css-fbgm9t>h6{font-size:16px;margin-bottom:6px;margin-top:12px;}</style><div class="css-fbgm9t e15djruj2"><h4>Article Info</h4><h6>Author</h6><a href="/about">Ben McCormick</a><h6>Publish Date</h6>February 7th 2018<h6>Category</h6><a href="/category/fe-architecture"><style data-emotion="css 1bs7qd7">.css-1bs7qd7:hover{-webkit-text-decoration:none;text-decoration:none;}</style><div class="css-1bs7qd7 e1nsgn8x0">Architecture</div></a></div></div></div></article></div><style data-emotion="css 1jou7jf">.css-1jou7jf{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:3em 0 1em 0;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;background-color:rgba(150, 178, 198, 0.4);border-top:1px solid rgb(150, 178, 198);}</style><div class="css-1jou7jf e7oz9l34"><style data-emotion="css 1iyv46l">.css-1iyv46l{width:100%;min-height:200px;max-width:960px;margin:0 auto;padding:0 1.05rem;display:grid;grid-template-columns:45% 45%;grid-column-gap:10%;grid-row-gap:30px;}@media all and (max-width: 450px){.css-1iyv46l{grid-template-columns:100%;}}</style><div class="css-1iyv46l e7oz9l33"><div><h2 class="css-0 e7oz9l31">Content</h2><style data-emotion="css xqihar">.css-xqihar{display:grid;grid-template-columns:1fr;grid-auto-rows:1fr;grid-row-gap:20px;}</style><div class="css-xqihar e7oz9l32"><a class="css-pe78rs" href="/archive/">Blog Archive</a><a class="css-pe78rs" href="/reviews-archive/">Book Reviews</a><a class="css-pe78rs" href="https://buttondown.email/benmccormick">Newsletter Archives</a><a class="css-pe78rs" href="/speaking/">Speaking</a></div></div><div><h2 class="css-0 e7oz9l31">Meta</h2><div class="css-xqihar e7oz9l32"><a class="css-pe78rs" href="/subscribe/">Subscribe To The Newsletter</a><a class="css-pe78rs" href="/built-with/">Built With</a><a class="css-pe78rs" href="http://twitter.com/_benmccormick">Personal Twitter</a><a class="css-pe78rs" href="http://twitter.com/benmccormickorg">Blog Twitter</a><a class="css-pe78rs" href="/about/">About Me</a></div></div><style data-emotion="css lfoydm">.css-lfoydm{font-family:"Inter","Helvetica Neue","Helvetica",Arial,sans-serif;font-size:14px;overflow:visible;white-space:nowrap;}</style><div class="css-lfoydm e7oz9l30">Copyright © 2012-2021 · Ben McCormick</div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2018/02/07/react-confessions/";window.___webpackCompilationHash="c2b7a7d72d0beca34400";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1160cb89470df92342a6.js"],"app":["/app-adfb23151c91a243bacb.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-0931ec0ced6486598e09.js"],"component---src-pages-index-js":["/component---src-pages-index-js-7a70f21961d3966b2ed9.js"],"component---src-pages-links-archive-js":["/component---src-pages-links-archive-js-897e809be2d8bce650a1.js"],"component---src-pages-lions-archive-js":["/component---src-pages-lions-archive-js-e5c6f4241adfca5990fb.js"],"component---src-pages-reviews-archive-js":["/component---src-pages-reviews-archive-js-76ac8639c604e8a08e4c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-4516b2a8ec63c40e3c81.js"],"component---src-templates-category-page-js":["/component---src-templates-category-page-js-162607b2be33c1e98678.js"],"component---src-templates-topic-page-js":["/component---src-templates-topic-page-js-e54725d3d472f5e6a7c6.js"]};/*]]>*/</script><script src="/polyfill-1160cb89470df92342a6.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-4516b2a8ec63c40e3c81.js" async=""></script><script src="/commons-62528db37e44861acd08.js" async=""></script><script src="/app-adfb23151c91a243bacb.js" async=""></script><script src="/framework-33fd2a29159c65f5ba17.js" async=""></script><script src="/webpack-runtime-27bb7198da2874802a78.js" async=""></script></body></html>