<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#57a3e8"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'Garamond','Baskerville','Baskerville Old Face','Hoefler Text','Times New Roman',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Garamond','Baskerville','Baskerville Old Face','Hoefler Text','Times New Roman',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.2rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.2rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:14px;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:"¬†";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style type="text/css" data-href="/0.3145d1f9f21dcd679291.css">a{color:#e2777a;text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}.footnote-backref,.footnote-ref{text-decoration:none;padding-left:3px}blockquote{border-left:5px solid #57a3e8;background:#eee;font-weight:400;font-size:.9rem;padding:1.5rem 2rem;margin:0 0 1rem}blockquote p{margin-bottom:.667em}h3{color:#57a3e8}h4{font-size:110%}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnotes{font-size:80%}.footnotes li>*{display:inline;margin-bottom:0}
#carbonads{height:300px;font-size:14px;width:150px;position:relative;border:3px solid #f0f0f0;padding:7px}.carbon-wrap{width:130px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}.carbon-text{padding:5px 10px;max-height:120px;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:hsla(0,0%,39%,.7);position:absolute;right:5px;bottom:0}.post-title-area{padding:1em 0}
.columns{display:grid;grid-template-columns:600px 1fr;grid-template-rows:1fr;grid-column-gap:50px}@media (max-width:700px){.columns{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center}.no-mobile{display:none}}@media (max-width:321px){html{font-size:100%!important}}

/*# sourceMappingURL=0.3145d1f9f21dcd679291.css.map*/</style><style type="text/css" data-href="/component---src-templates-blog-post-js.3ad4ad0634b12ff47adb.css">.markdown pre{display:block;background:#343d46;color:#d8dee9;padding:.8rem}.markdown pre code:after{content:unset}.token.comment,.token.quote{color:#a7adba}.token.addition,.token.attr,.token.selector-tag,.token.string{color:#99c794}.token.doctag,.token.meta .token.meta-string,.token.regexp{color:#89ddf3}.token.built_in,.token.function{color:#5fb3b3}.token.name,.token.section,.token.selector-class,.token.selector-id,.token.title{color:#69c}.token.attribute,.token.class .token.title,.token.template-variable,.token.type,.token.variable{color:#fac863}.token.bullet,.token.link,.token.meta,.token.meta .token.keyword,.token.selector-attr,.token.selector-pseudo,.token.subst,.token.symbol{color:#f9ae58}.token.boolean,.token.deletion,.token.literal,.token.number{color:#f07178}.token.keyword{color:#c594c5}.token.formula{background:#a7adba}.token.emphasis{font-style:italic}.token.strong{font-weight:700}
.gatsby-resp-image-wrapper{max-width:75%;display:block;margin:40px auto 20px}.bordered-img{border:3px solid #57a3e8}.img-group{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.img-group img{padding:0;height:auto}.inline-img{display:inline-block;float:right;padding:2rem}
.subscribe-page-group{width:400px;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.subscribe-page-group input{border-radius:3px;max-width:350px;width:80vw;border:1px solid #ccc;margin-right:10px;height:30px}.mc-field-group label{font-size:.9em;font-weight:600}.subscribe-button-large{font-family:-apple-system,system-ui,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:0 10px;margin:10px 0;cursor:pointer;width:40vw}.subscribe-button-large:hover{background:#3e8acf}.twitter-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.twitter-row>div{padding-right:20px;min-width:300px}
.twitter-tweet,twitterwidget{margin-left:auto;margin-right:auto}
.sidebar-group{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.sidebar{padding-left:2rem}.subscribe-container{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;-ms-flex-wrap:wrap;flex-wrap:wrap}.subscribe-email{padding:0 .1rem;margin:0 .2rem 0 0;font-size:.7rem;height:1.5rem;width:6rem}.subscribe-button{color:#fff;background:#57a3e8;border-radius:4px;font-size:1rem;line-height:1rem;height:1.5rem;width:1.5rem;max-width:2rem;-ms-flex-positive:0;flex-grow:0;border:0;margin:0;cursor:pointer}.rss{padding-bottom:10px}.rss a{display:-ms-flexbox;display:flex}.rss-icon{display:block;width:17px;margin-right:.5em;height:50px}.rss-icon *{fill:#e2777a}.twitter-item{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;margin-bottom:15px}.twitter-item iframe{margin:0 0 0 10px}

/*# sourceMappingURL=component---src-templates-blog-post-js.3ad4ad0634b12ff47adb.css.map*/</style><style id="glamor-styles">.css-1a7irg3,[data-css-1a7irg3]{color:rgba(100,100,100, 0.7);font-size:16px;font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}.css-1a7irg3:hover,[data-css-1a7irg3]:hover{color:#E2777A;}.css-bhw7gr,[data-css-bhw7gr]{font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:120%;margin:0 1px 0.8rem 1px;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;justify-content:space-between;align-items:center;border:3px dashed #E2777A;padding:15px;color:initial;transition:background 0.5s ease, color 0.5s ease;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-webkit-transition:background 0.5s ease, color 0.5s ease;-moz-transition:background 0.5s ease, color 0.5s ease;}.css-bhw7gr:hover,[data-css-bhw7gr]:hover{background:#E2777A;color:white;text-decoration:none;}.css-4u7z7f,[data-css-4u7z7f]{max-width:960px;margin:0 auto;padding:2.4rem 1.2rem;}.css-1rrcu7t,[data-css-1rrcu7t]{display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;padding-bottom:2rem;flex-direction:row;justify-content:space-between;flex-wrap:wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-lines:multiple;-webkit-flex-wrap:wrap;}.css-nj9d06,[data-css-nj9d06]{margin:0 20px 0 0;padding-bottom:0;}.css-nj9d06 a,[data-css-nj9d06] a{box-shadow:none;text-decoration:none;color:inherit;}.css-nj9d06 a:hover,[data-css-nj9d06] a:hover{text-decoration:none;}.css-1iige26,[data-css-1iige26]{color:rgba(100,100,100, 0.7);}.css-1821md7,[data-css-1821md7]{padding:0 0.5rem;}@media all and (max-width: 400px){.css-1821md7,[data-css-1821md7]{padding:0 0.25rem;}}.css-d0z96,[data-css-d0z96]{display:block;max-width:100%;}.css-1kurdub,[data-css-1kurdub]{display:block;font-family:Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:16px;color:rgba(100,100,100, 0.8);margin-top:0.8rem;margin-bottom:0.8rem;}.css-n40tvx,[data-css-n40tvx]{max-width:100%;}.css-n40tvx li,[data-css-n40tvx] li{padding-left:10px;}.css-n40tvx .reading-img img,[data-css-n40tvx] .reading-img img{width:150px;float:right;margin:0px 10px 20px 10px;}.css-n40tvx img.full-width,[data-css-n40tvx] img.full-width{max-height:none;}.css-n40tvx img.half-width,[data-css-n40tvx] img.half-width{max-height:none;width:50%;}.css-y3ugfx,[data-css-y3ugfx]{padding-left:2rem;}.css-1aluta2,[data-css-1aluta2]{height:300px;width:150px;overflow:hidden;margin:0 0 1rem 0;}@media all and (max-width: 700px){.css-1aluta2,[data-css-1aluta2]{display:none;}}.css-m9l7q0,[data-css-m9l7q0]{overflow:hidden;margin:0;}.css-m9l7q0 #mc_embed_signup form,[data-css-m9l7q0] #mc_embed_signup form{margin-bottom:20px;}@media all and (max-width: 700px){.css-m9l7q0,[data-css-m9l7q0]{padding-right:0;width:100% !important;padding:0 10px;}.css-m9l7q0 .mc-field-group,[data-css-m9l7q0] .mc-field-group{width:100% !important;}.css-m9l7q0 .mc-field-group input,[data-css-m9l7q0] .mc-field-group input{width:100% !important;font-size:0.8em;height:2.4em;}}.css-h2hkv8,[data-css-h2hkv8]{margin:0;font-size:0.79057rem;line-height:1.6rem;letter-spacing:-0.25px;}.css-4w3jde,[data-css-4w3jde]{color:inherit;}.css-33c833,[data-css-33c833]{margin-left:0;padding-left:0;}.css-vjg5fh,[data-css-vjg5fh]{max-width:60vw;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;align-items:centglamor.er;-webkit-box-align:centglamor.er;-webkit-align-items:centglamor.er;}@media all and (max-width: 700px){.css-vjg5fh,[data-css-vjg5fh]{max-width:100vw;}}.css-1m362nd,[data-css-1m362nd]{display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;align-items:center;-webkit-box-align:center;-webkit-align-items:center;}.css-1m362nd> *,[data-css-1m362nd]> *{margin-right:10px;}.css-1182rq7,[data-css-1182rq7]{font-family:Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:18px;margin:0;}.css-17c7pi4,[data-css-17c7pi4]{white-space:nowrap;font-size:18px;}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["1a7irg3","bhw7gr","4u7z7f","1rrcu7t","nj9d06","1iige26","1821md7","d0z96","1kurdub","n40tvx","y3ugfx","1aluta2","m9l7q0","h2hkv8","4w3jde","33c833","vjg5fh","1m362nd","1182rq7","17c7pi4"]
        // ]]>
        </script><title data-react-helmet="true">Evil JavaScript | benmccormick.org</title><meta data-react-helmet="true" name="description" content="Ben McCormick&#x27;s blog on JavaScript and Web Development"/><meta data-react-helmet="true" name="keywords" content="evil javascript proxies"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:site" content="@benmccormickorg"/><meta data-react-helmet="true" name="twitter:creator" content="@ben336"/><meta data-react-helmet="true" name="twitter:title" content="Evil JavaScript"/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="twitter:image" content="http://benmccormick.org/logo.png"/><script data-react-helmet="true" type="application/ld+json">{
                  "@context": "http://schema.org"
                  "@type": "BlogPosting",
                  "headline": "Evil JavaScript",
                  "genre": "Software Development",
                  "keywords": "evil javascript proxies",
                  "url": "http://benmccormick.org//2018/07/04/evil-javascript/",
                  "image": "http://benmccormick.org/logo.png",
                  "datePublished": "2018-07-4",
                  
                  "articleBody": "<p>JavaScript developers sometimes complain that their language is unjustly maligned for having too many confusing features.  Plenty of other people are out there explaining why this is misguided, but for this post I want to lean in.  Rather than falling into the <em>traps</em> that JavaScript exposes you to, what if we embrace our language‚Äôs reputation instead, and see what code we can write if we don‚Äôt care about the feelings of others?</p>
<p>The ‚ÄúEvil JavaScript‚Äù you‚Äôll see today takes advantage of an array of language features. Many of these techniques still work in other languages, so please don‚Äôt worry that I‚Äôm limiting your pursuit of the dark side. But JavaScript certainly has a flair for evil that is hard to match.  If you write code that other people have to work with, the opportunities to annoy, confuse, aggravate and bamboozle are limitless.  The following is a small selection of choice techniques.</p>
<h4>Modify objects in your getters</h4>
<p>JavaScript objects can define <code class=\"language-text\">getters</code>, functions that let you access the result of a function as a property.  Used normally, that looks like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> greeter <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
  name<span class=\"token punctuation\">:</span> <span class=\"token string\">'Bob'</span><span class=\"token punctuation\">,</span>
  <span class=\"token keyword\">get</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token string\">`Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeter<span class=\"token punctuation\">.</span>hello<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Hello Bob</span>
greeter<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'World'</span><span class=\"token punctuation\">;</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeter<span class=\"token punctuation\">.</span>hello<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Hello World</span></code></pre>
      </div>
<p>Used evilly though, we can come up with fun self-destructing objects!</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
   foo<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>
   bar<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>
   baz<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>
   <span class=\"token keyword\">get</span> <span class=\"token function\">evil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">let</span> keys <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>keys<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
         <span class=\"token keyword\">delete</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span>keys<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>
      <span class=\"token punctuation\">}</span>
      <span class=\"token keyword\">return</span> <span class=\"token string\">'Nothing to see here'</span><span class=\"token punctuation\">;</span>
   <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>Here, every time we read <code class=\"language-text\">obj.evil</code>, we delete one of the other properties on the object, with no indication to the code accessing <code class=\"language-text\">obj.evil</code> that anything extraordinary is happening.  But this is just the start of how we can introduce unexpected side effects.</p>
<h4>Nobody expects a Proxy!</h4>
<p>Getters are cool and all, but they‚Äôve been around for years, and many developers know about them.  We now have an even more powerful variation on the same theme with Proxies.  Proxies are an ES6 feature that let you put a wrapper class around an object that lets you control what happens when a user accesses or updates any property.  So we can, for instance define an object that will, one third of the time return a value from a random key whenever a user tries to access a key.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">let</span> handler <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>
    <span class=\"token keyword\">get</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> prop<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.33</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>
        <span class=\"token keyword\">let</span> keys <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
        <span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> keys<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>keys<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>
        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
      <span class=\"token punctuation\">}</span>
    <span class=\"token punctuation\">}</span>
<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

<span class=\"token keyword\">let</span> evilObj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>

<span class=\"token comment\">// this is example output that I received running the code</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span></code></pre>
      </div>
<p>Our sneakiness is undermined a bit by devtools, where evilObj will be identified as a Proxy, but we can still lead other developers on a merry chase before we‚Äôre caught.</p>
<h4>Contagious functions</h4>
<p>So far we‚Äôve talked about how objects can modify themselves, but we can also create innocuous looking functions that infect the objects that are passed to them with strange behavior.  For instance lets say we had a simple <code class=\"language-text\">get</code> function to do safe property lookups on an object that may not exist:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> property<span class=\"token punctuation\">,</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">return</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span>
   <span class=\"token punctuation\">}</span>
   <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>It would be easy to make that function contagious by subtly changing the object it was passed.  For instance we could make it so the retrieved property no longer showed up when the user enumerates the keys.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> property<span class=\"token punctuation\">,</span> defaultValue<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>obj <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>property <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">return</span> defaultValue<span class=\"token punctuation\">;</span>
   <span class=\"token punctuation\">}</span>
   <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
   <span class=\"token keyword\">delete</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
   Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> property<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>
      value<span class=\"token punctuation\">,</span>
      enumerable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>
   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>
   <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
<span class=\"token punctuation\">}</span>

<span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">:</span><span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>

console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ['a', 'b']</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ['b']</span></code></pre>
      </div>
<p>This is super subtle, since enumeration is neither rare nor particularly common.  Since the actual bug wouldn‚Äôt be tied to the infected object at all, it could persist in a code base for a long time.</p>
<h4>Messing with Prototypes</h4>
<p>Sometimes the old ways are best.  One of the most criticized features of the JavaScript language is the ability to modify built-in prototypes.  This was used in the early days of JavaScript to enhance built in objects like arrays.  For instance we can add a <code class=\"language-text\">contains</code> function for arrays like this:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\">Array<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">contains</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>It turns out that doing this in real libraries can <a href=\"http://2ality.com/2016/02/array-prototype-includes.html#frequently-asked-questions\">ruin the language for everyone else</a>.  So providing additional useful prototype methods is a good long con for malicious developers with patience.  But for the impatient sociopaths reading along, we also have some short term fun we can unleash.  The fun thing about prototype manipulation is that it affects all code running in an environment, even if that code is running in modules or closures.  So if we introduce the following code as a 3rd party script (maybe an ad or analytics script?), we can introduce subtle bugs throughout a site.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\">Array<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
   <span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>
   <span class=\"token keyword\">let</span> arr2 <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>
      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>
         idx <span class=\"token operator\">=</span> idx <span class=\"token operator\">+</span> <span class=\"token number\">1</span>
      <span class=\"token punctuation\">}</span>
      <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> acc<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">===</span> idx <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>idx <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> idx
      acc<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
      <span class=\"token keyword\">return</span> acc<span class=\"token punctuation\">;</span>
   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
   <span class=\"token keyword\">return</span> arr2<span class=\"token punctuation\">;</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>We‚Äôve rewritten <code class=\"language-text\">Array.prototype.map</code> to work just like normal <code class=\"language-text\">map</code> with the exception that we will randomly switch the order of 2 values 1/20th of the time.  An example result:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span><span class=\"token number\">12</span><span class=\"token punctuation\">,</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span><span class=\"token number\">14</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>
<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">square</span> <span class=\"token operator\">=</span> x <span class=\"token operator\">=></span> x <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>square<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token comment\">// [1,4,9,16,25,36,49,64,100,81,121,144,169,196,225</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>square<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token comment\">// [1,4,9,16,25,36,49,64,81,100,121,144,169,196,225]</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>square<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>
<span class=\"token comment\">// [1,4,9,16,25,36,49,64,81,100,121,144,169,196,225]</span></code></pre>
      </div>
<p>We ran map 3 times, and the first was subtly different than the next 2 runs.  It‚Äôs subtle enough that it won‚Äôt always cause anything to happen, and the crazy thing about this hack is that there‚Äôs no real way to know it‚Äôs happening without actually reading the source code that caused it.  Our function doesn‚Äôt show up weirdly in devtools, and it doesn‚Äôt error under strict mode or anything else.  This is how developers go mad.</p>
<h4>Naming things is hard</h4>
<p>As one of the 2 hard problems in Computer Science, you don‚Äôt have to be evil to come up with bad names<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  But it certainly doesn‚Äôt hurt.  We‚Äôll pass over the chump change of misleading names and outdated comments.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// initialize a date</span>
<span class=\"token keyword\">let</span> arrayOfNumbers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> userid<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">'Darth Vader'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>
      </div>
<p>No let‚Äôs get to the good stuff.  Did you know that much of unicode can be used to name variables in JavaScript?  If you‚Äôre into fun and games of course, this means that emoji are in play:</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> üí© <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> postid<span class=\"token punctuation\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span> postName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Evil JavaScript'</span><span class=\"token punctuation\">}</span></code></pre>
      </div>
<p>But we want evil JavaScript, so let‚Äôs go straight to lookalike characters.</p>
<div class=\"gatsby-highlight\" data-language=\"javascript\">
      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oÔΩÇj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>
console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error!</span></code></pre>
      </div>
<p>The <code class=\"language-text\">ÔΩÇ</code> in <code class=\"language-text\">oÔΩÇj</code> may look normal, but it is actually a <em>fullwidth latin small letter b</em> instead of a <em>latin small letter b</em>, and that distinction means that anyone typing in the variable directly is probably going to be very confused.</p>
<h3>Don‚Äôt be evil</h3>
<p>Despite appearances, it is the official position of this blog that evil JavaScript should not be encouraged and may in fact be harmful.  That said, it‚Äôs always good to know the ways things can go wrong. Each of these patterns exist out in the wild somewhere.  Hopefully in less malicious forms than I‚Äôve shown here.  But lack of intent doesn‚Äôt make them easier to debug, and knowing just how bad things can get is a good start to seeing these bugs coming.  You never know what bug is sitting out there waiting to strike. Just because you‚Äôre paranoid doesn‚Äôt mean that they‚Äôre not out to get you.</p>
<div class=\"footnotes\">
<hr>
<ol>
<li id=\"fn-1\">
<p>This may be hard to believe for old time Linux folks of course. They‚Äôve had years to associate the worst naming offender in the industry (Microsoft) with the deepest forms of evil.</p>
<a href=\"#fnref-1\" class=\"footnote-backref\">‚Ü©</a>
</li>
</ol>
</div>",
                    "author": {
                      "@type": "Person",
                      "name": "Ben McCormick"
                      "email": "mailto:ben@benmccormick.org",
                      "image": "/profile_pic.jpg",
                      "jobTitle": "Software Engineer",
                      "alumniOf": "Duke",
                      "birthPlace": "Pittsburgh, PA",
                      "gender": "male",
                      "url": "http://benmccormick.org",
                	    "sameAs" : [
                        "https://www.linkedin.com/in/benmccormick",
                        "http://twitter.com/ben336",
                      ]
                   }
                }</script><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f1ff7d131df0a80437e4.js"/><link as="script" rel="preload" href="/0-d78924833c2298485827.js"/><link as="script" rel="preload" href="/1-4a4df9f682b1321a5732.js"/><link as="script" rel="preload" href="/app-a122d914cf5d49401320.js"/><link as="script" rel="preload" href="/webpack-runtime-12e5e85d8875cc51585a.js"/><link rel="preload" href="/static/d/path---2018-07-04-evil-javascript-fed-e55-5BcSUdPAJUC97WBfCXgne7HEoAc.json" as="fetch" crossOrigin="use-credentials"/><link as="style" rel="preload" href="/component---src-templates-blog-post-js.3ad4ad0634b12ff47adb.css"/><link as="style" rel="preload" href="/0.3145d1f9f21dcd679291.css"/></head><body class="landing-page" style="background:#FCFCFC;padding:0 10px"><div id="___gatsby"><div class="css-4u7z7f" data-reactroot=""><div class="css-1rrcu7t"><h3 class="css-nj9d06"><a name="title" href="/">benmccormick.org</a></h3><div class="css-1iige26"><a class="css-1a7irg3" href="/archive/">Blog</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/subscribe/">Subscribe</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/speaking/">Speaking</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="http://twitter.com/ben336">Twitter</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/about/">About</a></div></div><div class="markdown"><div class="post-title-area"><h1 class="css-d0z96">Evil JavaScript</h1><h5 class="css-1kurdub">Originally Posted <!-- -->July 4th 2018</h5></div><div class="columns"><div class="css-n40tvx"><p>JavaScript developers sometimes complain that their language is unjustly maligned for having too many confusing features.  Plenty of other people are out there explaining why this is misguided, but for this post I want to lean in.  Rather than falling into the <em>traps</em> that JavaScript exposes you to, what if we embrace our language‚Äôs reputation instead, and see what code we can write if we don‚Äôt care about the feelings of others?</p>
<p>The ‚ÄúEvil JavaScript‚Äù you‚Äôll see today takes advantage of an array of language features. Many of these techniques still work in other languages, so please don‚Äôt worry that I‚Äôm limiting your pursuit of the dark side. But JavaScript certainly has a flair for evil that is hard to match.  If you write code that other people have to work with, the opportunities to annoy, confuse, aggravate and bamboozle are limitless.  The following is a small selection of choice techniques.</p>
<h4>Modify objects in your getters</h4>
<p>JavaScript objects can define <code class="language-text">getters</code>, functions that let you access the result of a function as a property.  Used normally, that looks like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> greeter <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span>hello<span class="token punctuation">)</span> <span class="token comment">// Hello Bob</span>
greeter<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span>hello<span class="token punctuation">)</span> <span class="token comment">// Hello World</span></code></pre>
      </div>
<p>Used evilly though, we can come up with fun self-destructing objects!</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
   foo<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
   bar<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
   baz<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
   <span class="token keyword">get</span> <span class="token function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">[</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token string">'Nothing to see here'</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Here, every time we read <code class="language-text">obj.evil</code>, we delete one of the other properties on the object, with no indication to the code accessing <code class="language-text">obj.evil</code> that anything extraordinary is happening.  But this is just the start of how we can introduce unexpected side effects.</p>
<h4>Nobody expects a Proxy!</h4>
<p>Getters are cool and all, but they‚Äôve been around for years, and many developers know about them.  We now have an even more powerful variation on the same theme with Proxies.  Proxies are an ES6 feature that let you put a wrapper class around an object that lets you control what happens when a user accesses or updates any property.  So we can, for instance define an object that will, one third of the time return a value from a random key whenever a user tries to access a key.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>keys<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> evilObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// this is example output that I received running the code</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evilObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evilObj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evilObj<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evilObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evilObj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evilObj<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span></code></pre>
      </div>
<p>Our sneakiness is undermined a bit by devtools, where evilObj will be identified as a Proxy, but we can still lead other developers on a merry chase before we‚Äôre caught.</p>
<h4>Contagious functions</h4>
<p>So far we‚Äôve talked about how objects can modify themselves, but we can also create innocuous looking functions that infect the objects that are passed to them with strange behavior.  For instance lets say we had a simple <code class="language-text">get</code> function to do safe property lookups on an object that may not exist:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">,</span> property<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> obj<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>It would be easy to make that function contagious by subtly changing the object it was passed.  For instance we could make it so the retrieved property no longer showed up when the user enumerates the keys.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">,</span> property<span class="token punctuation">,</span> defaultValue<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj <span class="token operator">||</span> <span class="token operator">!</span>property <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> defaultValue<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">let</span> value <span class="token operator">=</span> obj<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">delete</span> obj<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>
   Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> property<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">,</span>
      enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> obj<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['a', 'b']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['b']</span></code></pre>
      </div>
<p>This is super subtle, since enumeration is neither rare nor particularly common.  Since the actual bug wouldn‚Äôt be tied to the infected object at all, it could persist in a code base for a long time.</p>
<h4>Messing with Prototypes</h4>
<p>Sometimes the old ways are best.  One of the most criticized features of the JavaScript language is the ability to modify built-in prototypes.  This was used in the early days of JavaScript to enhance built in objects like arrays.  For instance we can add a <code class="language-text">contains</code> function for arrays like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript">Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">contains</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>It turns out that doing this in real libraries can <a href="http://2ality.com/2016/02/array-prototype-includes.html#frequently-asked-questions">ruin the language for everyone else</a>.  So providing additional useful prototype methods is a good long con for malicious developers with patience.  But for the impatient sociopaths reading along, we also have some short term fun we can unleash.  The fun thing about prototype manipulation is that it affects all code running in an environment, even if that code is running in modules or closures.  So if we introduce the following code as a 3rd party script (maybe an ad or analytics script?), we can introduce subtle bugs throughout a site.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript">Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> arr2 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> val<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.95</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         idx <span class="token operator">=</span> idx <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> index <span class="token operator">=</span> acc<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">===</span> idx <span class="token operator">?</span> <span class="token punctuation">(</span>idx <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> idx
      acc<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> index<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> acc<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> arr2<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>We‚Äôve rewritten <code class="language-text">Array.prototype.map</code> to work just like normal <code class="language-text">map</code> with the exception that we will randomly switch the order of 2 values 1/20th of the time.  An example result:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">square</span> <span class="token operator">=</span> x <span class="token operator">=></span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,4,9,16,25,36,49,64,100,81,121,144,169,196,225</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,4,9,16,25,36,49,64,81,100,121,144,169,196,225]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,4,9,16,25,36,49,64,81,100,121,144,169,196,225]</span></code></pre>
      </div>
<p>We ran map 3 times, and the first was subtly different than the next 2 runs.  It‚Äôs subtle enough that it won‚Äôt always cause anything to happen, and the crazy thing about this hack is that there‚Äôs no real way to know it‚Äôs happening without actually reading the source code that caused it.  Our function doesn‚Äôt show up weirdly in devtools, and it doesn‚Äôt error under strict mode or anything else.  This is how developers go mad.</p>
<h4>Naming things is hard</h4>
<p>As one of the 2 hard problems in Computer Science, you don‚Äôt have to be evil to come up with bad names<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.  But it certainly doesn‚Äôt hurt.  We‚Äôll pass over the chump change of misleading names and outdated comments.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// initialize a date</span>
<span class="token keyword">let</span> arrayOfNumbers <span class="token operator">=</span> <span class="token punctuation">{</span> userid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Darth Vader'</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>No let‚Äôs get to the good stuff.  Did you know that much of unicode can be used to name variables in JavaScript?  If you‚Äôre into fun and games of course, this means that emoji are in play:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> üí© <span class="token operator">=</span> <span class="token punctuation">{</span> postid<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span> postName<span class="token punctuation">:</span> <span class="token string">'Evil JavaScript'</span><span class="token punctuation">}</span></code></pre>
      </div>
<p>But we want evil JavaScript, so let‚Äôs go straight to lookalike characters.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> oÔΩÇj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span></code></pre>
      </div>
<p>The <code class="language-text">ÔΩÇ</code> in <code class="language-text">oÔΩÇj</code> may look normal, but it is actually a <em>fullwidth latin small letter b</em> instead of a <em>latin small letter b</em>, and that distinction means that anyone typing in the variable directly is probably going to be very confused.</p>
<h3>Don‚Äôt be evil</h3>
<p>Despite appearances, it is the official position of this blog that evil JavaScript should not be encouraged and may in fact be harmful.  That said, it‚Äôs always good to know the ways things can go wrong. Each of these patterns exist out in the wild somewhere.  Hopefully in less malicious forms than I‚Äôve shown here.  But lack of intent doesn‚Äôt make them easier to debug, and knowing just how bad things can get is a good start to seeing these bugs coming.  You never know what bug is sitting out there waiting to strike. Just because you‚Äôre paranoid doesn‚Äôt mean that they‚Äôre not out to get you.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>This may be hard to believe for old time Linux folks of course. They‚Äôve had years to associate the worst naming offender in the industry (Microsoft) with the deepest forms of evil.</p>
<a href="#fnref-1" class="footnote-backref">‚Ü©</a>
</li>
</ol>
</div></div><div class="css-y3ugfx no-mobile"><div class="css-1aluta2"></div><div class="css-m9l7q0"><div id="mc_embed_signup"><h6 class="css-h2hkv8">Subscribe via email</h6><form action="//benmccormick.us8.list-manage.com/subscribe/post?u=115446b80fd9d930ba091cc27&amp;id=f5b9f5acf2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group sidebar-group"><input type="email" name="EMAIL" class="subscribe-email required email" id="mce-EMAIL" placeholder="Email Address" value=""/><input type="submit" value="&gt;" name="subscribe" id="mc-embedded-subscribe" class="subscribe-button button"/></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position:absolute;left:-5000px" aria-hidden="true"><input type="text" name="b_115446b80fd9d930ba091cc27_f5b9f5acf2" tabindex="-1" value=""/></div><div class="clear"></div></div></form></div></div></div></div><div><hr/><div class=""><h3 class="css-4w3jde">You Might Also Like These Articles</h3><ul class="css-33c833"><a class="css-bhw7gr" href="/2018/06/05/es6-the-bad-parts/"><div class="css-vjg5fh"><div><div class="css-1m362nd">ES6: The Bad Parts</div><p class="css-1182rq7">Three years later, what parts of ES6 have I stopped using?</p></div></div><span class="css-17c7pi4 no-mobile">Jun 5th 2018</span></a><a class="css-bhw7gr" href="/2018/06/26/javascript-stale-practices/"><div class="css-vjg5fh"><div><div class="css-1m362nd">JavaScript ‚ÄúStale Practices‚Äù</div><p class="css-1182rq7">Looking at a few previous JavaScript best practices that are now out of date.</p></div></div><span class="css-17c7pi4 no-mobile">Jun 26th 2018</span></a><a class="css-bhw7gr" href="/2018/05/14/mobx-state-machines-and-flags/"><div class="css-vjg5fh"><div><div class="css-1m362nd">MobX Patterns: State Machines &amp; Flags</div><p class="css-1182rq7">Getting the best of state machine and flag patterns</p></div></div><span class="css-17c7pi4 no-mobile">May 14th 2018</span></a></ul></div></div></div></div></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script>
          window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"2018-07-04-evil-javascript-fed","path":"/2018/07/04/evil-javascript/"};window.dataPath="path---2018-07-04-evil-javascript-fed-e55-5BcSUdPAJUC97WBfCXgne7HEoAc";/*]]>*/</script><script src="/webpack-runtime-12e5e85d8875cc51585a.js" async=""></script><script src="/app-a122d914cf5d49401320.js" async=""></script><script src="/1-4a4df9f682b1321a5732.js" async=""></script><script src="/0-d78924833c2298485827.js" async=""></script><script src="/component---src-templates-blog-post-js-f1ff7d131df0a80437e4.js" async=""></script></body></html>