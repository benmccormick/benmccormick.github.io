{"data":{"markdownRemark":{"html":"<h1>Diving Into lodash</h1>\n<p>For the next few weeks, I’m going to be writing about one of my favorite libraries, <a href=\"https://lodash.com/\">lodash</a>.  lodash is a utility library, a collection of helpful functions for common small operations.  Over the following posts, I’m going to be walking through the whole API of lodash v4, and hopefully giving some new ideas on how each part might be useful to you.  Before that starts though, a quick word on why utility libraries in general and lodash in particular are a good idea.</p>\n<h4>Utility libraries can provide better developer ergonomics</h4>\n<p>Many of the functions that lodash provide have some equivalent in the JavaScript base language.  For instance <code class=\"language-text\">_.filter</code>, <code class=\"language-text\">_.map</code>, and <code class=\"language-text\">_.forEach</code> may seem redundant due to the widely supported <code class=\"language-text\">Array.prototype.filter</code>, <code class=\"language-text\">Array.prototype.map</code> and <code class=\"language-text\">Array.prototype.forEach</code>.  And its east to ask why lodash has <code class=\"language-text\">_.parseInt</code> when JavaScript provides a native <code class=\"language-text\">parseInt</code>.  In general redundancies like this in lodash are for 1 of 3 reasons: compatibility (covered below), better ergonomics for common use cases, or to overcome usability problems in the native API. </p>\n<p><code class=\"language-text\">_.filter</code> and its compatriots are a good example of improving the experience of using a native API for common use cases.  Let’s say we have a list of movies that we want to allow the user to filter by release year. The movie data looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\">\n      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> 'The Dark Knight'<span class=\"token punctuation\">,</span>\n    director<span class=\"token operator\">:</span> 'Christopher Nolan'<span class=\"token punctuation\">,</span>\n    studio<span class=\"token operator\">:</span> 'Warner Bros'<span class=\"token punctuation\">,</span>\n    releaseYear<span class=\"token operator\">:</span> '<span class=\"token number\">2008</span>'<span class=\"token punctuation\">,</span>\n    gross<span class=\"token operator\">:</span> <span class=\"token number\">533316061</span><span class=\"token punctuation\">,</span>\n    runtime<span class=\"token operator\">:</span> <span class=\"token number\">152</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Our movie lists are split by studio, so we also need to filter by studio, and make sure it matches the current studio.  Using <code class=\"language-text\">Array.prototype.filter</code> that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function\">onFilterChanged</span><span class=\"token punctuation\">(</span>newFilterValue<span class=\"token punctuation\">,</span> currentPage<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moviesToShow <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moviesList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>movie <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> movie<span class=\"token punctuation\">.</span>releaseYear <span class=\"token operator\">===</span> newFilterValue <span class=\"token operator\">&amp;&amp;</span> movie<span class=\"token punctuation\">.</span>studio <span class=\"token operator\">===</span> currentPage<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>with lodash we can take advantage of an alternate declarative syntax for the common case of matching on specific properties for filtering.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function\">onFilterChanged</span><span class=\"token punctuation\">(</span>newFilterValue<span class=\"token punctuation\">,</span> currentPage<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moviesToShow <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moviesList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        releaseYear<span class=\"token punctuation\">:</span> newFilterValue<span class=\"token punctuation\">,</span>\n        studio<span class=\"token punctuation\">:</span> currentPage<span class=\"token punctuation\">,</span>    \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>We’ve changed what is probably the most common case for filtering from an <em>imperative</em> action where the matching logic has to be written out to a <em>declarative</em> action where we just specify an interface to match against.  This increases clarity and reduces the potential for logic errors.  It’s a small gain, but the type that adds up over a large code base.</p>\n<p>Unlike <code class=\"language-text\">_.filter</code>, <code class=\"language-text\">_.parseInt</code> doesn’t add new syntax or capabilities over the native <code class=\"language-text\">parseInt</code>.  So why does it exist?  It turns out that JavaScript’s native API choices have occasional unfortunate consequences.  One of the more interesting bad situations you can create is by trying to mix <code class=\"language-text\">map</code> and <code class=\"language-text\">parseInt</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'10'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nlist<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>parseInt<span class=\"token punctuation\">)</span> <span class=\"token comment\">// [10, NaN, 2, 3, 4]</span></code></pre>\n      </div>\n<p>Wait what??  It turns out that <code class=\"language-text\">parseInt</code> accepts 2 arguments: a value to parse, and a radix, which determines what base to interpret the number as.  If radix is 0 or undefined, <code class=\"language-text\">parseInt</code> defaults to base 10 (or 16 for hexadecimal numbers).  Meanwhile, <code class=\"language-text\">map</code> always passes 3 arguments to the functions that it calls: value, index and the original array.  So when it is used with parseInt, the index becomes the radix value, resulting in the mess you see above.  <code class=\"language-text\">_.parseInt</code> maintains spec compliant behavior, but adds an additional check; if _.parseInt is passed a 3rd argument, it ignores the radix value and reverts to the default, thus catching the <code class=\"language-text\">map</code> edge case without effecting normal use.  </p>\n<p>This might seem like a tiny edge case, but the real value that lodash is providing is preventing you as a developer from needing to know every detail and sinkhole in the JavaScript spec and browser implementations.  Instead you’re free to focus on your application and it’s business logic.  lodash will handle the details and evolve over time as new traps are created or fixed.</p>\n<h4>Utility libraries help with compatibility</h4>\n<p>Though browser compatibility is much less of an issue than it used to be, there are still plenty of traps out there.  Let’s say we want to merge 2 contact objects that we’ve identified as being the same user:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> contact1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>\n    lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Smith'</span><span class=\"token punctuation\">,</span>\n    phone<span class=\"token punctuation\">:</span> <span class=\"token string\">'919.965.9999'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> contact2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>\n    email<span class=\"token punctuation\">:</span> <span class=\"token string\">'john.smith@gmail.com'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>In modern browsers, this is fairly straightforward.  We can use <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\">Object.assign</a> to merge the 2 contacts.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//create new merged contact object</span>\n<span class=\"token keyword\">let</span> newContact <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> contact1<span class=\"token punctuation\">,</span> contact2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//update contact1 to contain the merged contact information</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>contact1<span class=\"token punctuation\">,</span> contact2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>Unfortunately, while ubiquitous in modern browsers, Object.assign can’t be counted on without a polyfill.  If you have to support Internet Explorer or Safari 8 and don’t use a polyfill, the code gets ugly fast.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//create new merged contact object</span>\n<span class=\"token keyword\">var</span> newContact <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> keys1 <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>contact1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> keys2 <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>contact2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\nkeys1<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    newContact<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> contact1<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nkeys2<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    newContact<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> contact2<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//update contact1 to contain the merged contact information</span>\nkeys2<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    contact1<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> contact2<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>lodash provides <code class=\"language-text\">_.assign</code>, which effectively serves as a replacement for Object.assign that will work in IE9+, Safari 8+, Node.js and evergreen browsers.  As with the usability examples, the issue is less that this is a huge savings or insurmountable problem, and more a security net that allows you to focus on your app rather than spending all your time on <a href=\"http://caniuse.com/\">caniuse.com</a>.  </p>\n<h4>lodash is flexible, tested, and comprehensive</h4>\n<p>There are many utility libraries for JavaScript including lodash, <a href=\"http://underscorejs.org/\">underscore</a>, and <a href=\"http://ramdajs.com/\">ramda</a>.  This post is not meant to be about comparing them <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>. But I do want to quickly point out that lodash consistently shows up as the most popular according to <a href=\"https://www.npmjs.com/browse/star\">npm stats</a>.  One reason for that is its flexibility.  You can use all of lodash as a traditional namespaced library, pull in individual functions, and even use the whole library through an <a href=\"https://github.com/lodash/lodash/wiki/FP-Guide\">alternative functional syntax</a>.  The fact that it is so widely used also provides the comfort of knowing that you are unlikely to be the first person to experience a bug with the library.  It is also actively maintained, with an <a href=\"https://github.com/lodash/lodash/graphs/contributors\">incredibly high level of activity</a> maintained consistently since it was forked from underscore in 2012.</p>\n<h3>Coming Soon: A deep dive</h3>\n<p>The hard part about discussing lodash as compared to a framework like React is the diversity of what lodash does.  Most of its API methods are functions that provide incremental gains in very specific situations.  These functions are not all tightly related to each other and lodash v4 provides well over 100 methods.  This means that learning lodash is non-linear, and you can use parts of it for years without ever using other parts.  In this series I’m going to attempt to give a broad view of that API, with the hope that I’ll broaden your toolbox of approaches the next time you’re facing a JavaScript problem.</p>\n<h3>Subscribe</h3>\n<p>Thanks for taking the time to read this post!  JavaScript development is one of the main topics of this blog, so if you enjoyed the post, please consider subscribing by using the <a href=\"http://feedpress.me/benmccormick\">feed</a>, <a href=\"http://twitter.com/benmccormickorg\">Twitter</a> or my <a href=\"http://eepurl.com/WFYon\">mailing list</a>. You also might want to check out my post comparing <a href=\"http://benmccormick.org/2014/11/12/underscore-vs-lodash/\">lodash and underscore</a>.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>I did do a lodash/underscore comparison a while back: <a href=\"http://benmccormick.org/2014/11/12/underscore-vs-lodash/\"></a></p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","frontmatter":{"title":"","keywords":null,"category":null,"date":null,"path":null,"layout":null,"hideFooter":null,"hideSidebar":null},"fields":{"slug":"/posts/drafts/old-drafts/lodash/whylodash/"}}},"pageContext":{"slug":"/posts/drafts/old-drafts/lodash/whylodash/","relatedPosts":[{"path":"/404.html","data":{"title":"","path":"/404.html","description":null,"date":null,"category":null}},{"path":"/a-note-to-recruiters","data":{"title":"A note to recruiters","path":"/a-note-to-recruiters","description":null,"date":"2015-06-04T13:42:18+00:00","category":null}},{"path":"/built-with","data":{"title":"Built With","path":"/built-with","description":null,"date":null,"category":null}}]}}