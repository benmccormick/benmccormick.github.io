{"data":{"markdownRemark":{"html":"<p>Today on Twitter, <a href=\"http://2ality.com/index.html\">Axel Rauschmayer</a> posted a fun little coding challenge:</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">Code golf: check if an Array has holes. I’ll reply with two ideas of mine in a few minutes.</p>&mdash; Axel Rauschmayer (@rauschma) <a href=\"https://twitter.com/rauschma/status/1009053456123027463?ref_src=twsrc%5Etfw\">June 19, 2018</a></blockquote>\n<p>For context, <em>code golf</em> is a type of challenge where participants attempt to find the shortest possible way to express a program.  Arrays that have holes, or sparse arrays, refer to arrays that don’t have values at every index between their maximum and minimum values.  You can define a sparse array like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\narr<span class=\"token punctuation\">[</span><span class=\"token number\">100</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n<span class=\"token comment\">// arr.length is 100</span></code></pre>\n      </div>\n<p>or like this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// arr.length is 3</span></code></pre>\n      </div>\n<p>This is different from <code class=\"language-text\">let arr = [1, undefined, 2]</code>, because the index keys are not defined.  If this is difficult to understand, you can picture arrays as simple objects, with access to the <code class=\"language-text\">Array.Prototype</code> methods and a special <code class=\"language-text\">length</code> property that is aware of numeric keys.  The important thing is not whether a value is defined for a specific index, but whether a key was ever explicitly set.  Axel’s suggested solutions take advantage of that distinction:</p>\n<blockquote class=\"twitter-tweet\" data-conversation=\"none\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">// Does someArray have holes?<br><br>someArray.findIndex((x,i,arr) =&gt; x === undefined &amp;&amp; !(i in arr)) &gt;= 0<br>Object.keys(someArray).length &lt; someArray.length<br>someArray.filter(_ =&gt; true).length &lt; someArray.length</p>&mdash; Axel Rauschmayer (@rauschma) <a href=\"https://twitter.com/rauschma/status/1009056501095428096?ref_src=twsrc%5Etfw\">June 19, 2018</a></blockquote>\n<p>I’m going to standardize these into a function syntax for the purpose of comparison.  I’m only going to consider one liners, so we’ll define a simple arrow function <code class=\"language-text\">isSparse</code>, and compare the length of the function bodies.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Solution 1</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> someArray <span class=\"token operator\">=></span> someArray<span class=\"token punctuation\">.</span><span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>arr<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">===</span> undefined <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span>\n<span class=\"token comment\">// Solution 1 condensed (49 characters)</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>x<span class=\"token operator\">===</span>undefined<span class=\"token operator\">&amp;&amp;</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">>=</span><span class=\"token number\">0</span>\n<span class=\"token comment\">// Solution 2</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> someArray <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>someArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> someArray<span class=\"token punctuation\">.</span>length\n<span class=\"token comment\">// Solution 2 condensed (30 characters)</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span>a<span class=\"token punctuation\">.</span>length\n<span class=\"token comment\">// Solution 3</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> someArray <span class=\"token operator\">=></span> someArray<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>_ <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> someArray<span class=\"token punctuation\">.</span>length\n<span class=\"token comment\">// Solution 3 condensed (33 characters)</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>_<span class=\"token operator\">=></span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span>a<span class=\"token punctuation\">.</span>length</code></pre>\n      </div>\n<p>Axel’s solutions all rely on the fact that sparse items don’t have keys, and that Object.keys and Array.prototype methods therefore don’t iterate over them.  That’s a good insight and a good foundation for getting even more concise.  We can use a few tricks to do that.</p>\n<p>Let’s start with his second solution, which was the shortest and clearest in practice and modify it a bit</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// We're comparing the length of the list of keys to the array length</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span>a<span class=\"token punctuation\">.</span>length\n<span class=\"token comment\">//But we can use reduce to do this instead (28 characters)</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">=></span>x<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">0</span></code></pre>\n      </div>\n<p>So our first step is to use <code class=\"language-text\">reduce</code> to save 2 characters.  If you haven’t seen <code class=\"language-text\">reduce</code> before, I recommend checking out <a href=\"https://css-tricks.com/understanding-the-almighty-reducer/\">this great explainer</a> by Sarah Drasner that I linked to in my <a href=\"https://benmccormick.org/2018/06/15/weekly-links-06-15-18/\">Weekly Links post</a> last week.  Essentially though, reduce is a generic method for iterating through an array to produce a new value.  It takes a function and an initial value, and uses the items of the array to iteratively transform the initial value.  In this case, I’m just decrementing the value for each defined item in the array, starting at length and seeing if it equals 0.  Which ends up being shorter than taking the length of the keys array.  But we can still do better!</p>\n<p>Our next step will take advantage of a property of numbers in JavaScript.  When converting numbers to booleans, <code class=\"language-text\">0</code> is considered <em>falsy</em>, while every other number is considered <em>truthy</em>.  Since we want our function to produce a boolean, we can take advantage of this property, and write our function like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Boolean version (27 characters)</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>a<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">=></span>x<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>That seems like a bit of a local maximum.  But getting to this point made me realize that we weren’t actually saving anything by using the boolean version over a comparison, since we can increment instead and end up at the same length.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Counting up to length (27 characters)</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">=></span>x<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span>a<span class=\"token punctuation\">.</span>length</code></pre>\n      </div>\n<p><del>Doing it this way though, we can actually save 2 more characters, because if reduce doesn’t have an initial value, it just uses the unmodified first element in an array as its initial value, and goes from there:</del></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Final (broken) Version (25 characters)</span>\n<span class=\"token comment\">// UPDATE: This doesn't work</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">isSparse</span> <span class=\"token operator\">=</span> a <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">=></span>x<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span>a<span class=\"token punctuation\">.</span>length</code></pre>\n      </div>\n<p><strong>Update: This last solution only works in situations where the array starts with <code class=\"language-text\">1</code>.  So 27 is the best generic solution I can find at this point.  Thanks to <a href=\"https://twitter.com/rauschma/status/1009149034622275585\">Axel</a> for correcting me. Code golf is hard 😔.</strong></p>\n<p>So there you have it.  27 characters to identify sparse arrays.  I’d love to hear from you if you can do better.  Hit me up on <a href=\"https://twitter.com/ben336\">Twitter</a> or by <a href=\"ben@benmccormick.org\">email</a>.</p>","frontmatter":{"title":"Code Golf: Sparse Arrays","keywords":"code golf arrays","category":"javascript","date":"2018-06-19T06:00:00+00:00","path":"/2018/06/19/code-golf-sparse-arrays/","layout":"post","hideFooter":null},"fields":{"slug":"/2018/06/19/code-golf-sparse-arrays/"}}},"pageContext":{"jsonName":"2018-06-19-code-golf-sparse-arrays-cf9","internalComponentName":"Component20180619CodeGolfSparseArrays","path":"/2018/06/19/code-golf-sparse-arrays/","component":"/home/travis/build/benmccormick/benmccormickorg/src/templates/blog-post.js","componentChunkName":"component---src-templates-blog-post-js","context":{"slug":"/2018/06/19/code-golf-sparse-arrays/","relatedPosts":[{"path":"/2018/06/18/codemod-survival/","data":{"title":"A Codemod Survival Guide","path":"/2018/06/18/codemod-survival/","description":"Getting started with jscodeshift","date":"2018/06/18"}},{"path":"/2017/07/19/ten-things-javascript/","data":{"title":"Ten Things A Serious JavaScript Developer Should Learn","path":"/2017/07/19/ten-things-javascript/","description":"Some of the important things to pick up in the JS world","date":"2017-07-19T04:00:00+00:00"}},{"path":"/2018/06/05/es6-the-bad-parts/","data":{"title":"ES6: The Bad Parts","path":"/2018/06/05/es6-the-bad-parts/","description":"Three years later, what parts of ES6 have I stopped using?","date":"2018/06/05"}}]},"updatedAt":1530498435028,"pluginCreator___NODE":"Plugin default-site-plugin","pluginCreatorId":"Plugin default-site-plugin","componentPath":"/home/travis/build/benmccormick/benmccormickorg/src/templates/blog-post.js","slug":"/2018/06/19/code-golf-sparse-arrays/","relatedPosts":[{"path":"/2018/06/18/codemod-survival/","data":{"title":"A Codemod Survival Guide","path":"/2018/06/18/codemod-survival/","description":"Getting started with jscodeshift","date":"2018/06/18"}},{"path":"/2017/07/19/ten-things-javascript/","data":{"title":"Ten Things A Serious JavaScript Developer Should Learn","path":"/2017/07/19/ten-things-javascript/","description":"Some of the important things to pick up in the JS world","date":"2017-07-19T04:00:00+00:00"}},{"path":"/2018/06/05/es6-the-bad-parts/","data":{"title":"ES6: The Bad Parts","path":"/2018/06/05/es6-the-bad-parts/","description":"Three years later, what parts of ES6 have I stopped using?","date":"2018/06/05"}}]}}