{"pageContext":{"posts":[{"node":{"frontmatter":{"readNext":null,"topics":["Math","Jest","Gatsby"],"category":"opinion","key":"weekly-links-12-23-17","title":"Weekly Links: December 23rd 2017","description":"Math in JS, Google vs Apple Maps, and cheating at Settlers","layout":"weekly-links","path":"/2017/12/23/weekly-links-12-23-17/","date":"2017/12/23","dontfeature":null,"isDraft":null},"html":"<h3>JavaScript And The Web</h3>\n<p><a href=\"http://raganwald.com/2017/12/14/73939133.html\">73,939,133 / Truncatable Primes | Reg Braithwaite</a> - A nice writeup about how brute force can be useful in solving a <a href=\"https://projecteuler.net/\">Project Euler</a> style math problem.</p>\n<h3>Programming Tools and Practices</h3>\n<p><a href=\"http://facebook.github.io/jest/blog/2017/12/18/jest-22.html\">Jest 22: Refinements &#x26; Custom Runners | Jest Blog</a> - This looks like a solid refinement release for Jest.  One warning: If you’re running <code class=\"language-text\">jest -o</code> on precommit hooks as I described <a href=\"https://benmccormick.org/2017/02/26/running-jest-tests-before-each-git-commit/\">here</a>, Jest 22 fails when run with 0 tests, so you need to specify the <code class=\"language-text\">--passWithNoTests</code> flag in order to let things go when you make a change that doesn’t affect any tests.</p>\n<p><a href=\"https://www.gatsbyjs.org/blog/2017-12-20-introducing-the-gatsby-ux-research-program/\">Introducing The Gatsby UX Research Program | Gatsby Blog</a> - An unusual case of doing real UX research for an open source developer tool.  Very cool stuff.</p>\n<h3>Non-Tech</h3>\n<p><a href=\"https://www.justinobeirne.com/google-maps-moat\">Google Maps’s Moat</a> - If you have any interest in product design, maps, or computer intelligence, this is the one article you need to read this week.  Beautifully put together.  It’s an in depth examination of the difference between Google and Apple maps, but it reads as a deeper exploration of how big data combined with computer learning and automation can have a huge impact on product design.</p>\n<p><a href=\"https://izbicki.me/blog/how-to-cheat-at-settlers-of-catan-by-loading-the-dice-and-prove-it-with-p-values.html\">How to cheat at settlers by loading the dice | Mike Izbicki</a> - This is just a fun application of statistics to my favorite board game.</p>","fields":{"slug":"/2017/12/23/weekly-links-12-23-17/"}}},{"node":{"frontmatter":{"readNext":"saving-time-jest,backbone-devs-react,mobx-first","topics":["Jest","Testing","React"],"category":"tools","key":"jest-first","title":"Testing with Jest Snapshots: First Impressions","description":"First impression of testing UI components using Jest snapshots","layout":"post","path":"/2016/09/19/testing-with-jest-snapshots-first-impressions/","date":"2016-09-19T12:41:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>Over the past 6 months my team at work has been slowly transitioning a large Backbone application to React.  One of the main goals of the transition has been to build out unit tests as we transition components.  As part of that we switched from using Karma to using Jest for managing our tests.</p>\n<p>Our new setup with Jest has several advantages over our previous setup. All Jest tests run through node using a fake DOM implementation.  We don’t need to start up a browser so tests are faster and less flaky <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  Jest makes it possible to mock all modules by default <sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>, which works well for us since our code base currently contains a large amount of code that is difficult to test for one reason or another.  Jest provides great integration with Babel, which is helpful since all of our Backbone and React code uses ES6 that we transpile for the browser.  Finally Jest provides a wonderful watch mode that runs only the tests that are relevant to the changes you’ve made and makes it easy to see the result.</p>\n<p>About a month ago, Jest debuted a new feature: Snapshot testing.  It works a bit differently than a normal unit test.  Instead of executing some code and comparing the output against a value provided by a developer, the first time a test is run, the output passed into the test is saved to a “snapshot file”.  Then when the test is run in the future, the output is compared to the snapshot file.  If the output matches the file, the test passes, if the output is different then the file, the test fails and Jest prints a diff.  We’ve been using Jest snapshots for a few weeks now and I wanted to share my initial impressions.</p>\n<h3>What is it like to use a snapshot test ?</h3>\n<p>The process for snapshot testing is a bit different than normal tests.  Most snapshot tests look fairly simple.  Something like this example from the <a href=\"https://github.com/facebook/jest/tree/master/examples/snapshot\">Jest repository</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Link.react.js</span>\n<span class=\"token comment\">// Copyright 2004-present Facebook. All Rights Reserved.</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">STATUS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">NORMAL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'normal'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">HOVERED</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'hovered'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Link</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseEnter <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseEnter<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseLeave <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseLeave<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">STATUS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NORMAL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_onMouseEnter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">STATUS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HOVERED</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_onMouseLeave</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">STATUS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NORMAL</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>a\n        className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span>\n        href<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>page <span class=\"token operator\">||</span> <span class=\"token string\">'#'</span><span class=\"token punctuation\">}</span>\n        onMouseEnter<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseEnter<span class=\"token punctuation\">}</span>\n        onMouseLeave<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseLeave<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Link.react-test.js  (partial)</span>\n<span class=\"token comment\">// Copyright 2004-present Facebook. All Rights Reserved.</span>\n<span class=\"token comment\">/* eslint-disable no-unused-vars */</span>\n\n<span class=\"token string\">'use strict'</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Link <span class=\"token keyword\">from</span> <span class=\"token string\">'../Link.react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> renderer <span class=\"token keyword\">from</span> <span class=\"token string\">'react-test-renderer'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders correctly'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> tree <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Link page<span class=\"token operator\">=</span><span class=\"token string\">\"http://www.facebook.com\"</span><span class=\"token operator\">></span>Facebook<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>The first time the test is run, a snapshot file is produced.  In this case, running the previous test produces a snapshot file that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Link.react-test.js.snap  (partial)</span>\nexports<span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`test renders correctly 1`</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\n&lt;a\n  className=\"normal\"\n  href=\"http://www.facebook.com\"\n  onMouseEnter={[Function bound _onMouseEnter]}\n  onMouseLeave={[Function bound _onMouseLeave]}>\n  Facebook\n&lt;/a>\n`</span></span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>This gives us a baseline for what we expect the UI to look like.  The snapshot is generated in a folder in your <code class=\"language-text\">__tests__</code> directory, so that it can be checked into source control.</p>\n<p>The next time a test is run, if nothing has changed, the test passes.  However, if we change something (let’s say we add a class), the test fails and shows us a diff.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// updated link render method</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>a\n      className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token string\">`link-item </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">}</span>\n      href<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>page <span class=\"token operator\">||</span> <span class=\"token string\">'#'</span><span class=\"token punctuation\">}</span>\n      onMouseEnter<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseEnter<span class=\"token punctuation\">}</span>\n      onMouseLeave<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_onMouseLeave<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<div class=\"gatsby-highlight\" data-language=\"diff\">\n      <pre class=\"language-diff\"><code class=\"language-diff\"># jest output\n\nFAIL  __tests__/Link.react-test.js\n ✕ renders correctly (16ms)\n\n● renders correctly\n\n    Received value does not match the stored snapshot 1.\n\n    - Snapshot\n    + Received\n\n      &lt;a\n<span class=\"token deleted\">-       className=\"normal\"</span>\n<span class=\"token inserted\">+       className=\"link-item normal\"</span>\n        href=\"http://www.facebook.com\"\n        onMouseEnter={[Function bound _onMouseEnter]}\n        onMouseLeave={[Function bound _onMouseLeave]}>\n        Facebook\n      &lt;/a>\n\n      at Object.&lt;anonymous> (__tests__/Link.react-test.js:14:16)</code></pre>\n      </div>\n<p>We can then choose to accept this change by running <code class=\"language-text\">jest -u</code> to update the snapshot, or update our code to fix the regression.  If we update the snapshot file, the test will start passing again.</p>\n<h3>Snapshot tests are a complement for conventional tests not a replacement</h3>\n<p>The first thing that became clear to me while using snapshot testing is that they’re not for everything.  They are optimized for a different case than normal assertion-based tests.</p>\n<p>Classic assertion based tests are perfect for testing clearly defined behavior that is expected to remain relatively stable.</p>\n<p>Snapshot tests are great for testing less clearly defined behavior that may change often.</p>\n<p>Snapshot testing is perfect for things that in the past would have raised concern for “overly brittle” tests that slow development teams down.  The classic example of this (and the main focus of discussion around Jest snapshots so far) is UI testing.</p>\n<p>UI components often change in small and trivial ways.  Copy is changed, whitespace is added, a border color is modified. Generally this means that developers have to choose between detailed tests that catch any regression but require constant updates, or less detailed tests that focus on core behaviors but miss smaller regressions.</p>\n<p>Snapshot tests provide a new way of approaching these problems in unit tests.  Because they are easy to write and effortless to update, and provide a clear view of what changed after each update, whether it is major or minor.</p>\n<p>This isn’t without any disadvantage. Snapshot tests preserve a starting point, but don’t give any indication of developer intent to future developers.  Like any other test, if the initial snapshot passes with bugs, or doesn’t capture the full range of cases, the test won’t adequately cover those behaviors.  But unlike traditional tests, snapshot tests don’t provide specific guidance for what the original developer expected beyond the “actual behavior”.  If there are multiple sub-behaviors that interact to produce output, its not clear which of those are essential, and which are incidental.  That’s not something you want for your critical application logic, especially complicated logic with many subtle cases.  But for UI components and other application elements that are likely to change a lot over time, this is a good set of tradeoffs.</p>\n<h3>Snapshot tests are more useful with a healthy code review process</h3>\n<p>I’ve pointed out several times now that snapshot tests are easy to update.  One of the downsides of the current design is that they can be almost too easy to update.  When a snapshot test fails, you have the option of modifying the output so that the test passes again, or updating the snapshot to reflect the new output.  Unfortunately, Jest currently provides no granularity for this updating.  Running <code class=\"language-text\">jest -u</code> to update the snapshots will update all snapshots.  So if  a single change causes many snapshots to break, it can be easy to accidentally update all of them, and possibly difficult to work through the whole diff to find changes.</p>\n<p>A robust code review process minimizes these problems.  Because snapshots are checked into source, the diffs in the snapshots are checked into source control.  Viewing diffs in a dedicated code review tool like Github, Bitbucket or Gitlab, it’s easier to see exactly what changed over many files than it might be when updating snapshots from the command line, and if you update a snapshot multiple times in a single branch, you can see the net effect on the snapshot through source control diffs better than you can through Jest.</p>\n<h3>Snapshot tests work well with auto-mocking</h3>\n<p>Auto-mocking has been one of Jest’s more controversial features.  Prior to version 15, Jest mocked every module used in tests by default.  To run the actual module code, it was necessary to manually unmock each module used or change Jest configurations.  Though it is now disabled by default, auto-mocking actually works very well with snapshot tests.  One problem with tests that rely on generating DOM in React is the fact that most components of any complexity are actually made up of smaller components, that often use external functions with complex logic to determine what to show.  If we fully render everything, changing any of those pieces can break tests for many components, moving us away from the concept of a “unit test”.  If we mock child components and helper functions and then test them individually though, we can focus our tests to only change based on the logic of the individual component being tested.  This is incredibly easy with Jest, and especially helpful in large code bases that don’t have complete test coverage.  Auto-mocking is considered an “advanced feature” of Jest, but it’s not hard to use.  Most mocked modules produce something non-harmful by default, and when its necessary to override, its not difficult to produce something meaningful without getting too involved.  Just add a file with the same name as the file to be mocked into a <code class=\"language-text\">__mocks__</code> folder in that directory, and give the mocked module the same interface as the mocked component.  You can either write it from scratch or use <a href=\"http://facebook.github.io/jest/docs/api.html#jest-genmockfrommodule-modulename\">jest.genMockFromModule</a> as a starting place.</p>\n<h3>Summary</h3>\n<p>I’m impressed by Jest snapshots.  When combined with React, they’re providing my first non-frustrating experience unit testing UI components.  I’m excited to use them more going forward, and will be interested to see how they evolve from here.</p>\n<hr>\n<h3>Extra: A few miscellaneous Jest Thoughts</h3>\n<ul>\n<li>The UI output from Jest 15 tests is the best I’ve ever seen from a testing framework.  Aside from the nice diffs on snapshots, they do a good job explaining how output differed from expectations in assertion based tests, and communicating context for test failures, warnings and logging messages.  They also give great guidance when making configuration changes:</li>\n</ul>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\"><a href=\"https://twitter.com/cpojer\">@cpojer</a> This is lovely, thank you! <a href=\"https://t.co/CX1v11CAVc\">pic.twitter.com/CX1v11CAVc</a></p>&mdash; Ben McCormick (@ben336) <a href=\"https://twitter.com/ben336/status/772906536154894336\">September 5, 2016</a></blockquote>\n<ul>\n<li>\n<p>I’ve also been super impressed with Jest’s watch mode in Jest 15.  <code class=\"language-text\">--watch</code> makes it easy to focus on a few files or run tests on all files, and stays up to date as you change code.  If you haven’t worked with Jest in a while, the developer experience alone makes it worth trying out.</p>\n</li>\n<li>\n<p>One potential future annoyance with snapshot tests:  The snapshot format can’t be iterated on without breaking all current tests.  Make sure not to mix functional changes with Jest updates!</p>\n</li>\n</ul>\n<blockquote class=\"twitter-tweet\" data-cards=\"hidden\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">We&#39;ll update the snapshot format sometimes in minor/major releases. When updating Jest, please update snapshots<br><br>See <a href=\"https://t.co/gPE63dMz8P\">https://t.co/gPE63dMz8P</a></p>&mdash; Christoph Pojer (@cpojer) <a href=\"https://twitter.com/cpojer/status/776623521069805568\">September 16, 2016</a></blockquote>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>Randy Coulman has a <a href=\"http://randycoulman.com/blog/2016/09/06/snapshot-testing-use-with-care/\">nice article</a> on some of the reasons to be careful about embracing snapshot testing.  He makes good points about the requirement of human involvement in verifying a change in time-crunched situations and also the potential value of snapshot tests for legacy code.</p>\n</li>\n<li>\n<p>My team uses a mix of <a href=\"https://github.com/airbnb/enzyme\">enzyme</a> and snapshot tests for unit testing React Components.  <a href=\"https://github.com/trayio/enzyme-to-json?utm_content=buffer6b78b&#x26;utm_medium=social&#x26;utm_source=twitter.com&#x26;utm_campaign=buffer\">This repo</a> combines them, allowing you to use enzyme to generate the snapshot output to diff against rather than the renderer provided by Jest. I personally haven’t felt the need to integrate these two tools, but if your team uses enzyme and wants consistency/fewer (used) dependencies, this could be a cool option.</p>\n</li>\n<li>\n<p>Finally here’s <a href=\"https://blog.grommet.io/post/2016/09/01/how-we-landed-on-jest-snapshot-testing-for-javascript\">another article</a> on how Snapshot testing convinced one team to migrate to Jest from Tape</p>\n</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>PhantomJS was a tremendous source of pain in our Karma setup.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p>This used to be the default setting, with Jest 15 it can be configured to work that way.</p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/2016/09/19/testing-with-jest-snapshots-first-impressions/"}}},{"node":{"frontmatter":{"readNext":"jest-first,backbone-devs-react,mobx-first","topics":["Jest","Testing"],"category":"tools","key":"saving-time-jest","title":"Saving Time With Jest: Meetup Summary","description":"A summary of my meetup talk on saving time with Jest","layout":"post","path":"/2016/12/10/saving-time-with-jest","date":"2016-12-10T05:15:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>This week I gave a talk at the brand new Triangle ReactJS meetup group on how <a href=\"https://facebook.github.io/jest/\">Jest</a> can save developers time.  I was asked afterwards to share the content online for those who missed it.  My talk was mostly demos and wasn’t recorded, so there unfortunately isn’t much to share, but I thought I could write out the basic ideas behind the talk, and share them here.</p>\n<h3>What is Jest</h3>\n<p>Jest is a JavaScript testing framework built by Facebook to address their internal problems testing JavaScript code.  It was open-sourced in 2014, but unlike Facebook’s other recent high profile JavaScript OSS projects like React, Flux, Relay and GraphQL, it failed to develop much traction in the community and mostly stagnated for 2 years.  That changed in early 2016 when 2 Facebook developers, <a href=\"https://twitter.com/cpojer\">Christoph Pojer</a> and <a href=\"https://twitter.com/abramov_dmitrii\">Dmitrii Abramov</a> began working on improving the project. Over the past year they’ve brought massive improvements to the developer experience of using Jest.</p>\n<p>At a more practical level Jest is a test runner with a built in assertion library and support for code coverage, babel transpilation, and module mocking.  It began as a wrapper around <a href=\"https://jasmine.github.io/\">Jasmine</a>, an older JavaScript testing library, but has since replaced parts of Jasmine with replacement functionality, while retaining backwards compatibility.</p>\n<h3>How Can Jest Save Me Time?</h3>\n<p>Jest saves developers  time in 4 main ways:</p>\n<ol>\n<li><strong>Setup</strong> - Jest is simple to configure</li>\n<li><strong>Writing Tests</strong> - Jest provides a method for writing simple UI tests, and makes it easy to port over existing tests</li>\n<li><strong>Running Tests</strong> - Jest runs tests in parallel, doesn’t require a browser, and only runs the tests that are affected by the current code changes</li>\n<li><strong>Fixing Tests</strong> - Jest gives great error messages, helps you find the failing code, and has other smaller UX features that make it easy to debug your failing tests quickly.</li>\n</ol>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">Tonight <a href=\"https://twitter.com/ben336\">@ben336</a> speaks about using <a href=\"https://twitter.com/hashtag/jest?src=hash\">#jest</a> with <a href=\"https://twitter.com/hashtag/reactjs?src=hash\">#reactjs</a> for your testing needs <a href=\"https://twitter.com/nestraleigh\">@nestraleigh</a> <a href=\"https://t.co/CAV8wZUwFw\">pic.twitter.com/CAV8wZUwFw</a></p>&mdash; Tracy Lee | ladyleet (@ladyleet) <a href=\"https://twitter.com/ladyleet/status/806655476515618822\">December 8, 2016</a></blockquote>\n<h3>Setup</h3>\n<p>Setting up Jest is extremely straightforward. Here’s a <code class=\"language-text\">Hello World</code> React Project</p>\n<div class=\"gatsby-highlight\" data-language=\"json\">\n      <pre class=\"language-json\"><code class=\"language-json\">//package.json\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"simple_example\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A minimal jest testing example\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jest\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^15.4.1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"babel-jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^17.0.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"babel-preset-es2015\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.18.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"babel-preset-react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.16.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^17.0.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react-test-renderer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^15.4.1\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>In package.json we have 4 dependencies that are part of a normal React project setup, <code class=\"language-text\">react</code>, the 2 babel presets for using <a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">es2015</a> syntax, and <code class=\"language-text\">react-test-renderer</code>, which is a react addon for rendering react for testing, similar to how <code class=\"language-text\">react-dom</code> renders components for the browser.  We then add <code class=\"language-text\">jest</code> and <code class=\"language-text\">babel-jest</code>.  <code class=\"language-text\">jest</code> provides the test runner, assertions API, mocking capabilities, and cli.  <code class=\"language-text\">babel-jest</code> is a drop-in dependency that lets Jest integrate with Babel.  Neither require any additional configuration in the normal case. Lets say the rest of our project looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\">\n      <pre class=\"language-txt\"><code class=\"language-txt\">├── __tests__\n│   └── simple-component.spec.js\n├── package.json\n└── simple-component.js</code></pre>\n      </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// simple-component.js</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SimpleComponent</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    Hello World\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// __tests__/simple-component.spec.js</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> renderer <span class=\"token keyword\">from</span> <span class=\"token string\">'react-test-renderer'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>SimpleComponent<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../simple-component'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'shows Hello World'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">&lt;</span>SimpleComponent<span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> componentJSON <span class=\"token operator\">=</span> component<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>componentJSON<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>Given this project, we only have to run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">yarn # or npm install\njest</code></pre>\n      </div>\n<p>and jest will automatically find our test file and run the test.</p>\n<img src=\"/jest-hello-world-73fcca901c1fc3f499dbffd86bea035a.gif\" class=\"full-width\" alt=\"gif of running jest\">\n<h3>Writing Tests</h3>\n<p>Jest provides Snapshot Tests, which are a quick way of writing tests to catch changes in the rendered output of a UI component (or any other serializable content).  <a href=\"http://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/\">I’ve written about Snapshot testing before</a>, so I won’t go into depth here.  But snapshot tests are significantly faster to write than traditional assertion based tests, and for the write type of code can provide greater or equal benefit.  This is one area where technically Jest may not save you time.  Instead it may take your team to a place where you’re actually willing to write tests for your UI components for the first time.</p>\n<p>There are also a great set of codemods for Jest. <a href=\"https://github.com/skovhus/jest-codemods\">jest-codemods</a> can help you take your existing suite of tests from Mocha, Ava, or tape and translate it over to Jest automatically.  Of course if you were using Jasmine previously, your tests can be migrated without changes. So Jest saves you time by not requiring you to rewrite any tests.</p>\n<h3>Running Tests</h3>\n<p>Jest runs tests fast by default.  While I’ve seen from comments on my last Jest post and elsewhere that some people may have been able to optimize mocha or AVA to be fast enough that switching to Jest was a downgrade, for most people Jest is going to be faster than whatever they may have been using before.  This is true because of performance reasons (tests run in parallel, and mock out timers to avoid unnecessary waiting), but also because of UX decisions.  Jest is able to use git and node’s modules system to detect what files have changed since the last commit, and which tests are affected by that.  Because of that, it is able to optionally run only the tests that might have changed on each run (<code class=\"language-text\">jest -o</code>).  Since it is usually able to run tests fast as a result (since it only runs a few at a time), Jest also is able to have an awesome watch mode (<code class=\"language-text\">jest --watch</code>).  In watch mode, tests rerun as files change, and there are options to target specific tests, run all tests, or fix snapshots as you go.</p>\n<img src=\"/jest-watch-279da95ef1b66a9874d8aa5edae7651e.gif\" class=\"full-width\" alt=\"gif of running jest --watch\">\n<h3>Fixing Tests</h3>\n<p>Jest provides 4 main conveniences for fixing tests</p>\n<ol>\n<li>Error messages have clear formatted diffs, making it easy to know the difference between what was received and expected</li>\n<li>Error messages have a clear traceback to the line that failed, either the assertion in the test file, or the exception in the source file</li>\n<li>Even though tests run in parallel, Jest makes sure that any console output from the test is placed in line with the test output, making it easy to debug with quick console messages</li>\n<li>When running Jest multiple times, Jest runs the tests that failed in the previous run prior to other tests, leading to a faster feedback loop even when not using watch mode</li>\n</ol>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.198653198653204%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAABHElEQVQoz4VSyXaDMAzkB+Ndsrw09BDScmhv+f+ObA4p7zWVhbEEI2kGlsf9/ti2tdbben3v7Wv//N4/9u22rlcmsta6v20x1nrvMxGcU0ohUAwxhIuzznv30hZczCxZrci8Z66Se6XM/iVewQD1tQMCh+mBuUgec4R/wALwWyNK5mIslgGVYcY4cD4C6w7/DUb5TBwimGJTC14tEoF2QH8i3ccgz7MsKIX3lLYIEYF1wcSZKWfpTRC0VnqXVhFCGxl0UooKBnI2RDy7zgOeQyvopftwp200EwIgmlhiitCn1gIfbRp2lEeIGz41Qsgxe5wFQy5RmlLrtFh8aA7YOORWC/CzxAnsMScrBpTBFD+LcsKZZyEIUWRkzuAf7BTYD91EyT8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n    <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" alt=\"gif of running jest --watch\" title=\"\" src=\"/static/7ea5ecbab2a2764639183ffbf4a3ef06/d766e/jest-error.png\" srcset=\"/static/7ea5ecbab2a2764639183ffbf4a3ef06/a6b6e/jest-error.png 143w,\n/static/7ea5ecbab2a2764639183ffbf4a3ef06/8e488/jest-error.png 285w,\n/static/7ea5ecbab2a2764639183ffbf4a3ef06/d766e/jest-error.png 570w,\n/static/7ea5ecbab2a2764639183ffbf4a3ef06/13239/jest-error.png 855w,\n/static/7ea5ecbab2a2764639183ffbf4a3ef06/cab6d/jest-error.png 1140w,\n/static/7ea5ecbab2a2764639183ffbf4a3ef06/348f6/jest-error.png 1188w\" sizes=\"(max-width: 570px) 100vw, 570px\">\n  </span>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>Another speakup at Wednesday’s meetup has a Jest related blog post out this week.  Nate Hunzaker blogged about <a href=\"https://www.viget.com/articles/acceptance-testing-react-apps-with-jest-and-nightmare\">using Jest with Nightmare.js for acceptance tests</a></p>\n</li>\n<li>\n<p>If you live in the Triangle area (thats Raleigh/Durham, North Carolina to the rest of the world) make sure to check out the <a href=\"http://www.meetup.com/trianglereact/\">Triangle React meetup</a>.  The plan as I understand it is to do events once a month, alternating project nights and talks.  I believe <a href=\"https://twitter.com/ladyleet\">Tracy</a> is looking for more speakers too, so hit her up if you’re interested.  This time 4 of us spoke for 15-20 minutes, so it isn’t as much preparation as other events where you’re the only speaker.</p>\n</li>\n</ul>","fields":{"slug":"/2016/12/10/saving-time-with-jest"}}},{"node":{"frontmatter":{"readNext":"jest-first,saving-time-jest,mobx-first","topics":["Jest","Code Quality","Testing"],"category":"tools","key":"jest-git","title":"Running Jest Tests Before Each Git Commit","description":"A simple setup to run your Jest tests before every commit","layout":"post","path":"/2017/02/26/running-jest-tests-before-each-git-commit/","date":"2017-02-26T23:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>My main work project makes heavy use of <a href=\"https://facebook.github.io/jest/\">Jest</a> to test our JavaScript code.  For a while now I’ve wanted to set up a way to run tests every time I run a commit.  I knew that git provides <a href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks\">hooks</a> that allow scripting actions to occur before or after any commit or push, and in fact we were already using a <code class=\"language-text\">pre-commit</code> hook script to lint our code with <a href=\"http://eslint.org/\">ESLint</a>.  But it was non-obvious how to make that work well with Jest testing.  I eventually figured out a setup that worked, and the found a better way to do both the Jest and ESLint testing.  Since it took me a while to work through, I thought I’d share it here and save the rest of you some time.</p>\n<h3>What didn’t work</h3>\n<p>A naive approach to this problem would be to set up a pre-commit hook that simply ran <code class=\"language-text\">jest</code> to run all tests. The problem is that running our full test suite currently takes between 10 and 20 seconds to run all tests and that time is increasing as we grow our test suite.  Adding that overhead to every commit would cost my team a lot of time, and would be especially inefficient since the repo contains plenty non-JavaScript code that doesn’t require tests to be run when updated.</p>\n<p>For our ESLint hook, we queried git to get a list of staged files, and then ran eslint against each one of them individually, displaying a pass/fail message.  That looked something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">STAGED_FILES<span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> <span class=\"token function\">diff</span> --cached --name-only --diff-filter<span class=\"token operator\">=</span>ACM <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"js$\"</span><span class=\"token variable\">)</span></span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$STAGED_FILES</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token keyword\">exit</span> 0\n<span class=\"token keyword\">fi</span>\n\nPASS<span class=\"token operator\">=</span>true\n\n<span class=\"token keyword\">for</span> FILE <span class=\"token keyword\">in</span> <span class=\"token variable\">$STAGED_FILES</span>\n<span class=\"token keyword\">do</span>\n    eslint --quiet <span class=\"token string\">\"<span class=\"token variable\">$FILE</span>\"</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$?</span>\"</span> <span class=\"token operator\">==</span> 0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[32mESLint Passed: <span class=\"token variable\">$FILE</span>\\033[0m\"</span>\n    <span class=\"token keyword\">else</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[41mESLint Failed: <span class=\"token variable\">$FILE</span>\\033[0m\"</span>\n        PASS<span class=\"token operator\">=</span>false\n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">done</span></code></pre>\n      </div>\n<p>This works great for ESLint, but doesn’t work out of the box for Jest, because I don’t want Jest to run the files that changed, I want them to run any tests that changed AND any tests that might have been broken because of that.</p>\n<p>Jest has a wonderful command line flag <code class=\"language-text\">jest --onlyChanged</code>/<code class=\"language-text\">jest -o</code> that runs only the tests related to files that have been changed according to git.  It is extremely helpful since it is smart enough to read the dependency structure for the project and run all tests that might be changed from updating a source file. It also has a <code class=\"language-text\">--lastCommit</code> option that does the same thing for files that were in the previous commit.  Unfortunately, these options aren’t helpful at the point of committing, since <code class=\"language-text\">onlyChanged</code> does not look at files that have been staged for commit, and we haven’t actually made a commit yet for <code class=\"language-text\">lastCommit</code> to read.</p>\n<h3>What Did Work</h3>\n<p>Fortunately Jest has a lower level command that uses the same logic as <code class=\"language-text\">onlyChanged</code> and <code class=\"language-text\">lastCommit</code>.  <code class=\"language-text\">--findRelatedTests</code> is a flag that tells Jest to run any tests related to the files passed to it instead of trying to run those files as tests as it would normally do.</p>\n<a class=\"gatsby-resp-image-link\" href=\"/static/9350cbcea06e8f1f423335d94d84ac98/1b819/jest-related-tests.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 81.97573656845753%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y41UyW7TUBT1t7GoxA4EWzZsQCz4KYSEQKBSAWppJVQQlDYNbVzHyYsd2+95SNI4djwl6Xi4fulAUJtmcXSvh3feHc69yiA0YbochrAJDizPAfcdmOQP6dto2MbZyCUInI+n9ozs+S1Q1jafY3XzJeK+gcOgBbtdg8s1eEJHL2hIQhx5V2Tnc8gk4auP9/Dm0xLymBGhjrr2C6y5jRbbgWXu0gV/MOg1MUnt6wjnECvvvjzAh7VHSMIGhF3DduUbNG0LqvqTCKtwiNB1asgiczHC96sPsfz1MYphi0gNdLwD+EKFY+1RxHWkAwPHuQNMvMVSDtzv6He35MGjzKGaWeS3kFNESUg2NnFa8KvIpphDaJs1cEuVdSrocFmzFqtg2G9JwuiQzXb4gvA2KAbbhsf3ZTePqPAdT5PRYXJ9610kM4SjhONk5GOScYzLlFNH+ieFkKmeFlS/sVgYymFPhcGbsKWgOdyOQNAV4AFHMrAQRhyDJECUeGR9pJmHLJv6ESFOPcRkh+n0vbKy8QTL608R9hh8t4G6XiEdVsHYHoSjwnXriGMHRe5JjHMXk8JFnnlX7wryRxfflNcrS3j7+T51VkdAcqmQDpuN31LgnKTTJ+lEXR2TpC3remfKa5vPsP7jBcZ0IKIohbOPwD2gRtWkDnu+hrBLI5hYCzVICbsayaNJMmEkm5K0KQnKySiRX0zIrGzEzMT86yussQOD7dJyYFI6baMqcUlYTg/ox3JS/sdNC0MRNtWpo1PKFk2KTRtGl0TluB3nXC6F8rkU+uUF5VSVE3TTwvgL5+Ghb81Fxi8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n    <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" alt=\"an example of findRelatedTests running against the redux repo\" title=\"\" src=\"/static/9350cbcea06e8f1f423335d94d84ac98/d766e/jest-related-tests.png\" srcset=\"/static/9350cbcea06e8f1f423335d94d84ac98/a6b6e/jest-related-tests.png 143w,\n/static/9350cbcea06e8f1f423335d94d84ac98/8e488/jest-related-tests.png 285w,\n/static/9350cbcea06e8f1f423335d94d84ac98/d766e/jest-related-tests.png 570w,\n/static/9350cbcea06e8f1f423335d94d84ac98/1b819/jest-related-tests.png 577w\" sizes=\"(max-width: 570px) 100vw, 570px\">\n  </span>\n  </a>\n<p>This is a perfect fit for a pre-commit hook.  I was able to integrate it into my existing script like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">jest --bail --findRelatedTests <span class=\"token variable\">$STAGED_FILES</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$?</span>\"</span> <span class=\"token operator\">==</span> 0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[32mJest Tests Passed\\033[0m\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[41mJest Tests Failed\\033[0m\"</span>\n    PASS<span class=\"token operator\">=</span>false\n<span class=\"token keyword\">fi</span></code></pre>\n      </div>\n<p><code class=\"language-text\">$STAGED_FILES</code> is re-used from the eslint portion of the script, and is just a space delimited list of files that are being committed.  The <code class=\"language-text\">--bail</code> option simply stops running tests as soon as one has failed.  Including that is optional, you won’t see all the tests that have failed, but the failure will happen faster and you’ll be able to decide how to proceed, including possibly running the full test script on your own.   </p>\n<p>Those lines (along with some sanity checks for the existence of Jest and error handling when PASS is set to false) are enough to get a workable commit hook going, but they’re not ideal.  pre-commit hooks aren’t persisted by git, so each user has to install the hook script individually, and any updates aren’t shared automatically.  Plus I’m inefficiently passing all staged files to eslint and Jest regardless of whether they’re JavaScript that those tools are actually meant to work on.  My ESLint code was also written before ESLint developed robust <code class=\"language-text\">--fix</code> capabilities, and doesn’t try to fix the errors it is capable of fixing.  Finally, while this is just poor coding and not an inherent limitation of my other method, I’m using globally installed versions of Jest and ESLint instead of scoping them to my project.</p>\n<h3>Making it better</h3>\n<p>Fortunately I’d discovered a better solution the other day while working on something else.  There is an npm package for making this process easier, <a href=\"https://github.com/okonet/lint-staged\">lint-staged</a>.  Lint staged abstracts away the boilerplate of getting the staged files, and makes it easy to run local node executables against specific sets of files.  I was able to replace my whole pre-commit script and address all of the problems mentioned above with only a few lines in my package.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\">\n      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lint-staged\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"*.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"eslint --fix\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"git add\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"jest --bail --findRelatedTests\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.16.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"19.0.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.3.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p><code class=\"language-text\">lint-staged</code> now handles making sure that I’m only running checks against JavaScript files, lets eslint autofix and stage any files that it can fix, and uses the local versions of jest and eslint.  It also adds a nice pretty interface for the results:</p>\n<a class=\"gatsby-resp-image-link\" href=\"/static/07049d14abcd3c0065c9779b76d22045/41b68/lint-staged-errors.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.321100917431195%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABCElEQVQoz3WR63KCMBCF8/6P15ZWEUXBCnJLMFwD9nQ3gU7r2B/fbNhkz5zDClkEuFxD6DrEqEO0co+mCtCpPerCt+eGetzv6wOm5oSvPsa9i2x9RHRyB5Vt7OBwc6KmOdrBgQRG2zvCMNSf2+iP4KOwGFWAJH6DzLfk6mBFWYwfYjj/InYsg3z/DGHKLRoSslEJFla5b88szvSLU6597XrP4jqHMsBMyoZccdy5de44GvemBY7LsccFvue3juhnTlTkRl83qOMX8Dn99JAlH8hTgmpy9nArd9AEL0lRAv5uFScKoJel6dLtQBjpY8w8TPk7TOWjK2hB6Sv60rdO1tiry/X//hf5G+jMEWFL2TQIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n    <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" alt=\"pretty lint-staged output\" title=\"\" src=\"/static/07049d14abcd3c0065c9779b76d22045/d766e/lint-staged-errors.png\" srcset=\"/static/07049d14abcd3c0065c9779b76d22045/a6b6e/lint-staged-errors.png 143w,\n/static/07049d14abcd3c0065c9779b76d22045/8e488/lint-staged-errors.png 285w,\n/static/07049d14abcd3c0065c9779b76d22045/d766e/lint-staged-errors.png 570w,\n/static/07049d14abcd3c0065c9779b76d22045/13239/lint-staged-errors.png 855w,\n/static/07049d14abcd3c0065c9779b76d22045/41b68/lint-staged-errors.png 872w\" sizes=\"(max-width: 570px) 100vw, 570px\">\n  </span>\n  </a>\n<p><code class=\"language-text\">lint-staged</code> docs recommend using an npm based hooks manager like <a href=\"https://github.com/observing/pre-commit\">pre-commit</a> for running the scripts, but due to some quirks in my setup (node_modules is symlinked, and I sometimes want to run these commands inside a docker container), I found it easier to maintain a custom pre-commit script and just replace the previous logic with <code class=\"language-text\">npm run lint-staged</code>.  Either way, all of the actual logic is now checked into the repository and shared between all users.  The only manual step is adding the call to a pre-commit hook or (if you’re using a helper lib) running npm install.</p>\n<h3>More Resources</h3>\n<ul>\n<li>This maybe merits a future post on its own, but if you’re interested in automating away your code style maintenance look at combining <a href=\"https://github.com/prettier/prettier\">prettier</a> (and possibly  <a href=\"https://github.com/not-an-aardvark/eslint-plugin-prettier\">eslint-plugin-prettier</a>) with the pre-commit hooks from above.  Prettier will guarantee that your code follows a consistent style, and because it handles maximum line lengths, is much more robust than ESLint on its own.  Using its ESLint plugin within my editor and on pre-commit hooks has pretty much eliminated me manually fixing code style problems.</li>\n</ul>","fields":{"slug":"/2017/02/26/running-jest-tests-before-each-git-commit/"}}},{"node":{"frontmatter":{"readNext":"jest-matchers-2,ten-things-js,jest-git","topics":["Jest","Testing"],"category":"javascript","key":"jest-matchers-1","title":"Taking Advantage of Jest Matchers (Part 1)","description":"Looking at the different API options Jest provides for assertions","layout":"post","path":"/2017/08/15/jest-matchers-1/","date":"2017-08-15T04:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>Back in May, my favorite testing library, Jest, released it’s 20th version and <a href=\"https://facebook.github.io/jest/blog/2017/05/06/jest-20-delightful-testing-multi-project-runner.html\">rebranded itself</a> as the library for “Delightful JavaScript Testing”.  Delightful and testing are two words that usually don’t go together in the software development lexicon.  But that claim is the result of 2 years of hard work from the Jest team trying to get the usability details of testing exactly right.  One of the version 20 announcements that exemplified this commitment to detail was the addition of several new assertion APIs to an already large list. This post dives into the many matcher options in Jest, why they’re there, and how to make good use of them.</p>\n<p>Assertion APIs, or matchers, are the methods that the library makes available for defining the expected value of a variable or expression.  The most basic assertion in Jest is the <code class=\"language-text\">.toBe</code> matcher, which checks to see if one value is the same as the other.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Math still works'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h3>Why so many matchers?</h3>\n<p>When writing tests, the only assertion api you really <strong>need</strong> is a method that takes a boolean and determines whether it is true or false.  Assuming you can figure out inspecting functions and async code, everything else can be expressed with an assert method like that:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Math still works'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>So why does Jest need 30+ matcher methods?  Because they allow you to be specific in your intent, and also let Jest provide helpful error messages.  For instance, when you write a test like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getRecord</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fullName'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Ben McCormick'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'records have a name and an ID'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> record <span class=\"token operator\">=</span> <span class=\"token function\">getRecord</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>it is obvious what the test is trying to check, and you can get detailed output like this:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/165f7e639e1a843277420540e4ec6cf6/d766e/error_output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.94736842105264%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABfklEQVQoz42SfXKCMBDFuf9ReoNO79Bq62hVVARtpSoIhJBA9PUlOlO048cfv9klk919L4sXRz1s4iHirwGyrQ9TLdCUERoZuViLORoRPownXp6QLbvYhG9Ilu8uN8kQJh3BZD6gljhUIYkewtOrd1REfXWhf/qovpnHPeh1Hzr5pMoZ9jJ8GE+VIZS1lYxR5zMoa5OTGlpXYgJVjHFQCzfdFtxVKDYjZIse8oh2V31kUReKsf4ZYL+bkCnMzsdeBGdNrzX3qt0YyeoN1XYImfqQ2zGK9RCK+aGcsxFhPLQaXdIe4NmkKQPsW1NgLarjpYYYeSo4FeFCVVut13C6pC2LyqYQVFamE5fvmK+2I6z5vpY08SF4LosAFanJP4WGlmpH4P49LY4XG55VXJJFc6jmt4unvGY09kkuG0qqKTi5zibuV6m5AMWGmo3MqejeZs8sR0EH6XoEvRkg/3iGXLwiT6fIuZx2wS3OFM5nHehi5t4tXvZoNfi7eKXoFr8I+45e19wrEAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Error output from Jest\"\n        title=\"\"\n        src=\"/static/165f7e639e1a843277420540e4ec6cf6/d766e/error_output.png\"\n        srcset=\"/static/165f7e639e1a843277420540e4ec6cf6/a6b6e/error_output.png 143w,\n/static/165f7e639e1a843277420540e4ec6cf6/8e488/error_output.png 285w,\n/static/165f7e639e1a843277420540e4ec6cf6/d766e/error_output.png 570w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n      />\n  </span>\n  </a></p>\n<p>You get the structure of the object as it is, the name of the property that is missing, the line number and file name where you can find the assertion, all in a concise, colorful and nicely formatted test failure message.</p>\n<p>You can categorize Jest’s matchers into 8 different categories: equality matchers, template matchers, numeric comparison matchers, contains matchers, async matchers, snapshot matchers, function matchers, and meta matchers.  I’ll go through the first 3 in this post, and cover the rest in a followup.</p>\n<h3>Equality Matchers</h3>\n<p>Equality matchers are the workhorse matchers of any test libraries.  This is where we see whether an expression evaluates to the value we expect. This being JavaScript however, equality takes a few different forms, and Jest covers each of them, along with some syntactic shortcuts.</p>\n<h4>toBe and toEqual</h4>\n<p><code class=\"language-text\">toBe</code>, as mentioned previously, is the simplest Jest matcher.  It is equivalent to a simple <code class=\"language-text\">===</code> statement, and verifies that the expression being tested is the same reference as the expression that it is matched against.  Since it is reference based, toBe is a good fit for numbers, strings and booleans, or for checking that an object is the exact same reference as another object.  But it’s not good for comparing two separate objects.  It behaves like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'on'</span> <span class=\"token operator\">+</span> <span class=\"token string\">'e'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword\">let</span> oneObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false!</span></code></pre>\n      </div>\n<p>For comparing object and array equality, it usually is better to use <code class=\"language-text\">toEqual</code>, which does a deep property comparison:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oneObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> nestedObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>nested<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>nestedObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>nested<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre>\n      </div>\n<p><code class=\"language-text\">toEqual</code> doesn’t line up to any built in JavaScript idea of equality exactly, it just does a recursive equal check. But it behaves like most people who haven’t already encountered the details of JavaScript equality would expect equality to work.  If objects share the same structure and values, they’re equal. There also is no Jest equivalent to <code class=\"language-text\">==</code> with its odd type casting behavior, and that is ok by me.</p>\n<h4>toBeDefined, toBeNull and toBeUndefined</h4>\n<p><code class=\"language-text\">toBeDefined</code>, <code class=\"language-text\">toBeNull</code>, and <code class=\"language-text\">toBeUndefined</code> are all shortcut functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// same as expect(x).toBe(null)</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// same as expect(typeof x).toBe('undefined')</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeUndefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// same as expect(typeof x).not.toBe('undefined')</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>One thing worth pointing out here is the use of <code class=\"language-text\">.not</code> in my example comment.\n<code class=\"language-text\">.not</code> is a utility property that you can chain to reverse the output of\nany matcher.</p>\n<h4>toBeFalsy and toBeTruthy</h4>\n<p>These matchers essentially are shortcuts that act like <code class=\"language-text\">if</code> and <code class=\"language-text\">else</code> statements.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// same as expect(!!x).toBe(true)</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeTruthy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// same as expect(!!x).toBe(false)</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeFalsy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>If you aren’t aware of the JavaScript concepts of truthiness and falsiness, the terms refer to whether a value is evaluated as true or false when evaluated in a boolean context.</p>\n<h3>Template matchers</h3>\n<p>Template matchers are matchers that don’t check for a specific value, but instead look to see if the expression is consistent with a certain pattern or shape.</p>\n<h4>toMatch</h4>\n<p><code class=\"language-text\">toMatch</code> is a template matcher for strings.  It accepts a regular expression that\nyou can use to describe the acceptable list of strings.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> id1 <span class=\"token operator\">=</span> <span class=\"token string\">'155-60-7723'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> id2 <span class=\"token operator\">=</span> <span class=\"token string\">'15-60-7723'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> socialSecurityNumberFormat <span class=\"token operator\">=</span> <span class=\"token regex\">/\\d{3}-\\d{2}-\\d{4}/</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>id1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span>socialSecurityNumberFormat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>id2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span>socialSecurityNumberFormat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span></code></pre>\n      </div>\n<h4>toMatchObject and toHaveProperty</h4>\n<p><code class=\"language-text\">toMatchObject</code> and <code class=\"language-text\">toHaveProperty</code> are template matchers for objects. <code class=\"language-text\">toMatchObject</code> works similarly to <code class=\"language-text\">toEqual</code> and does a deep comparison on objects and arrays.  But unlike <code class=\"language-text\">toEqual</code>, <code class=\"language-text\">toMatchObject</code> doesn’t require an exact match, it just verifies that the expression has the same properties as the template object.  So extra properties on the expression we’re evaluating don’t matter.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oneObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> uno<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre>\n      </div>\n<p><code class=\"language-text\">toHaveProperty</code> performs a similar function but doesn’t enforce the whole structure of an object.  Instead it just tests whether a single property is defined.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oneObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre>\n      </div>\n<p><code class=\"language-text\">toHaveProperty</code> can take a second “value” argument, at which point it acts as a more limited version of <code class=\"language-text\">toMatch</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oneObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>oneObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span></code></pre>\n      </div>\n<h4>toHaveLength</h4>\n<p><code class=\"language-text\">toHaveLength</code> is a simple matcher for checking the length of strings, arrays and any other array-like object that has a length property.  <code class=\"language-text\">expect(x).toHaveLength(y)</code> is just a shorthand for <code class=\"language-text\">expect(x.length)</code> with the benefit of handling undefined values of <code class=\"language-text\">x</code> safely.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'From'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'The'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Other'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Side'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>length<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre>\n      </div>\n<h4>toBeInstanceOf</h4>\n<p><code class=\"language-text\">toBeInstanceOf</code> allow’s checking the “type” of an object to see if it is an instance of a class, including inherited classes.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'We can test whether an object is an instance of a class'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">B</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">C</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">B</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">C</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInstanceOf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInstanceOf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true because of inheritance</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBeInstanceOf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h3>toThrow</h3>\n<p><code class=\"language-text\">toThrow</code> is a bit of a different template matcher, because rather than matching a value, it matches against an exception.  <code class=\"language-text\">except()</code> takes a function, and instead of evaluating that function, it executes the function and looks to see if an exception is thrown. If there is an exception, <code class=\"language-text\">toThrow</code> can take a string, regex or Class and acts like either <code class=\"language-text\">toMatch</code> or <code class=\"language-text\">toBeInstanceOf</code> depending on what it is passed.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'We can match exceptions'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">throwingFunc1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpecialError</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">throwingFunc2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SpecialError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>throwingFunc1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toThrow</span><span class=\"token punctuation\">(</span><span class=\"token string\">'err'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>throwingFunc1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toThrow</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/err/</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>throwingFunc2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toThrow</span><span class=\"token punctuation\">(</span>SpecialError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h3>Numeric Comparison Matchers</h3>\n<p>Numeric comparison matchers are straightforward.  They test whether a number relates correctly to another number.</p>\n<h4>toBeGreaterThan, toBeGreaterThanOrEqual, toBeLessThan, toBeLessThanOrEqual</h4>\n<p>These are exactly what they sound like.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeLessThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeLessThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeLessThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeLessThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre>\n      </div>\n<h4>toBeCloseTo</h4>\n<p>This test checks whether a number is the same as another number within a set number of significant digits.  <code class=\"language-text\">toBeCloseTo</code> takes a number and an optional second option that determines the number of significant digits, then tests whether an expression is the same as that number within that number of significant digits.  This is useful in JavaScript since <a href=\"https://stackoverflow.com/questions/588004/is-floating-point-math-broken\">floating point math is not precise and 0.1 + 0.2 famously does not equal 0.3 exactly</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Floating Point Math Is Hard'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.2</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//true</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.2</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeCloseTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h3>Part 2 Coming Soon</h3>\n<p>There’s a lot to cover here, so check back soon for part 2 of this post, with contains matchers, async matchers, snapshot matchers, function matchers, meta matchers, and a few extra tricks for using matchers.</p>","fields":{"slug":"/2017/08/15/jest-matchers-1/"}}},{"node":{"frontmatter":{"readNext":"jest-matchers-1,ten-things-js,jest-git","topics":["Jest","Testing"],"category":"javascript","key":"jest-matchers-2","title":"Taking Advantage of Jest Matchers (Part 2)","description":"More API options for descriptive Jest tests","layout":"post","path":"/2017/09/04/jest-matchers-2/","date":"2017-09-05T03:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This post continues my look at Jest matchers from <a href=\"https://benmccormick.org/2017/08/15/jest-matchers-1/\">Part 1</a>.</em></p>\n<p>In part 1 I covered the first 4 types of Jest matchers.  In this post I’m going to cover <em>contains</em> matchers, <em>async</em> matchers, <em>snapshot</em> matchers, <em>function</em> matchers and <em>meta</em> matchers, as well as looking at a few extra tips and tricks for using matchers.</p>\n<h3>Contains Matchers</h3>\n<p>Contains matchers are exactly what they sound like.  They’re matchers that check to see if an array contains an item or if a string contains a substring.  </p>\n<h4>toContain and toContainEqual</h4>\n<p><code class=\"language-text\">toContain</code> and <code class=\"language-text\">toContainEqual</code> both check to see if a value is contained inside of an array or string.  When used against a string, they are both equivalent and check to see if a passed string is a substring of the expression being tested.  This means they serve as a more limited version of <code class=\"language-text\">toMatch</code> that will only take a substring and not a regex.  When used against an array or array-like object, <code class=\"language-text\">toContain</code> looks for matches using strict equality while <code class=\"language-text\">toContainEqual</code> looks for matches using recursive equality<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  In practice that looks like</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// toContain does exact matches</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ab'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/a/</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">:</span> <span class=\"token string\">'bc'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>b<span class=\"token punctuation\">:</span> <span class=\"token string\">'cd'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">:</span> <span class=\"token string\">'bc'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n\n<span class=\"token comment\">// toContainEqual does recursive matches</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContainEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">:</span> <span class=\"token string\">'bc'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>b<span class=\"token punctuation\">:</span> <span class=\"token string\">'cd'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContainEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">:</span> <span class=\"token string\">'bc'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span></code></pre>\n      </div>\n<h3>Async Matchers</h3>\n<p>Async matchers handle testing functions that have an asynchronous component.  We’ll look at <code class=\"language-text\">resolves</code> and <code class=\"language-text\">rejects</code> for testing Promises.  But first, it is worth noting that any matcher can be used for asynchronous testing if necessary.  You just have to use the callback option that is passed to each test function, like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Delayed Test'</span><span class=\"token punctuation\">,</span> done <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token function-variable function\">delayedEval</span> <span class=\"token operator\">=</span> condition <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token function\">delayedEval</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>Jest detects whether the <code class=\"language-text\">done</code> callback has been defined for the function, and if it is waits for 5 seconds to see if <code class=\"language-text\">done</code> is called before failing, and evaluates any\nasynchronous expects that occur before then.  This behavior is inherited from Jasmine, and works ok, but can be a bit difficult to work with.  Jest makes this easier in 2 ways.  First with a set of special matchers for working with promises, and second with a set of meta matchers that can make async tests more reliable.  We’ll get to the meta matchers in a second, but first we’ll look at the promise matchers.</p>\n<h4>.resolves, .rejects</h4>\n<p><code class=\"language-text\">resolves</code> and <code class=\"language-text\">rejects</code> are chaining matchers like <code class=\"language-text\">not</code> that let you write async tests with Promises.  Using <code class=\"language-text\">resolves</code> to rewrite the previous example looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Delayed Test with promises'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> testPromise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> rej<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">res</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>testPromise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>resolves<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>This waits for the promise to resolve, and then compares the resolved output with <code class=\"language-text\">toBe</code>.  If a rejection is expected, you can replace <code class=\"language-text\">resolves</code> with <code class=\"language-text\">rejects</code> for a similar test. This ends up being much clearer in my opinion than the callback-based async tests, since the assertion is much more direct, and you don’t have to worry about cases where <code class=\"language-text\">done</code> might not be called where it should be.</p>\n<h3>Meta Matchers</h3>\n<p>Meta matchers pair well with the <code class=\"language-text\">done</code> async matchers above, if you have to use them.  They just let you test that all of your assertions have actually run. The first one, <code class=\"language-text\">expect.assertions</code> tests that a specific number of assertions have been run at that point in the test.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'records have a name and an ID'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> record <span class=\"token operator\">=</span> <span class=\"token function\">getRecord</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    expect<span class=\"token punctuation\">.</span><span class=\"token function\">assertions</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// true</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fullName'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    expect<span class=\"token punctuation\">.</span><span class=\"token function\">assertions</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>This can be useful for async tests to make sure things have run correctly before calling <code class=\"language-text\">done()</code>, for tests with conditional logic to make sure that the logic played out as expected, and for normal tests as an extra paranoid quality check to make sure that tests aren’t accidentally deleted.</p>\n<p><code class=\"language-text\">expect.hasAssertions</code> is just a simpler version of this test that checks that you’ve asserted something in the test.  It’s useful for the same things as <code class=\"language-text\">expect.assertions</code> but will be a little less reliable and also a bit less fragile when tests change.</p>\n<p>Note that neither <code class=\"language-text\">expect.assertions</code> nor <code class=\"language-text\">expect.hasAssertions</code> count as assertions themselves and don’t contribute to the assertion count.</p>\n<h3>Snapshot Matchers</h3>\n<p>Snapshot testing is one of Jest’s signature features.  It’s been described in depth in many other places, including <a href=\"https://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/\">on this blog</a>.  If you’re unfamiliar with snapshot testing, I recommend checking out one of those deeper posts.  But at a high level, snapshots are an assertion that data has remained the same since the last time a test was run.  Jest has serializers for a bunch of built in data types and React components. But it’s possible to define serializers for different data types to determine how that data should be represented in a snapshot.  </p>\n<p>The core snapshot function, <code class=\"language-text\">toMatchSnapshot()</code> is fairly simple to explain. When run the first time, <code class=\"language-text\">toMatchSnapshot</code> takes the string representation of the data passed to it (generated by whatever serializer is used for that data type) and writes it to a snapshot file.  After the snapshot has been written once, future runs of <code class=\"language-text\">toMatchSnapshot</code> behave differently.  If Jest is run normally, <code class=\"language-text\">toMatchSnapshot</code> compares the serialized data to the value in the snapshot file, and fails the test if they are different.  If Jest is run with the <code class=\"language-text\">-u</code> option, it will instead update the snapshot file with the current serialized value.  This behavior lets us write tests that don’t have a pre-defined “correct value”, instead we can use our test cases to see what has changed, and choose to accept it or not.</p>\n<h4>toThrowErrorMatchingSnapshot</h4>\n<p>In addition to <code class=\"language-text\">toMatchSnapshot</code>, Jest offers a second snapshot matcher, <code class=\"language-text\">toThrowErrorMatchingSnapshot</code>, which catches errors and verifies that they match a snapshot, similar to the <code class=\"language-text\">toThrow</code> matcher I described in part 1.</p>\n<h3>Function Matchers</h3>\n<p>One of Jest’s nicer features is its function mocking system.  A full discussion of function mocking is outside the scope of this post, but suffice it to say that you can create “tracked” functions in Jest.  The following matchers work with those tracked functions to verify behavior, using an example of a function that takes another function and calls it with the given arguments.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">executeFn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h4>toHaveBeenCalled, toHaveBeenCalledTimes</h4>\n<p>The most basic matcher when dealing with functions is <code class=\"language-text\">toHaveBeenCalled</code>.  It works more or less how it sounds, and determines whether a function has executed during the test.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'does executeFn run the function passed to it?'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> fn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">executeFn</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>Jest also has a related matcher, <code class=\"language-text\">toHaveBeenCalledTimes</code> which lets you specify how many times a function has been called.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'does executeFn run the function passed to it only once?'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> fn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">executeFn</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h4>toHaveBeenCalledWith, toHaveBeenLastCalledWith</h4>\n<p>Sometimes you don’t just want to know if a function was called, but want to make sure that it was called with the right arguments.  Jest has you covered.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'does executeFn run the function with the passed arguments'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> fn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">executeFn</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p><code class=\"language-text\">toHaveBeenCalledWith</code> lets you check that the function was called with the right arguments.  You have to be careful though, if the function was called multiple times, you’re only verifying that it was called with those arguments at some point.  If you want to get more specific, you can use <code class=\"language-text\">toHaveBeenLastCalledWith</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'does executeFn run the function with the passed arguments'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> fn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">executeFn</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">executeFn</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenLastCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h3>Bonus Content</h3>\n<p>That’s all for matcher methods, but there are a few other helpful things to know about matchers that I didn’t get to work into any of the matcher categories.  So here you go:</p>\n<h3>Extension Methods</h3>\n<p>Jest’s expect object has 2 methods for extending what it can do: <code class=\"language-text\">expect.addSnapshotSerializer</code> and <code class=\"language-text\">expect.extend</code>.  <code class=\"language-text\">expect.addSnapshotSerializer</code> lets you add a new snapshot serializer as a one off for a specific test file. A serializer is simply an object that defines <code class=\"language-text\">test</code> and <code class=\"language-text\">print</code> methods.  You can learn more <a href=\"http://facebook.github.io/jest/docs/en/configuration.html#snapshotserializers-array-string\">in the docs</a>.</p>\n<p><code class=\"language-text\">expect.extend</code> allows you to define custom matchers!  It takes an object with methods that define the new matchers to add.  Each method should be a function that takes the expected value as a first argument, and then expected arguments to the matcher as the rest of the arguments.  For instance, here is a matcher to see whether a string is a palindrome.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">expect<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">toBeAPalindrome</span><span class=\"token punctuation\">(</span>received<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> received <span class=\"token operator\">!==</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token string\">'expected ${received} to be a string, but it was a ${typeof received}'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> reversed <span class=\"token operator\">=</span> received<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> pass <span class=\"token operator\">=</span> received <span class=\"token operator\">===</span> reversed<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        message<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n          <span class=\"token template-string\"><span class=\"token string\">`expected </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>received<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> not to be a palindrome`</span></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        pass<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        message<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`expected </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>received<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> to be a palindrome but it was </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>reversed<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> when reversed`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        pass<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Anna is a palindrome'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'anna'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeAPalindrome</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ann'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBeAPalindrome</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<h3>Matcher Wildcards</h3>\n<p>Several of the matchers I’ve described in these posts are focused on equality of a particular part of a structure. These include the template matchers, contains matchers, and the <code class=\"language-text\">toEqual</code> matcher.  In these cases you’re trying to say that some part of an object is equal to something else.  But sometimes you want to be a bit open-minded about part of that.  Maybe you want to ensure that an object has an <code class=\"language-text\">email</code> property that is a string with the character <code class=\"language-text\">@</code> in it , or that it has a name property defined, but that could be anything as long as its defined.  Jest has wildcards that help you do this.</p>\n<ul>\n<li><code class=\"language-text\">expect.any(&lt;constructor&gt;)</code> lets you match any object of a specific type</li>\n<li><code class=\"language-text\">expect.anything()</code> matches anything except null and undefined</li>\n<li><code class=\"language-text\">expect.stringMatching(regexp)</code> matches any string that matches the regex you pass it</li>\n<li><code class=\"language-text\">expect.stringContaining(string)</code> matches strings against a substring</li>\n<li><code class=\"language-text\">expect.arrayContaining(array)</code> matches arrays that have a specific set of values in them</li>\n<li><code class=\"language-text\">expect.objectContaining(object)</code> matches objects that have a specific set of key/value pairs</li>\n</ul>\n<p>Using wildcards looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'wildcard example'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>expect<span class=\"token punctuation\">.</span><span class=\"token function\">anything</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'baz'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    foo<span class=\"token punctuation\">:</span> expect<span class=\"token punctuation\">.</span><span class=\"token function\">arrayContaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<h3>expect outside of Jest</h3>\n<p>As I was finishing up this post, Jest 21 was released, along with the exciting news that <code class=\"language-text\">jest-matchers</code> has been renamed to <code class=\"language-text\">expect</code> and is now available as a standalone module that can be used in other test frameworks, including in the browser.  So if the matchers in these blog posts have looked appealing to you, but you have an existing test framework that you’re tied to, feel free to check it out <a href=\"https://www.npmjs.com/package/expect\">on npm</a>.</p>\n<h2>More Resources</h2>\n<ul>\n<li>The latest info on all of these matcher APIs is always going to be in their very readable <a href=\"http://facebook.github.io/jest/docs/en/expect.html\">docs</a>.  Check them out for more examples and good links to a deeper dive on some of the other topics that these posts have touched on, like snapshot testing and mock functions.</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>Similar to toBe and toEqual from part 1, strict equality here means it’s the same reference and is equivalent to <code class=\"language-text\">x === y</code>, while recursive equality means the object’s are structured the same and any object with the same structure and values will be considered equal.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/2017/09/04/jest-matchers-2/"}}}],"topic":"Jest"}}