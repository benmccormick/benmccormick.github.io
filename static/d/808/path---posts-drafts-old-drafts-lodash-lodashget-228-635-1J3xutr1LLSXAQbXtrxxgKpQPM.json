{"data":{"markdownRemark":{"html":"<h1>Diving Into lodash: Getting and Setting nested properties</h1>\n<p>Dealing with nested properties in JavaScript is a bit of a pain.  Because JavaScript has no explicit static typing system, it never makes guarantees about the structure of data, and there are no great language idioms for easily handling missing data.  There are a few common idioms for handling missing data.  Many developers will use <code class=\"language-text\">||</code> to assign a placeholder for a missing element, like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span>message <span class=\"token operator\">||</span> <span class=\"token string\">'Nothing to say'</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>When handling nested data that may be missing, the choice is usually between accessing it unsafely, checking each layer to see if it exists first, or using a try catch block:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/* \nif we expect user to look like this:\n{\n    name: 'Jon Smith',\n    //...\n    addresses: [{\n        street: '311 Main St',\n        city: 'Durham',\n        state: 'NC',\n        zip: '27701',\n    }],\n}\n*/</span>\n\n<span class=\"token comment\">//this is an unsafe lookup</span>\n<span class=\"token keyword\">let</span> userCity <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>city<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//this is using checks</span>\n\n<span class=\"token keyword\">let</span> userCity <span class=\"token operator\">=</span> user <span class=\"token operator\">&amp;&amp;</span> user<span class=\"token punctuation\">.</span>addresses <span class=\"token operator\">&amp;&amp;</span> user<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&amp;&amp;</span> user<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> user<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">?</span> user<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>city <span class=\"token punctuation\">:</span> <span class=\"token string\">'Unknown City'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//this is using try catch </span>\n<span class=\"token keyword\">let</span> userCity<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n   userCity <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>city<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    userCity <span class=\"token operator\">=</span> <span class=\"token string\">'Unknown City'</span><span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Each of these is unsatisfactory in its own special way.  Using <code class=\"language-text\">||</code> for placeholder values can be unreliable.  It will replace <code class=\"language-text\">0</code>, <code class=\"language-text\">false</code> and <code class=\"language-text\">&#39;&#39;</code> with placeholder values even when those might be valid values.  That means you need to think through the possible values every time you use it.  Unsafe lookups are in fact unsafe.  While they can be ok in sections of code where the values that are being passed have been guaranteed through other means, JavaScripts dynamic nature makes them a likely source of crashes in the long run.  Finally, the conditional and try catch options both obscure the logic of the code and come with their own pitfalls.  When going 3 levels deep its easy to miss a conditional check, and while in the above example it is obvious that an error is coming from missing values, try catches in the real world will often require more boilerplate to make sure that we’ve safely caught the right error and handled it correctly with the placeholder value.</p>\n<p>lodash provides 3 methods for safely accessing nested data, and 5 more for safely updating that data.  In this post I’m going to quickly review those options.</p>\n<h3>Accessing nested data</h3>\n<p>The 3 methods lodash provides for safely accessing nested data are <code class=\"language-text\">_.get</code>, <code class=\"language-text\">_.result</code>, and <code class=\"language-text\">_.invoke</code>.  Each provides a safe way of accessing data through a path.</p>\n<p><code class=\"language-text\">_.get</code> is the simplest of the 3.  It takes 3 arguments: an object, a path, and optionally a default value.  With <code class=\"language-text\">_.get</code>, our example from above looks like this: </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/* \nif we expect user to look like this:\n{\n    name: 'Jon Smith',\n    //...\n    addresses: [{\n        street: '311 Main St',\n        city: 'Durham',\n        state: 'NC',\n        zip: '27701',\n    }],\n}\n*/</span>\n\n<span class=\"token keyword\">let</span> userCity <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token string\">'addresses[0].city'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Unknown City'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>If any portion of the nested path is undefined, <code class=\"language-text\">_.get</code> will return the default value, or undefined if one is not set.  The defaulting behavior is reliable.  It will only switch to the default on an undefined value along the path, not on a falsy value like <code class=\"language-text\">||</code>.  </p>\n<p><code class=\"language-text\">_.result</code> has the same behavior and signature as <code class=\"language-text\">_.get</code> with one exception.  If the object and path evaluates to a function, <code class=\"language-text\">_.result</code> will evaluate the function and return the result.  This is extremely useful for designing flexible APIs, both for library authors and inside a larger application, as it is possible to specify options that can be passed either as data or as a function that will evaluate to data at run time.  <a href=\"http://backbonejs.org/\">Backbone</a> makes heavy use of this in their APIs, where many properties of Backbone Views and Models can be specified either as a string or a function.</p>\n<p>Finally <code class=\"language-text\">_.invoke</code> is similar to <code class=\"language-text\">_.result</code>, but always attempts to call the result of evaluating the object and a path as a function.  If the end of the path is a function, <code class=\"language-text\">_.invoke</code> calls it and returns the result.  If the end of the path is undefined, <code class=\"language-text\">_.invoke</code> returns undefined.  If the end of the path is defined, but not a function, <code class=\"language-text\">_.invoke</code> throws an error.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    b<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n_<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// () => 2</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">result</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n\n_<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">result</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Uncaught TypeError: func.call is not a function(…)</span>\n\n_<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'default'</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">result</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'default'</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined</span></code></pre>\n      </div>\n<h3>Updating nested data</h3>\n<p>The 5 methods lodash provides for updating nested data are <code class=\"language-text\">_.set</code>, <code class=\"language-text\">_.setWith</code>, <code class=\"language-text\">_.unset</code>, <code class=\"language-text\">_.update</code>, and <code class=\"language-text\">_.updateWith</code>. </p>\n<p><code class=\"language-text\">_.set</code> is the simplest possible update.  It allows you to set a nested property, but builds out the path to the property if it doesn’t exist. So for instance you can do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n_<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token string\">'b[0].c'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { b: [{c: 2}]}</span></code></pre>\n      </div>\n<p>Set tries to be smart about how it builds out the path, build arrays for <code class=\"language-text\">[n]</code> notation areas, and new objects for keys in the path.</p>\n<p><code class=\"language-text\">_.setWith</code> gives you a bit more control.  It works similarly to <code class=\"language-text\">_.set</code>, but exposes an extra argument <em>customizer</em> that lets you define a function to manage the behavior at each level in the path.  The customizer takes the existing path values if they exist as well as the key names, and lets the user define the structure of the values to fill the path with.</p>\n<p><code class=\"language-text\">_.unset</code> does exactly what it sounds like.  It safely attempts to delete a nested property, and will return true if it successfully deletes a property, false otherwise.  It’s syntax is similar to <code class=\"language-text\">_.get</code> and <code class=\"language-text\">_.set</code>, it takes 2 arguments, an object and a path.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n_<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token string\">'b[0].c'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { b: [{c: 2}]}</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">unset</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token string\">'b[0].c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { b: [{}]}</span></code></pre>\n      </div>\n<p><code class=\"language-text\">_.update</code> works the same as set, but instead of taking a new value, takes a function.  That function gets the current property value, and then set’s the result of passing that value to the updater function.  Like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> \n    b<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        c<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">safeSquare</span> <span class=\"token operator\">=</span> value <span class=\"token operator\">=></span> _<span class=\"token punctuation\">.</span><span class=\"token function\">isFinite</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> value <span class=\"token operator\">*</span> value <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n_<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token string\">'b.c'</span><span class=\"token punctuation\">,</span> safeSquare<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// a => {b: {c: 4}}</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token string\">'b.d'</span><span class=\"token punctuation\">,</span> safeSquare<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// a => {b: {c: 4, d: 0}}</span></code></pre>\n      </div>\n<p><code class=\"language-text\">_.update</code> is also paired with an <code class=\"language-text\">_.updateWith</code>, which takes a customizer function that works the same way as <code class=\"language-text\">_.setWith</code>. </p>\n<h3>Subscribe</h3>\n<p>Thanks for taking the time to read this post!  JavaScript Development is one of the main topics of this blog, so if you enjoyed the post, please consider subscribing by using the <a href=\"http://feedpress.me/benmccormick\">feed</a>, <a href=\"http://twitter.com/benmccormickorg\">Twitter</a> or my <a href=\"http://eepurl.com/WFYon\">mailing list</a>. You also might want to check out the other lodash posts in this series.</p>","frontmatter":{"title":"","keywords":null,"category":null,"date":null,"path":null,"layout":null,"hideFooter":null,"hideSidebar":null},"fields":{"slug":"/posts/drafts/old-drafts/lodash/lodashget/"}}},"pageContext":{"slug":"/posts/drafts/old-drafts/lodash/lodashget/","relatedPosts":[{"path":"/404.html","data":{"title":"","path":"/404.html","description":null,"date":null,"category":null}},{"path":"/a-note-to-recruiters","data":{"title":"A note to recruiters","path":"/a-note-to-recruiters","description":null,"date":"2015-06-04T13:42:18+00:00","category":null}},{"path":"/built-with","data":{"title":"Built With","path":"/built-with","description":null,"date":null,"category":null}}]}}