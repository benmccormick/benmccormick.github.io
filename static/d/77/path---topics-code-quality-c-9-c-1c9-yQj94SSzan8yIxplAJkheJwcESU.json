{"pageContext":{"posts":[{"node":{"frontmatter":{"readNext":null,"topics":["Code Quality","Architecture"],"category":"software-productivity","key":null,"title":"How I Work:  Refactoring","description":"Describing the process that goes behind refactoring code","layout":"post","path":"/2013/02/03/how-i-work-refactoring","date":"2013-02-03T21:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>I recently took the time to re-examine a section of code that I’ve worked on as part of a team for the last year.  Looking at it with fresh eyes I saw plenty of room for improvement.  The issues weren’t the result of one bad checkin or poor decision.  Instead they were the result of “death by a thousand cuts”, a series of small decisions made by different people that were individually justifiable but eventually resulted in brittle, hard to maintain code.</p>\n<p>Over the last few days I’ve been taking some time to refactor the code.  Doing so made me think about what questions I should be asking while refactoring code.  Here are a few of the things I look for when I’m working to clean up code:</p>\n<h4>Does each function do only one thing?</h4>\n<p>This has been the hardest bad habit for me to break.  I have a natural inclination when adding new functionality to try to toss it into a related function.  This seems great as first, but its how you go from a function that “removes special characters from a string”, to one that “removes extra characters from a string”, to one that “processes strings”, and finally to “the string function” that takes a string and returns a new output determined by a glob of unreadable code that nobody understands and everyone is scared to touch.</p>\n<p>Functions that perform only one purpose are easier to understand, easier to use, easier to test, and easier to port to new environments.  When functions start to perform multiple purposes it becomes harder to maintain <a href=\"http://en.wikipedia.org/wiki/Don&#x27;t_repeat_yourself\">DRY</a> principles.  If one function performs actions A&#x26;B, another performs B&#x26;C, and a 3rd one performs A&#x26;C, you have to duplicate each action twice, adding code bloat and opening up the risk of inconsistent changes across methods.</p>\n<h4>Does each object/concept have a consistent naming convention throughout the system?</h4>\n<p>One source of frustration I’ve had when debugging the code for my project has been the fact that different developers have started different naming conventions for objects within the code.  This results in a single object being called chartObj within function, chart within another, params in another place, and chartData in another instance.  Sometimes these different references even pop up within the same function.  This inconsistency makes it much harder for an unfamiliar developer to understand how the system functions.  This again can lead to duplicating information, if a developer modifying a function or class doesn’t realize they already have the information they need.</p>\n<h4>What assumptions have I made?</h4>\n<p>One thing that can easily add confusion within a system is making undocumented assumptions.  One common assumption thats made for javascript code is that it will always run in a browser, or have access to a specific library such as jQuery.  While some of these assumptions are necessary, its worthwhile documenting them in some way, either in the comments or through code checks that through exceptions if the assumptions are violated.</p>\n<p>This is important because requirements change.  The particular code that I’m working with was originally intended to run only in the browser, without any thought of server-side use.  When a requirement made it necessary to run it with PhantomJS, plenty of changes were needed.  This isn’t necessarily problematic, because this particular change was not likely when the original code was made, and the adaptation was not hard.  More problematic was the fact that developers not directly involved with the phantomJS work still were acting under the assumption that the code would run within a browser environment.</p>\n<p>These three questions are obviously not the only things that can be wrong in code, but in my experience they’re especially treacherous because they can come in slowly and then make every future change harder.</p>\n<hr>\n<h3>Further Reading</h3>\n<ul>\n<li><a href=\"http://www.codinghorror.com/blog/2007/03/curlys-law-do-one-thing.html\">Coding Horror: Curly’s Law</a> a readable explanation of DRY principles</li>\n<li><a href=\"http://refactoring.com/\">Refactoring.com</a>- A nice collection of resources on refactoring by Martin Fowler, who also has written a well regarded <a href=\"http://www.amazon.com/gp/product/0201485672/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0201485672&linkCode=as2&tag=productjavasc-20\">book</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=productjavasc-20&amp;l=as2&amp;o=1&amp;a=0201485672\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\">\non refactoring.</li>\n</ul>","fields":{"slug":"/2013/02/03/how-i-work-refactoring"}}},{"node":{"frontmatter":{"readNext":null,"topics":["Code Quality"],"category":"software-productivity","key":"readable-code","title":"Readable code: Know your audience ","description":"A quick observation about what it means to write readable code","layout":"post","path":"/2016/12/11/readable-code-audience","date":"2016-12-12T04:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>A coworker asked me last week if there was a better way to write the following python code:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\">\n      <pre class=\"language-python\"><code class=\"language-python\">self<span class=\"token punctuation\">.</span>custom_attributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> a<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>I semi-jokingly replied that there were 3 better ways:</p>\n<h5>For people who like comprehensions</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\">\n      <pre class=\"language-python\"><code class=\"language-python\">self<span class=\"token punctuation\">.</span>custom_attributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token punctuation\">:</span> value\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span>entry<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> entry <span class=\"token keyword\">in</span> a<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<h5>For people who like functions</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\">\n      <pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">build_obj</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> val<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span>\n   acc<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value\n   <span class=\"token keyword\">return</span> acc\nself<span class=\"token punctuation\">.</span>custom_attributes <span class=\"token operator\">=</span> <span class=\"token builtin\">reduce</span><span class=\"token punctuation\">(</span>build_obj<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<h4>For people who like other folks to be able to read their code</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\">\n      <pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># create a hash of custom attributes</span>\nself<span class=\"token punctuation\">.</span>custom_attributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token comment\"># get the entries from splitting the input string</span>\nentries <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># for each entry split the key value pairs and add them to the hash</span>\n<span class=\"token keyword\">for</span> entry <span class=\"token keyword\">in</span> entries<span class=\"token punctuation\">:</span>\n   <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span>\n   self<span class=\"token punctuation\">.</span>custom_attributes<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value</code></pre>\n      </div>\n<p>The joke of course is that it doesn’t really matter what the author of the code considers the best way to write it.  Like writing an essay or persuasive speech, it is much more important to consider the audience, and what style will work best for them.  Most code will eventually be read by other people, even if that is simply a future version of the original author who has been stripped of context by time <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.</p>\n<p>If my coworker is confident that his code will be read in the future by confident Python programmers who understand object comprehensions, then he could go with the first example, with its heavy use of python idioms.  If he thought it was more likely that somebody like me who is used to JavaScript idioms, he might consider the less idiomatic python from the second example that matched his teammates.  If he didn’t know who would read the code in the future, he might go with the more explicit and difficult to misinterpret version 3, and possibly tuck it away within a named function so that the main code flow could remain uninterrupted.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\">\n      <pre class=\"language-python\"><code class=\"language-python\">self<span class=\"token punctuation\">.</span>custom_attributes <span class=\"token operator\">=</span> parse_entry_string<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ... elsewhere ...</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">parse_entry_string</span> <span class=\"token punctuation\">(</span>entry_string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    attributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token comment\"># get the entries from splitting the input string</span>\n    entries <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># for each entry split the key value pairs and add them to the hash</span>\n    <span class=\"token keyword\">for</span> entry <span class=\"token keyword\">in</span> entries<span class=\"token punctuation\">:</span>\n       <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n       attributes<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value\n    <span class=\"token keyword\">return</span> attributes</code></pre>\n      </div>\n<p>Of course once the functionality is separated out into a function, it matters a lot less how it is implemented since the only time somebody will need to read it is when they are interested in that specific functionality and can invest the time to understand the code.  The well named function replaces the need for understanding everything when people browse through the code.  This is extremely important in larger code bases, since data often flows through many lines of code.  The more of it that can be usefully (and accurately) abstracted away for a reader, the easier the code base is to debug.</p>\n<p>So quick tip version:</p>\n<ol>\n<li>Think about the audience of the code you’re writing</li>\n<li>Naming functions well limits the needs to make implementation details readable for everybody. It can also make your program flow easier to follow.</li>\n</ol>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>In my experience, it usually only takes about a week for me to look back at my old code and wonder what maniac wrote it and what he could have possibly been thinking</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/2016/12/11/readable-code-audience"}}},{"node":{"frontmatter":{"readNext":"staying-productive,orthogonality-css-js,readable-code","topics":["Architecture","Code Quality"],"category":"software-productivity","key":"ll-context","title":"Giving Context To Best Practices","description":"What we talk about when we talk about best practices","layout":"post","path":"/2017/02/18/context-to-best-practices/","date":"2017-02-18T23:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>I’ve noticed a frustrating trend in online discussions about web development where developers take their personal experience with a tool or practice and promote it as a universal truth.  Some of this is the nature of being human: we all see the world through our own lens.  But the best technical observations exist within a specific context.</p>\n<p>Compare</p>\n<blockquote>\n<p>Everybody should be writing code using static types, the extra syntax is worth it because of all the bugs it prevents.</p>\n</blockquote>\n<p>to</p>\n<blockquote>\n<p>If you’re working in a large code base with many developers, static typing is extremely useful, because the overhead from writing extra code and compiler errors is more than made up for by reducing bugs and clearly expressing intent when developers edit code they didn’t write.</p>\n</blockquote>\n<p>The first quote presents a tradeoff and declares a universal preference for one direction in the tradeoff.  The second quote adds more details about the context in which the practice has been beneficial, and explains what about those circumstances (developers editing code they didn’t write) affects the tradeoff decision.  </p>\n<p>These type of distinctions are often lost in online discussions about development best practices. I have no interest in naming and shaming, but specifically I’ve seen this in discussions around JavaScript performance, testing, frameworks vs other frameworks vs VanillaJS, responsive design, progressive enhancement, and build pipelines.  For this post, I’m going to try to lay out a list  of some of the context that I’ve found helpful to take into account when giving or interpreting best practice advice.</p>\n<h3>Context to keep in mind when discussing and interpreting best practices</h3>\n<h4>Beginner vs Veteran</h4>\n<p>I’ll start with a distinction that folks seem better about making. Sometimes recommendations that make sense for beginners don’t work as well for more experienced developers and vice versa.  For instance it might make sense to advise a more experienced developer to use and heavily configure a build system like <a href=\"https://webpack.github.io/\">Webpack</a> for a new project. But beginners already have a lot to learn with each new project and might benefit from a simpler system; either a simple project without a build step, or a “batteries included” system like <a href=\"https://github.com/facebookincubator/create-react-app\">Create React App</a> or <a href=\"https://ember-cli.com/\">Ember CLI</a>.  Making these distinctions is important for helping developers who may feel overwhelmed by all the concepts they need to learn when getting started with web development.</p>\n<h4>Big Team vs Small team vs Individual</h4>\n<p>Another dynamic that matters when expressing best practices is the size of a team working on a project.  If a project is being developed by a large team, or several teams, or is meant to be used as a library by many people, techniques like automated documentation, static type checking, and clear style guidelines may be essential.  But for a personal project or a professional project run by a 1 person team, those same techniques may provide a lot of overhead for minimal benefit. Most teams will fall between those extremes and will have to weigh the tradeoffs in each case.</p>\n<h4>Personal Project vs Internal tool vs B2B Products vs Consumer Products</h4>\n<p>The audience of a project is also important.  Some projects we build for ourselves.  Some may be internal for a company, or for a group that we’re a part of.  Other projects are sold professionally to businesses or offered freely to consumers on the web.  There are different goals and expectations for each of these groups, that may impact which practices and techniques are important.  For instance, nobody cares if a personal web application you’ve made to organize your todos crashes in Internet Explorer or doesn’t have alt-text for images.  But browser compatibility and accessibility might be extremely important for a consumer web app aimed at a broad population.  Similarly, it might be ok for your internal web tool to have un-minified JavaScript and large un-optimized CSS and JavaScript bundles, since it will always be served locally over a fast connection.  But it could severely hurt the user experience to do the same things for a high traffic public site.</p>\n<h4>Web page vs Web app</h4>\n<p>Distinguishing between web pages<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> and web apps<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup> would short circuit a large number of internet arguments before they started.  Specifically arguments about progressive enhancement, whether we use too much JavaScript and whether a site is “acceptable” if it doesn’t work without JavaScript.  Many accessibility and performance proponents push very strongly for less JavaScript and sites that work without JavaScript.  And that is a good thing… for the sites that <strong>can</strong> function without JavaScript.  Web apps like Trello, Google Docs, or Postman just don’t make sense without JavaScript.  But saying that we should use less JavaScript isn’t bad advice, it’s just bad advice when given or taken without context.</p>\n<h4>Existing project vs Greenfield project</h4>\n<p>Some choices are only easy to make at the start of a project.  It is possible to change the language or framework a project is written in midstream, but it is often extremely risky and painful.  So asking a developer working on a 5 year old JavaScript project with thousands of lines of code why they didn’t write it in <a href=\"http://elm-lang.org/\">Elm</a> or <a href=\"https://clojurescript.org/\">ClojureScript</a> is not helpful.  But suggesting that somebody write a new project in Elm may be just fine.</p>\n<h4>Short term project vs Long term project</h4>\n<p>Some software projects are meant to be written, completed, and never seen again.  For instance a promotional site for an event.  Some projects, like financial software, are meant to last for decades.  This is yet another distinction than can impact best practice discussions.  When working on a short term project, speed of delivery and initial quality tend to matter a lot.  For long term projects it may be better to prioritize maintainability, security and ease of deployment.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>Web page: sites that are mostly content focused with some possible interactivity layered on top</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p>Web app: sites that are primarily an interactive experience for the user and behave more like traditional desktop or mobile applications</p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/2017/02/18/context-to-best-practices/"}}},{"node":{"frontmatter":{"readNext":"jest-first,saving-time-jest,mobx-first","topics":["Jest","Code Quality","Testing"],"category":"tools","key":"jest-git","title":"Running Jest Tests Before Each Git Commit","description":"A simple setup to run your Jest tests before every commit","layout":"post","path":"/2017/02/26/running-jest-tests-before-each-git-commit/","date":"2017-02-26T23:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>My main work project makes heavy use of <a href=\"https://facebook.github.io/jest/\">Jest</a> to test our JavaScript code.  For a while now I’ve wanted to set up a way to run tests every time I run a commit.  I knew that git provides <a href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks\">hooks</a> that allow scripting actions to occur before or after any commit or push, and in fact we were already using a <code class=\"language-text\">pre-commit</code> hook script to lint our code with <a href=\"http://eslint.org/\">ESLint</a>.  But it was non-obvious how to make that work well with Jest testing.  I eventually figured out a setup that worked, and the found a better way to do both the Jest and ESLint testing.  Since it took me a while to work through, I thought I’d share it here and save the rest of you some time.</p>\n<h3>What didn’t work</h3>\n<p>A naive approach to this problem would be to set up a pre-commit hook that simply ran <code class=\"language-text\">jest</code> to run all tests. The problem is that running our full test suite currently takes between 10 and 20 seconds to run all tests and that time is increasing as we grow our test suite.  Adding that overhead to every commit would cost my team a lot of time, and would be especially inefficient since the repo contains plenty non-JavaScript code that doesn’t require tests to be run when updated.</p>\n<p>For our ESLint hook, we queried git to get a list of staged files, and then ran eslint against each one of them individually, displaying a pass/fail message.  That looked something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">STAGED_FILES<span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> <span class=\"token function\">diff</span> --cached --name-only --diff-filter<span class=\"token operator\">=</span>ACM <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"js$\"</span><span class=\"token variable\">)</span></span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$STAGED_FILES</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token keyword\">exit</span> 0\n<span class=\"token keyword\">fi</span>\n\nPASS<span class=\"token operator\">=</span>true\n\n<span class=\"token keyword\">for</span> FILE <span class=\"token keyword\">in</span> <span class=\"token variable\">$STAGED_FILES</span>\n<span class=\"token keyword\">do</span>\n    eslint --quiet <span class=\"token string\">\"<span class=\"token variable\">$FILE</span>\"</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$?</span>\"</span> <span class=\"token operator\">==</span> 0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[32mESLint Passed: <span class=\"token variable\">$FILE</span>\\033[0m\"</span>\n    <span class=\"token keyword\">else</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[41mESLint Failed: <span class=\"token variable\">$FILE</span>\\033[0m\"</span>\n        PASS<span class=\"token operator\">=</span>false\n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">done</span></code></pre>\n      </div>\n<p>This works great for ESLint, but doesn’t work out of the box for Jest, because I don’t want Jest to run the files that changed, I want them to run any tests that changed AND any tests that might have been broken because of that.</p>\n<p>Jest has a wonderful command line flag <code class=\"language-text\">jest --onlyChanged</code>/<code class=\"language-text\">jest -o</code> that runs only the tests related to files that have been changed according to git.  It is extremely helpful since it is smart enough to read the dependency structure for the project and run all tests that might be changed from updating a source file. It also has a <code class=\"language-text\">--lastCommit</code> option that does the same thing for files that were in the previous commit.  Unfortunately, these options aren’t helpful at the point of committing, since <code class=\"language-text\">onlyChanged</code> does not look at files that have been staged for commit, and we haven’t actually made a commit yet for <code class=\"language-text\">lastCommit</code> to read.</p>\n<h3>What Did Work</h3>\n<p>Fortunately Jest has a lower level command that uses the same logic as <code class=\"language-text\">onlyChanged</code> and <code class=\"language-text\">lastCommit</code>.  <code class=\"language-text\">--findRelatedTests</code> is a flag that tells Jest to run any tests related to the files passed to it instead of trying to run those files as tests as it would normally do.</p>\n<a class=\"gatsby-resp-image-link\" href=\"/static/9350cbcea06e8f1f423335d94d84ac98/1b819/jest-related-tests.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 81.97573656845753%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y41UyW7TUBT1t7GoxA4EWzZsQCz4KYSEQKBSAWppJVQQlDYNbVzHyYsd2+95SNI4djwl6Xi4fulAUJtmcXSvh3feHc69yiA0YbochrAJDizPAfcdmOQP6dto2MbZyCUInI+n9ozs+S1Q1jafY3XzJeK+gcOgBbtdg8s1eEJHL2hIQhx5V2Tnc8gk4auP9/Dm0xLymBGhjrr2C6y5jRbbgWXu0gV/MOg1MUnt6wjnECvvvjzAh7VHSMIGhF3DduUbNG0LqvqTCKtwiNB1asgiczHC96sPsfz1MYphi0gNdLwD+EKFY+1RxHWkAwPHuQNMvMVSDtzv6He35MGjzKGaWeS3kFNESUg2NnFa8KvIpphDaJs1cEuVdSrocFmzFqtg2G9JwuiQzXb4gvA2KAbbhsf3ZTePqPAdT5PRYXJ9610kM4SjhONk5GOScYzLlFNH+ieFkKmeFlS/sVgYymFPhcGbsKWgOdyOQNAV4AFHMrAQRhyDJECUeGR9pJmHLJv6ESFOPcRkh+n0vbKy8QTL608R9hh8t4G6XiEdVsHYHoSjwnXriGMHRe5JjHMXk8JFnnlX7wryRxfflNcrS3j7+T51VkdAcqmQDpuN31LgnKTTJ+lEXR2TpC3remfKa5vPsP7jBcZ0IKIohbOPwD2gRtWkDnu+hrBLI5hYCzVICbsayaNJMmEkm5K0KQnKySiRX0zIrGzEzMT86yussQOD7dJyYFI6baMqcUlYTg/ox3JS/sdNC0MRNtWpo1PKFk2KTRtGl0TluB3nXC6F8rkU+uUF5VSVE3TTwvgL5+Ghb81Fxi8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n    <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" alt=\"an example of findRelatedTests running against the redux repo\" title=\"\" src=\"/static/9350cbcea06e8f1f423335d94d84ac98/d766e/jest-related-tests.png\" srcset=\"/static/9350cbcea06e8f1f423335d94d84ac98/a6b6e/jest-related-tests.png 143w,\n/static/9350cbcea06e8f1f423335d94d84ac98/8e488/jest-related-tests.png 285w,\n/static/9350cbcea06e8f1f423335d94d84ac98/d766e/jest-related-tests.png 570w,\n/static/9350cbcea06e8f1f423335d94d84ac98/1b819/jest-related-tests.png 577w\" sizes=\"(max-width: 570px) 100vw, 570px\">\n  </span>\n  </a>\n<p>This is a perfect fit for a pre-commit hook.  I was able to integrate it into my existing script like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">jest --bail --findRelatedTests <span class=\"token variable\">$STAGED_FILES</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$?</span>\"</span> <span class=\"token operator\">==</span> 0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[32mJest Tests Passed\\033[0m\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\\t\\033[41mJest Tests Failed\\033[0m\"</span>\n    PASS<span class=\"token operator\">=</span>false\n<span class=\"token keyword\">fi</span></code></pre>\n      </div>\n<p><code class=\"language-text\">$STAGED_FILES</code> is re-used from the eslint portion of the script, and is just a space delimited list of files that are being committed.  The <code class=\"language-text\">--bail</code> option simply stops running tests as soon as one has failed.  Including that is optional, you won’t see all the tests that have failed, but the failure will happen faster and you’ll be able to decide how to proceed, including possibly running the full test script on your own.   </p>\n<p>Those lines (along with some sanity checks for the existence of Jest and error handling when PASS is set to false) are enough to get a workable commit hook going, but they’re not ideal.  pre-commit hooks aren’t persisted by git, so each user has to install the hook script individually, and any updates aren’t shared automatically.  Plus I’m inefficiently passing all staged files to eslint and Jest regardless of whether they’re JavaScript that those tools are actually meant to work on.  My ESLint code was also written before ESLint developed robust <code class=\"language-text\">--fix</code> capabilities, and doesn’t try to fix the errors it is capable of fixing.  Finally, while this is just poor coding and not an inherent limitation of my other method, I’m using globally installed versions of Jest and ESLint instead of scoping them to my project.</p>\n<h3>Making it better</h3>\n<p>Fortunately I’d discovered a better solution the other day while working on something else.  There is an npm package for making this process easier, <a href=\"https://github.com/okonet/lint-staged\">lint-staged</a>.  Lint staged abstracts away the boilerplate of getting the staged files, and makes it easy to run local node executables against specific sets of files.  I was able to replace my whole pre-commit script and address all of the problems mentioned above with only a few lines in my package.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\">\n      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lint-staged\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"*.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"eslint --fix\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"git add\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"jest --bail --findRelatedTests\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.16.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"19.0.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.3.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p><code class=\"language-text\">lint-staged</code> now handles making sure that I’m only running checks against JavaScript files, lets eslint autofix and stage any files that it can fix, and uses the local versions of jest and eslint.  It also adds a nice pretty interface for the results:</p>\n<a class=\"gatsby-resp-image-link\" href=\"/static/07049d14abcd3c0065c9779b76d22045/41b68/lint-staged-errors.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.321100917431195%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABCElEQVQoz3WR63KCMBCF8/6P15ZWEUXBCnJLMFwD9nQ3gU7r2B/fbNhkz5zDClkEuFxD6DrEqEO0co+mCtCpPerCt+eGetzv6wOm5oSvPsa9i2x9RHRyB5Vt7OBwc6KmOdrBgQRG2zvCMNSf2+iP4KOwGFWAJH6DzLfk6mBFWYwfYjj/InYsg3z/DGHKLRoSslEJFla5b88szvSLU6597XrP4jqHMsBMyoZccdy5de44GvemBY7LsccFvue3juhnTlTkRl83qOMX8Dn99JAlH8hTgmpy9nArd9AEL0lRAv5uFScKoJel6dLtQBjpY8w8TPk7TOWjK2hB6Sv60rdO1tiry/X//hf5G+jMEWFL2TQIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n    <img class=\"gatsby-resp-image-image\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\" alt=\"pretty lint-staged output\" title=\"\" src=\"/static/07049d14abcd3c0065c9779b76d22045/d766e/lint-staged-errors.png\" srcset=\"/static/07049d14abcd3c0065c9779b76d22045/a6b6e/lint-staged-errors.png 143w,\n/static/07049d14abcd3c0065c9779b76d22045/8e488/lint-staged-errors.png 285w,\n/static/07049d14abcd3c0065c9779b76d22045/d766e/lint-staged-errors.png 570w,\n/static/07049d14abcd3c0065c9779b76d22045/13239/lint-staged-errors.png 855w,\n/static/07049d14abcd3c0065c9779b76d22045/41b68/lint-staged-errors.png 872w\" sizes=\"(max-width: 570px) 100vw, 570px\">\n  </span>\n  </a>\n<p><code class=\"language-text\">lint-staged</code> docs recommend using an npm based hooks manager like <a href=\"https://github.com/observing/pre-commit\">pre-commit</a> for running the scripts, but due to some quirks in my setup (node_modules is symlinked, and I sometimes want to run these commands inside a docker container), I found it easier to maintain a custom pre-commit script and just replace the previous logic with <code class=\"language-text\">npm run lint-staged</code>.  Either way, all of the actual logic is now checked into the repository and shared between all users.  The only manual step is adding the call to a pre-commit hook or (if you’re using a helper lib) running npm install.</p>\n<h3>More Resources</h3>\n<ul>\n<li>This maybe merits a future post on its own, but if you’re interested in automating away your code style maintenance look at combining <a href=\"https://github.com/prettier/prettier\">prettier</a> (and possibly  <a href=\"https://github.com/not-an-aardvark/eslint-plugin-prettier\">eslint-plugin-prettier</a>) with the pre-commit hooks from above.  Prettier will guarantee that your code follows a consistent style, and because it handles maximum line lengths, is much more robust than ESLint on its own.  Using its ESLint plugin within my editor and on pre-commit hooks has pretty much eliminated me manually fixing code style problems.</li>\n</ul>","fields":{"slug":"/2017/02/26/running-jest-tests-before-each-git-commit/"}}},{"node":{"frontmatter":{"readNext":null,"topics":["Command Line","Code Quality"],"category":"tools","key":null,"title":"Creating a Build System For a Coffeescript Project with Ant","description":"Using Ant to build my coffeescript projects","layout":"post","path":"/2013/03/23/creating-a-build-system-for-a-coffeescript-project-with-ant","date":"2013-03-23T16:23:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>I’ve recently taken the time to develop an organized build system for a <a href=\"http://Coffeescript.org/\">Coffeescript</a> and <a href=\"http://sass-lang.com/\">SASS</a> <a href=\"https://bitbucket.org/ben336/scratchcalc\">project</a> that I’ve been working on in my free time.  I learned a lot during the process, and I wanted to share my experience here.  I used Ant for my build system, and worked in a variety of different libraries for minification, testing and documentation.</p>\n<h3>Getting Started</h3>\n<p>The first step is to install Ant.  It comes preinstalled on OSX, is <a href=\"http://www.rndblog.com/how-to-install-ant-on-linux/\">fairly straightforward</a> to install on Linux, and is <a href=\"http://www.nczonline.net/blog/2012/04/12/how-to-install-apache-ant-on-windows/\">a bit more involved</a> to install on Windows  If you’re using my exact setup, you’ll also need <a href=\"http://nodejs.org/\">NodeJS</a> (for Coffeescript, UglifyJS,and Docco) and <a href=\"http://www.ruby-lang.org/\">Ruby</a> (for SASS) installed.</p>\n<h3>My Project Structure</h3>\n<p>I went for a structure with 4 directories.</p>\n<ul>\n<li>src</li>\n<li>build</li>\n<li>test</li>\n<li>docs</li>\n</ul>\n<p>All of the source files are in the source directory, with Javascript and Coffeescript files in a scripts directory, and SASS styles in a styles folder.  This particular app has only a single HTML file, which sits in the root of the source directory.  The test folder contains a single HTML page, and a series of unit test files written in Coffeescript, in a structure that mirrors the src directory.  The build and docs directories are initially empty.</p>\n<h3>The Basics</h3>\n<p>We start with a simple Ant setup.  We’ll create an init task, a clean task, and debug and production tasks.  The following code goes into our build.xml file, which is placed at the root of the project directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">&lt;project name=&quot;scratchcalc&quot; default=&quot;debug&quot;&gt;\n\n    &lt;loadproperties srcfile=&quot;build.properties&quot; /&gt;\n\n    &lt;target name=&quot;debug&quot; depends=&quot;clean, init&quot;&gt;\n        &lt;echo&gt;ScratchCalc Version ${version} (Debug Version)&lt;/echo&gt;\n    &lt;/target&gt;\n\n    &lt;target name=&quot;production&quot; depends=&quot;clean, init&quot;&gt;\n        &lt;echo&gt;ScratchCalc Version ${version}&lt;/echo&gt;\n    &lt;/target&gt;\n\n    &lt;target name= &quot;init&quot;&gt;\n        &lt;mkdir dir=&quot;${build.dir}&quot; /&gt;\n    &lt;/target&gt;\n\n    &lt;target name=&quot;clean&quot;&gt;\n        &lt;delete dir=&quot;${build.dir}&quot; /&gt;\n    &lt;/target&gt;\n\n&lt;/project&gt;</code></pre>\n      </div>\n<p>So for this project, we now have 4 tasks that we can call.  To call the init task, all we need to do is run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">Ant init</code></pre>\n      </div>\n<p>from the command line.   Both our debug and production tasks mark clean and init as dependencies, so running them will remove and restore the build directory.  Beyond that, our build doesn’t do much right now.  Lets change that.</p>\n<h3>Copying</h3>\n<p>The simplest thing we can do with our Ant file is basic copying of files.  So lets start with a task that just copies over our files from the src directory to the build directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\">\n      <pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>copy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Copies files from src to build dirs<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>echo</span><span class=\"token punctuation\">></span></span>Copying JS, CSS &amp; HTML Files<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>echo</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>copy</span> <span class=\"token attr-name\">todir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.dir}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileset</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${src.dir}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">includes</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>**/*.HTML,**/*.css,**/*.js<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>copy</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<p>This simply copies any HTML, CSS, or Javascript files in the src directory over to an equivalent position in the build directory.  The segments in the <code class=\"language-text\">${}</code> format are variables defined in our build.properties file.  For my project, that looks something like this so far:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">version = 0.0.1\ncopyright = Copyright 2012-2013 Ben McCormick.\nsrc.dir = ./src\nbuild.dir = ./build\ntest.dir = ./test\nlib.dir = ${src.dir}/ext</code></pre>\n      </div>\n<p>This would be a great place to start for a project thats currently running without a build system.  If you’re able to get your project to build like this, it will set you up to be able to start more interesting things going forward.</p>\n<p>And we of course want to do more interesting things.  This project uses Coffeescript and SASS, so we’ll need to do a bit more than just copy files.  So lets copy those scripts as well, but convert them to Javascript and CSS while we do.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\">\n      <pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>copy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Compiles Coffeescript and SASS files,copies the rest<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>echo</span><span class=\"token punctuation\">></span></span>Copying Coffeescript Files<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>echo</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>copy</span> <span class=\"token attr-name\">todir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.dir}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileset</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${src.dir}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">includes</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>**/*.HTML,**/*.css,**/*.js<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>copy</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exec</span> <span class=\"token attr-name\">executable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>coffee<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--compile<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--map<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--output<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.script.dir}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${src.script.dir}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exec</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mkdir</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.styles.dir}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>apply</span> <span class=\"token attr-name\">executable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sass<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dest</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.dir}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">verbose</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">failonerror</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--unix-newlines<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>srcfile</span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>targetfile</span> <span class=\"token punctuation\">/></span></span>\n        &lt;filelist dir =\"${src.dir}\" files=\"styles/scratch.sass\" />\n        <span class=\"token comment\">&lt;!--&lt;fileset dir=\"${src.dir}\" includes=\"**/*.sass\"  />--></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>glob<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">from</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>*.sass<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>*.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>apply</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<p>So along with copying the raw files, we also now copy the Coffeescript and SASS files.  For Coffeescript, we run the coffee executable against the entire src dir, and have it mirror the output to the build dir.  For Sass, we only want to run the compile on a single file, which pulls all of the other files into it through import statements.  So we use the filelist and mapper to specify the input and output files.</p>\n<h3>Concatenation</h3>\n<p>Mirroring your directory can be helpful for debugging, and is a good initial step if you’re converting to Ant from a locally run project.  But we’d really like to limit the amount of requests we make when deploying our site.  To do that, we’ll concatenate the js files together.  For my project I create 2 files, one for my external dependencies, and one for my own local files.  I may eventually reduce this to 1, but for now I like separating the 2 for debugging clarity.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\">\n      <pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>concatenatejs<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Concatenate All the JS together<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- Instead of concatenating the JS files directly, use coffee to preserve the source map --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>echo</span><span class=\"token punctuation\">></span></span>Concatenating the JS<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>echo</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>concat</span> <span class=\"token attr-name\">destfile</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.libs}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n         &lt;filelist dir =\"${build.script.dir}\" files=\"lib/jquery.js,lib/knockout.js,lib/BigDecimal.js\" />\n\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileset</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.script.dir}/lib<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">includes</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>**/*.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>concat</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>apply</span> <span class=\"token attr-name\">executable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>coffee<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">verbose</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">failonerror</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parallel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--compile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--map<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--join<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.script.output}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>srcfile</span> <span class=\"token punctuation\">/></span></span>\n    &lt;filelist dir =\"${src.script.dir}\" files=\"editor/toolkit.coffee,editor/markupGen.coffee,parser/eqTreeBuilder.coffee,parser/NumberValue.coffee,parser/eqScanner.coffee,parser/eqTokenizer.coffee,parser/tablePlaceHolder.coffee,parser/EQParser.coffee,parser/calcFramework.coffee,editor/editor.coffee\" />\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>apply</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<p>For the external libraries I use Ant’s built in <code class=\"language-text\">concat</code> task to concatenate the files together.  For the Coffeescript files, I use the coffee compiler rather than concatenating the files that I copied.  I was hoping to do this in order to preserve the source map, which allows for easier debugging.  Unfortunately the compiler has trouble generating source maps for joined files right now.  I’m hoping to fix that in the future, in the meantime I may be using a different approach, possibly using uglifyjs to concatenate the files and generate the maps.</p>\n<h2>Minify</h2>\n<p>Speaking of <a href=\"https://github.com/mishoo/UglifyJS2\">uglifyjs</a>, I use that for minifying my Javascript.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\">\n      <pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>minify<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Minify the JS for Production<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>echo</span><span class=\"token punctuation\">></span></span>Minifying the JS For Production with UglifyJS<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>echo</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>apply</span> <span class=\"token attr-name\">executable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>uglifyjs<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">verbose</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">failonerror</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>srcfile</span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--output<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${build.script.output}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        &lt;filelist  files =\"${build.script.output}\"/>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>apply</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<p>I only require this for the production task, and leave the full source available for the debug task to preserve the readability of the generated JS.</p>\n<h3>Documentation</h3>\n<p>I use <a href=\"http://jashkenas.github.com/docco\">docco</a> for my Coffeescript documentation.  It converts comments into documentation and runs them through a <a href=\"http://daringfireball.net/projects/markdown/\">Markdown</a> parser to generate a clean HTML page with the code and comments intermingled.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\">\n      <pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>documentation<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Generate Docco Documentation for coffee files<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>echo</span><span class=\"token punctuation\">></span></span>Generating Documentation with Docco<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>echo</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>apply</span> <span class=\"token attr-name\">executable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>docco<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">verbose</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">failonerror</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>srcfile</span> <span class=\"token punctuation\">/></span></span>\n        &lt;fileset dir =\"${src.script.dir}\" >\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>**/*.coffee<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileset</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>apply</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<h3>Testing</h3>\n<p>I use Jasmine for testing.  <a href=\"http://pivotal.github.com/jasmine\">Jasmine</a> is a “Behavior Driven Development” style unit testing framework for Javascript.  In an ideal world I would be setting up a build task to run on the server and display the results when I run the build.  Unfortunately I wasn’t able to find a way to do that without generating additional dependencies.  Its possible with NodeJS or RequireJS style modules and dependencies, and its also possible using phantomJS, but I didn’t want to require either of those for testing.   So instead I have my build task generate an HTML page with the test results.  I may add some scripting to open this page by default after running a production build in the future.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\">\n      <pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Generate the JS for testing with Jasmine<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- Ideally this would run a server side jasmine test, but that requires better dependency management than we have right now--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>echo</span><span class=\"token punctuation\">></span></span>Generating the Test JS with jasmine<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>echo</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>apply</span> <span class=\"token attr-name\">executable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>coffee<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">verbose</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">force</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">failonerror</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parallel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--compile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>--join<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>${test.output}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>srcfile</span> <span class=\"token punctuation\">/></span></span>\n    &lt;fileset dir =\"${test.dir}\" >\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>**/*.coffee<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileset</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>apply</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<h3>Summary</h3>\n<p>Adding a build system has been great for my project.  Its allowed me to be a lot more organized and to do some cool things that are a pain by hand (unit testing, Coffeescript).  I definitely recommend looking into doing this for any non-trivial Javascript/web project that you’re working on.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">&lt;project name=&quot;scratchcalc&quot; default=&quot;debug&quot;&gt;\n\n  &lt;loadproperties srcfile=&quot;build.properties&quot; /&gt;\n\n  &lt;target name=&quot;debug&quot; depends=&quot;clean, init, copy,concatenatejs&quot;&gt;\n    &lt;echo&gt;ScratchCalc Version ${version} (Debug Version)&lt;/echo&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;production&quot; depends=&quot;clean, init, copy,concatenatejs,minify,documentation,test&quot;&gt;\n    &lt;echo&gt;ScratchCalc Version ${version}&lt;/echo&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;copy&quot; description=&quot;Compiles Coffeescript and SASS files,copies the rest&quot;&gt;\n    &lt;echo&gt;Copying Coffeescript Files&lt;/echo&gt;\n     &lt;copy todir=&quot;${build.dir}&quot;&gt;\n      &lt;fileset dir=&quot;${src.dir}&quot; includes=&quot;**/*.HTML,**/*.css,**/*.js&quot; /&gt;\n     &lt;/copy&gt;\n     &lt;exec executable=&quot;coffee&quot;&gt;\n        &lt;arg value=&quot;--compile&quot;/&gt;\n        &lt;arg value=&quot;--map&quot; /&gt;\n        &lt;arg value=&quot;--output&quot; /&gt;\n        &lt;arg value=&quot;${build.script.dir}&quot; /&gt;\n        &lt;arg value=&quot;${src.script.dir}&quot; /&gt;\n     &lt;/exec&gt;\n     &lt;mkdir dir=&quot;${build.styles.dir}&quot; /&gt;\n     &lt;apply executable=&quot;sass&quot; dest=&quot;${build.dir}&quot; verbose=&quot;true&quot; force=&quot;true&quot; failonerror=&quot;true&quot;&gt;\n          &lt;arg value=&quot;--unix-newlines&quot; /&gt;\n          &lt;srcfile /&gt;\n          &lt;targetfile /&gt;\n          &lt;filelist dir =&quot;${src.dir}&quot; files=&quot;styles/scratch.sass&quot; /&gt;\n          &lt;!--&lt;fileset dir=&quot;${src.dir}&quot; includes=&quot;**/*.sass&quot;  /&gt;--&gt;\n          &lt;mapper type=&quot;glob&quot; from=&quot;*.sass&quot; to=&quot;*.css&quot;/&gt;\n      &lt;/apply&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;concatenatejs&quot; description=&quot;Concatenate All the JS together&quot;&gt;\n    &lt;!-- Instead of concatenating the JS files directly, use coffee to preserve the source map --&gt;\n    &lt;echo&gt;Concatenating the JS&lt;/echo&gt;\n    &lt;concat destfile=&quot;${build.libs}&quot;&gt;\n       &lt;filelist dir =&quot;${build.script.dir}&quot; files=&quot;lib/jquery.js,lib/knockout.js,lib/BigDecimal.js&quot; /&gt;\n\n        &lt;fileset dir=&quot;${build.script.dir}/lib&quot; includes=&quot;**/*.js&quot;/&gt;\n    &lt;/concat&gt;\n    &lt;apply executable=&quot;coffee&quot;  verbose=&quot;true&quot; force=&quot;true&quot; failonerror=&quot;true&quot; parallel=&quot;true&quot;&gt;\n      &lt;arg value=&quot;--compile&quot; /&gt;\n      &lt;arg value=&quot;--map&quot; /&gt;\n      &lt;arg value=&quot;--join&quot; /&gt;\n      &lt;arg value=&quot;${build.script.output}&quot; /&gt;\n      &lt;srcfile /&gt;\n      &lt;filelist dir =&quot;${src.script.dir}&quot; files=&quot;...&quot; /&gt;\n    &lt;/apply&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;documentation&quot; description=&quot;Generate Docco Documentation for coffee files&quot;&gt;\n    &lt;echo&gt;Generating Documentation with Docco&lt;/echo&gt;\n    &lt;apply executable=&quot;docco&quot; verbose=&quot;true&quot; force=&quot;true&quot; failonerror=&quot;true&quot;&gt;\n          &lt;srcfile /&gt;\n          &lt;fileset dir =&quot;${src.script.dir}&quot; &gt;\n            &lt;include name=&quot;**/*.coffee&quot;/&gt;\n          &lt;/fileset&gt;\n      &lt;/apply&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;test&quot; description=&quot;Generate the JS for testing with Jasmine&quot;&gt;\n    &lt;!-- Ideally this would run a server side jasmine test, but that requires better dependency management than we have right now--&gt;\n    &lt;echo&gt;Generating the Test JS with jasmine&lt;/echo&gt;\n    &lt;apply executable=&quot;coffee&quot;  verbose=&quot;true&quot; force=&quot;true&quot; failonerror=&quot;true&quot; parallel=&quot;true&quot;&gt;\n      &lt;arg value=&quot;--compile&quot; /&gt;\n      &lt;arg value=&quot;--join&quot; /&gt;\n      &lt;arg value=&quot;${test.output}&quot; /&gt;\n      &lt;srcfile /&gt;\n      &lt;fileset dir =&quot;${test.dir}&quot; &gt;\n        &lt;include name=&quot;**/*.coffee&quot;/&gt;\n      &lt;/fileset&gt;\n    &lt;/apply&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;minify&quot; description=&quot;Minify the JS for Production&quot;&gt;\n    &lt;echo&gt;Minifying the JS For Production with UglifyJS&lt;/echo&gt;\n    &lt;apply executable=&quot;uglifyjs&quot; verbose=&quot;true&quot; force=&quot;true&quot; failonerror=&quot;true&quot;&gt;\n          &lt;srcfile /&gt;\n          &lt;arg value=&quot;--output&quot; /&gt;\n          &lt;arg value=&quot;${build.script.output}&quot; /&gt;\n          &lt;filelist  files =&quot;${build.script.output}&quot;/&gt;\n      &lt;/apply&gt;\n  &lt;/target&gt;\n\n  &lt;target name= &quot;init&quot;&gt;\n    &lt;mkdir dir=&quot;${build.dir}&quot; /&gt;\n  &lt;/target&gt;\n\n  &lt;target name=&quot;clean&quot;&gt;\n    &lt;delete dir=&quot;${build.dir}&quot; /&gt;\n  &lt;/target&gt;\n\n&lt;/project&gt;</code></pre>\n      </div>\n<p><em>Update June 2014: Since writing this post, Javascript based build tools have continued to mature and grow.  These days I’d recommend <a href=\"http://gruntjs.com/\">Grunt</a> or <a href=\"http://gulpjs.com/\">Gulp</a> for your front end build script needs, though Ant is still a fine choice if you’re integrating your builds with a Java project, or have lots of experience with it.</em></p>\n<hr>\n<h3>Further Reading</h3>\n<ul>\n<li><a href=\"http://www.amazon.com/gp/product/1449327680/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1449327680&linkCode=as2&tag=productjavasc-20\">Maintainable JavaScript</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=productjavasc-20&amp;l=as2&amp;o=1&amp;a=1449327680\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\"> - This is a great little book for anyone writing Javascript applications in teams.  It has a great section on developing a Javascript build system with Ant</li>\n</ul>","fields":{"slug":"/2013/03/23/creating-a-build-system-for-a-coffeescript-project-with-ant"}}},{"node":{"frontmatter":{"readNext":"ecma-explanation,callbacks-to-promises,what-are-hocs","topics":["JavaScript","ECMAScript","Code Quality"],"category":"javascript","key":"clean-higher-order-functions","title":"ES6 Patterns: Clean Higher Order Functions","description":"A quick tip for clean functional syntax in ES6","layout":"post","path":"/2015/11/30/es6-patterns-clean-higher-order-functions","date":"2015-11-30T05:06:03+00:00","dontfeature":null,"isDraft":null},"html":"<div class=\"explanation\">\nI've been writing code using the new features defined in the ECMAScript 2015 version of JavaScript (<a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">more commonly known as ES6</a>) since January.  Throughout the year I've seen myself start using a few new patterns that I think make my code better.  I'm going to share them here with a few quick hitter articles, starting with a simpler way of writing higher order functions\n</div>\n<p>A higher order function is a function that either</p>\n<ol>\n<li>\n<p>Takes another function as an argument or</p>\n</li>\n<li>\n<p>Returns a function when called</p>\n</li>\n</ol>\n<p>Although many people have never heard of them, higher order functions are a key part of JavaScript development and something that most JavaScript developers will encounter every day, whether they know the term or not.  jQuery, Underscore, and many other JavaScript libraries are built on higher order functions.  Many of the core JavaScript APIs, like map, filter, forEach, and setTimeout are functions that take functions as arguments.  If you’re not comfortable with these patterns, learning about them can help you understand the JavaScript ecosystem better.  Hopefully this article will pique your interest.</p>\n<p>For this pattern, I’ll be focused on the second class of higher-order functions, functions that return other functions.  They can be useful in a variety of cases.  As an example, let’s consider a blog commenting application with a list of users.  Our task is to get a list of comments for each user.  We can do that with the builtin <code class=\"language-text\">map</code> and <code class=\"language-text\">filter</code> functions and a simple helper function like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> commentList <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./comments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCommentFromUser</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        user<span class=\"token punctuation\">:</span> userId<span class=\"token punctuation\">,</span>\n        comments<span class=\"token punctuation\">:</span>commentList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> comment<span class=\"token punctuation\">.</span>user <span class=\"token operator\">===</span> userId\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> userIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    userComments <span class=\"token operator\">=</span> userIds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getCommentFromUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//do stuff with comments</span></code></pre>\n      </div>\n<p>We’ve now written some simple, working code.  We take a list of user ids and return a list of users with the ids mapped to their comments.  Everything is fine, and we can move forward to do things with the comments.  If we don’t need to maintain this code base, we could probably stop here.</p>\n<p>The problem is, while this example works for the simple case, it isn’t very flexible.  We pull the comments directly from a single source that we’ve made available to all of the code in our module.  We can’t add any additional filters on the comments used or pull comments from additional sources without rewriting our mapping logic. If we decide we only want comments that were written in the past year for instance, we’ll need to rewrite our function or mutate commentList in a way that could effect code in the rest of the file. That feels pretty sloppy, since mapping comments to users should be unrelated to determining what comments we’re including in our groupings.  Fortunately we can solve this using a higher order function.  If we rewrite the code so that <code class=\"language-text\">getCommentFromUser</code> takes a list of comments and returns a function that takes an id, we can then control exactly what comments are included in the grouping.  For now we’ll leave our full list, but it could be rewritten later to be a filtered list or to pull comments from multiple sources, without re-writing this logic.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> commentList <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./comments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCommentFromUser</span> <span class=\"token punctuation\">(</span>comments<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            user<span class=\"token punctuation\">:</span> userId<span class=\"token punctuation\">,</span>\n            comments<span class=\"token punctuation\">:</span> comments<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> comment<span class=\"token punctuation\">.</span>user <span class=\"token operator\">===</span> userId\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> userIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    userComments <span class=\"token operator\">=</span> userIds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">getCommentFromUser</span><span class=\"token punctuation\">(</span>commentList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//do stuff with comments</span></code></pre>\n      </div>\n<p>Our code has gotten much more flexible, but at the cost of readability.  Most developers without significant functional programming experience will have to look twice at the 4 levels of nesting and multiple return statements in our helper function definition to understand what is going on.  We’ve added significant boilerplate in a way that muddies up the meaning of our function, when all we’re really trying to do is provide a way to make the comments list used in the function configurable.  That is extremely “beginner-unfriendly”.  At the same time using higher order functions like this is a useful pattern that serves a real need in the design of our application.  Fortunately, ES6 gives us the opportunity to clean up our syntax.  </p>\n<p>ES6 provides “arrow functions”, a shorthand for functions that have 2 main differences from the JavaScript <code class=\"language-text\">function</code> keyword.  First, they don’t bind a <code class=\"language-text\">this</code> value as a context, instead using the <code class=\"language-text\">this</code> of the parent scope.  Secondly, they can be written inline, with no parentheses and an implicit return.  So you can write a squaring function as <code class=\"language-text\">const square = (x) =&gt; x * x;</code>.  The first property of these functions has many consequences that have been covered in depth elsewhere around the internet.  But when writing non object oriented functions that don’t use <code class=\"language-text\">this</code> like our example above, it is mostly not relevant.  In this case though, the cleaner syntax that arrow functions provide allow us to write a clear and clean higher order function to solve our use case.  With arrow functions, our example from above now looks like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> commentList <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./comments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getCommentFromUser</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>comments<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">:</span> userId<span class=\"token punctuation\">,</span>\n    comments<span class=\"token punctuation\">:</span> comments<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> comment<span class=\"token punctuation\">.</span>user <span class=\"token operator\">===</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> userIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    userComments <span class=\"token operator\">=</span> userIds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">getCommentFromUser</span><span class=\"token punctuation\">(</span>commentList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//do stuff with comments</span></code></pre>\n      </div>\n<p>I like to call the <code class=\"language-text\">() =&gt; () =&gt;</code> pattern a “double function”, and have found it popping up all over the code I write since I began using ES6, especially when I’m using <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, and <code class=\"language-text\">reduce</code>.  Array transformations using those functions often require contextual information beyond the contents of the array.  A naive approach to this would involve having the function reference variables in the outer scope directly, like we did with commentList above.  More commonly that happens when a user inlines a function inside of a <code class=\"language-text\">map</code> call and references variables in the parent scope.  I’ve found that it is much clearer and less error prone to use a higher order function that takes only the variables that are needed for the transformation in, and returns a new function that can be used for the transformation.  This reduces the number of things that can effect the output of the function, allows for greater configurability without directly changing the transformation logic, and makes it clear to readers what values are expected to be used in the function.  Double functions make this easy, and they’ve easily been one of my favorite new code patterns with ES6.  </p>\n<h3>More Resources</h3>\n<ul>\n<li>If you’re interested in higher order functions and JavaScript, I know of no better reference than <a href=\"https://leanpub.com/javascriptallongesix\">JavaScript Allongé</a>.  It’s a fantastic deep dive into the JavaScript language with a functional flavor, building understanding from the bottom up and providing many ideas for code recipes along the way.  And it’s recently been rewritten to reflect the changes to the language that ES6 brought.</li>\n<li>Here’s a nice <a href=\"http://www.2ality.com/2012/04/arrow-functions.html\">deep dive on arrow functions at 2ality</a> by Axel Rauschmayer.  If you haven’t seen his blog, it’s a fantastic reference on ES6 and JavaScript in general</li>\n</ul>","fields":{"slug":"/2015/11/30/es6-patterns-clean-higher-order-functions"}}},{"node":{"frontmatter":{"readNext":"ecma-explanation,clean-higher-order-functions,backbone-devs-react","topics":["JavaScript","ECMAScript","Code Quality"],"category":"javascript","key":"callbacks-to-promises","title":"ES6 Patterns: Converting Callbacks to Promises","description":"How to convert a callback driven API to a Promise-based one","layout":"post","path":"/2015/12/30/es6-patterns-converting-callbacks-to-promises","date":"2015-12-30T03:30:47+00:00","dontfeature":null,"isDraft":null},"html":"<div class=\"explanation\">\nI've been writing code using the new features defined in the ECMAScript 2015 version of JavaScript (<a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">more commonly known as ES6</a>) since January.  Throughout the year I've seen myself start using a few new patterns that I think make my code better.  I'm going to share them here with a few quick hitter articles.  If you missed it, I wrote about <a href=\"http://benmccormick.org/2015/11/30/es6-patterns-clean-higher-order-functions/\">clean higher order functions</a> earlier this week.  This post focuses on working with asynchronous code in ES6.  \n</div>\n<h3>Background</h3>\n<p>One of the nicest new features of ES6 JavaScript is the standardization of Promises.  Promises are a method for managing asynchronous code that serve as an alternative to the standard callback function syntax that has been the JavaScript standard for years.  If you’re unfamiliar with them, a good example of a Promise based API is the new <code class=\"language-text\">fetch</code> api provided by browsers.  <code class=\"language-text\">fetch</code> is a replacement for the older callback based XMLHttpRequest API.  A quick example of an HTTP request with the 2 APIs provides a nice comparison of how Promises can lead to clearer code.</p>\n<p>A simple get request with XMLHttpRequest looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">reqListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reqError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fetch Error :-S'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \nrequest<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token comment\">//do stuff with data</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \n\nrequest<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'There was a problem with the request'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nrequest<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/api/foo/bar'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \nrequest<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>whereas with fetch we get this instead</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/foo/bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>jsonData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//do stuff with the data</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'There was a problem with the request'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>This is admittedly a slightly unfair example due to XMLHttpRequest’s clunky object oriented API, but the key take away here is that promises allow for easier visualization of a program’s flow, as well as the ability to easily chain both synchronous and asynchronous operations together into a unified API.</p>\n<p>Promises have been around for a little while in user-land.  There are a bunch of Promise libraries out there that eventually standardized on a spec called <code class=\"language-text\">Promises/A+</code>.  Promises/A+ compliant libraries include <a href=\"https://github.com/kriskowal/q\">Q</a>, <a href=\"https://github.com/petkaantonov/bluebird\">Bluebird</a>, and <a href=\"https://github.com/tildeio/rsvp.js\">rsvp</a>.  There are also many older libraries that provide Promise-like capabilities but are not completely spec compatible, most notably <a href=\"https://api.jquery.com/category/deferred-object/\">jQuery deferreds</a>.  But with ES6 Promises are being standardized.  Happily, since the implementation uses the standard that user-land libaries have agreed upon, the Promise spec is compatible with existing implementations, and existing code bases can remove their existing libraries in favor of the browser supplied version, or have code written to use the browser version interop cleanly with their existing code.  Support for Promises now exists in the latest versions of all major browsers, but it never made it to Internet Explorer and is Edge only for Microsoft browsers.  So most developers will still want to consider using a polyfill for the time being.</p>\n<h3>Converting callback-driven code to use Promises</h3>\n<p>If you believe that Promises are worthwhile, you’ll immediately encounter a problem in today’s JavaScript world.  Many JavaScript APIs, including most standard browser APIs and older but still popular libraries like jQuery and Backbone are heavily callback driven.  Rather than mixing 2 different styles of asynchronous code, wouldn’t it be nice if we could easily convert callback-based APIs to use Promises?  It turns out that it’s not that hard.  Let’s take the simplest example possible to start.  <code class=\"language-text\">setTimeout</code> is a straightforward browser API that waits for a specified period of time and then executes a callback.  A standard use looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>doStuff<span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>A Promise-based API for this function would likely look something like this code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>doStuff<span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>We can create an API like that using setTimeout.  To do that, we’ll need a function <code class=\"language-text\">timeout</code> which takes a timeout variable and returns a Promise.  </p>\n<p>You can define A+ compliant Promises using the Promise constructor, which expects a single function as an argument.  That function takes 2 arguments, a <code class=\"language-text\">resolve</code> function and a <code class=\"language-text\">reject</code> function.  The wonderful thing is that under the covers these are just callback functions that the Promise api glosses over.  </p>\n<p>Since we already have an API that can handle callbacks, the implementation of our <code class=\"language-text\">timeout</code> function is pretty simple.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span>delay<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>We don’t use the reject callback, since setTimeout doesn’t provide any hooks for an error state. So we pass resolve as the callback to setTimeout, and that is all we need.  Now we have a great chainable setTimeout function that we could include in a Promise chain.</p>\n<p>Moving on to a more complicated example, let’s take our <code class=\"language-text\">XMLHttpRequest</code> code from above and see if we can create a simplified version of the <code class=\"language-text\">fetch</code> API using <code class=\"language-text\">XMLHttpRequest</code> under the covers.  In this case I’m going to use ES6 style arrow functions to reduce the boilerplate a bit.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fetch <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>method<span class=\"token punctuation\">:</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    request<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> resolve\n    request<span class=\"token punctuation\">.</span>onerror <span class=\"token operator\">=</span> reject<span class=\"token punctuation\">;</span>\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    request<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>This is a simplified implementation that doesn’t come close to covering all the use cases of fetch, but it provides a great example of how simple it can be to transform a callback based api to a Promise based one, without having to rewrite the existing code<sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.   </p>\n<p>For what it’s worth, it is equally easy to convert functions in the other direction.  For instance a callback based implementation of fetch can be a one liner.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callbackFetch</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> succ<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>succ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>It’s useful to know that the various syntaxes for asynchronous code in JavaScript are effectively equivalent and interoperable.  When designing APIs for your code, both for public libraries with external libraries and components that you use in an application, these patterns can be useful for providing a consistent API, even if you’re using code under the covers that presents it’s asynchronous code in a different way than your API.  </p>\n<h3>More Resources</h3>\n<ul>\n<li>The free online version of Exploring ES6 by Axel Rauschmayer has a <a href=\"http://exploringjs.com/es6/ch_promises.html\">great chapter</a> on ES6 Promises explaining the API and how they fit in with the A+ standard.</li>\n<li>There was also a <a href=\"http://blogs.msdn.com/b/eternalcoding/archive/2015/09/30/javascript-goes-to-asynchronous-city.aspx\">great post by David Catuhe on one of the MSDN blogs</a> earlier this year highlighting how asynchronous code has evolved in JavaScript over the years, including a look at the new <code class=\"language-text\">async/await</code> patterns proposed for ES2016.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        And even a full implementation of fetch using XMLHttpRequest is only<a href=\"https://github.com/github/fetch/blob/master/fetch.js\"> ~300 lines</a>\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2015/12/30/es6-patterns-converting-callbacks-to-promises"}}},{"node":{"frontmatter":{"readNext":null,"topics":["Code Quality"],"category":"software-productivity","key":null,"title":"The Debugging Toolbox","description":"The process I use for solving problems","layout":"post","path":"/2014/08/19/the-debugging-toolbox","date":"2014-08-19T11:35:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>Do you know a <em>Problem Solver</em>?  They’re the ones who can take a crazy, vague bug report from a client and come up with a fix in an hour.  The ones who everybody else asks for help when the project deadline is creeping up.  The ones who get shipped out to the client site when the field team is out of their depth.  In school they were the person you called at 1AM the night before your project was due, hoping for a miracle.</p>\n<p>I’m guessing you can think of somebody.  Problem solving is a valuable gift, something that stands out.  But the truth is, all software developers should be problem solvers.  It’s a key part of our jobs.  We just happen to call it debugging.</p>\n<p>Debugging is hard.  As developers, we’re faced with vague problem descriptions, massive code bases, and constant pressure to move our projects forward.  But you can do some great things if you’re disciplined about getting better at debugging.</p>\n<p>I’ve built up my own debugging process over the years.  It’s nothing more exciting than <em>Problem Solving 101</em>, but it’s a productive way of working that lets me get stuff fixed quickly and keep issues from happening again. It helps me fix things even when I’m not qualified to do so, and keeps maintenance work from overwhelming my ability to get things done.  If that sounds useful to you, you should probably keep reading. Here’s my process.</p>\n<h3>Step 1: Define The Problem</h3>\n<p>The need to define the problem seems like common sense, but it often gets skipped.  The first thing you need before fixing a problem is a clear definition of what the problem looks like.  That means a detailed look at 2 things:</p>\n<ol>\n<li>What is the current behavior?</li>\n<li>What should the behavior be?</li>\n</ol>\n<p>The second question often gets neglected.  At Windsor Circle, we have a system that receives product records from another system.  The data it was receiving occasionally contained blank product titles, which was not considered valid data.  I was asked to ensure that the second system would not pass invalid data.  I could of course have just decided to not pass any records that had blank product data.  Or I could have filled them with a <code class=\"language-text\">&quot;None&quot;</code> string, calculated a value from other attributes, or a thousand other approaches.  Since each of these would have removed the current bad behavior, I might have been able to slip them by for a while.  Instead I asked what the correct behavior should be, which led to a longer discussion and an eventual decision that we would need to handle a small set of empty titles after all.  At that point I was able to actually deal with the problem.</p>\n<h3>Step 2: Reproduce The Problem</h3>\n<p>After you define the problem, the next step is to reproduce it.  <strong>Do not skip this step.</strong>  If you can’t define and consistently reproduce a situation where the problem occurs, it will be impossible to know whether you’ve solved it.  If the issue involves a lot of specific circumstances and moving parts, or only occurs sporadically, this may be the hardest part of the whole process.  The things you want to keep in mind:</p>\n<ol>\n<li>What are the circumstances under which this occurs? Always? Only on certain browsers/OSs/hardware?  Is it a timing issue? A timezone issue? All of the above?</li>\n<li>Is there a series of actions that I can do that makes this occur every single time?</li>\n<li>Am I confident that I know all of the situations that cause this to occur?</li>\n</ol>\n<p>Answering #1 is the first step.  If you can say yes to #2 you’re in a fantastic position to proceed.  If you can say yes to #3, you need to get a lot more suspicious and cynical.  But the more confident you can be about each of these, the better equipped you’ll be going forward.</p>\n<h3>Step 3: Narrow the Scope</h3>\n<p>Now that we’ve established our problem and hopefully found a consistent path to reproduce it, we’re ready to start rooting out our problem.  </p>\n<p>The first step is to narrow the scope.  In a normal software environment, you’re likely to be dealing with a large amount of your own code, as well as 3rd party libraries and APIs, some sort of environment, and unpredictable user behavior.  That’s a lot of uncertainty and information to process.  I’ve seen developers who really try to understand the whole system before even thinking about the problem.  But in many cases that’s unrealistic.  Instead, you should be trying to get rid of as much of that information as possible by narrowing the scope of where the bug might exist.  There are 4 main ways of narrowing scope.</p>\n<h4>Prove That The Problem Is Unique To A Component</h4>\n<p>If you want to eliminate a system component from consideration, one good way is by proving that the issue is not unique to it.  This works particularly well for platform issues.  For instance, you might prove that something is not a browser-specific problem by showing that the issue occurs in all browsers.  This can give you some firm ground to stand on.  If you do expose a platform-specific issue, that can be good news too, as they tend to be better documented.</p>\n<h4>Follow The Flow</h4>\n<p>If your problem is a data issue (and many issues are), you can also narrow the scope by following the flow of data through your application.  There are 2 main ways to do this.  One is by starting at the beginning of the flow, where the data initially comes into the system, and follow it through, looking to see where things go wrong. You could also start at the end with the incorrect output and try to trace back and see where it came from.  </p>\n<p>A good debugging tool is a great asset here.  There may be times when you’re forced to work without one though (for example, working in an environment you don’t control or a domain-specific language without adequate tooling).  In that case you can get by with log statements, or even changing the code to output a result early.  Regardless, what you want is clear evidence that data was good at a certain point, or already bad at another.  This allows you to eliminate that code from consideration and focus in on the code before it.</p>\n<h4>Follow The History</h4>\n<p>If you know this problem was introduced relatively recently, you can approach it by figuring out what changed.  Version control systems in particular provide great tools for this type of analysis.  If you know that the change was introduced within a set period of time, that provides an additional dimension from which you can narrow the scope and filter ideas.</p>\n<h3>Step 4: Make An Educated Guess</h3>\n<p>Now it’s time to make a guess at where the problem may be.  It’s important for this to be an <strong>educated</strong> guess.  You don’t want to check code at random.  Your starting point should come from your past experience with similar issues, or be the result of research into the problem. I can’t overstate how important research can be. It’s always worth starting with a quick Google search, since it might save you hours of time looking on your own.  Once you’ve narrowed the scope a bit, you can revisit your research, looking specifically for known issues with a specific component for instance.  Your guesses also can be a follow-up to new information from Step #5.  Despite the ordering I give here, debugging is never a completely linear process. You need to have all of these tools in your toolbox.  Experience will help you know which to use.</p>\n<h3>Step 5: Understand The Behavior</h3>\n<p>If you’ve managed to isolate the unwanted behavior a bit and have a guess where the problem might be, now’s the time to read more deeply into the code.  What is actually happening in there?  Does the logic of the code match your understanding of its purpose?  Do you see any red flags or danger signs?</p>\n<p>I once interviewed a candidate for a programming job who told me he didn’t read code very much while debugging.  Instead he made changes to observe the new behavior and kept fiddling until the output worked the way he wanted.  While that might work for aligning text on a Wordpress site, you simply can’t get away with that in a complex application.  Reading and understanding code quickly is a skill, but it’s one you must develop if you want to be a productive developer.</p>\n<h3>Step 6: Repeat Steps 3-5 until you have a thesis</h3>\n<p>If you’ve narrowed your scope and read some code, you might have an idea about what you think the problem is and how to solve it.  If you do, then proceed to step #6.  If not, take what you’ve learned and use it to loop back to step #3, to reduce the scope even more.</p>\n<h3>Step 7: Test your Thesis</h3>\n<p>If you think you have a handle on the problem, now’s the time to test it.  There are a few ways to do that.  One obvious way is to apply a fix and see if the problem goes away.  But if the fix would be expensive in time, money or complexity or if you’re afraid of treating the symptoms rather than the disease, you can also look into creating a simpler test case.  </p>\n<p>Earlier this month I encountered an issue where a <a href=\"http://handlebarsjs.com/\">handlebars</a> template was failing to render correctly occasionally.  After digging in and narrowing the scope, I determined that the issue occurred only on Chrome, and seemed to happen randomly after a few renders.  I was able to create a <a href=\"http://jsfiddle.net/w2gtm3yx/1/\">very simple test case</a> that reproduced the problem in a jsFiddle. I didn’t use any of my own data. Instead I just created the simplest test that I expected to fail.  And it did.  That gave me confidence that the issue was in the Handlebars-Chrome interaction, and I was able to find a workaround by looking through their <a href=\"https://github.com/wycats/handlebars.js/issues/832\">issues page</a> on Github<sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.  That type of iteration on your test cases also provides useful reference material in case the issue reoccurs.</p>\n<h3>Step 8: Repeat 3-7 until you can no longer reproduce</h3>\n<p>If your thesis turns out to be wrong, take your new knowledge and go back to step #3. It’s important to understand that this isn’t a rigidly structured process though.  This also may be time to go back and double check steps 1 &#x26; 2.  Do you really know what the right behavior is?  Have you learned anything that might change that?  If you couldn’t reproduce the issue after a change, are you sure that you’ve really fixed it?  Or were there holes in your original path to reproduce it?  A healthy amount of paranoia helps here.</p>\n<h3>Step 9: Document and future-proof</h3>\n<p>Once you’ve fixed the problem, or gotten to a point where you’re not going to continue for some reason, there’s one very important last step.  Document what you’ve learned.  If you made a change to the code that “looks wrong” but fixes the problem, leave a comment explaining it, and save it from future “code cleanups”.  If you can’t reproduce the problem consistently and it still exists, document what you learned in a bug tracker so that somebody can come back to it later.  If you isolated the problem to a 3rd party component, file a bug report and include your test case (simplified as much as possible).  If you created a useful test case, automate it or add it as a reference somewhere.  Exact processes will vary by team, but the key phrase here is “Those who don’t learn from the past are doomed to repeat it.”  Are you going to bruise this bug or bury it?  Make sure you can fix the problem quickly if it happens again. If you can do anything to keep it from coming back, do it.</p>\n<h3>The Takeaway</h3>\n<p>Real world engineering means dealing with code you don’t understand.  That might be your coworkers’ code, a 3rd party library, a buggy video driver, or your own 3 year old code. To do that effectively you need a process.  That might be mine, or one of your own, it could be formal, or just built on habit.  But make sure you have one.  The ability to dive in quickly, understand what’s going on and create a fix will set you apart.  It’s not that hard, but it takes discipline, creativity, and most of all practice.  So go ahead and start fixing something.  Maybe you’ll be the <em>Problem Solver</em> next time</p>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        Chrome 36.0.1985.143 seems to have resolved the issue.\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/08/19/the-debugging-toolbox"}}},{"node":{"frontmatter":{"readNext":"jest-first,ll-context,callbacks-to-promises","topics":["Architecture","CSS","Code Quality"],"category":"software-productivity","key":"orthogonality-css-js","title":"Orthogonality and CSS in JS","description":"Separation of concerns in the context of CSS and JavaScript","layout":"post","path":"/2017/01/03/orthogonality-and-css-in-js/","date":"2017-01-03T00:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>One of the realities of the constant change in the web development world is that “best practices” are often hotly contested.  One issue that the front end community doesn’t seem to have come to a consensus on yet is how tightly to bundle JavaScript, HTML and CSS in code.  Should they be bundled and managed completely separately?  Kept in different files and imported together into JavaScript component files?  Or can we remove HTML and CSS files entirely and generate everything in JavaScript? This is a discussion that still comes up all the time in my <a href=\"https://twitter.com/thomasfuchs/status/810885087214637057\">twitter</a> <a href=\"https://twitter.com/TheLarkInn/status/812089065210335232\">feed</a>.</p>\n<p>Many new frameworks that encourage a component based architecture (including React, Vue, and Angular2 <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>) provide affordances for including HTML and CSS directly in JavaScript, but those solutions are not yet used universally.  Many people are still very happy keeping CSS bundled separately.  I have no idea what the <em>best</em> solution is.  But I am interested in how people talk about the problem.  One major argument I have seen from people advocating both sides is that their preferred approach encourages good “separation of concerns”.</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">I&#39;m moving from storing my CSS, JS and HTML in different files, to physically putting them on different drives. Keep those concerns separate</p>&mdash; Ben Lesh (@BenLesh) <a href=\"https://twitter.com/BenLesh/status/812092408519413761\">December 23, 2016</a></blockquote>\n<p>I’d like to take a deeper look at this and give some vocabulary that can hopefully help anyone working through discussions on how to manage CSS for components.  I’ll focus specifically on CSS since frameworks tend to be more agnostic to how it is blended with JS than they are about HTML, and on components since that is the main context in which people are arguing for blending of css. For this piece, I’ll consider a component to be a set of HTML, CSS, and JavaScript that combine to form a reusable piece of UI <sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.</p>\n<h3>Orthogonality, Cohesion, and Coupling</h3>\n<p><a href=\"http://amzn.to/2hNzQ0t\">The Pragmatic Programmer</a>, one of the best books ever written on Software Engineering, uses the following three terms when talking about “Separation of Concerns”: orthogonality, cohesion, and coupling.  </p>\n<p>Orthogonality is the idea that modules should be written in a way that a change in one module should not require changes in any other module.</p>\n<blockquote>\n<p>Two or more things are orthogonal if changes in one do not affect any of the others. In a well-designed system, the database code will be orthogonal to the user interface: you can change the interface without affecting the database, and swap databases without changing the interface.</p>\n<p><strong>— The Pragmatic Programmer</strong></p>\n</blockquote>\n<p>Cohesion is a measure of how well the internal contents of a module relate to each other. A cohesive module is one with a single well defined purpose, where all code in the module is related to that purpose.  A less cohesive module might have multiple purposes, with pieces of code that are completely unrelated to each other.  <a href=\"https://sites.google.com/site/unclebobconsultingllc/\">Robert C. Martin</a> describes this as each module having “a single reason to change”.</p>\n<p>Coupling is a measure of how dependent different modules are on the internal workings of other modules. In a loosely coupled system, any module can be completely rewritten as long as it exposes the same public interface, without any other modules needing to change.  In a tightly coupled system, changing the internal details of one module may require changes in many other modules.</p>\n<p>In the real world most systems are not purely orthogonal, and their modules are likely not 100% cohesive and uncoupled.  But striving for these goals is a good approximation of what many people mean when they talk about <em>separation of concerns</em>.</p>\n<h3>Conways Law</h3>\n<p><a href=\"http://amzn.to/2hNzQ0t\">The Pragmatic Programmer</a> does touch on another application of orthogonality to software engineering:</p>\n<blockquote>\n<p>Have you noticed how some project teams are efficient, with everyone knowing what to do and contributing fully, while the members of other teams are constantly bickering and don’t seem able to get out of each other’s way?</p>\n<p>Often this is an orthogonality issue. When teams are organized with lots of overlap, members are confused about responsibilities. Every change needs a meeting of the entire team, because any one of them might be affected.</p>\n<p>How do you organize teams into groups with well-defined responsibilities and minimal overlap? There’s no simple answer. It depends partly on the project and your analysis of the areas of potential change. It also depends on the people you have available. Our preference is to start by separating infrastructure from application. Each major infrastructure component (database, communications interface, middleware layer, and so on) gets its own subteam. Each obvious division of application functionality is similarly divided. Then we look at the people we have (or plan to have) and adjust the groupings accordingly.</p>\n<p>You can get an informal measure of the orthogonality of a project team’s structure. Simply see how many people need to be involved in discussing each change that is requested. The larger the number, the less orthogonal the group. Clearly, an orthogonal team is more efficient.</p>\n<p><strong>— The Pragmatic Programmer</strong></p>\n</blockquote>\n<p>The idea is that teams work more efficiently when each can work in its own areas without having to be bogged down by using another group (or individuals) code, and only interacting with those modules through a well communicated interface.  This is also known as <a href=\"https://en.wikipedia.org/wiki/Conway&#x27;s_law\">Conway’s Law</a>, which is often used disparagingly but still stands as a true observation about real life code.</p>\n<blockquote>\n<p>organizations which design systems … are constrained to produce designs which are copies of the communication structures of these organizations</p>\n<p><strong>— Conway’s Law</strong></p>\n</blockquote>\n<p>Although it usually isn’t phrased quite so explicitly, I believe Conway’s law is often related to what people mean when they discuss separation of concerns in front end development.</p>\n<h3>Boundaries and Interfaces between CSS and JavaScript</h3>\n<p>Let’s look at 2 examples of how CSS can be structured.  We’ll use a “page view counter” as our example. The element will show the number of users who have viewed the page, and respond to click events by showing a modal with the most popular pages on the site.\nFirst, for a more traditional example, I’ll show a <a href=\"http://marionettejs.com/\">Marionette</a> View, with separate CSS. For a more integrated example, I’ll use a React component.</p>\n<h4>Marionette</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//view-counter.js</span>\n\n<span class=\"token keyword\">import</span> Mn <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone.marionette'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> template <span class=\"token keyword\">from</span> <span class=\"token string\">'./view-counter.hbs'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getPageViews<span class=\"token punctuation\">,</span> showModal <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../util/page-views'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> ViewCounter <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  template<span class=\"token punctuation\">,</span>\n\n  className<span class=\"token punctuation\">:</span> <span class=\"token string\">'page-view-counter'</span><span class=\"token punctuation\">,</span>\n\n  ui<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'showPageViewsModal'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'.show-modal-js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  events<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'click @ui.showPageViewsModal'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'showPageViewsModal'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">templateContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        pageViews<span class=\"token punctuation\">:</span> <span class=\"token function\">getPageViews</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">showPageViewsModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">showModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<div class=\"gatsby-highlight\" data-language=\"hbs\">\n      <pre class=\"language-hbs\"><code class=\"language-hbs\">{{!view-counter.hbs}}\n\n&lt;span class=&quot;page-view-counter__title&quot;&gt; Page Views: &lt;/span&gt;\n&lt;span class=&quot;page-view-counter__counter show-modal-js&quot;&gt; {{pageViews}} &lt;/span&gt;</code></pre>\n      </div>\n<div class=\"gatsby-highlight\" data-language=\"css\">\n      <pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">//view-counter.css\n\n.page-view-counter</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.page-view-counter__title</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> 700<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 3px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.page-view-counter__counter</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 3px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<h4>React</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//view-counter.jsx</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> showModal <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../util/page-views'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">PageViewCounter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>display<span class=\"token punctuation\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        fontWeight<span class=\"token punctuation\">:</span> <span class=\"token number\">700</span><span class=\"token punctuation\">,</span>\n        padding<span class=\"token punctuation\">:</span> <span class=\"token string\">'3px'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        Page Views<span class=\"token punctuation\">:</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>padding<span class=\"token punctuation\">:</span> <span class=\"token string\">'3px'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>pageViews<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>The React and Marionette examples have set different module boundaries. In the Marionette example, we have defined 3 modules, split by code type.  Ignoring the leaky abstractions in the Marionette boundaries <sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup>, we can say we have 3 modules with clear singular purpose (styling, behavior,  structure) that use class names and  <code class=\"language-text\">templateContext</code> as interfaces.  The handlebars file exposes classes, which the CSS uses to style elements and the JavaScript code uses as attachment points for event handling.  The JavaScript view passes data to the template through templateContext.  In the React code we have defined a single module that exports a component as its only external interface. The module’s single purpose could be defined as “rendering a PageViewCounter”.</p>\n<h3>How do we define module boundaries?</h3>\n<p>If you’re excited to read which of the above examples is the <em>correct</em> module boundary definition, I’m sorry to disappoint you.  It turns out that module boundaries are more of an art than a science.  Let’s consider each of these examples by the criteria we laid out above.</p>\n<p>The Marionette modules are <strong>cohesive</strong>.  Each module is single purpose, with a clear reason why it might change.  The React module is also cohesive, as it describes a single atomic component. However, it has more reasons it might change.  We might change that module because of a change in the look and feel of the site, because of a change in the expected behavior of the click event, or because we’re changing the text inside the component.</p>\n<p>The Marionette modules are not quite <strong>decoupled</strong>.  While this CSS doesn’t nest selectors and we don’t have any explicit dependencies on the HTML structure, it is still written in a way that assumes <code class=\"language-text\">.page-view-counter__title</code> and <code class=\"language-text\">.page-view-counter__counter</code> will be direct children of <code class=\"language-text\">.page-view-counter</code>.  So changing the “internal details” of the Handlebars file by adding an extra element around those children would break the CSS. While the modules are not completely decoupled from each other, they don’t rely on any private details of other modules or global styles and can be used together as a reusable component.  The React module is similarly decoupled from the rest of the system, and as a single module faces no internal coupling issues.</p>\n<p>Both components should be <strong>orthogonal</strong> from the rest of the system, even though the Marionette modules may be less orthogonal internally.  The question of how they meet a Conway’s law style of orthogonality depends on a team.  If your team has designers, and developers separately working on style/structure and behavior, the Marionette version may allow for more efficient division of labor, with communication centering on class based communication.  If you instead have a group of polyglot front end developers who implement mocks from designers across all 3 areas, the React version will instead present a simpler implementation that maps better to your team, with the focus on interfaces across different components.  </p>\n<p>In the end decisions like this are an exercise in understanding context and preferences.  What will make your team productive? You can accept the coupling of the first example in order to gain the benefits of small focused modules.  Or you can take the larger scope of the React component in exchange for keeping all information relevant to a component in one place.  Are you making single developers responsible for a set of components?  Or are they responsible for behavior generally, with design handled by someone else? Make the decisions that work for your project.</p>\n<h3>More Resources</h3>\n<ul>\n<li><a href=\"http://amzn.to/2hNzQ0t\">The Pragmatic Programmer</a> is a great book. Much of the vocabulary in this post comes from its Chapter 8, but the whole book is worth a read and is highly recommended.</li>\n<li>CSS Tricks has a good look at the <a href=\"https://css-tricks.com/the-debate-around-do-we-even-need-css-anymore/\">pros and cons of CSS in JS</a>.  I focused on theory here, but this is much more hands on about the practical concerns around this debate.  </li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>This is a bit of a generalization.  React provides an abstraction over HTML that replaces hand-written HTML, but doesn’t specify anything for CSS, CSS in JS solutions are simply popular in that community.  Vue and Angular both allow  CSS and HTML to share a file with JS, but CSS can still be handled separately.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p>There are some distinctions about CSS in JS vs importing CSS into JS using webpack that I’m not really dealing with here.  This is a post about how to think about these decisions moreso than the specific options for bundling CSS and JS</p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-3\">\n<p>The root HTML element in any Marionette component is always defined implicitly in JavaScript, and Handlebars is an expressive templating language that can handle more than structure.</p>\n<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/2017/01/03/orthogonality-and-css-in-js/"}}},{"node":{"frontmatter":{"readNext":"ten-things-js,favorite-interview,ll-context","topics":["Teams","Code Quality","Leadership"],"category":"fe-architecture","key":"large-improvements-small-team","title":"Tips For Improving a Large Code Base With A Small Team","description":"How do you keep improving things with limited resources?","layout":"post","path":"/2018/01/07/large-improvements-small-team/","date":"2018/01/07","dontfeature":null,"isDraft":null},"html":"<p>Over the last year I’ve been acting as the lone JavaScript resource working on a codebase with around 90k lines of JavaScript code.  That has left me spending the vast majority of my work time trying to knock out features and deal with bugs across the large code surface area.  But I’ve also wanted to do my best to continue to improve code quality with limited resources.  Here are a few things I’ve learned about trying to improve code quality across a large project with limited resources.</p>\n<h4>1. You need to accept not being on the bleeding edge</h4>\n<p>Let’s be real, in the JavaScript world the only way to always be on the bleeding edge is to never maintain an application for more than a few weeks.  And even in other contexts, it often is much less feasible than hype bubbles at conferences or sites like Hacker News might make it seem.  Most companies that are shipping software that users actually pay for are using quite a lot of very old technology quite extensively.  That’s not to say there’s no place for new and shiny things, but there will always be limits to how new and shiny things get.  When you’re low on people resources for the size of your project, those limits get a lot more restrictive.</p>\n<h4>2. It’s important to identify your pain points.</h4>\n<p>There are 3 main type of value that developers can add by changing a software system. They can write new <strong>features</strong>, which give users new capabilities.  They can improve some <strong>cross-feature attributes</strong> of the system like loading speed, accessibility, design, logging or documentation.  Or they can make <strong>architecture improvements</strong> that make it easier to make other changes.  Generally engineers don’t have to argue to add features, because the business decision makers will be calling for them constantly.  Cross-feature things like performance, design or logging sometimes come from business decision makers, but often only when things have become problematic, and then the conversations around how long it will take to achieve improvements can be tense ones.  Architecture concerns pretty much never come from business folks, because they usually don’t see the effects of a bad architecture until it is too late and shipping simple features has become a disastrously slow process<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  It’s part of a developer’s job to push for the latter 2 type of changes when they’re needed.   But with limited resources, <em>needed</em> is often hard to quantify.</p>\n<p>That’s why it is important to know what is <em>actually</em> causing you pain, or will soon be causing pain.  Is your site getting slower and slower?  Is your CSS a giant tangled mess that creates bugs with every change<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>?  Make a list, and then prioritize it by importance and expected effort.</p>\n<h4>3. Take things one at a time</h4>\n<p>Once you have a list of things that you want to fix, it can be tempting to try to fit those fixes in all over the places.  You’re creating a new page, might as well write it in Vue instead of Angular.  You’re changing some styles, maybe you can use a CSS in JS library.  But the absolute worst thing you can do with limited resources is try to improve too many things at once.  You’ll end up with a codebase with many different ways to do everything, so that every change requires a full context reset, and maintenance means dealing with multiple sets of bugs and compatibility issues for each duplicated approach.  That’s why prioritization is critical.  With limited bandwidth, you need to know what <strong>one thing</strong> will be the best use of your time.</p>\n<h4>4. Expand from small footholds, don’t boil the ocean</h4>\n<p>A few truths to note at this point:</p>\n<ol>\n<li><strong>Changing large systems is hard.</strong>  They have a million different subtle assumptions weaved into their code, and making seemingly the same change in different places can often produce subtly different results.</li>\n<li><strong>Practice is how you learn to use a tool or technique optimally.</strong> Unless you’ve already used a technology extensively in a different context, you will never be more blind to it’s downsides than at the start of adding it to a project.  As you begin using it, you’ll learn more about it and how to use it better in your system.</li>\n<li><strong>Well designed systems have good interface points</strong>.  Interface points are areas where one part of the system doesn’t need to care about the details of how other parts of the system are implemented, they just need to know the <em>interface</em> for interacting with that part of the system.  For example, when using React, parent components don’t need to know the details of how a child component work, just what props they take.  Similarly when writing HTMl, you don’t need to know the details of how CSS will work for layout, you just need to expose meaningful class names that CSS can use.  A website doesn’t need to know what language a web server is written in to make HTML requests to it.  These are examples of interface points, and while well designed systems will have more of them and fewer “breaches” of the interface lines, all systems have them to some extent.</li>\n</ol>\n<p>The implication of these truths is that there is value in starting small and expanding.  If we can pick a small section of the application that is cordoned off from the rest of the code in a meaningful way, we can create a foothold for the new technology.  This serves as a learning opportunity, an example, and a starting place.  If it goes badly, small changes are easy to revert or fix.  If it works well, we can look for more similar interface boundaries, or expand out to convert some of the code that uses the new code.</p>\n<p>When I converted a large Backbone app to use React, I took advantage of 2 different interface boundaries.  I started by converting small “widget” components to be written in React, and came up with a method of calling these widgets from within Backbone code.  Once I had enough of these building block widgets written in React, I started writing new pages in React.  Then finally I would convert subsections of Backbone driven pages to React, starting from the bottom up and converting the top level layouts of the page last.  I was using 2 interface boundaries: components and pages.  That made sense for Backbone to React, where I was essentially converting one type of component tree to another.  But the lines may be different for other changes, and you’ll need to use your judgement.</p>\n<h4>5. Automate what you can</h4>\n<p>Not every change needs to be hard and slow.  Sometimes we can take advantage of automation. Tools like <a href=\"https://prettier.io/\">Prettier</a> and <a href=\"https://eslint.org/\">ESLint</a> make it easy to automate code style and correctness fixes.  Tools like React often provide <a href=\"https://github.com/reactjs/react-codemod\">codemods</a> to help make it easier to update to a new version of the tool or use best practices.  Unit tests can help you prevent regression bugs and are easy to automate with a CI server or <a href=\"https://benmccormick.org/2017/02/26/running-jest-tests-before-each-git-commit/\">pre-commit hooks</a>.</p>\n<p>If you’re dealing with problems that are more specific to your codebase, it may make sense to invest time into writing your own automation scripts, whether that means hacking together a crazy bash/python script to do a massive find and replace, or using a tool like Ansible to automate some previously manual developer processes. It made a big difference in our company when our QA developer put in the work to automate the creation of consistent local environments.</p>\n<h4>6. Count the cost of maintenance</h4>\n<p>With a small team, some improvements may simply not be worth it over time.  Genuinely valuable things like test coverage, JSDoc style automated documentation, old browser support, add overhead to future changes as well as any up front cost to implement. These are the type of things that advocates tend to moralize about, and say that it’s the developers job to advocate for them.  And that is true as I alluded to earlier.  But when faced with limited resources, it’s important to prioritize, and understanding the cost of maintaining certain improvements is part of that.</p>\n<h4>7. Distinguish between craftsmanship and business needs</h4>\n<p>Along the same lines, as developers we’re often encouraged to think of ourselves as craftsmen.  Think of <a href=\"https://thenextweb.com/apple/2011/10/24/steve-jobs-obsession-with-the-quality-of-the-things-unseen/\">Steve Jobs talking about using good wood for the back of a cabinet</a> or the aforementioned moralizing about code and process quality.  There are great things about this, since it is a developers job to look after the quality and craftsmanship of their product.  But it also is good to align that craftsmanship with business needs and create something that is useful rather than merely theoretically beautiful.  So there is a place for making changes to improve the “purity” of code, but when investing limited resources, it’s even more important than usual to balance that with business needs.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>I’ve gotten to work with plenty of non-devs who respect the need for good architecture.  They still aren’t going to be able to identify when changes need to happen.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p>Little known fact: CSS actually stands for “Giant Tangled Mess that creates bugs with every change”</p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/2018/01/07/large-improvements-small-team/"}}}],"topic":"Code Quality"}}