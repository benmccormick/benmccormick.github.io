{"data":{"markdownRemark":{"html":"<h1>Diving into lodash: Reducing collections</h1>\n<p>7 years ago, TC39, the group responsible for authoring the ECMAScript standard produced ES5, the 4th major version of the JavaScript language<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  One of the hallmark features of that release was a set of functional methods for working with arrays: <code class=\"language-text\">forEach</code>, <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code> and <code class=\"language-text\">reduce</code>.  The first 3 seem to be fairly well understood and widely used by many JavaScript developers, but <code class=\"language-text\">reduce</code> has remained more obscure.  </p>\n<p>The purpose of <code class=\"language-text\">reduce</code> is to provide a simple functional way to reduce a list of values into a single value.  This can be done for simple mathematical operations like summing or maxing, to build complex objects out of a list of keys, or to transform a dataset into a different form.</p>\n<p><code class=\"language-text\">reduce</code> takes 2 arguments, a reducer function and an optional initial value (also called an accumulator) and returns an aggregate value.  For each item in an array the reducer function receives the current value of the aggregate, the next value in the array, the index of the value, and a reference to the whole collection.  In practice, using it can look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//generate a list of random numbers between 0 and 99</span>\n<span class=\"token keyword\">let</span> nums <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> _<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">99</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//get the maximum value</span>\n<span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> nums<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>max<span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> num <span class=\"token operator\">></span> max <span class=\"token operator\">?</span> num <span class=\"token punctuation\">:</span> max<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// get the sum of all of the numbers</span>\n<span class=\"token keyword\">let</span> sum <span class=\"token operator\">=</span> nums<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>total<span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> num <span class=\"token operator\">+</span> total<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Get the counts of the occurence of each number between 0 and 99 in nums</span>\n<span class=\"token keyword\">let</span> frequencies <span class=\"token operator\">=</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfrequencies <span class=\"token operator\">=</span> nums<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> arr<span class=\"token punctuation\">[</span>num<span class=\"token punctuation\">]</span><span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> frequencies<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>lodash provides its own version of the native <code class=\"language-text\">reduce</code>.  <code class=\"language-text\">_.reduce</code> works similarly to the native function, but takes the collection as its first object and like other lodash functions will accept any array-like object and iterate it like an array, or normal objects, with which it will iterate over key value pairs. <code class=\"language-text\">_.reduce</code> also has special compatibility with many lodash functions that take multiple arguments, and makes sure to pass them only the first 2 arguments to avoid the index and collection arguments contaminating the function.  This allows code like this more complex version of the example from <a href=\"\">my article on merging objects in lodash</a> :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> contacts <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>\n    lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Smith'</span><span class=\"token punctuation\">,</span>\n    phone<span class=\"token punctuation\">:</span> <span class=\"token string\">'919.222.7855'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>\n    phone<span class=\"token punctuation\">:</span> <span class=\"token string\">'919.965.9999'</span><span class=\"token punctuation\">,</span>\n    email<span class=\"token punctuation\">:</span> <span class=\"token string\">'john.smith@gmail.com'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n    firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'John'</span><span class=\"token punctuation\">,</span>\n    lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'Smith'</span><span class=\"token punctuation\">,</span>\n    twitter<span class=\"token punctuation\">:</span> <span class=\"token string\">'@johnsmith232'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n_<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>contacts<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">.</span>assign<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// {firstName: \"John\", lastName: \"Smith\", phone: \"919.965.9999\", email: \"john.smith@gmail.com\", twitter: \"@johnsmith232\"}</span></code></pre>\n      </div>\n<p>We can also use <code class=\"language-text\">_.reduce</code> to recreate other lodash methods like <code class=\"language-text\">_.map</code> or <code class=\"language-text\">_.reverse</code>.  Here’s an implementation of <code class=\"language-text\">_.reverse</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">reverse</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> _<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>newArr<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    newArr<span class=\"token punctuation\">.</span><span class=\"token function\">unshift</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> newArr<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>The above code works fine, but it is extremely inefficient for large arrays.  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0.09 seconds</span>\n<span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2.84 seconds</span>\n<span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// over 6 minutes</span></code></pre>\n      </div>\n<p>The problem is that we’re shifting all of the values in the array everytime we insert a new value.  It would be great if we could just add values to the end instead, but we’re getting them in the wrong order.  Fortunately, lodash provides <code class=\"language-text\">_.reduceRight</code>. <code class=\"language-text\">_.reduceRight</code> works the same way as <code class=\"language-text\">_.reduce</code>, but starts from the end of the collection rather than the beginning.  That allows us to create a more efficient <code class=\"language-text\">reverse</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">betterReverse</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> _<span class=\"token punctuation\">.</span><span class=\"token function\">reduceRight</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>newArr<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    newArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> newArr<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">betterReverse</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0.11 seconds</span></code></pre>\n      </div>\n<h3>_.transform</h3>\n<p><code class=\"language-text\">_.transform</code> is a variation on reduce with some different behavior.  If you don’t pass a specific initial value, <code class=\"language-text\">_.transform</code> will try to do the right thing by reading the prototype of the collection and using either an empty array or object.  Changes are then made by mutating the accumulator rather than returning a new value.  <code class=\"language-text\">_.reduce</code> will simply start with the first item in the list if nothing is provided. So we can do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">reverse</span> <span class=\"token operator\">=</span> arr <span class=\"token operator\">=></span> _<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>newArr<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> newArr<span class=\"token punctuation\">.</span><span class=\"token function\">unshift</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p><code class=\"language-text\">_.transform</code> can also be short-circuited by returning false from the function. So we could use it to cut off an array at the first odd number:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">cutOffAtOdd</span> <span class=\"token operator\">=</span> arr <span class=\"token operator\">=></span> _<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>newArr<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  newArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p><code class=\"language-text\">_.transform</code> is more limited to reduce as the returned collection has to be the same type as the original collection.  You can’t replicate the <code class=\"language-text\">max</code> or <code class=\"language-text\">sum</code> functions from the beginning of this article with it for instance, since you can’t mutate an array down to a number.</p>\n<h3>_.keyBy and _.countsBy</h3>\n<p>One of the primary use cases for <code class=\"language-text\">_reduce</code> is taking a collection and building an object from it.  lodash provides 2 methods that handle specialized versions of this use case.</p>\n<p>[mergeclone]</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>If that sentence was confusing, feel free to check out this <a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">quick primer</a> on ECMAScript/JS terminology.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","frontmatter":{"title":"","keywords":null,"category":null,"date":null,"path":null,"layout":null,"hideFooter":null,"hideSidebar":null},"fields":{"slug":"/posts/drafts/old-drafts/lodash/lodash_reduce/"}}},"pageContext":{"slug":"/posts/drafts/old-drafts/lodash/lodash_reduce/","relatedPosts":[{"path":"/404.html","data":{"title":"","path":"/404.html","description":null,"date":null,"category":null}},{"path":"/a-note-to-recruiters","data":{"title":"A note to recruiters","path":"/a-note-to-recruiters","description":null,"date":"2015-06-04T13:42:18+00:00","category":null}},{"path":"/built-with","data":{"title":"Built With","path":"/built-with","description":null,"date":null,"category":null}}]}}