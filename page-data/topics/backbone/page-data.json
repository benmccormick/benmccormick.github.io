{"componentChunkName":"component---src-templates-topic-page-js","path":"/topics/backbone","result":{"pageContext":{"posts":[{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javascript","book-review"],"category":"reviews","key":null,"title":"Book Review: Building Backbone Plugins","description":"A book review of a great deep dive into Backbone best practices","layout":"review","path":"/2014/07/09/understanding-the-backbone-mindset-a-review-of-building-backbone-plugins-by-derick-bailey","date":"2014-07-09T11:38:40+00:00","dontfeature":null,"isDraft":null},"html":"<p>As the saying goes, judging a book by its cover is a dangerous business.  A lot of books have titles that promise great things, and content that under-delivers and disappoints.  Every once in a while, though, you find a gem that does the opposite. <a href=\"https://leanpub.com/building-backbone-plugins?a=3a4Srv2pP9p87WQ_eoDoGp\">Building Backbone Plugins</a> sounds like a niche book for library developers.  But it actually is the best resource on <a href=\"http://backbonejs.org/\">Backbone.JS</a> development I’ve found, a book that will benefit anyone who works with Backbone.</p>\n<p>So what’s the fuss about?  The book’s author, Derick Bailey, is the creator of <a href=\"http://marionettejs.com/\">Marionette.JS</a>, a popular application framework for Backbone Apps.  <em>Building Backbone Plugins</em> explores the problems that Derick tried to solve with Marionette and then explains the mindset behind Marionette’s solutions.  It is not a book exclusively about Marionette though.  The solutions in the book are example code that represents a simplified view of what Marionette does.  Instead the book looks at the common problems any developer will encounter in a Backbone project, and provides a possible solution, while working hard to generalize the lessons and concepts as much as possible.</p>\n<p>Building Backbone Plugins is divided into 4 parts.  The first two look at Backbone Views and dealing with the DOM.  The third looks at Models and Collections.  The last part deals with application structure and events.  These are followed by a series of appendices that read as stretched-out blog posts on a variety of related topics that didn’t quite fit into one of the 4 buckets that the rest of the book falls into.</p>\n<p>In my mind, the first two parts are the heart of the book.  They’re a step-by-step look at how you can remove repetitive code from your Backbone Views and structure your application to expose the developers intent in each file, rather than burying the purpose in boilerplate. I learned a lot about how I could improve my Backbone code, and these two sections actually inspired me to start integrating Marionette into a project at work. The application structure advice in the fourth part is also particularly strong, with quality information about events, and ideas on how to scale a Backbone application beyond TodoMVC sizes.</p>\n<p>On the other hand, the appendices feel a bit tacked on, and seem to be full of stuff the author wanted to add but couldn’t figure out how to weave into the rest of the book.  Since it’s legitimate content rather than simply greater detail on things that have been already covered, they don’t act as real appendices and leave the book feeling a bit unfocused at the end. When you combine that with some weaker content in part 3 (where the author moves away from Marionette into some other smaller examples), the book can feel a bit choppy and directionless.  But the goldmine of knowledge and perspective in Parts 1, 2 and 4 more than make up for it.</p>\n<p>I would not recommend BBP as a “first book” on Backbone.  It assumes plenty of knowledge, and doesn’t attempt to teach Backbone basics.  But for an intermediate level Backbone developer, or any Javascript developer who wants to grow their thinking about application structure, there is plenty of solid insight here. Meditations on handling nested views, cleaning up unused views, abstracting out repetitive boilerplate, and structuring genuinely large applications are all worth the price of the book.  Finally, if you’re writing code using Marionette already, this book is a must-have.  Marionette’s documentation does a great job of explaining the “what” and the “how” of Marionette.  But this book explains the all-important “why” of a framework that is based on encoding Backbone best practices into a library. It will help you think like an experienced Backbone developer.</p>\n<h3>More Resources</h3>\n<ul>\n<li><a href=\"https://leanpub.com/building-backbone-plugins?a=3a4Srv2pP9p87WQ_eoDoGp\">Building Backbone Plugins</a> - You can purchase the book on leanpub. (Note: Affiliate Link)</li>\n<li><a href=\"http://addyosmani.github.io/backbone-fundamentals/\">Developing Backbone Applications</a> - This book by Addy Osmani is a great resource for Backbone Beginners who want a more basic introduction to Backbone concepts.  It’s available as a free HTMl site on github, but you also can <a href=\"http://www.amazon.com/gp/product/1449328253/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1449328253&linkCode=as2&tag=productjavasc-20&linkId=5RQTSOTPFIGKMLJK\">purchase it as a paperback or ebook.</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=productjavasc-20&amp;l=as2&amp;o=1&amp;a=1449328253\" width=\"1\" height=\"1\" alt style=\"border:none !important; margin:0px !important;\"></li>\n<li><a href=\"http://marionettejs.com/\">Marionette.js</a> - This framework serves as the inspiration for Derick’s book and is a great way to structure larger Backbone apps.</li>\n</ul>","fields":{"slug":"/2014/07/09/understanding-the-backbone-mindset-a-review-of-building-backbone-plugins-by-derick-bailey"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javascript"],"category":"frameworks","key":null,"title":"marionette-service: Service Objects for Marionette","description":"Introducing marionette-service, a services library for Marionette apps","layout":"post","path":"/2015/05/25/marionette-service-service-objects-for-marionette","date":"2015-05-25T14:02:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><a href=\"http://backbonejs.org/\">Backbone.js</a> is a great way to structure web applications.  Its built in Models, Collections, Views and Routers are a very reasonable “minimum common ground” that pretty much any web project will be able to put to good use.  But more sophisticated applications have needs that extend beyond these basic concepts.  In addition to having some data that needs to be displayed, rich web apps often have resources and functionality that need to be shared across many different Views and Models.  There’s no definitive way to implement this consistently, but a common pattern is to create “services” of some type that Views and Models can communicate with.   </p>\n<p>This pattern is easiest to show with an example.  Let’s take a look at a simple logging implementation.  We might start out just using simple console commands throughout our code like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Do a thing</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'We did Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s fine for a while, but what if we wanted to switch to a logging library like <a href=\"http://js.jsnlog.com/\">JSNLog</a> or some 3rd party service?  We’d have a huge find and replace job to work through.  It’s better to centralize.  <a href=\"https://github.com/marionettejs/backbone.radio\">Backbone.Radio</a> is perfect for this purpose.  We can use it to centralize our logic and create a logging module:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Radio <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone.radio'</span>\n\n<span class=\"token keyword\">let</span> loggingChannel <span class=\"token operator\">=</span> Radio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'logError'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'logWarning'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We could then log a message like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Do a thing</span>\n  loggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'We did Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There are 2 main use cases for this sort of service pattern: centralizing common tasks and UI actions like logging or displaying an alert, and requesting a resource without having to worry about where it came from.  Both are easily possible using Backbone Radio, using code very similar to whats above.</p>\n<p>Using Backbone Radio like this is a useful pattern, but it’s very ad hoc and imperative.  Not very Backbone-like.  What if we could follow the Marionette route of pulling a useful pattern into an object and allow it to be configured declaratively?  We could instead create a “Service Object” like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Mn <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone.marionette'</span>\n\n<span class=\"token keyword\">let</span> LoggingService <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>Service<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    radioCommands<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'log log'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'logMessage'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'log logError'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'logError'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'log logWarning'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'logWarning'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">logMessage</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">logError</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">logWarning</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LoggingService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is much more in the Backbone and Marionette style, with a declarative hash to delegate to different functions based on channels and the events passed.  It makes it much easier to create “service objects” to make functionality available in a decoupled way.</p>\n<p>Declarative radio handling will be <a href=\"https://github.com/marionettejs/backbone.marionette/pull/2431\">coming to Marionette Core</a> as part of Marionette version 3, but for now I’ve written a small library to make it available in the short term.  </p>\n<p><a href=\"https://github.com/benmccormick/marionette-service\">marionette-service</a> provides the above Service Object to Marionette.  It allows you to listen to Radio Events, Commands or Requests, and associate them with callback functions.  It’s compatible with plans for Marionette v3, so all that will be required to remove it when upgrading will be a name change for service objects to use Marionette.Object rather than Marionette.Service. I’m excited to see how people use it.</p>\n<p>Marionette-service is available to install both on <a href=\"https://www.npmjs.com/package/marionette-service\">npm</a>, and <a href=\"http://bower.io/search/?q=marionette%20service\">bower</a>.  Or you can clone the repo directly from <a href=\"https://github.com/benmccormick/marionette-service\">Github</a>.</p>\n<h3>More Resources</h3>\n<ul>\n<li>If you’re new to Backbone.Radio you can learn more about it from <a href=\"http://benmccormick.org/2015/01/26/backbone-radio/\">my post</a>, or from the <a href=\"https://github.com/marionettejs/backbone.radio\">official docs</a>.</li>\n<li>If you’re confused why somebody would want to separate out the implementation of a service through Radio rather than passing a service object directly, <a href=\"http://arguments.callee.info/2009/05/18/javascript-design-patterns--mediator/\">this is a nice piece by HB Stone</a> on the power of loose coupling and the Mediator Pattern</li>\n</ul>","fields":{"slug":"/2015/05/25/marionette-service-service-objects-for-marionette"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-es6-1","topics":["backbone","Marionette","javascript"],"category":"frameworks","key":null,"title":"Building Complex Layouts With Marionette.js","description":"How to build complex UIs with Marionette.js","layout":"post","path":"/2014/12/22/building-complex-layouts-with-marionette-js","date":"2014-12-22T04:43:47+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the third post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>.  For more background on what Marionette is, check out the first post in the series, <a href=\"http://benmccormick.org/2014/12/02/the-case-for-marionette-js/\">The Case For Marionette</a>  Also note that this article was written about Marionette v2.  The current latest version of Marionette is v3, and while most of the high level concepts remain the same, the specific syntax has changed in some cases.</em></p>\n<p>When building complex web applications, many of the first decisions you have to make revolve around the structure and layout of your application. Most applications will have some static portions like navigations or footers, and some dynamic portions holding content or page specific controls.  A good layout manager will allow you to easily control these layouts, helping you keep structure consistent between pages and actions while swapping out content on changes in routes or data.  </p>\n<p>Backbone provides Views as a way of managing the display of a web app’s UI.  But it doesn’t provide any guidance on how you should use them to construct complex layouts.  Should you have one view per page and control the layout with templates and jQuery?  Use one View for each section of the page?  Or have a top level view that creates child views to manage different sections?  All of these are possible with Backbone, and none of them are particularly encouraged or discouraged by the library design.  In fact because Backbone doesn’t provide any consistent conventions for managing subviews, rendering content, or attaching rendered content to the DOM, even projects that take the same approach to managing layout might implement these patterns quite differently.</p>\n<p>In my <a href=\"http://benmccormick.org/2014/12/02/the-case-for-marionette-js/\">first post</a>, I talked about how one of the strengths of Marionette is the way it helps remove many of the decisions that Backbone developers have to make for each project by providing components based on community-tested patterns.  Layout is another area where Marionette can give you a standardized solution.  Marionette does this by providing Regions and by making it easy to manage child Views.</p>\n<h3>Layout in Marionette</h3>\n<p>Regions are the primary tool Marionette provides for defining layouts.  A Region is a defined portion of the page, held within a root DOM element. You can swap different Views in and out of Regions, or show one View and let it stay there permanently.  Like everything in Backbone applications, Regions emit events, which allow you to design functionality that is triggered before or after a region’s content changes.  Regions map very well to low fidelity layout wireframes like the one below, but they also can be used for organizing smaller components.  They’re an organization tool for attaching and removing Views in a consistent way.</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 72.12953876349363%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAABYlAAAWJQFJUiTwAAABPElEQVQoz5WQX0vCYBSH348XaLYtE7USosSwIiIvvOuqLxLun85qOSmom7qS7oK1uTn7FiHn7abz7p2bqSyFh7EdeM7v7EfeB28fjjv0x94o+BoHjh+4MV7geKPPYQS+x9iub9s2uex/18zJ8QM0nuD6ldZMqPcSTi047zPOrGR40oOqCVcvE5KRaVaGTAtEFSq3kG3BphyBc0mDUodRaLNPPs8psHEDdeuHSCogogLFNlw80h0dZsnrsK1FxENchH7zmRIMRAQlmm4pwCcpYFhOhoO7qSyGctlgW1aR8fgjM5QFlQXiheXOqslMvqcEf2bXgD0DimExc8kCR/kzT2RJS2qYk1Er6Gz1fpetFhbl9LN5ybgXn+JSOW67tCD/c/asvHZhwjQhry8pLEU+5G3zZPyxSneN5KpJfwHK4TFj7bg1hAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Regions image\"\n        title=\"\"\n        src=\"/static/331a9e83c26d8624a64ca39ca049925c/a9e6e/marionette_regions-1.png\"\n        srcset=\"/static/331a9e83c26d8624a64ca39ca049925c/40f08/marionette_regions-1.png 143w,\n/static/331a9e83c26d8624a64ca39ca049925c/d4502/marionette_regions-1.png 285w,\n/static/331a9e83c26d8624a64ca39ca049925c/a9e6e/marionette_regions-1.png 570w,\n/static/331a9e83c26d8624a64ca39ca049925c/c2e96/marionette_regions-1.png 855w,\n/static/331a9e83c26d8624a64ca39ca049925c/f4f98/marionette_regions-1.png 1140w,\n/static/331a9e83c26d8624a64ca39ca049925c/3cbde/marionette_regions-1.png 2038w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n      />\n  </span></p>\n<p>Regions really shine when it comes to child Views.  When you’re setting up Views in a normal Backbone application, you have to be very careful to avoid memory leaks by replacing a view without properly destroying it, especially for long-running SPA style apps. If you’re properly cleaning up Views when they’re destroyed, another thing that Marionette can help with, Regions remove that pain by ensuring that a View is properly destroyed if replaced in a Region, removing boilerplate and the opportunity for subtle memory bugs.  They also provide a clean central way to attach child Views, making it easier to maintain consistency across a project and promoting readability when moving into different code.</p>\n<h3>LayoutView</h3>\n<p>Regions are great, but for the most part you’re not going to want to use them directly.  Instead, Marionette provides a special View class, LayoutView.  LayoutViews allow you to build View tree hierarchies.  You can have one top level View that controls the entire page, or a section of the page that your Marionette app lives in.  That root view can then contain Regions which you use to show child Views.  Some of those child Views may themselves be LayoutViews, and so on for as many levels as you like.  This setup allows you to create modular View classes with few responsibilities that you can easily replace or update without having to write a lot of boilerplate code.</p>\n<p>That’s the high level overview, but let’s dig into what the code looks like.  To use regions in a LayoutView, we don’t have to directly create them.  Instead we define a regions object that works similarly to the events object on normal Backbone Views.  The regions object takes a Region name as a key and a jQuery selector as a value, and then create Region objects for each key-value pair and attach them to the View.  If you need to do something more complicated you can create a regions function that returns an object with the key-value pairs that you would like.  Here’s an example of what a LayoutView might look like in practice.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Mn <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.marionette'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> Radio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.radio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> FooterView <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/footer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> HeaderView <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/header'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> IndexView <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> RootView <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>LayoutView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  regions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    header<span class=\"token punctuation\">:</span> <span class=\"token string\">'#navbar'</span><span class=\"token punctuation\">,</span>\n    content<span class=\"token punctuation\">:</span> <span class=\"token string\">'.content-area'</span><span class=\"token punctuation\">,</span>\n    footer<span class=\"token punctuation\">:</span> <span class=\"token string\">'footer'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">initialize</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Radio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'set:content'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">contentView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span>contentView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">onBeforeShow</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'header'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HeaderView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'footer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FooterView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is an example of a RootView that could be shown in a standalone Region and used as the top-level of a View hierarchy.  There are a few things to note about this example.  It defines 3 regions, a header and footer that render static Views, and a content area that originally contains an index View.  The initialize function uses Backbone.Radio to listen for commands and can swap out the View held in the content region when commanded. Those views could be swapped based on users navigating to a new route, with the routes initializing the Views and passing the commands, or based on a data change of some type.  We can also see that the child Views are shown within the onBeforeShow callback.  I’ll be discussing View life-cycle methods more in my next post, but for now just know that onBeforeShow runs immediately before a View is shown in a region.  You can use it when nesting your Views in order to make sure your Views are only attached to the DOM once, which prevents the browser from having to repaint the window multiple times.</p>\n<h3>It’s Turtles All The Way Down</h3>\n<p>The great thing about Marionette’s View system is that you can take the 3 Views I’ve gone over in my last 2 posts, ItemView, CollectionView, and LayoutView, and use them to represent pretty much any layout you’d like.  The basic rules: LayoutViews are used to structure the page into regions and regions into subregions. ItemViews are used to bind data to a UI, and CollectionViews are used to iterate over a Collection when each item in a Collection has complex data or behaviors associated with it and should be bound to an individual View or View tree<sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>. This consistency makes it easy to learn how to structure Marionette apps, and makes it simple for experienced Marionette developers to jump into a new project quickly and get their bearings.  That’s really the promise of Marionette in a nutshell: consistent patterns that allow for a better development experience.</p>\n<h3>More Resources</h3>\n<ul>\n<li>For more on nesting Marionette Views, you can check out <a href=\"https://www.youtube.com/watch?v=CTr-tTwRH3o\">this talk</a> by Marionette core team member Sam Saccone.  It’s a quick 10 minute video covering much of the same stuff I went through here.</li>\n<li>I’ll talk more about this in a future post, but if you have a Marionette app and want to visualize your View hierarchy, <a href=\"https://github.com/marionettejs/marionette.inspector\">Marionette Inspector</a> is a great new tool for debugging Marionette apps, and it’s primary developer, Jason Lastner gave a <a href=\"https://www.youtube.com/watch?v=jbGm3mJXh_s\">great talk</a> describing how to use it at BackboneConf this week.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        Marionette also contains a 4th View type, CompositeView.  But it's essentially a helper for the case where you want to display a CollectionView inside a region of a LayoutView, and isn't strictly necessary.  Technically you can also use LayoutViews to replace ItemViews, but the semantic difference is useful for encouraging readability.\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/12/22/building-complex-layouts-with-marionette-js"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","marionette","javascript"],"category":"frameworks","key":null,"title":"Marionette Explained: Connecting Data to Your Views","description":"How to bind data to your views in Marionette.js","layout":"post","path":"/2014/12/10/marionette-explained-connecting-your-data-to-your-views","date":"2014-12-10T12:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the second post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>.  For more background on what Marionette is, check out the first post in the series, <a href=\"http://benmccormick.org/2014/12/02/the-case-for-marionette-js/\">The Case For Marionette</a>.  Also note that this article was written about Marionette v2.  The current latest version of Marionette is v3, and while most of the high level concepts remain the same, the specific syntax has changed in some cases.</em></p>\n<p>One of the most interesting design choices of <a href=\"http://backbonejs.org/\">Backbone</a> was the decision to not provide a default render function for Views. Backbone Views by default are an empty function that adds nothing to the DOM when rendered.  Although a View can have a Model or Collection associated with it, there is no built in way to associate that with the generated View.  When you contrast that to other modern frameworks like Ember, Angular and KnockoutJS, and their emphasis on using 2 way bindings to associate a data object to a rendered View, Backbone can feel a bit incomplete.  The goal is to allow for a variety of rendering approaches, without making one of them a favored approach.  But it leaves a situation where choosing a rendering procedure is one of the first steps in any new Backbone project.  Marionette provides a structured approach for binding your data to your view layer, while still providing flexibility to introduce customization.</p>\n<h3>Rendering and Data-Binding in Marionette</h3>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 570px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 44.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqUlEQVQoz2P49vP3/MM3J+2+cvT2i//////79+8/GECoXVeeTNh1ZdmJO3/+QsWRAcOLj9+MG9Yrlixv2nAOyP8LUwQxpGDZMfmS5R69237+/gM3EaH51advju2b9WrWdG07D9IMthpoz2+wKRWrTujWrA6evOvHr98gzUDpP38gCKT599+/lx+9PHXn6bP3n8GaoVZDyIevP56+++zGszdgjX/RnQ3SAHTSrz8ffnx69P4pkPv91+/9159dePQGouLP95+fvn16+O4xkP3+9o3z/a2XpvVcnNr94/07hi8/v846tXjOqSUdhyYHLE188+1Fz/bLymXL9WvXHLn56tjjYz0Hp/cfnemxIPzW56cvD+5daam60dNyraPBx4f3GD58/9iwv6fpQF/xjgbnBWGPPz6oXnVGp3q1bvWq7Reebrm1tWhHQ/WedosZnufe3X51YO8Kc5Wtwc5rHfQ+ATXDo+fl59cXnl4BMt58+jp554XVJ2/DYu3/u28fzj25BFJz4cz+nPiDJWkHS9K/vn4J0gwJPnBQAdWjRAdQ8M9fkCxI6h96VAMALtbIblSMWu4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"rendering diagram\"\n        title=\"\"\n        src=\"/static/c46f3a6beda389f53c3b773508f44dee/a9e6e/renderpattern-3.png\"\n        srcset=\"/static/c46f3a6beda389f53c3b773508f44dee/40f08/renderpattern-3.png 143w,\n/static/c46f3a6beda389f53c3b773508f44dee/d4502/renderpattern-3.png 285w,\n/static/c46f3a6beda389f53c3b773508f44dee/a9e6e/renderpattern-3.png 570w,\n/static/c46f3a6beda389f53c3b773508f44dee/8ff1e/renderpattern-3.png 800w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n      />\n  </span></p>\n<p>Marionette.JS handles rendering in a way that is similar to the <a href=\"http://en.wikipedia.org/wiki/Model_View_ViewModel\">Model-View-ViewModel</a> pattern that developers who have used KnockoutJS or Durandal will be familiar with <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>. Marionette implements its render cycle through 2 primary methods available in all of its base View classes.  The first is <code class=\"language-text\">serializeData</code>. serializeData is a function that produces what is essentially a <code class=\"language-text\">ViewModel</code> in the sense of an MVVM application. It takes your data (a Backbone Model or Collection), and pulls it into a simplified form that a View can easily render.  By default Marionette will simply call the Model or Collection’s <code class=\"language-text\">toJSON</code> function to serialize the Backbone object down into a simple JavaScript object.  But it’s possible to override serializeData to provide more complicated logic.  For instance here’s an example from the <a href=\"https://github.com/tastejs/todomvc/tree/gh-pages/examples/backbone_marionette\">Marionette TodoMVC project</a> that takes a collection of todos and calculates a few values to show the number of completed todos.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">serializeData</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> active <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">getActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> total <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        activeCount<span class=\"token punctuation\">:</span> active<span class=\"token punctuation\">,</span>\n        totalCount<span class=\"token punctuation\">:</span> total<span class=\"token punctuation\">,</span>\n        completedCount<span class=\"token punctuation\">:</span> total <span class=\"token operator\">-</span> active\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Once the serialized data/view model has been prepared, data is passed to the render function which starts by looking for a template to render.  In Marionette, templates are defined by setting the template property on your View, or by setting a getTemplate method if you want to conditionally load your templates. The render function takes that template, passes it the serialized data, and renders it using a template engine.  The default Marionette template engine is Underscore, which makes sense since it’s a Backbone dependency already.  But it’s easy to switch to a different templating engine.  Here’s the entire chunk of code I wrote to use Handlebar templates in Windsor Circle’s Marionette app.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//render templates with Handlebars instead of Underscore</span>\nBackbone<span class=\"token punctuation\">.</span>Marionette<span class=\"token punctuation\">.</span>Renderer<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">render</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">template<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> renderer <span class=\"token operator\">=</span> Handlebars<span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span>template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">renderer</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>ItemView and CollectionView</h3>\n<p>Marionette provides several View classes that you can use as bases, but the core Views for representing data are ItemView and CollectionView.  An ItemView takes a single data object, either a Model or Collection and passes it to the template to render.  A CollectionView iterates over a Collection and renders a child View for each Model. You can either use the same View for every Collection, or mix and match Views based on the Model’s properties.</p>\n<p>So for instance, views for a simple todo list might look something like this <sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> TodoView<span class=\"token operator\">=</span> Marionette<span class=\"token punctuation\">.</span>ItemView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    tagName<span class=\"token punctuation\">:</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span>\n    template<span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;span class=\"checkbox\" {{checked}}>&lt;/span>&lt;span class=\"text\">{{ text}}&lt;/span>&lt;span class=\"delete\">&lt;/span>'</span><span class=\"token punctuation\">,</span>\n    events<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'click .checkbox'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'toggleChecked'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'click .delete'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'deleteItem'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">serializeData</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            checked<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'checked'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">'checked'</span><span class=\"token punctuation\">:</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">toggleChecked</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//logic for checking the box</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">deleteItem</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//logic for deleting the todo</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> TodoListView <span class=\"token operator\">=</span> Marionette<span class=\"token punctuation\">.</span>CollectionView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    childView<span class=\"token punctuation\">:</span> TodoView<span class=\"token punctuation\">,</span>\n    tagName<span class=\"token punctuation\">:</span> <span class=\"token string\">'ul'</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When the TodoListView is given a collection and rendered, it will display an unordered list of rendered TodoViews, with the data for each model bound to the template object associated with TodoView.</p>\n<h3>A brief note on 2 way data-binding</h3>\n<p>Marionette data-binding is one-way by default.  Over the last few years the discussion around data-binding has gone from “cool there’s structured data-binding” when Backbone first came out, to “how can you ship without 2-way data-bindings?” when Knockout, Angular and Ember popularized the 2-way approach, to “1 way bindings keep things simple and they’re cool again” based on the popularity of React.  I’m not going to go deep into that debate during this post, but the important takeaway is that Marionette generally prefers explicit bindings to implicit.  So when model values change, it will be based on code that you’ve written, not implicit library code.</p>\n<h3>Wrap-Up</h3>\n<p>I kept things pretty simple in this post, but consistent data binding is a core part of what Marionette provides.  Having a single documented system for attaching Model and Collection data to Views is a big win for keeping Backbone applications lean and readable.  When using these conventions you can move from View to View or project to project and quickly pick up on the intent and structure of the code.  Instead of trying to solve these problems for every  View, you can rely on the experience of others and focus on writing code to achieve your application’s goals.</p>\n<p>This was a short but important start to diving deeper into Marionette. I’ll talk more about layouts, view life-cycles, and other Marionette features in future posts, but at their heart, web applications are about exposing data in rich UIs.  Without that core, your web applications won’t have much function at all.  So make sure to understand and take advantage of this aspect of Marionette before you move on to anything else.</p>\n<h3>More Resources</h3>\n<ul>\n<li>If you absolutely must have 2 way data bindings in Backbone, <a href=\"http://nytimes.github.io/backbone.stickit/\">Backbone.stickit</a> is a good project to check out.  At Windsor Circle we use it for binding model data to forms (2 way data-binding’s best use case).  Rather than the template based approach most libaries use for 2 way data-binding, stickit allows you to configure bindings declaratively in your view code.  </li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        MVVM is normally associated with 2 ways bindings though, which Backbone and Marionette do not provide\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:2\">\n        <p>\n        In practice Marionette developers would likely use a ui hash on the TodoView, pull the template out into a separate file, and might have the CollectionView be a CompositeView to provide structure around the list.  But I'll dive into all of those things in more detail in future posts.\n        </p>\n        <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/12/10/marionette-explained-connecting-your-data-to-your-views"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javascript"],"category":"frameworks","key":null,"title":"The Case For Marionette.js","description":"Making the case for Marionette.js as a framework for front end development","layout":"post","path":"/2014/12/02/the-case-for-marionette-js","date":"2014-12-02T01:53:52+00:00","dontfeature":null,"isDraft":null},"html":"<p>Building large web applications using <a href=\"http://backbonejs.org/\">Backbone.js</a> can be hard.  Backbone is a great tool, but it’s designed to be minimalist and useful in a wide variety of situations.  As a result, you get less guidance and support from the tool as you scale up than you do from more opinionated frameworks like <a href=\"https://angularjs.org/\">Angular</a> and <a href=\"http://emberjs.com/\">Ember</a>.  When a Backbone application grows, maintaining it requires adding structure, either through a custom set of conventions and components, or based on somebody elses framework.  There are a lot of different Backbone frameworks out there, but I want to make the case for using <a href=\"http://marionettejs.com/\">Marionette.js</a>.  </p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0c7dbedbcc10868db2db704e69cd9ad/2dcf9/marionettelogo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 355px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 124.7887323943662%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFYElEQVQ4y3WVe0xTVxzHW3TukWwucxPl0fbe9va+ykPoA5WgZuzhlmxzuqmZc+4lf7jNOTX4GkuMqEXepa3yEkoFKshUBGUKDtAyVFqgwgCrWczccFm2mWxZpI+z37m0cE3YSX75nXvO93x+v/O8EgmU9o5ObLNw/VL79+s7LncNO3uurR0duz1HMkNpOt2c1nDqdE/L+e9q8LfNXifFjKlyruWCpLyiSgDW2OsyqqrtCMDoQtul37u6nVl9roGoc61tTzY2ndlYW98wCEBUWn4clVVU2fGY7Tt3SesdjY9GPXDQGPYLd+3ep9/21c43CwpNrScbvkUQ8EGdo/GuvdaB8guKb27fkflh5q692oOHj9B4TIn5qPQRmOfmj5ISyzGhEXwCZPGMZ3h0IQAqj5ZWIGNO3m+HjLljFZXVGN4/Mupd0Xax4zmT+Wg8HlNcYpVW2U5MwtyEGkOERvxdZLLElVdWx8ASjBabLGOHjbmbv9y24/m4uMTHsg8a0yGbBvuJet+ppjOrDufkqUJAwdwkJOwm1QK4ee17whpa8gqTbQcOzc3OyUvI2vtN7Eyb8vX+7LRjOzKfsOYX6dqXp88eefaFiPb0V6cFN9T81Brs6boiRBjbvWe2ubpGtw7qMOWIIzaboDHX1VO1ZguB6/sud3LiQC6cHKQpDU2ddSmZj3uSDVVuFdPcG6vy2Fauzn0dIeHomBiDMIO8zVs3tRHcoEdBXXQu0jf0UdxWt4Ja4qI4aYgaApJ09y8UjwYVFPKqWORW0KhRrUXVK1evCmdQ8cmWeQW0YfySjEW3QTNEqNFtJWhJ2uci1JFTqfYpmacgynC/mkftusUTg3KVr5tgJ05Gc6hexo875HEy4QRE8W3mSA6dimUfDilU/s4kg7+XjfcNQBLAWCSaOz0fgPcxsGvp8sBgLBnsiNchW2Kq76wA1fSWRGtsFQDLp3R+R1IquhlLBHsSdUFnsiEwLFehPhX7mhioAOC/LhqAi9OCkCG6rGAD1foXg/akNH9jNIvKIllkorSBgpSXg3WKuIBHpkQ98cnBq9oU/6hcyHDDNFDJqPsh7etsPOo2LMXAYCfBIUcUi+y6Ff6apLSAhdb7TCkvBQqjeHQSAnhAA0B0NTnFfwvGAiNDDGRh19A1LiF4Rb/EPwJ1J8mcPSHTeJthyvbkZX+al7wybgVYwQLuYZOcq/XIlYEfMFCb4vNOAj8XA5lp4FLfHYJGg0p6vzUmnoD1+6sphkeWSCZQGqVBxoWad70UvWwU9AD0i4CfiYEUrGHwOhOHulNSfV44Dn0kU4r7GmU8WSfTuK3R/IPiKP4t4SIomXVj08DwlDeLN0UGwL9damFTJm4BENpqwv3HY/iny2N4mSiBTXdAA8CJq9rFsCnCLq8XZzgPgD8P0BrUmbp8YkwhAFtx33k5Ozusa5Exj4f0234CoDPJMOFM0geGJoHp0web4mbB1RvwUByI9PeGJzPsxX3DpFrqiOWl5dG8tJ9UzwrNKNtL0qgnUXvvBs3/M4D1SoaWhK5cWNR0V8WhEdiQuwCGAH9A39yQRgr9EhdBR4TuffM4LM8IQPHVg757rpB26vkCEQGNb4B9BPUs8AUAWhAGuieB4TXfA5oj4DPA3gZLeAch8bNDS2d693BWIWAENlfIS/6nFB4rjxAPIvGdBuMh66m/HbTLZhqMwbARU7oia+kaU4nVJAlHBL8brAamchb8B2Dvuwl6I/hMsA3CN0l/AbYKbAtYLgTPA/2neJlKD+WsAWiWGLgBOlvBl4E54H1zg98J3gQeB7kIZgZrB0ALtBeB3gj103Dkzg3Nj56b8ev9Of8BPFfACKJ2lRAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Marionette Logo\"\n        title=\"\"\n        src=\"/static/a0c7dbedbcc10868db2db704e69cd9ad/2dcf9/marionettelogo.png\"\n        srcset=\"/static/a0c7dbedbcc10868db2db704e69cd9ad/40f08/marionettelogo.png 143w,\n/static/a0c7dbedbcc10868db2db704e69cd9ad/d4502/marionettelogo.png 285w,\n/static/a0c7dbedbcc10868db2db704e69cd9ad/2dcf9/marionettelogo.png 355w\"\n        sizes=\"(max-width: 355px) 100vw, 355px\"\n      />\n  </span>\n  </a></p>\n<p>I’ve been using Marionette for the past year, and it’s been incredibly valuable.  It’s really helped ease a lot of the initial issues I found with scaling out Backbone.  But there was one big issue with Marionette when I started with it. It was not simple to figure out how exactly I should be using it.</p>\n<p>When I start to use a new piece of software, I’m always hoping to see 2 types of documentation.  The first is the nitty-gritty stuff that most people associate with documentation.  What are the APIs available, what can you pass to them, what components, features, or functions does it provide?  The second type is what I think of as the “story telling” documentation.  It overlaps a bit with marketing, but basically it’s the documentation that explains the value of the software, gives you ideas on how you might use it, and outlines the philosophy that lead to the tool.  Without the first type of documentation you end up with an exciting idea that you may struggle to implement.  Without the second type, you can end up with a lot of nice tools that you aren’t sure how to combine together.</p>\n<p>Marionette is great, but it’s a tool that doesn’t have much of the story telling documentation I mentioned above.  It gets off to a good start, with the following intro on its website:</p>\n<blockquote>\n<p>Backbone.Marionette is a composite application library for Backbone.js that aims to simplify the construction of large scale JavaScript applications.</p>\n</blockquote>\n<blockquote>\n<p>It is a Collection of common design and implementation patterns found in the applications that we have been building with Backbone, and includes pieces inspired by composite application architectures, event-driven architectures, messaging architectures, and more.</p>\n</blockquote>\n<p>But the site fails to follow through on explaining the values or philosophy that went into building it.  Instead, when you start with Marionette you’re left with a bunch of components that are well documented individually, without much guidance on how to put them together or use them.  Any explanation of the value added is scoped to an individual component in the docs, and there’s no real indication of why these particular components are bundled together. I’m going to try and provide this type of high level explanation of the value that Marionette can bring, laying out the big picture in this piece and then digging into each area of value in future posts.  To start, let’s look at the problems that Marionette is trying to solve.</p>\n<h3>Decisions, Decisions</h3>\n<p>Developing with Backbone is an exercise in decision making.  Backbone provides you with a minimalist set of Models and Collections that essentially serve as light wrappers around JavaScript objects synced over Ajax. It provides you lightweight Views that associate an object with a DOM node and some data.  It provides a router that associates URLs with function, and it provides helpers for managing events between all of these options.  That leaves Backbone developers with many questions to answer.</p>\n<ul>\n<li><strong>How do you render Views?</strong> - By default, Backbone’s render method does nothing. To use it, you need to fill in your own rendering function.  That could use a templating system like Underscore templates or Handlebars, jQuery manipulation of the DOM, or simple string inserts with <code class=\"language-text\">.innerHTML()</code>.  You could use the same method for every View, or mix it up and use different methods for different Views.</li>\n<li><strong>How do you manage relationships between objects?</strong> - By default Backbone provides a way to manage sets of Models as a Collection, but it doesn’t have any built-in utilities for handling nested Models or Collections.  And if you want to nest your Views you’re completely on your own.  You can have a View manage it’s child Views, have a single object that manages all Views, or let each View manage itself.</li>\n<li><strong>How do your Views communicate between each other?</strong> - Views will often need to communicate with each other.  If for instance one View needs to change the contents of another area of the page, it could do so directly through jQuery, could get a direct reference to a View managing that area and call a function on it, change a Model that another View listens to, adjust a URL that a router listens to, or fire an event that another View could respond to. Apps can use some combination of all of these methods.</li>\n<li><strong>How do you avoid repeating yourself?</strong> - If you’re not careful, Backbone can involve a lot of boilerplate.  Taking the naive approach, you could end up writing rendering code, View management code and event management code over and over again in every View.  If you try to get around that using inheritance, you can end up with brittle designs that require you to make calls down to a Views prototype when you want View specific code.  Avoiding that type of repetition and the maintenance overhead it brings is a challenge.</li>\n<li><strong>How do you manage a View’s life-cycle??</strong> - What code is responsible for rendering a View?  Does it render itself on creation?  Or is it the responsibility of the object creating it?  Does it get attached to the DOM immediately on render? Or is that a separate step?  When the View is removed from the DOM or deleted, how do you handle any cleanup that is needed?</li>\n<li><strong>How do you structure your application?</strong> - How do you get your app started?  Do you have a central object that starts everything, or is it more distributed?  If you do centralize, do you use the router to start things, or provide some other object for managing your code?</li>\n<li><strong>How do you prevent memory leaks?</strong> - If your application is a <a href=\"http://en.wikipedia.org/wiki/Single-page_application\">Single Page Application</a> or it contains long lasting interactive sections, another issue that you may need to deal with is memory leaks.  It can be easy to create “zombie Views” in Backbone if you’re not attentive to the need to unregister events attached to a View after you’re done with it.</li>\n</ul>\n<p>That’s just a small sample of the type of decision making that you have to make for a Backbone project.  Those questions signify flexibility, but they also represent mental overhead.  If you’re like me, you see these common problems and think that you can get better results relying on a shared solution that leverages the experience of the community.  </p>\n<h3>What does Marionette Give You?</h3>\n<p>Marionette is an attempt to provide this type of shared solution, capturing Backbone best practices as a set of components and design patterns.  So what value does it provide?  Marionette gives you:</p>\n<ul>\n<li><strong>A Standardized Rendering process</strong> - Marionette takes an opinionated stand on how Views should be rendered.  Without any additional configuration, it will take a template that you specify with a View’s template property, compile it with Underscore’s templating function and pass it a model or collection.  If you need to pass it other data, or want to use a different template library, Marionette provides hooks to customize that process in a <a href=\"http://en.wikipedia.org/wiki/Don%27t_repeat_yourself\">DRY</a> way.</li>\n<li><strong>A consistent View lifecycle</strong> - Marionette defines a consistent View life cycle where Views are initialized, rendered, shown, refreshed, and destroyed.  Each of these events has events and callbacks associated it, and any common boilerplate associated with them is handled behind the scenes.</li>\n<li><strong>The ability to define and manage complex layouts</strong> - Marionette provides region objects that define portions of the DOM that can display and swap out Views.  Combined with utilities to manage child views, you can easily create deeply nested View structures with Marionette while minimizing complexity.</li>\n<li><strong>A central event bus with semantic events to simplify communication between Views</strong> - Marionette includes Backbone.Wreqr or Backbone Radio as an event bus to allow communication between Views without explicitly coupling them.  </li>\n<li><strong>Helpers to help you write DRY Code</strong> - In addition to centralizing the rendering and view management code, Marionette provides hooks to allow you to abstract away details of the DOM and events in your View code, and a mechanism to pull common ui operations out into separate reusable objects</li>\n<li><strong>Helpers to avoid “Zombie Views” and memory leaks</strong> - Marionette’s lifecycle includes an explicit destroy phase that cleans up many common sources of memory leaks, and provides a hook for you to take care of the rest</li>\n<li><strong>A central Application object to initialize your application</strong> - Using Marionette, you’re able to specify a set of initializers that run any code that needs to be executed before your application starts, providing a clear structure and starting point to your app.</li>\n</ul>\n<p>That’s not the complete feature set, but it is the essential sales pitch.  I’ll be digging deeper into each of these advantages over my next few posts, but the important thing to understand is that Marionette provides a framework for building Backbone apps that builds on established practices from the community.  If you’re building a Backbone application and want to focus on the problems that are specific to your application, Marionette is a great way to move past common issues and focus on what’s unique to you.</p>\n<h3>More Resources</h3>\n<ul>\n<li>For a practical introduction to Marionette, you could do much worse than <a href=\"https://www.youtube.com/watch?v=PrQSpdWkN6Q\">this talk</a> from the recent Nodevember conference.  Jeremy Fairbank, a member of the Marionette core team, explained how you can use Marionette to improve the architecture of your Backbone apps.</li>\n<li>The resource that best helped me understand Marionette isn’t technically about Marionette at all.  Derek Bailey’s book <a href=\"https://leanpub.com/building-backbone-plugins?a=3a4Srv2pP9p87WQ_eoDoGp\">Building Backbone Plugins</a> lays out the philosophy and thinking behind Marionette without directly referencing it, explaining the challenges that he faced in building a useful abstraction over Backbone.  You can read my <a href=\"http://benmccormick.org/2014/07/09/understanding-the-backbone-mindset-a-review-of-building-backbone-plugins-by-derick-bailey/\">full review</a> if you’re interested, but I highly recommend it for any Backbone developer as a way of better understanding how to structure your Backbone applications.</li>\n</ul>","fields":{"slug":"/2014/12/02/the-case-for-marionette-js"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javaScript"],"category":"frameworks","key":null,"title":"The Life of a Marionette View","description":"A breakdown of the lifecycle of Marionette Views","layout":"post","path":"/2015/01/05/marionette-view-life-cycles","date":"2015-01-05T04:01:45+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the fourth post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>, a framework for developing apps with <a href=\"http://backbonejs.org/\">Backbone.js</a>.  For more background on what Marionette is, check out the series page: <a href=\"http://benmccormick.org/marionette-explained/\">Marionette Explained</a>  Also note that this article was written about Marionette v2.  The current latest version of Marionette is v3, and while most of the high level concepts remain the same, the specific syntax has changed in some cases.</em></p>\n<p>When building Single Page Applications, it’s important to manage UI components throughout their existence on the page, making sure they’re properly created, attached, and destroyed.  Marionette.js helps Backbone developers manage that by providing life cycle methods that developers can use when defining their Views.  These life cycle functions fit nicely with the rest of Marionette’s features, and can help simplify UI development with Backbone.</p>\n<p>Building scalable user interfaces is hard.  It’s a challenge that sits at the intersection of fields requiring very different skill sets: Software Development, Graphic Design, User Experience and Information Architecture.  Because interface code is concerned with both presentation and interaction logic and is exposed directly to user input, it can be difficult to reason about.  Fortunately, as modern web developers, we have 30+ years of industry knowledge to fall back on.  One lesson learned is the value of Object Oriented Programming concepts in UI design; specifically, the idea of breaking interfaces into a set of independent components, and giving each component a consistent “life cycle”, a set of events that occur between a component’s creation and destruction.</p>\n<p>Having a clear life cycle for UI components makes a developer’s life easier in a few ways:  It eases the process of reasoning about changes in a component over time, and how it interacts with other elements of the UI.  It creates consistent hooks to add behaviors, which promotes readability and reduces boilerplate code.  Finally, it smooths integrations with outside code that may need to be run when the component is in a specific state, without needing a bunch of conditional logic to detect when it should run.  Marionette Views provide a life cycle for Backbone Views that help give all of these benefits.</p>\n<p>The Marionette View life cycle is made up of a list of events and conventions.  Events are fired at each signficant step in a View’s life cycle.  Each event has a corresponding View method associated with it that Marionette automatically runs when the event is fired. These events and callbacks follow a consistent naming convention.  An event that occurs before a moment in the life cycle is fired in the form <code class=\"language-text\">before:&lt;eventname&gt;</code> and the callback is called <code class=\"language-text\">onBeforeEventName</code>. An event that is fired after the same moment in the life cycle will have the form <code class=\"language-text\">eventname</code> and the callback will be called <code class=\"language-text\">onEventName</code>.  By default the callback functions for each event do nothing, but developers can overwrite them to define behavior for a specific View instance.  For instance, defining the callback functions for the <code class=\"language-text\">render</code> and <code class=\"language-text\">before:render</code> events on a new View would look like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> ExampleView <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>ItemView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token function-variable function\">onRender</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// do stuff after the View is rendered</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">onBeforeRender</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// do stuff before the View is rendered</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Render is only one of the relevant moments in a View’s life cycle.  This is the full list of relevant methods and events, with a brief explanation of how each one might be used.</p>\n<h4>Initialize</h4>\n<p>The first function in a View’s life cycle is <code class=\"language-text\">initialize</code>. <code class=\"language-text\">initialize</code> isn’t a Marionette-specific method. It’s part of Backbone, but it’s important to make sure you understand where it fits into the View’s life.  Backbone provides two functions that are run when a View is instantiated, <code class=\"language-text\">constructor</code> and <code class=\"language-text\">initialize</code>.  <code class=\"language-text\">constructor</code> is used for Backbone and Marionette’s internal setup, and shouldn’t normally be overridden.  <code class=\"language-text\">initialize</code> is the suggested function for defining behavior on View setup.  It’s a great place for setting up event listeners, and allows workings directly with the options passed to the View on creation <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>. Unlike the other methods on this list, <code class=\"language-text\">initialize</code> only provides a single method with no associated event.</p>\n<h4>onRender/onBeforeRender</h4>\n<p>The second step in the Marionette View life cycle is the render step, which exposes two events <code class=\"language-text\">render</code> and <code class=\"language-text\">before:render</code>, corresponding to the <code class=\"language-text\">render</code> and <code class=\"language-text\">onBeforeRender</code> callbacks.  These events fire before and after the View template is rendered.  In a Marionette View, rendering means that the View has generated a fragment of HTML, but it may or may not be visible or attached to the DOM.  onRender is useful for any direct manipulation of the generated HTML that doesn’t require it to be visible or attached to the DOM.</p>\n<h4>onAttach/onBeforeAttach (Marionette 2.3+)</h4>\n<p>After rendering, the next set of events that might fire in a Marionette View’s life cycle is <code class=\"language-text\">before:attach</code> and <code class=\"language-text\">attach</code>.  These events are fired whenever showing a View in a region causes it to be attached to the DOM.  Because Views can be rendered independently of Regions, and some Regions may not be attached to the DOM when a View is shown, this event may not always be fired immediately (or at all).  But if you’re using Regions to render all your Views, it can be very useful for setting up jQuery plugins or other operations that require HTML to be attached to the DOM before being acted on.  A nice aspect of the attach events is that they will propagate down a tree of LayoutViews if you’ve set up a View hierarchy as described in <a href=\"http://benmccormick.org/2014/12/22/building-complex-layouts-with-marionette-js/\">my last post</a>, so you can count on the event firing even if you build the View tree and then attach the top View to the DOM later.</p>\n<h4>onShow/onBeforeShow</h4>\n<p>Another Region-specific set of events, <code class=\"language-text\">show</code> and <code class=\"language-text\">before:show</code> fire before and after a View is shown within a region.  These events are great for rendering child Views.  The Marionette docs recommend using <code class=\"language-text\">onBeforeShow</code> specifically for rendering children, since it allows for only a single DOM paint when rendering nested Views, and prevents attach events from firing multiple times, which might happen if the child Views are attached to the parent after the parent View has already been shown.</p>\n<h4>onDomRefresh</h4>\n<p>The <code class=\"language-text\">dom:refresh</code> event is the last Region-specific event  It’s triggered after an already shown View is rerendered.  Like onAttach, this can be useful for managing UI plugins that manipulate the DOM, if they need to be reinitialized when the HTML tree is refreshed. It differs from <code class=\"language-text\">onRender</code> in that it will not run the first time the View is rendered, and you can count on the View always being attached to the document when it fires.  So if an operation requires the View to be attached to the DOM, you can run any initial logic in <code class=\"language-text\">onShow</code>, and then put any refresher logic into an <code class=\"language-text\">onDomRefresh</code> callback.  If you’re running Marionette 2.3 or later though, onDomRefresh is less useful because onAttach provides similar functionality in a more consistent way.</p>\n<h4>onBeforeAddChild/onBeforeRemoveChild/onAddChild/onRemoveChild (CollectionView Only)</h4>\n<p>CollectionViews get their own special life-cycle events to manage adding and removing Models to the Collection.  CollectionViews automatically display a new ChildView when a Model is added to its Collection, and destroy the View when the Model is removed.  They fire events before and after each of these changes, to allow you to customize the behavior around each.  You could for instance hide specific Views if necessary. You could also modify them based on some logic, though that type of thing may be more appropriate within the child View’s code itself.</p>\n<h4>onDestroy/onBeforeDestroy</h4>\n<p>The final Marionette life-cycle event set is <code class=\"language-text\">destroy</code> and <code class=\"language-text\">before:destroy</code>.  Appropriately, these events are fired when a View is destroyed and serve as a place to handle any custom cleanup.  The most common use case for these functions is unbinding any events not covered by Marionette’s built-in event cleanup<sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>. It’s worth noting that you cannot use <code class=\"language-text\">onBeforeDestroy</code> to prevent the View being destroyed.  The Marionette team’s position here is basically that you should not call destroy directly on any View you don’t want destroyed.  If you’re swapping a View out of a region but don’t want it to be destroyed, Marionette provides a <code class=\"language-text\">preventDestroy</code> option to its show method that allows you to preserve the existing View.</p>\n<h3>Cogs In A Machine</h3>\n<p>The nice thing about Marionette’s View life cycles is the consistency it shares with the rest of Marionette.  The life cycles are built to work with the Region and Layout system I described in my last post.  If you lay out your Views using the system described in that post, you’ll be able to take advantage of all of the above functions consistently across your application.  Regions themselves have similar life cycle methods, with callbacks that run before and after showing Views, swapping Views and emptying the region. Finally, Marionette Applications, the object that Marionette uses to initialize the app, also has a single set of life-cycle events, <code class=\"language-text\">onStart</code> and <code class=\"language-text\">onBeforeStart</code> that can be hooked into when setting up your application.  This sense of cohesiveness in a set of components that share conventions makes Marionette easy to learn without obscuring what happens with the type of magic you see in other frameworks.</p>\n<h3>Take What You Need</h3>\n<p>Like everything else in Marionette and Backbone, life cycles are a pattern that you can choose to use or ignore.  If you want to define your own way of managing a Views life cycle, it’s perfectly possible to do so.  But the advantages provided by Marionette’s implementation are quite nice.  It presents a simple mental model of what occurs to a View over time, fits in with the other patterns provided by Marionette, and doesn’t require any extra boilerplate when you choose not to use them.  I personally use some of these methods a lot, and have never used a few of them at all.  But it’s helpful to know what is available so that you can keep that simple model of how a View changes over time and choose the appropriate hook for any given View code.  Code is scalable when you can take a few simple concepts and use them repeatedly to build up to something big.  That’s what Marionette can do for you.</p>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        Marionette also exposes those options later using the <code>view.getOption()</code> method\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:2\">\n        <p>\n        Marionette cleans up events created through its event hash objects, and any defined using listenTo.  But any custom eventing stuff you do will need to be cleaned up directly\n        </p>\n        <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2015/01/05/marionette-view-life-cycles"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-es6-1","topics":["backbone","javascript"],"category":"frameworks","key":"bb-radio","title":"Building Modular Web Apps With Backbone.Radio","description":"An overview of using Backbone.Radio in Marionette apps","layout":"post","path":"/2015/01/26/backbone-radio","date":"2015-01-26T12:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the fifth post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>.  For more background on what Marionette is, check out the series page, <a href=\"http://benmccormick.org/marionette-explained/\">Marionette Explained</a></em></p>\n<p>One of the great things about Backbone is how it encourages a modular approach to building UIs.  Different portions of the pages are separated into individual Views, allowing you to simplify your reasoning about your code by focusing on bite-sized chunks at a time.  Easier said than done though, right?  In practice, it’s not hard to create Backbone applications with large views that have tight dependencies on each other.  This usually isn’t an intentional decision, but part of a slow decay as developers work to connect the various aspects of their applications.  </p>\n<p>So far in this series I’ve talked about how Marionette makes it easier to create maintainable Views.  Now I’m going to look at <a href=\"https://github.com/marionettejs/backbone.radio\">Backbone.Radio</a>, Marionette’s tool for communication between application components.</p>\n<h3>What’s so hard about modular architecture?</h3>\n<p>There are many advantages to designing your web UI in a modular or component-based fashion.  Your code tends to be easier to reason about and test, it’s easier to swap out one piece of code for another, and it greatly increases the chances that you’ll be able to reuse your code in other places.  Unfortunately for all except the most basic applications, different components of a UI always have to be aware of the things that happen in other areas of the UI.  It may be something simple like responding to a button click by showing a modal, or more complicated like updating multiple dashboard items when the user applies a filter, but these connections will exist.  At this point you have options.  You can begin having components reference each other directly for example, or you could try to capture state within a shared data object that each component watches.  But there’s another solution that borrows from many years of development best practice on backend systems.  You can use a message bus.</p>\n<h3>A simple Message Bus</h3>\n<p>A message bus is a software architecture model for communicating between two systems.  The idea is that instead of referencing each other directly, system components are able to send messages through a shared mediator object.  It’s quite straightforward to create a simple message bus using Backbone.  </p>\n<p>Backbone.Events is Backbone’s event object, which gets mixed into the various Backbone classes to provide the Backbone event functions (<code class=\"language-text\">on</code>, <code class=\"language-text\">off</code>, <code class=\"language-text\">listenTo</code>, <code class=\"language-text\">trigger</code>, etc).  It’s easy and common to mix it into a separate object.  That’s all you need to create a message bus: something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> mediator <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>Backbone<span class=\"token punctuation\">.</span>Events<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now Models and Views can listen to or trigger events on the mediator object, allowing them to communicate without having to be directly aware of each other.  This is a great pattern, and quite useful as is, but there are some limitations.  With a mediator object, all events are global.  Any object can listen to any event, and you have to be careful to avoid naming collisions when using common terms.  It’s also a single object for multiple types of communication.</p>\n<h3>The Backbone.Radio API</h3>\n<p>Backbone.Radio builds on this concept to provide a more powerful message bus.  Instead of a single object, Radio provides multiple “channels” each of which can correspond to a page or functional section of your web app. Also, instead of a single events API, Radio provides three, Events, Commands, and Requests, each built for a different use case.  </p>\n<h4>Events</h4>\n<p>Radio Events are the exact same as our simple message bus.  When you create a channel with Radio, they extend Backbone.Events.  That means you can call any Backbone.Events function on them, or pass them to the <code class=\"language-text\">listenTo</code> method of other Backbone objects.  Events provide Radio’s publish-subscribe functionality.  Multiple objects can subscribe to an event using <code class=\"language-text\">on</code> or <code class=\"language-text\">listenTo</code>.  And any object can publish an event using <code class=\"language-text\">trigger</code>.  For those of you unfamiliar with Backbone’s events, they have two features that you might not expect.  First, unlike native browser events or jQuery events, Backbone events are synchronous; when you trigger an event, all callbacks that are registered on that event run immediately.  Second, it’s easy to pass data with Backbone events.  Unlike native browser events which tend to simply consist of an event and a target, any data you pass when you trigger an event gets passed directly to the callback function, making it a true messaging system.</p>\n<p><img src=\"/events-b0d8f4148e5c2054b5aa69db422ca94a.svg\" alt=\"events diagram\"></p>\n<p><strong>Functions Provided</strong> - <code class=\"language-text\">on</code>, <code class=\"language-text\">off</code>, <code class=\"language-text\">trigger</code>, <code class=\"language-text\">once</code>, <code class=\"language-text\">listenTo</code>, <code class=\"language-text\">listenToOnce</code>, <code class=\"language-text\">stopListening</code></p>\n<h4>Commands</h4>\n<p><strong>Update January 2016</strong> - <em>During 2015, Commands were deprecated from Backbone.Radio as part of their 1.0.0 release.  From a code level, they’re simply a request that doesn’t return a value, so feel free to keep any existing code, but change command to request and comply to reply</em></p>\n<p>Radio Commands are similar to Events, with the distinction that only a single callback can handle or “comply” to a given command.  Commands do not add any functionality on top of events; instead, they provide a semantic distinction and enforce simpler logic.  When <code class=\"language-text\">exampleChannel.command(&#39;something&#39;)</code> is called, you know that it is requesting an action be performed, and you can be confident that there will be no side effects.  Only one object will comply to the command.  Commands are a maintenance-friendly tool; they make your code easier to follow by doing less and doing it more obviously.</p>\n<p><img src=\"/commands-0d940b905285467c9345d4608fafbaa2.svg\" alt=\"commands diagram\"></p>\n<p><strong>Functions Provided</strong> - <code class=\"language-text\">comply</code>, <code class=\"language-text\">stopComplying</code>, <code class=\"language-text\">command</code>, <code class=\"language-text\">complyOnce</code></p>\n<h4>Requests</h4>\n<p>Radio Requests share the one-to-one nature of Commands, but provide functionality not seen in Backbone.Events.  You can use Requests to retrieve information from other objects.  Each request can be serviced by a single response callback, with the request receiving the return value of the callback function.  This is very useful for providing resources in a decoupled manner, where a View or other object doesn’t have to know the details of how an object is stored or retrieved.</p>\n<p><img src=\"/requests-1c9139c16fb2e5f48ac88fba8a3f8116.svg\" alt=\"requests diagram\"></p>\n<p><strong>Functions Provided</strong> - <code class=\"language-text\">reply</code>, <code class=\"language-text\">stopReplying</code>, <code class=\"language-text\">request</code>, <code class=\"language-text\">replyOnce</code></p>\n<h4>Channels</h4>\n<p>Radio Channels are a method of segmenting out your messaging across functions.  Instead of holding every event inside a global namespace, objects can interact with a Channel that’s limited to the functionality they need.  This minimizes the chances of naming collisions across the app, and provides additional semantic guidance for future readers of the code.  It’s much easier to trace through small, focused messaging networks than a large, global one when you’re trying to understand a complex behavior.</p>\n<h3>Backbone.Radio in practice</h3>\n<p>Radio’s API is fairly small and simple.  Its power comes from the development patterns it enables.  The following are examples from my own code of how Radio assists in building modular testable UI code.</p>\n<h4>Decouple your Views with Radio Events</h4>\n<p><a href=\"http://en.wikipedia.org/wiki/Loose_coupling\">Loose coupling</a> is one of the most commonly cited design principles in Object Oriented Programming.  In Backbone, loose coupling can be applied to mean that your Views should know as little about each other as possible.  In my own work I implement this by allowing Views to know about and reference their own child Views, but do not allow them to directly reference any other Views.  If Views need to communicate up or across a tree of Views, I use Radio.</p>\n<p>Radio Events are great for alerting other parts of the application about a change of state.  For instance, in an application where we have a main content area and a sidebar that provides context for the main area (for instance, a mail app like Gmail that shows contact info in the sidebar next to an open email), we could use Radio Events to keep our sidebar in sync with the main content.  That might look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Mn <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.marionette'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> Radio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.radio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> inboxChannel <span class=\"token operator\">=</span> Radio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inbox'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> ContactView <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>ItemView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    template<span class=\"token punctuation\">:</span> <span class=\"token string\">'#contact-template'</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">initialize</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>inboxChannel<span class=\"token punctuation\">,</span> <span class=\"token string\">'show:email'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>showContact<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>inboxChannel<span class=\"token punctuation\">,</span> <span class=\"token string\">'show:inbox'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>showAd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">showContact</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">emailObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//show the contact for the emailObject</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">showAd</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//when we don't have a contact to show, show an ad instead</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> ContactView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Note that our sidebar View doesn’t need to know anything about the inbox area.  The <code class=\"language-text\">show:email</code> event could be fired by our inbox view, by a navigation View, or by our router on page load.  The sidebar doesn’t know and doesn’t care.  </p>\n<p>It’s also important to note that the event represents a change in state external to our component.  Something else changed (the state of the inbox), and the sidebar component is reacting to this.  There might be many coponents that react to this state change, or just this one.  Our View doesn’t know or care.</p>\n<h4>Centralize UI Logic with Commands</h4>\n<p>While Events are a way of notifying other components about a change in state, commands are useful when you want to cause a change in state without having to know the implementation.  For instance, in an application that I work on, we have a centralized event-logging module that can take application events that we want logged and send them to a backend API and also to Google Analytics.  We use commands for this.  In practice the logging module looks a bit like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Radio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.radio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Send event to the backend API and Google Analytics</span>\n<span class=\"token punctuation\">}</span>\n\nRadio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'appEvents'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span>log<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then we can run <code class=\"language-text\">Radio.channel(&#39;appEvents&#39;).command(&#39;log&#39;, event)</code> anywhere we want to log an application event.  We could use events for this, but there’s value in using commands.  We’re explicitly saying that we want our application to log a specific piece of data, whereas a similar event would have the connotation that an event had occured, and anything that wanted to respond to it could.  We can be more confident of what’s happening here.</p>\n<h4>Share Resources Across Nested Views with Requests</h4>\n<p>One of the challenges of nested View architectures like Marionette or ReactJS is deciding how to pass data down to deeply nested View components.  One approach is to pass all necessary data into the top level view and then pass it down along the View tree to whatever View needs it.  That has the advantage of a clear data flow, but the disadvantage of cluttering up parent Views with data they don’t need and tightly coupling the parent Views to the implementation of their children.  Another approach is simply making the data available globally, which has all the disadvantages that global data normally brings.  Radio requests provide a nice solution to this problem.  You can define “data providers” that are responsible for providing any data you need that is not passed directly down a view chain. These could be separate modules similar to Angular’s service objects.  They could be other UI components like a datepicker.  Or they could just be models and collections you define at the root of your application but don’t pass directly to your Views.  In the same application as above, I have a set of task views that can have users assigned to them.  Because these tasks are deeply nested in the UI, I don’t pass the collection of possible Users to assign down the View tree.  Instead, I define that collection within my top level application object and then request it when the user opens up the user-picker View.  I use jQuery deferreds to make sure that the collection has been populated before the picker appears.  That all looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//in app.js</span>\n<span class=\"token keyword\">var</span> usersDeferred <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">UserCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nresourceChannel<span class=\"token punctuation\">.</span><span class=\"token function\">reply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'userlist'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> usersDeferred<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//in task.js</span>\n<span class=\"token keyword\">var</span> usersDeferred <span class=\"token operator\">=</span> resourceChannel<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'userlist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nusersDeferred<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>showUserPicker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>A Quick Note on Backbone.Radio and Marionette</h3>\n<p>Those of you who have used Marionette before may be a bit confused as to why this post is part of my Marionette article.  As of version 2.3, the current shipping version of Marionette, Radio is not distributed as part of the library.  Marionette instead ships with <a href=\"https://github.com/marionettejs/backbone.wreqr\">Backbone.Wreqr</a> as its message bus implementation.  Wreqr is a precursor to Radio with a significantly more confusing API.  Radio provides a cleaner approach, as well as a more intuitive name.  However, because Marionette follows semantic versioning, they’re waiting for 3.0 to make Radio the default.</p>\n<p>In the meantime, though, it’s easy to replace Wreqr with Radio.  You can simply make sure that you’re loading in Radio instead of Wreqr, and then implement the following <a href=\"https://gist.github.com/thejameskyle/48afb443b8c8c6ee4f46\">shim</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(function(root, factory) {\n  if (typeof define === &#39;function&#39; &amp;&amp; define.amd) {\n    define([&#39;backbone.marionette&#39;, &#39;backbone.radio&#39;, &#39;underscore&#39;], factory);\n  } else if (typeof exports !== &#39;undefined&#39;) {\n    module.exports = factory(require(&#39;backbone.marionette&#39;), require(&#39;backbone.radio&#39;), require(&#39;underscore&#39;));\n  } else {\n    factory(root.Backbone.Marionette, root.Backbone.Radio, root._);\n  }\n}(this, function(Marionette, Radio, _) {\n  &#39;use strict&#39;;\n\n  Marionette.Application.prototype._initChannel = function () {\n    this.channelName = _.result(this, &#39;channelName&#39;) || &#39;global&#39;;\n    this.channel = _.result(this, &#39;channel&#39;) || Radio.channel(this.channelName);\n  }\n}));</code></pre></div>\n<p>It’s also worth pointing out that Radio has no direct dependency on Marionette, and can be used on any Backbone project.  For example, it might be an interesting tool to implement a Flux-style dispatcher in an application using Backbone and React. All of the benefits Radio provides can help any application with decoupled View components.</p>\n<p><strong>Thanks to the Marionette Teams for the diagrams above, which come directly from the Backbone.Radio <a href=\"https://github.com/marionettejs/backbone.radio\">README</a>.</strong></p>\n<h3>More Resources</h3>\n<ul>\n<li>Although it’s focused on Node and backend use cases, <a href=\"https://www.youtube.com/watch?v=rWz8OoVuDls\">this video</a> is a great rundown of semantic messaging patterns.</li>\n</ul>","fields":{"slug":"/2015/01/26/backbone-radio"}}},{"node":{"frontmatter":{"readNext":"bb-es6-2,backbone-eco,backbone-devs-react","topics":["javascript","backbone"],"category":"frameworks","key":"bb-es6-1","title":"Why Backbone.js and ES6 Classes Don't Mix","description":"A rundown of the challenges of using ES6 classes in Backbone","layout":"post","path":"/2015/04/07/es6-classes-and-backbone-js","date":"2015-04-07T03:19:44+00:00","dontfeature":null,"isDraft":null},"html":"<p>I’ve seen some confusion out there about how to use ES6 Classes with <a href=\"http://backbonejs.org/\">Backbone</a>.  In the original version of the ES6 class spec, this was actually a simple thing to do, though the syntax wasn’t great.  With the finalized specification for classes and subclassing though, it’s no longer practical to try and use the two together.  Here’s a short explanation of the issues, as well as a discussion on whether any of this matters.</p>\n<h3>What are ES6 Classes anyway?</h3>\n<p>ES6 <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup> is the newest version of JavaScript. It provides a variety of new features for JavaScript developers including native Promises, destructuring, modules and default function parameters.  One of these new features is a native JavaScript Class implementation.  It allows us to simplify class patterns that were formerly a bit verbose in JavaScript.  Take this example of JavaScript inheritance from <a href=\"http://www.amazon.com/gp/product/0596517742/ref=as_li_tl?ie=UTF8&#x26;camp=1789&#x26;creative=390957&#x26;creativeASIN=0596517742&#x26;linkCode=as2&#x26;tag=benmccormicko-20&#x26;linkId=XZEWUV7PCEO7DNTY\">Javascript: The Good Parts</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Mammal</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Mammal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get_name</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Mammal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">says</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Cat</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">=</span> <span class=\"token string\">'meow'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mammal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">purr</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> i<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            s <span class=\"token operator\">+=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        s <span class=\"token operator\">+=</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get_name</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It’s a bit verbose.  With ES6 classes we can instead write:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Mammal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">get_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Cat</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Mammal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">=</span> <span class=\"token string\">'meow'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">purr</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> i<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                s <span class=\"token operator\">+=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            s <span class=\"token operator\">+=</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">get_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This allows us to clean things up a lot, removing some boilerplate and focusing the code on our intended functionality.  ES6 classes work quite nicely for simple JavaScript classes like that.  But what about Backbone objects like Models and Views?</p>\n<p>We might think that we can just treat them as classes and the new syntax will “just work”, similar to how CoffeeScript classes function.  So we’d take this example from the <a href=\"http://backbonejs.org/\">Backbone website</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> DocumentRow <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  tagName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span>\n\n  className<span class=\"token punctuation\">:</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">,</span>\n\n  events<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"click .icon\"</span><span class=\"token punctuation\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"click .button.edit\"</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"click .button.delete\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"destroy\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">initialize</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">render</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>and convert it to something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n  tagName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"li\"</span>\n\n  className<span class=\"token punctuation\">:</span> <span class=\"token string\">\"document-row\"</span>\n\n  events<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"click .icon\"</span><span class=\"token punctuation\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"click .button.edit\"</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"click .button.delete\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"destroy\"</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately this errors out.  So what’s the problem?  It turns out that ES6 classes don’t support adding properties directly to the class instance, only functions/methods.  This makes sense when you understand what is actually happening.  With JavaScript inheritance, properties are generally meant to be set on an instance when its created, while methods are set on the prototype object and shared between every instance.  If properties are added to the prototype directly they will also get shared between every instance, creating problems if the property is an object with mutable state like an array.  You can see that in the following simple example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var testClass = function(){};\ntestClass.prototype.foo = [];\n\nvar testA = new testClass();\nvar testB = new testClass();\n\nconsole.log(testA.foo.length); //0\nconsole.log(testB.foo.length); //0\ntestA.foo.push(&#39;x&#39;);\nconsole.log(testA.foo.length); //1\nconsole.log(testB.foo.length); //1</code></pre></div>\n<p>When we place a property on the prototype it can cause unexpected side effects.  Instead most of the time, we want to use the class’ constructor to add any properties to each new instance.  <del>Since that is a bit unwieldy when adding many properties, Backbone abstracts away this difference with its extend function.</del> <strong>Edit: Backbone actually does add properties directly to the prototype, going against conventions a bit.</strong> But ES6 classes are focused on the prototype, and the code that is shared between instances. They make the opinionated default properties for instances are handled in the constructor. This maps very cleanly to the current semantics for existing JavaScript class creation, but is different than Backbone’s abstraction. So using ES6 classes for Backbone, we’ll need to give up this nicety.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span>  <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"click .icon\"</span><span class=\"token punctuation\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.edit\"</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.delete\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Until recently, this was a valid way of defining a Backbone View with ES6 classes.  It’s questionable whether it was a real gain, given the relative ugliness of the syntax for defining instance properties, but it did work.   Unfortunately, in the final version of the ES6 spec for classes, this is no longer valid.  The final spec requires <code class=\"language-text\">super()</code> to be called before <code class=\"language-text\">this</code> is referenced in a constructor for classes that are extending another class.  So we have to change our constructor to look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span>  <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"click .icon\"</span><span class=\"token punctuation\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.edit\"</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.delete\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately this doesn’t do what we expect. Backbone does significant initialization processing in its constructor, and most properties that Backbone expects to be defined on a Model or View need to be pulled in prior to the constructor executing in order to be used properly.  So with the final ES6 spec we no longer have any way of using declarative properties on subclasses if we want them to be processed by the constructor.</p>\n<h3>So what are our options?</h3>\n<p>There are a few workarounds here, but they’re ugly.  First, Backbone allows any of of its instance properties to also be defined as methods.  So we can rewrite our View like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">className</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">events</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"click .icon\"</span><span class=\"token punctuation\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.edit\"</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.delete\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’re starting to get ridiculous here though.  First, this isn’t a one to one conversion, so if we’re converting existing code, we could develop bugs from any code that directly referenced a View’s properties.  And if that code modified those properties, its no longer as simple to modify them again.  Of course if it’s a property that isn’t processed within the constructor like the <code class=\"language-text\">url</code> property for Models, we can simply leave it as is.  But suddenly we’re requiring ourselves to know what properties are processed in the constructor or not, as well as wrapping and rewrapping properties in functions.  We’ve added a lot of complexity, and it’s not totally clear what we’ve gained.</p>\n<p>The second option is to simply re-run the Backbone View or Model constructor a second time after adding the initialization properties.  This has a few issues though.  First, it’s ugly.  Nobody wants to do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span>  <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"click .icon\"</span><span class=\"token punctuation\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.edit\"</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"click .button.delete\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        Backbone<span class=\"token punctuation\">.</span><span class=\"token function\">View</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But it also opens an opportunity for more subtle bugs.  Constructors aren’t meant to be run twice.  Doing so, will among other things cause the Views initialization function to run twice, with a different <code class=\"language-text\">cid</code> (Backbone’s internal unique id system) set on the View each time. That violates a ton of expectations, again for no clear gain.  So the long and the short of it is that there’s no longer any viable way to use ES6 classes for Backbone objects without a clear loss in functionality and predictability.</p>\n<h3>So Does Any Of This Matter?</h3>\n<p>The idea of using ES6 classes for Backbone has some appeal.  The “class” keyword is nice syntax and there’s an appeal to using more standardized code and fewer library extensions.  Right now, many developers are also just curious about ES6 and how it fits into their workflow.  But does it really matter that this doesn’t work?  I think a case can be made either way, with 2 clear points in each sides favor.  The case for this being a problem:</p>\n<ol>\n<li>\n<p><strong>ES6 Classes are becoming the standard</strong></p>\n<p>By pretty much any standard, Backbone is currently one of the 4 most popular JavaScript frameworks/libraries for building web applications, along with <a href=\"https://angular.io/\">Angular</a>, <a href=\"http://emberjs.com/\">Ember</a>, and <a href=\"https://facebook.github.io/react/\">React</a>.  What do the Angular, Ember, and React teams all have in common?  They’re each working to make sure that current or future versions of their frameworks use ES6 classes to define objects.  As this style of code becomes ubiquitous, Backbone will start to look even more boilerplate heavy and non-standard.  Developers will also start learning about ES6 classes as part of standard JavaScript training, requiring them to map their knowledge about prototypes and class syntax to Backbone’s concepts, rather than just using things they already understand as in other libraries.</p>\n</li>\n<li>\n<p><strong>More Native == Less Library code</strong></p>\n<p>This is more of a far-future advantage, but at some point ES6 classes will be usable everywhere without library support, allowing libraries based on it to include less code for handling this themselves.<sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup></p>\n</li>\n</ol>\n<p>And the case that it doesn’t really matter:</p>\n<ol>\n<li>\n<p><strong>Just because its standardized doesn’t make it reusable</strong></p>\n<p>While it’s true that ES6 classes are a standard, realistically Backbone code written using a class syntax isn’t going to be easier or harder to convert to equivalent code using React for example.  Backbone’s way of using it’s standard functions and properties is a much bigger obstacle to code reuse than the particular way it defines classes.  ES6 classes and Backbone objects are in the end just different syntactic sugar over the same prototypical inheritance concepts.  A developer who understands the concepts will be able to use both, and code written in either style will not be easy to reuse outside the Backbone ecosystem.</p>\n</li>\n<li>\n<p><strong>Sometimes doing it yourself is just better</strong></p>\n<p>The truth is that sometimes there are advantages to writing your own APIs.  Backbone’s class code makes the things that are important to using Backbone easy, without any of the trade offs discussed in this article.  There’s something to be said for using the right interface for the job.  There are trade offs for this, just as their are trade offs in other libraries choice to require or encourage a build step for their code.  Both these choices improve the developer API at a cost (complexity, extra code, extra process, etc).  Whether those trade offs are worth it is a judgment call.</p>\n</li>\n</ol>\n<p>It will be interesting to see how the lack of standardization here effects Backbone in the long run, if it does at all.  Along with native Promises, ES6 now offers 2 major features that are similar to but incompatible with important Backbone features <sup id=\"fnref:3\"><a href=\"#fn:3\">3</a></sup>. Along with ES5’s get and set capabilities and ES7’s Object.Observe <sup id=\"fnref:4\"><a href=\"#fn:4\">4</a></sup>, a significant number of Backbone features that once required library code will someday soon be natively supported. Of course Backbone has never been a set of features as much as a way of writing programs.  Since Backbone is essentially finished and there are <a href=\"https://github.com/jashkenas/backbone/issues/3405\">no plans to significantly change the interface</a>, the continued improvements to the standard language serve as both a validation of Backbone’s core concepts as well as a challenge to its future.   </p>\n<p><strong>Update:</strong> <em>There’s been a <a href=\"https://github.com/jashkenas/backbone/issues/3560\">great discussion of this issue</a> on Backbone’s Github issue tracker.  Feel free to weigh in there if you’re interested in figuring this out.</em></p>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>If you do want to use ES6 now, <a href=\"https://babeljs.io/\">Babel</a> is the best tool for making that happen.  The Babel website also contains a <a href=\"https://babeljs.io/docs/learn-es6/\">great rundown</a> of the various features that make up ES6.</p>\n</li>\n<li>\n<p>Axel Rauschmayer has <a href=\"http://www.2ality.com/2015/02/es6-classes-final.html\">a great article</a> describing the final spec for ES6 classes, including a description of the changes that made them incompatible with Backbone.</p>\n</li>\n<li>\n<p>React Developers have noted the same issues with property initializers that Backbone users encounter.  As part of version 0.13 of React, they’re supporting a special property initialization syntax for classes, which may eventually be standardized.  There’s more info on that in <a href=\"https://esdiscuss.org/topic/es7-property-initializers\">this ESDiscuss thread</a>.  This standard is still being worked out but an experimental support version is available in Babel 5.0.0.  Unfortunately that version defines class properties as being instantiated after the superclass constructor is run, so this doesn’t solve Backbone’s issues here.</p>\n</li>\n<li>\n<p>If you were confused by the discussion of prototypes and the code examples of non-ES6 JavaScript classes, I wrote a quick explanation of <a href=\"http://benmccormick.org/2013/01/12/explaining-javascript-object-oriented-programming/\">Object Oriented Programming in Javascript</a> back in 2012.</p>\n</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        ECMAScript version 6, now officially ECMAScript 2015\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n        <li class=\"footnote\" id=\"fn:2\">\n            <p>\n            This is admittedly a bigger advantage for Ember, Angular 2.0, and React, which all encourage using a build step to convert ES6/Typescript/JSX to ES5 JavaScript.  That means they can all rely on ES6 class support now, since older browser support is handled through compilation.  \n            </p><p>\n            Backbone doesn't require or encourage a transpilation step (although CoffeeScript works very nicely for this case), and so it's more important for it to have a top-notch API supported by all JavaScript engines that it is likely to be run on.  It will be a long time before that is true of ES6 classes.\n            <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n        </li>\n    <li class=\"footnote\" id=\"fn:3\">\n        <p>\n        Promises are similar to jQuery deferreds, which are technically not a Backbone feature, but are a key part of Backbone development for many developers because they're used with Backbone sync.\n        <a href=\"#fnref:3\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2015/04/07/es6-classes-and-backbone-js"}}},{"node":{"frontmatter":{"readNext":"bb-es6-1,backbone-devs-react,mn-series","topics":["javascript","backbone"],"category":"frameworks","key":"bb-es6-2","title":"Backbone and ES6 Classes Revisited","description":"A second look at using ES6 classes with Backbone","layout":"post","path":"/2015/07/06/backbone-and-es6-classes-revisited","date":"2015-07-06T11:22:22+00:00","dontfeature":null,"isDraft":null},"html":"<p>A few weeks ago I wrote <a href=\"http://benmccormick.org/2015/04/07/es6-classes-and-backbone-js/\">an article</a> explaining why the final spec for classes in the ES6/ES2015 version of JavaScript was not usable in Backbone applications.  That post got a lot of great feedback, including this <a href=\"https://github.com/jashkenas/backbone/issues/3560\">discussion</a> with the Backbone core team. The gist of that discussion has been that there are several ways to make ES6 classes work with Backbone now, though they may be less clean than the current <em>Backbone.extend</em> syntax.  But there’s hope for a really great experience: decorators, a <a href=\"https://github.com/wycats/javascript-decorators\">proposed feature for the ES7/ES2016 spec</a>, provide a much cleaner interface when working with Backbone and native classes.</p>\n<p>Let’s start with a quick reminder on the problem that Backbone developers face when adapting ES6 classes.  Both <em>Backbone.extend</em> and ES6 classes serve as syntactic sugar around traditional JavaScript inheritance methods.  So the following code snippets are effectively equivalent:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> ExampleView <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">foo</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and each corresponds roughly to this vanilla ES5 snippet</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">ExampleView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Backbone<span class=\"token punctuation\">.</span><span class=\"token function\">View</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">ExampleView</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ExampleView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ExampleView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">foo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>All of that works fine.  The problem is that even though these abstractions are similar, they’re not quite the same.  Specifically ES6 class syntax supports an opinionated subset of what you can accomplish with plain prototype inheritance.  There’s good reason for this, since many developers don’t understand prototype inheritance and can shoot themselves in the foot.  But ES6 class restrictions don’t mesh well with Backbone’s conventions.  Specifically, Backbone relies on adding properties to a class’ prototype before a class’ constructor is invoked <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.  ES6 classes don’t provide any way to define properties on the prototype as part of the class definition.  They also do not allow you to add instance properties to a constructor prior to calling super() to run a parent class’ constructor.  As a result, properties that are processed within Backbone objects’ constructors like <code class=\"language-text\">events</code>, <code class=\"language-text\">className</code>, <code class=\"language-text\">urlRoot</code> and others can’t be set within an ES6 class definition without resorting to some less than beautiful syntax.  There are however at least 3 different ways of dealing with this problem under the ES6 spec.  I’ll take a look at each of them.</p>\n<h3>ES6 solutions</h3>\n<p>The 3 main solutions I’ve seen proposed for using the current ES6 class spec with Backbone classes are passing properties to the <code class=\"language-text\">super</code> function, creating everything as a method, and adding properties to the prototype outside of the class definition.  I’ll go through those one by one, using <a href=\"https://github.com/tastejs/todomvc/blob/gh-pages/examples/backbone_require/js/views/todos.js\">a view from one of the Backbone TodoMVC implementations</a> as an example.</p>\n<h4>Pass properties to the super constructor</h4>\n<p>The first solution is to define a constructor function for each Backbone object that has properties, and pass the properties directly to the constructor.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Backbone <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'underscore'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> todosTemplate <span class=\"token keyword\">from</span> <span class=\"token string\">'text!templates/todos.html'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Common <span class=\"token keyword\">from</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            tagName<span class=\"token punctuation\">:</span>  <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span>\n\n            template<span class=\"token punctuation\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n            events<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'dblclick label'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'keypress .edit'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'keydown .edit'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'blur .edit'</span><span class=\"token punctuation\">:</span>       <span class=\"token string\">'close'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> isCompleted <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">// hidden cases only</span>\n            <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n            <span class=\"token punctuation\">(</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'active'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleCompleted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> trimmedValue <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">:</span> trimmedValue <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">!==</span> trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">updateOnEnter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>keyCode <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ENTER_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">revertOnEscape</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>which <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ESCAPE_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Also reset the hidden input back to the original value.</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>There are a few advantages to this approach.  It keeps everything within the class definition, and lets Backbone itself manage attaching properties to the prototype, assuring compatibility with existing code.  However it adds a constructor call to a class that otherwise wouldn’t need one, making it less obvious when a developer is actually modifying the constructor to do something important.  It also isolates properties from methods, whereas Backbone philosophically has always treated them interchangeably.  In fact that philosophy is the key to the next solution.</p>\n<h4>Treat everything like a method</h4>\n<p>Backbone evaluates all of its properties using Underscore’s <code class=\"language-text\">_.result</code> function <sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>. <code class=\"language-text\">_.result</code> checks to see if an object property is a function. If it is then <code class=\"language-text\">_.result</code> will evaluate it and return the result.  This allows Backbone to accept its properties as either an object or a function.  Very handy.  So one workaround to the constructor problem is to make everything a method, including properties.  We can actually go one better than this, and use the <code class=\"language-text\">get</code> keyword to make our methods serve as <em>getters</em> for a property.  This means they will be accessible as properties, but defined as methods, retaining compatibility with any existing references if you’re converting existing code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">events</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'dblclick label'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'keypress .edit'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'keydown .edit'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'blur .edit'</span><span class=\"token punctuation\">:</span>       <span class=\"token string\">'close'</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... etc</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>This approach uses only standard class syntax, which is great.  Getters and methods are highly idiomatic class structures, and work fine with Backbone right now.  They also enforce the immutability of these properties, a design concern with the current Backbone property implementation <sup id=\"fnref:3\"><a href=\"#fn:3\">3</a></sup>.  But lets be real, <code class=\"language-text\">get tagName() { return &#39;li&#39;}</code> is a significantly less clean interface than the <code class=\"language-text\">tagName: &#39;li&#39;</code> syntax you get with <em>Backbone.extend</em>.  </p>\n<h4>Defining properties directly on the prototype</h4>\n<p>The final example is the most straightforward.  Since there’s no special class syntax for adding properties to the prototype, we can just do so directly after we’ve defined the class.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... etc</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">TodoView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">TodoView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>template <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">TodoView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'dblclick label'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'keypress .edit'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'keydown .edit'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'blur .edit'</span><span class=\"token punctuation\">:</span>       <span class=\"token string\">'close'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>This approach is unambiguous, but its also removes the advantages of using abstracted syntax to begin with.  Adding directly to the prototype takes properties out of the context of the class definition, making it harder to view the class as a holistic unit.  Forcing properties to appear after the class definition also breaks with Backbone community conventions.  Almost all examples of Backbone code that I’ve seen put properties at the top of Backbone class declarations, above any methods, since they’re usually important to read when trying to understand the purpose and role of an object.  They’re then followed by methods, which often contain extensive logic that is less helpful in understanding a class’ overall purpose.</p>\n<p>Of these 3 solutions, I personally prefer using methods and getters.  However I don’t see any of them as an improvement on the existing <em>Backbone.extend</em> syntax.</p>\n<h3>ES7 and Decorators</h3>\n<p>JavaScript is not staying stagnant however.  The TC39 committee recently approved the final spec for ES6 and is aiming to release a new spec on a yearly basis going forward.  One proposed feature for a future spec is <a href=\"https://github.com/wycats/javascript-decorators\">JavaScript decorators</a>.  Decorators are a declarative way of adding extra behavior to a class or class method.  They’re simple functions that take a class or method as an argument and then return an augmented version.</p>\n<p>For instance here’s a simple example from the proposal of a decorator that adds an isTestable property to classes that it decorates.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">@<span class=\"token function\">isTestable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">isTestable</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      target<span class=\"token punctuation\">.</span>isTestable <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Based on that example, it’s not hard to see how this is relevant to the syntax struggle we experienced above.  Here’s a naive solution to our properties problem that utilizes a <code class=\"language-text\">props</code> decorator to add a Backbone-esque hash of properties to the prototype.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//decorators.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">props</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Backbone <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'underscore'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> todosTemplate <span class=\"token keyword\">from</span> <span class=\"token string\">'text!templates/todos.html'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Common <span class=\"token keyword\">from</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'decorators'</span>\n\n@<span class=\"token function\">props</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    tagName<span class=\"token punctuation\">:</span>  <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span>\n\n    template<span class=\"token punctuation\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    events<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'dblclick label'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'keypress .edit'</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'keydown .edit'</span><span class=\"token punctuation\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'blur .edit'</span><span class=\"token punctuation\">:</span>       <span class=\"token string\">'close'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... etc</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s a big improvement over our ES6 solutions above.  Our properties are added declaratively at the top of the class and are still clearly associated with the class.  Everything lines up reasonably well with both Backbone and native idioms. This is also reminiscent of the <a href=\"https://angular.io/docs/js/latest/quickstart.html#section-angular-create-account\">approach that Angular 2 is taking</a> with its interface, using decorators heavily for component configuration.  It turns out though that we can actually do better.</p>\n<p>I got a tweet from Steven Langbroek last week asking me to look at his <a href=\"https://gist.github.com/StevenLangbroek/6bd28d8201839434b843\">idea for using decorators to provide a cool new syntax for event binding in Backbone</a>.  I thought it was awesome and it inspired me to think in a more fine grained way about using decorators with Backbone.  How can we make the syntax better, as opposed to just replicating the current experience.  Here’s what a more “fine grained” decorators approach might look like with our example.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//decorators.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>template <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">eventName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> descriptor</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>target<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The on decorator is not compatible with an events method'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>eventName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The on decorator requires an eventName argument'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    target<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">[</span>eventName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> descriptor<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Backbone <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'underscore'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> todosTemplate <span class=\"token keyword\">from</span> <span class=\"token string\">'text!templates/todos.html'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Common <span class=\"token keyword\">from</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>tagName<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">,</span> on<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'decorators'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'li'</span><span class=\"token punctuation\">)</span>\n@<span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> isCompleted <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">// hidden cases only</span>\n            <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n            <span class=\"token punctuation\">(</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'active'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">toggleCompleted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dblclick label'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'blur .edit'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> trimmedValue <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">:</span> trimmedValue <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">!==</span> trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keypress .edit'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">updateOnEnter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>keyCode <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ENTER_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown .edit'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">revertOnEscape</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>which <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ESCAPE_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Also reset the hidden input back to the original value.</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now we’re getting somewhere.  Steven’s <code class=\"language-text\">on</code> decorator provides a really nice upgrade to Backbone’s event system.  Event handlers are now in the context of the methods they refer to, making it much easier to get context as you scroll through a large view.  Our tagName gets a nice declarative setter at the top of the view rather than being bundled into an object hash.  And our template processing gets standardized, with the call to <code class=\"language-text\">_.template</code> abstracted away into the decorator.  That last decorator would probably be project specific, but the other 2 could easily be incorporated into a general Backbone decorator library.  </p>\n<p>The main downside I see to this is one shared by a few of the other approaches.  Specifically that declaring a property like tagName as a method or as a property requires different implementation styles.  Backbone philosophically treats these scenarios as equivalent, and its not unusual to start with a static property for keys like <code class=\"language-text\">className</code>, <code class=\"language-text\">url</code>, or <code class=\"language-text\">template</code> and then refactor to use a function as code is reused in different situations.  Artificially separating out those scenarios is not very Backbone-like and might discourage that type of refactoring.</p>\n<h3>Recommendations</h3>\n<p>If you want to use ES6 classes with Backbone in production today, you should probably make everything a method, and make liberal use of the getter functionality.  That seems to be the most Backbone-like, with everything contained in a single class definition, and easy refactoring when a property begins to require logic around it.  If you’re experimenting though, you should definitely consider playing with decorators and see how you can make Backbone’s interface better.  </p>\n<p><em>If you have ideas about this, feel free to contribute on the <a href=\"https://github.com/jashkenas/backbone/issues/3560\">github issue</a></em></p>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        I completely screwed up explaining this in my first piece.  I was under the mistaken impression that Backbone was adding properties like `className` and `events` to each instance rather than to the prototype.  Which makes no sense in retrospect, since those properties need to be present before the Backbone.View is run.\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n        <li class=\"footnote\" id=\"fn:2\">\n            <p>\n            Well, almost all. iDAttribute <a href=\"https://github.com/jashkenas/backbone/pull/3684\">is still catching up</a>.\n            <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n        </li>\n        <li class=\"footnote\" id=\"fn:3\">\n            <p>\n            Oh you didn't realize that adding an item to the event hash for your view would add it to every instance of that View?  Whoops.\n            <a href=\"#fnref:3\" title=\"return to article\"> ↩</a></p>\n        </li>\n</ol>\n</div>","fields":{"slug":"/2015/07/06/backbone-and-es6-classes-revisited"}}}],"topic":"backbone"}},"staticQueryHashes":[]}