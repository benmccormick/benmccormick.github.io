{
    "componentChunkName": "component---src-templates-topic-page-js",
    "path": "/topics/javascript",
    "result": {"pageContext":{"posts":[{"node":{"frontmatter":{"readNext":null,"topics":["book review","javascript"],"category":"reviews","key":"effective-js","title":"Book Review: Effective Javascript","description":"A book review of Effective Javascript by David Herman","layout":"review","path":"/2013/01/06/book-review-effective-javascript","date":"2013-01-06T22:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b713bbc3c334bd74873922c7189181a/5a46d/effectivejs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.46853146853147%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFDklEQVQ4y3WU2W8bRRzH3apP0EpIUJEqPvZe7+31nvbaa3t9rO/4tmM7cXzEieMcjpI2adqGpiVCqhq1qUoLQgUhJCqEBE2hIB54hhf+J2QbIiFA+j7MjOaj33d+852xvJOtXWsN6XCcJ0mOZlwMy5IkR9EsQfEMyxAkQ1DjKUnRTmK6QmK4wLncnMvy1lzj3e4WFUsJFM1SNM9wLEW7WI7CCdktRkNh04iaRsTwBww9aIajZjiqipLg4t0sZ7mcq1tK7fcED2q1wgAIOxywAzgXCkITgSgIYhCMghAGjVdAm53AcMvlufrFSndG1pwOBwYj4x1T/YX9ryjcOalc6V4VvbjdDjlA2AFgEDwVAoDTwb9JBADH8Ntz9Uu1ZcBvEADg5lwsRQNWG2R3AFYbgeGgze6YtSIA+N/wxUQpcv9hb3t3Lpk62L9ZLZU9ihqPxkq5fC6dCfkD0ZBBO4lzF+dexvClVKXy+NNsd3Wl3V5bHWwO10cbG92l9kpvebg6GA4G+9dv8Aw7tTMVaLMDszZycubG5eaAS+eb5XJQDyiiFAmFZbfAkrTkFliKLufLESPiYjivrMpuUeB4TfX6PBpL0uNuW0rtq6IHs9kcVpvslqrlWq/brxTKjVpzob4Y0oMLjcV0IhUOGutrG4vN1kpvpVKq0gQ57vaFam9G8TkdAAJCUSOaSWaD/kAuMxcLxyKhcDqZzmVyMSMS8OkpM5U0ExIvCC6ewomxbUu1NyP7cLsdAWGPrGiKqoqSpqiKIAicS/dqqiCpguj3eESO1xTVKyu6V2NJamK70n1f1qYwgWLTGDMEyZKUi2I8sqr7/GY0LnC8IsqKKEu8wFE05ST+AaOTYCAAiMMIhqAUQc7PN81YYnFx6fGTZ3t7tzPpnO4PpFIZSVRYivnb9uTMOIISKOZEUBgAGYrZHu3ePTq+fefo+1c/fP7FVy+/+e7u3WOvR9u9frPfXwuHo+PKFyrdGcWH2ewYjOAIKvDu0db2ixdf7uzsPX36/OTk9NXZm+XlwXB96/TJs2ajtb4x2j+40+v1p1fVsfsMXVHNSLxcrB7dO37w4NHXL789OvpQldTR5vZvv/9x69bhjb2D4+OPer2Vfn9QLtd2d/cntssdMBCLB0MRI6pr/qgR6XT6jx4/ff36x1jETMaTZ2dvzl7/dHz8IBaJmVGz2Wj5NL1SqU1eVbV3TdWdDgeOIDgMEwjaWlg6efjoxvW9wztHjfmF9lK32VhQZEWV1Mb8wnC4JbiEsBGZhKTSvab4KQgmnQQKgPVa/fknnwkuHgWgSCgc0PyFucJ8rZ5JZRJmcn19q1golYoVVfFOuz2G0Vkr7AAktxjwBYq5QqfVrteaEi/yDBvw6R5Z9Xm1hJkMBkKFfGljfaRI6vlV6Zog5rMFTfFSOAHMWu/f/+iDw3uGHqSdRL1aD+kBlqKz6bl0MivwbiNoNOoL0z+s44xnVzu9e0fHGARNQgJnU5nD24epeCoejW9ubpuxOInjLoYjMBwGQASEErHEpHJxSSw3Ql7NzfFOBCUxJwpCB/sHP//y63BtIxFLdNrLRiCoKWrQ5/d7vKoke2R5nO0ruaal0Ar1BrlUGgGhYr4ouHgMgk8ePh5t7ezs7Pk8mhmJFnP5TDJVzhfbi616tbbYaMqCaLmSa1hyzcRg1KzVOZZb7a+pkgza7d1O9/T042wq40RQHIJpnKBwp5vlpnLRDENSfwKOz4vkw340KgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Effective JS\"\n        title=\"Effective JS\"\n        src=\"/static/6b713bbc3c334bd74873922c7189181a/5a46d/effectivejs.png\"\n        srcset=\"/static/6b713bbc3c334bd74873922c7189181a/a6b04/effectivejs.png 143w,\n/static/6b713bbc3c334bd74873922c7189181a/0e2fe/effectivejs.png 285w,\n/static/6b713bbc3c334bd74873922c7189181a/5a46d/effectivejs.png 300w\"\n        sizes=\"(max-width: 300px) 100vw, 300px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After seeing some positive early reviews, I went to Amazon last week and bought “Effective JavaScript” by David Herman.  I’m glad that I did.  The book is a great experience for anyone who wants to deepen their understanding of the JavaScript language in a practical grounded fashion.</p>\n<h3>Whats the book like?</h3>\n<p>The subtitle of the book, “68 Specific Ways To Harness The Power Of JavaScript”, gives you a hint as to what it will be like.  The book contains 68 best-practice”items”, each an imperative sentence (Prefer Primitives to Object Wrappers, Get comfortable using Higher-Order Functions), divided into 7 chapters (Accustoming yourself to JavaScript, Variable Scope, Objects and Prototypes,  Arrays and Dictionaries, Library and API design, Concurrency).  Each of these items contains an in depth examination of why it is a best practice.  You could read through the table of contents and get something out of the book, but the heart of this book is the way that the author fully digs into each best practice, explaining not only why its a good idea but also what the exception cases are, and why it might be a good idea to break the rule.  The way the discussion of language attributes is grounded by the practical imperative statements, combined with the clear and concise explanations of the author makes everything feel extremely relevant.</p>\n<h3>Who is the book for?</h3>\n<p>This is a great book for people who are familiar with JavaScript, and maybe know some of the best practices, but want to deepen their understanding of how the language works and how to use it better.  This is not a comprehensive reference book, or an introductory text for people just starting with Javascript.  I would recommend <a href=\"http://www.amazon.com/gp/product/1118026691/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1118026691&linkCode=as2&tag=productjavasc-20\">Professional JavaScript for Web Developers</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=productjavasc-20&amp;l=as2&amp;o=1&amp;a=1118026691\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\"> and <a href=\"http://www.amazon.com/gp/product/0596517742/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0596517742&linkCode=as2&tag=productjavasc-20\">JavaScript: The Good Parts</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=productjavasc-20&amp;l=as2&amp;o=1&amp;a=0596517742\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\"> respectively for those cases.  This book will increase understanding, not knowledge of the syntax or basics.</p>\n<h3>What is good about the book?</h3>\n<p>The layered explanations are fantastic.  On the top layer the author gives you the <strong>specific</strong> best practices, then follows that with an explanation of the underlying reasons for these practices, gives examples of them in action, and following up with any cases where it might be best to use a different method.  The book communicates clearly and concisely about complex subjects.  The payoff is understanding.</p>\n<h3>What is not so great?</h3>\n<p>I felt the chapter on Library and API design was significantly weaker than the rest of the book.  Perhaps it’s because I’m not currently working on building a library, but these chapters felt less like deep explanations and more like quick writeups to justify the stating of the best practices.  The depth of the other explanations was not there.</p>\n<h3>Want to buy it?</h3>\n<p>Its available on <a href=\"http://www.amazon.com/gp/product/0321812182/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0321812182&linkCode=as2&tag=benmccormicko-20&linkId=HOPC6ZNKSVMH3NZ7\">Amazon</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=benmccormicko-20&amp;l=as2&amp;o=1&amp;a=0321812182\" width=\"1\" height=\"1\" border=\"0\" alt=\"\" style=\"border:none !important; margin:0px !important;\">\n.</p>","fields":{"slug":"/2013/01/06/book-review-effective-javascript"}}},{"node":{"frontmatter":{"readNext":null,"topics":["javascript"],"category":"javascript","key":"closures","title":"Explaining Javascript: Closures","description":"Diving into one of JavaScripts more confusing concepts","layout":"post","path":"/2013/01/08/explaining-javascript-closures","date":"2013-01-08T23:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>Javascript can be a confusing language when you start to use it.  Designed in a hurry with a functional programming heart and an object oriented skin, Javascript looks a lot like Java or C at first glance.  That expectation causes frustration though when you realize that writing Java style code means that you have no private variables, no block scope, no threads, and no abstract/classes or interfaces.  When I started writing Javascript I had only ever written in pure object oriented languages.  My javascript code was inefficient, fragile, and no fun to write.  I wanted to share some of the things I’ve learned since here, to help other people making that adjustment.</p>\n<h3>Closures</h3>\n<p>Closures are one of the key concepts to understand when you start writing Javascript.  By default, all javascript objects are global, and blocks such as for loops and if statements do not restrict scope.  Closures are Javascript’s mechanism for information hiding and controlling scope.  They also allow for some advanced functionality in an elegant way.</p>\n<h4>Laying the ground</h4>\n<p>There are a few things you need to understand about Javascript before closures make sense.</p>\n<h4>Functions are objects</h4>\n<p>Javascript uses First Class Functions, meaning that Functions are Objects in Javascript.  They can be passed to other functions, assigned properties, and be added as properties of another object.  This is very important to understand about Javascript, and a big difference between Javascript and Java/C++.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">f</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> x<span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//6</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">f2</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func<span class=\"token punctuation\">,</span> param</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">func</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">f2</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 11</span></code></pre></div>\n<h4>Functions have their own scope</h4>\n<p>Functions are effectively the only construct in Javascript that can limit scope.  Unlike other languages, code blocks don’t automatically limit scope.  So variables defined in for loops and if statements are not confined to those constructs, and Javascript doesn’t have an exact equivalent to javascript classes.  Instead functions are used to manage scope.  The key point is that from within a function you can reference variables defined outside the function, but you cannot access variables defined within a function from outside that function.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">f</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// alerts 1, alerts 2</span>\n    a <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//alerts 3, alerts 2</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined</span></code></pre></div>\n<h4>Functions can be defined inside of other functions</h4>\n<p>This naturally follows from the other two points.  Functions are just objects and can be defined anywhere.  So you can define a function inside another function, and use it as the return value of the outer function.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">outer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">inner</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> x<span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> inner<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4</span></code></pre></div>\n<h4>What is a Closure?</h4>\n<p>A closure is a function defined inside of another function and returned by that function which maintains a reference to variables in the outer functions scope.  Since the inner function was created within the scope of the outer function, it can reference variables defined within the scope of the outer function.  This is best seen by example.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">outer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n        <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">inner</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> x<span class=\"token operator\">*</span>y<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> inner<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> triple <span class=\"token operator\">=</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">triple</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 6;</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//undefined</span></code></pre></div>\n<p>Since the outer function scope is maintained, you can also use the variables within that class to track state for the function so that it can only be modified through the function.  This is how javascript implements private variables.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">outer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">inner</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            y<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> inner<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> message <span class=\"token operator\">=</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0</span>\n    <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n    <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n    <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\n    <span class=\"token comment\">//...</span></code></pre></div>\n<h4>Closures in practice</h4>\n<p>Closures are one of the most commonly used idioms in javascript.  They’re used anytime a programmer wants to protect their implementation of a feature, and prevent other code from directly referencing internal variables.  Its also the key concept in the popular <a href=\"http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth\">module pattern</a>, and many more javascript patterns.  If you are writing javascript of any complexity, or need to understand other people’s javascript code, understanding closures is essential.</p>\n<h2>Further Reading</h2>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Guide/Closures\">Mozilla Documentation on Closures</a></li>\n<li><a href=\"http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth\">Ben Cherry on the Module Pattern</a></li>\n<li><a href=\"http://www.amazon.com/Effective-JavaScript-Specific-Software-Development/dp/0321812182\">Effective Javascript</a> is a great book for understanding javascript.  I wrote a review of it <a href=\"http://benmccormick.org/blog/2013/01/06/book-review-effective-javascript/\">here</a></li>\n</ul>","fields":{"slug":"/2013/01/08/explaining-javascript-closures"}}},{"node":{"frontmatter":{"readNext":null,"topics":["javascript"],"category":"javascript","key":null,"title":"Explaining Javascript: Object Oriented Programming","description":"A look at Object Oriented programming principles in JavaScript","layout":"post","path":"/2013/01/12/explaining-javascript-object-oriented-programming","date":"2013-01-12T03:05:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>I’m continuing this series on Javascript concepts for people new to the language by looking at  object oriented programming.  One of the more confusing concepts for new Javascript programmers, especially those used to the classical inheritance structures of Java or C++ is Javascript’s prototypical inheritance model.  Because it is possible to write syntax for Javascript object creation that can look very similar to classical inheritance in Java, its easy to be misled and have false expectations.  Its important to understand how Javascript’s object model works, so that you can adjust your expectations and write code that takes advantage of the language’s expressive power.</p>\n<h4>Creating a new object</h4>\n<p>Javascript provides multiple ways to create new objects.  The simplest way is to just create an empty object with <code class=\"language-text\">{}</code>.  The one I’ll be looking at today was modeled after Java syntax and gives the language a deceptively classical vibe:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//Creating Objects with new</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>home <span class=\"token operator\">=</span> <span class=\"token string\">\"earth\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>noise <span class=\"token operator\">=</span> <span class=\"token string\">\"roar\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sound</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>noise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">var</span> animalObject <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    animalObject<span class=\"token punctuation\">.</span><span class=\"token function\">sound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// roar</span>\n    <span class=\"token keyword\">var</span> home <span class=\"token operator\">=</span> animalObject<span class=\"token punctuation\">.</span>home <span class=\"token comment\">//earth</span></code></pre></div>\n<p>This all looks very familiar and comfortable to a Java programmer.  Animal() is the constructor of a class Animal, with a function sound() and animalObject is an instance of that class.  And you can write code like that if you want.  The problem is, that model is not enforced at all by javascript.  Javascript doesn’t have any special “constructor functions” or classes<sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup>.  Any function can be used as a constructor</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//Normal Function as constructor</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">normalFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This is a normal function\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> normal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">normalFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    normal <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">normalFunc</span>  <span class=\"token comment\">//true</span>\n    <span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    x<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> normalFunc<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> huh <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">x<span class=\"token punctuation\">.</span>y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    huh instance <span class=\"token keyword\">of</span> normalFunc <span class=\"token comment\">//true</span></code></pre></div>\n<p>So whats actually happening when you call new before a function?  The new operator generates a new object, binds <code class=\"language-text\">this</code> to that object for the constructor function, calls that function and sets that function as the prototype of the new object.  But what is a prototype?</p>\n<h4>Prototypes</h4>\n<p>Javascript inheritance is at its heart “prototypical inheritance”.  This means that rather than having a concept of “classes” and “implementations” of those classes, javascript objects inherit their properties directly from other objects.  So for the “classical” example above, what is actually happening is that a new object is being created, it is having some of its properties set by the constructor function, and then has the constructor’s prototype set as its prototype.  This means that it has access to any properties on the “prototype chain” of the constructor, which in this case includes the sound method.  All objects have acccess to Object.prototype, giving it access to object properties and methods like toString, hasOwnProperty and others.</p>\n<h4>The ES5 Way</h4>\n<p>The ECMAScript 5 specification defines a new way to create objects from existing objects with the <strong><a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create\">Object.create()</a></strong> syntax.  Object.create takes an existing object and sets it as the prototype object for a newly created object<sup id=\"fnref:2\"><a href=\"#fn:2\" rel=\"footnote\">2</a></sup>.  This was added to make the syntax for setting the prototype of a new object easier and more clear.<sup id=\"fnref:3\"><a href=\"#fn:3\" rel=\"footnote\">3</a></sup>  It also allows us to simulate classical inheritance:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//ES5 Classical Inheritance example</span>\n\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Cat</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">Animal</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//Call the Animal constructor to set local variables</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>noise <span class=\"token operator\">=</span> <span class=\"token string\">\"meow\"</span> <span class=\"token comment\">//override the Animal sound</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Animal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span>\n\n   <span class=\"token keyword\">var</span> kitty <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   kitty<span class=\"token punctuation\">.</span><span class=\"token function\">sound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//meow</span>\n   <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>kitty<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sound\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//false</span>\n   <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>kitty <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//true</span>\n   <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>kitty <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//true</span></code></pre></div>\n<p>So as you can see, it is very possible to write Object-Oriented Javascript.  The key is to understand that what’s happening behind the scenes in Javascript is different than Java or C++, even though the syntax may look similar.</p>\n<h4>Summary</h4>\n<ul>\n<li>\n<p>Inheritance and object oriented programming in javascript are possible, but are more of a programmer defined construct rather than an inherent property of the language</p>\n</li>\n<li>\n<p>Javascript supports prototypical inheritance, meaning that it inherits functions and properties from its prototype object.  All objects inherit from Object.prototype.</p>\n</li>\n<li>\n<p>ECMAScript 5 introduced support for Object.create, which provides an easier syntax for creating new objects and simulating inheritance.</p>\n</li>\n</ul>\n<hr>\n<h3>Further Reading</h3>\n<ul>\n<li>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Introduction_to_Object-Oriented_JavaScript\">Mozilla’s Developer Documentation</a> has a good summary of implementing Object Oriented Programming concepts in Javascript</p>\n</li>\n<li>\n<p><a href=\"http://msdn.microsoft.com/en-us/magazine/gg314983.aspx\">Managing Javascript Objects</a> is a great article by Nicholas Zakas for MSDN about designing an object oriented application in Javascript.  Zakas also has recently written a <a href=\"https://leanpub.com/oopinjavascript\">book</a> on object oriented programming in Javascript</p>\n</li>\n</ul>\n<hr>\n<h3>Explaining Javascript</h3>\n<p>This is the second article in my Explaining Javascript series for introducing Javascript concepts to new JS developers.</p>\n<ol>\n<li>\n<p><a href=\"http://www.benmccormick.org/blog/2013/01/08/javascript-explained-closures/\">Closures</a></p>\n</li>\n<li>\n<p><a href=\"http://www.benmccormick.org/blog/2013/01/12/javascript-explained-object-oriented-javascript/\">Object Oriented Programming</a></p>\n</li>\n</ol>\n<hr>\n<div class=\"footnotes\"><ol>\n<li class=\"footnote\" id=\"fn:1\">\n<p>\nIn the next version of Javascript ES6 there will be a more formal concept of classes.  You can read more <a href=\"http://wiki.ecmascript.org/doku.php?id=strawman:maximally_minimal_classes\">here</a> if interested\n<a href=\"#fnref:1\" title=\"return to article\"> ↩</a>\n</p>\n</li>\n<li class=\"footnote\" id=\"fn:2\">\n<p>\nWith an optional second argument to set the local properties of the object from another object.  Note that these properties will need to be Objects, not primitive values, or a TypeError will be thrown        \n<a href=\"#fnref:2\" title=\"return to article\"> ↩</a>\n</p>\n</li>\n<li class=\"footnote\" id=\"fn:2\">\n<p>Thanks to <a href=\"https://plus.google.com/u/0/110077141419510454119/posts\">Eric Elliot</a> for pointing out that my original description of Object.Create was misleading.  There are multiple ways to create and reuse object code in Javascript.  I only touch on one of them in this article.<br>\n<a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n</li>\n</ol></div>","fields":{"slug":"/2013/01/12/explaining-javascript-object-oriented-programming"}}},{"node":{"frontmatter":{"readNext":null,"topics":["javascript"],"category":"javascript","key":null,"title":"Unexpected Javascript: That Doesn't Do What You Think","description":"A quiz for JavaScript developers","layout":"post","path":"/2013/01/15/unexpected-javascript-that-doesnt-do-what-you-think","date":"2013-01-15T23:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>When I started writing Javascript, I encountered a lot of stuff that was just plain weird.  Stuff didn’t act the way I expected, syntax seemed misleading, and some behavior just seemed completely wrong.  I have a better understanding now and have come to appreciate Javascript for the quirky but stable language that it is once you know the rules.  But just for fun, here are some examples of assumptions that its easy to make when looking at Javascript for the first time.  All of the following statements are wrong (at least in some cases).  See if you know why.  And feel free to contribute more in the comments!</p>\n<h3>Equality Problems</h3>\n<ul>\n<li><code class=\"language-text\">0.1+0.2 === .3</code> is true <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup></li>\n<li><code class=\"language-text\">10000000000000001+20000000000000000 === 300000000000000001</code> is true <sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></li>\n<li><code class=\"language-text\">x === x</code> is true for all values of x <sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup></li>\n<li><code class=\"language-text\">\"1.0e0\" == {valueOf: function(){ return true;}};</code> is false <sup id=\"fnref-4\"><a href=\"#fn-4\" class=\"footnote-ref\">4</a></sup></li>\n<li>if <code class=\"language-text\">x==y</code> and <code class=\"language-text\">x==z</code> then <code class=\"language-text\">z==y</code> <sup id=\"fnref-5\"><a href=\"#fn-5\" class=\"footnote-ref\">5</a></sup></li>\n<li><code class=\"language-text\">parseInt('016') === 16</code> is true. <sup id=\"fnref-6\"><a href=\"#fn-6\" class=\"footnote-ref\">6</a></sup></li>\n</ul>\n<h3>Environment Concerns</h3>\n<ul>\n<li><code class=\"language-text\">window</code> will always be available as a global variable <sup id=\"fnref-7\"><a href=\"#fn-7\" class=\"footnote-ref\">7</a></sup></li>\n<li>Javascript will always be enabled on your web page <sup id=\"fnref-8\"><a href=\"#fn-8\" class=\"footnote-ref\">8</a></sup></li>\n<li>If it works in firebug it will work in the browser <sup id=\"fnref-9\"><a href=\"#fn-9\" class=\"footnote-ref\">9</a></sup></li>\n</ul>\n<h3>Code Structure</h3>\n<ul>\n<li>You don’t need to add semicolons in javascript, they’re inserted automatically <sup id=\"fnref-10\"><a href=\"#fn-10\" class=\"footnote-ref\">10</a></sup></li>\n<li>I always add semicolons, so I don’t need to know about how they’re inserted <sup id=\"fnref-11\"><a href=\"#fn-11\" class=\"footnote-ref\">11</a></sup></li>\n<li>The var keyword is unnecessary, variables are created just by referencing them. <sup id=\"fnref-12\"><a href=\"#fn-12\" class=\"footnote-ref\">12</a></sup></li>\n<li><code class=\"language-text\">return eval(\"x\")</code> is the same as <code class=\"language-text\">var a = eval; return a(\"x\");</code> <sup id=\"fnref-13\"><a href=\"#fn-13\" class=\"footnote-ref\">13</a></sup></li>\n<li>Functions are the only thing in Javascript that restrict scope.  <sup id=\"fnref-14\"><a href=\"#fn-14\" class=\"footnote-ref\">14</a></sup></li>\n</ul>\n<h3>Function Issues</h3>\n<ul>\n<li>I will always know what <code class=\"language-text\">this</code> is when the function is run <sup id=\"fnref-15\"><a href=\"#fn-15\" class=\"footnote-ref\">15</a></sup></li>\n<li>You can get the last argument of the function using <code class=\"language-text\">arguments.pop()</code> <sup id=\"fnref-16\"><a href=\"#fn-16\" class=\"footnote-ref\">16</a></sup></li>\n<li>The following will generate different names and alerts for each link: <sup id=\"fnref-17\"><a href=\"#fn-17\" class=\"footnote-ref\">17</a></sup></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">addLinks</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> link<span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">\"Link \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>The following function will return 1: <sup id=\"fnref-18\"><a href=\"#fn-18\" class=\"footnote-ref\">18</a></sup></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>The if statement code can be removed here with no side effects: <sup id=\"fnref-19\"><a href=\"#fn-19\" class=\"footnote-ref\">19</a></sup></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">testf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  x<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> x<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Explanations here:</h4>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">Actually comes to 0.30000000000000004 See <a href=\"http://stackoverflow.com/questions/588004/is-javascripts-floating-point-math-broken\">here</a><a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">Loses the trailing 1 due to limits of <a href=\"http://stackoverflow.com/questions/588004/is-javascripts-floating-point-math-broken\">floating point numbers</a><a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-3\">It turns out that <code class=\"language-text\">NaN === NaN</code> is false<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-4\">Both values get cast to 1 by the <a href=\"http://stackoverflow.com/questions/359494/javascript-vs-does-it-matter-which-equal-operator-i-use\">== operator</a><a href=\"#fnref-4\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-5\">” == ‘0’ is false, 0==” is true, as is 0 ==‘0’<a href=\"#fnref-5\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-6\">Prior to ECMAScript 5, strings with leading 0s were interpreted as Octal Notation.  This is resolved in newer browsers, but IE8 and other older browsers still show this behavior.<a href=\"#fnref-6\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-7\">Window is a browser construct.  It may not be available in all JS environments (for instance, it is not available in Node.js)  Unless you know exactly where your code will be run, be careful<a href=\"#fnref-7\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-8\">Especially in government situations, security conscious users may disable javascript.  Even if the user is able to enable JS, it may be disabled by default.  You can prepare your site for this.<a href=\"#fnref-8\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-9\">This is not always accurate.  Firebug executes in eval context, <a href=\"http://perfectionkills.com/understanding-delete/\">and that may lead to strange behavior </a>.<a href=\"#fnref-9\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-10\">There are some cases when a JS parser may unexpectedly concatenate 2 lines you didn’t intend.  This is particularly an issue when the next line begins with an arithmetic operator or a <code class=\"language-text\">(</code>, as is the case for immediately invoked function expressions.  You can see an example with <a href=\"http://jsfiddle.net/2XSCk/\">this fiddle</a><a href=\"#fnref-10\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-11\">You can still be burned by automatic semicolon insertion even if you don’t want to take advantage of it.  The classic example is that Javascript will automatically insert a semicolon after <code class=\"language-text\">return</code> if you put the value to be returned on a new line, something that may happen often if you’re returning a new object and like to start your curly braces on a new line.<a href=\"#fnref-11\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-12\">This is more of a beginner assumption.  Undeclared variables are automatically set as global variables and can cause plenty of problems if you don’t understand this.<a href=\"#fnref-12\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-13\">Strangely, Javascript differentiates between direct calls to eval and indirect calls. You can read more on this <a href=\"http://stackoverflow.com/questions/9107240/1-evalthis-vs-evalthis-in-javascript\">StackOverflow Question</a><a href=\"#fnref-13\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-14\">This is admittedly an edge case, but catch statements of try…catch blocks also restrict scope, and the <code class=\"language-text\">with</code> statement also modifies the scope, in a different way.  <code class=\"language-text\">with</code> is not recommended<a href=\"#fnref-14\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-15\">Even methods of an object can be called by another object with Javascript’s call and apply functions.  The only way to guarantee that the correct value of this is used is to use <a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind\">Javascript’s bind function</a><a href=\"#fnref-15\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-16\"><code class=\"language-text\">arguments</code> is not a real array.  It is array-like, in that it has a length value, and has integer properties that it accepts.  But you can’t run normal array arguments on it without converting it to an Array object.<a href=\"#fnref-16\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-17\">This is the classic example of improper closure behavior.  I got this example from <a href=\"http://robertnyman.com/2008/10/09/explaining-javascript-scope-and-closures/\">this article</a>, where you can read more.<a href=\"#fnref-17\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-18\">Function declarations are hoisted to the top of the function.  Therefore both versions of f are defined, and the second one overrules the first, before f is called and return<a href=\"#fnref-18\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-19\">More variable hoisting.  In this case the var x declaration is hoisted to the top of the function, even though the assignment can never be executed.  This has the effect of making the variable local to the function rather than global, which is potentially very significant.  You can see the difference in this <a href=\"http://jsfiddle.net/H4bCx/\">jsFiddle</a>/<a href=\"#fnref-19\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2013/01/15/unexpected-javascript-that-doesnt-do-what-you-think"}}},{"node":{"frontmatter":{"readNext":null,"topics":["javascript"],"category":"javascript","key":null,"title":"Alternative JavaScript","description":"A non-comprehensive run-through of the various compile to JS languages out there","layout":"post","path":"/2014/11/24/alternative-javascript","date":"2014-11-24T03:58:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>It’s become a bit of a cliche that JavaScript is the “machine code of the web”. But now that mobile browsers have conclusively killed Flash, Silverlight and other “plugin languages”, JavaScript has become the only language that can reasonably claim to be “write once, run anywhere”.  That’s still a bit inflated though.  More accurately, you can use a subset of modern JavaScript that is compatible with the set of browsers and JavaScript environments that you want to support and run it in those places.  In practice this ends up being a version of JavaScript that matches the EcmaScript 5 spec <sup id=\"fnref:0\"><a href=\"#fn:0\">1</a></sup> for users who want to support modern browsers, or a very limited subset of the language that is somewhat similar to the ES3 spec for developers supporting old versions of Internet Explorer.  Because of the strange dynamic that the user rather than the developer of JavaScript code controls the language runtime that code uses, the JavaScript language has been forced to evolve slowly, with very few developers using the latest language features at any given time.  This, combined with a dislike of JavaScript from some developers has led to a proliferation of “compile to JavaScript” languages.</p>\n<p>There’s a problem with talking about “compile to JS” languages though.  That category groups 2 types of languages that are not especially similar.  The first type are languages that are completely different than JavaScript, which are then compiled down into JavaScript so that they can run in a web browser.  This is where the term “machine code of the web” really applies.  From the developer’s point of view, the fact that the code is compiled to JS is an implementation detail, and the JavaScript that is generated is likely to be unreadable, without any clear relation to the structure of the original code. Examples of this type of “compile to JS” language include new languages created for this purpose like <a href=\"https://www.dartlang.org/\">Dart</a> and <a href=\"http://haxe.org/\">Haxe</a>, as well as existing languages like <a href=\"https://github.com/clojure/clojurescript\">Clojure</a> and <a href=\"http://www.gwtproject.org/\">Java</a>.  The most extreme example of this has probably been <a href=\"http://asmjs.org/\">ASM.js</a> and <a href=\"http://kripken.github.io/emscripten-site/\">emscripten</a>, which together allow developers to compile C++ code to a subset of JavaScript that browsers can optimize for performance.  This type of language is great for developers who have a strong preference in language style, or an existing codebase that they want to port to the web.</p>\n<p>But there’s a second type of “compile to Javascript” language. These are languages that embrace the structure and semantics of JavaScript and focus on providing an alternative syntax that provides some benefit.  Benefits can include better code readability, cleaner syntax for common operations,  and support for modern JavaScript features that are not yet safe to use in common browsers without a compile step.  These languages will generally compile down to readable ES5 JavaScript that can easily be matched up 1 to 1 with the original source code.  They’re not intended to excuse you from learning JavaScript, instead they ‘re meant to smooth over the development process as you build JavaScript applications.  Examples of this second type of language include <a href=\"http://coffeescript.org/\">CoffeeScript</a>, <a href=\"http://www.typescriptlang.org/\">TypeScript</a>, <a href=\"http://facebook.github.io/react/docs/jsx-in-depth.html\">JSX</a>, <a href=\"http://sweetjs.org/\">Sweet.js</a>, and <a href=\"https://github.com/google/traceur-compiler\">Traceur</a>.  In this post I’m going to take a look at the strengths and weaknesses of some of these alternative Javascript syntaxes, and thinking through when it’s a good idea to use them.</p>\n<p>I’ll start by standing up for the much maligned vanilla ES5 JavaScript syntax.  It has advantages.  It’s supported in many environments these days, including most browsers that people actually still use.  It has an incredible stable of tooling built up around it that allows for a smooth development experience.  And you can use it without jumping through any compile step hoops, or having to mentally translate the production code back to the source.  I’d argue that JavaScript sets a high bar for an alternate syntax to meet. Whether you agree or disagree with that, let’s at least admit that there is a bar and that the convenience of broad support and 1-1 mapping is an advantage that any alternative has to overcome.</p>\n<p>So what type of advantages can alternatives offer?  The different syntaxes I go through below all provide different strengths, but one mostly shared strength is that they allow you to start using some features of the newest version of JavaScript, EcmaScript 6.  ES6 brings a bunch of new features that make common development patterns easier, and looks to be a great improvement to the language.  By allowing you to take advantage of those features now, alternative syntaxes can speed up development and ease the transition into the new version of the language.  To get an idea of the more specific benefits an alternate syntax can bring, I’m going to go through 4 of the most popular syntaxes and explain why somebody would want to use them.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 450px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.783216783216783%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAp0lEQVQI1y3OsSpAARjF8fsY36+QlSLfKQsWsRgUBoMMyiaTQRmVwWpTipLFKCWv4QFsZq9At+50Oud/Op2BHJJzckkuSJFdsl/Vc+SUvJBVMkNCrsg8WSTrZI8sk+OBfJBf8lPV31U9Dl6TA3Jf1a/kiTySN3JGnkdGbsjt5D+r+mGo6iPyVdV/Y7mqx2yDbJIT8j7pSlWvTQ+3q3qLLJFZckd2yMI/x2QwSOsqWvgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"coffeescript logo\"\n        title=\"coffeescript logo\"\n        src=\"/static/96215865b690b19799dc30ead7ac854f/fc2a6/coffeelogo.png\"\n        srcset=\"/static/96215865b690b19799dc30ead7ac854f/a6b04/coffeelogo.png 143w,\n/static/96215865b690b19799dc30ead7ac854f/0e2fe/coffeelogo.png 285w,\n/static/96215865b690b19799dc30ead7ac854f/fc2a6/coffeelogo.png 450w\"\n        sizes=\"(max-width: 450px) 100vw, 450px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>CoffeeScript was the first alternative JavaScript syntax to gain popularity, and it is also one of the biggest breaks from the normal syntax.  Rewriting a simple Backbone view from the <a href=\"http://todomvc.com/\">TodoMVC project</a> in CoffeeScript would look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AppView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span>\n    <span class=\"token property\">el</span><span class=\"token operator\">:</span> <span class=\"token string\">'#todoapp'</span>\n    <span class=\"token property\">statsTemplate</span><span class=\"token operator\">:</span> _<span class=\"token punctuation\">.</span>template <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#stats-template'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token property\">events</span><span class=\"token operator\">:</span>\n        <span class=\"token string-property property\">'keypress #new-todo'</span><span class=\"token operator\">:</span> <span class=\"token string\">'createOnEnter'</span>\n        <span class=\"token string-property property\">'click #clear-completed'</span><span class=\"token operator\">:</span> <span class=\"token string\">'clearCompleted'</span>\n        <span class=\"token string-property property\">'click #toggle-all'</span><span class=\"token operator\">:</span> <span class=\"token string\">'toggleAllComplete'</span>\n\n    <span class=\"token function-variable function\">initialize</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token class-member variable\">@allCheckbox</span> <span class=\"token operator\">=</span> @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#toggle-all'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        @$input <span class=\"token operator\">=</span> @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#new-todo'</span><span class=\"token punctuation\">)</span>\n        @$footer <span class=\"token operator\">=</span> @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#footer'</span><span class=\"token punctuation\">)</span>\n        @$main <span class=\"token operator\">=</span> @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#main'</span><span class=\"token punctuation\">)</span>\n        @$list <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#todo-list'</span><span class=\"token punctuation\">)</span>\n\n        @<span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'add'</span><span class=\"token punctuation\">,</span> <span class=\"token class-member variable\">@addOne</span><span class=\"token punctuation\">)</span>\n        @<span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'reset'</span><span class=\"token punctuation\">,</span> <span class=\"token class-member variable\">@addAll</span><span class=\"token punctuation\">)</span>\n        @<span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'change:completed'</span><span class=\"token punctuation\">,</span> <span class=\"token class-member variable\">@filterOne</span><span class=\"token punctuation\">)</span>\n        @<span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'filter'</span><span class=\"token punctuation\">,</span> <span class=\"token class-member variable\">@filterAll</span><span class=\"token punctuation\">)</span>\n        @<span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'all'</span><span class=\"token punctuation\">,</span> <span class=\"token class-member variable\">@render</span><span class=\"token punctuation\">)</span>\n        app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token property\">reset</span><span class=\"token operator\">:</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function-variable function\">render</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        completed <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">.</span><span class=\"token function\">completed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length\n        remaining <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length\n\n        <span class=\"token keyword\">if</span> app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">.</span>length\n            @$main<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            @$footer<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n            @$footer<span class=\"token punctuation\">.</span>html <span class=\"token class-member variable\">@statsTemplate</span>\n                <span class=\"token property\">completed</span><span class=\"token operator\">:</span> completed<span class=\"token punctuation\">,</span>\n                <span class=\"token property\">remaining</span><span class=\"token operator\">:</span> remaining\n\n            filter <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token keyword\">or</span> <span class=\"token string\">''</span>\n\n            @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#filters li a'</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span>removeClass <span class=\"token string\">'selected'</span>\n                <span class=\"token punctuation\">.</span>filter <span class=\"token string\">\"[href=\\\"#/<span class=\"token interpolation variable\">#{filter}</span>\\\"]\"</span>\n                <span class=\"token punctuation\">.</span>addClass <span class=\"token string\">'selected'</span>\n        <span class=\"token keyword\">else</span>\n            @$main<span class=\"token punctuation\">.</span><span class=\"token function\">hide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            @$footer<span class=\"token punctuation\">.</span><span class=\"token function\">hide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token class-member variable\">@allCheckbox</span><span class=\"token punctuation\">.</span>checked <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>remaining\n\n    <span class=\"token function-variable function\">addOne</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">todo</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        view <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoView</span>\n            <span class=\"token property\">model</span><span class=\"token operator\">:</span> todo\n        @$list<span class=\"token punctuation\">.</span>append view<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>el\n\n    <span class=\"token function-variable function\">addAll</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        @$list<span class=\"token punctuation\">.</span>html <span class=\"token string\">''</span>\n        app<span class=\"token punctuation\">.</span>todos<span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token class-member variable\">@addOne</span><span class=\"token punctuation\">,</span> @\n\n   <span class=\"token comment\"># ... and so on</span></code></pre></div>\n<p>As you can see, Coffeescript uses Ruby and Python style significant whitespace, which gives it a very different feel than JavaScript.  But it retains the language’s structure, giving it a low learning curve.  All of CoffeeScript’s built in structures compile down to ES3-compatible code, so anything you write in CoffeeScript will work in any modern JavaScript environment as long as you don’t use any incompatible APIs.</p>\n<p>Coffeescript gives you plenty of niceties to help you write faster and more succinct code.  In general it’s focused on taking common patterns and finding a short succinct way of representing them.  It removes some of the boilerplate from JavaScript code by replacing <code class=\"language-text\">function(){}</code> and <code class=\"language-text\">this.</code> with <code class=\"language-text\">() -></code> and <code class=\"language-text\">@</code> respectively.  It’s a small change, but giving these common patterns easily recognizable shorthand saves plenty of characters across a code base.  These aren’t the only shorthands.  For instance it provides destructuring and string interpolation capabilities, allowing you to do things like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">a <span class=\"token operator\">=</span> <span class=\"token string\">\"example\"</span>\nb <span class=\"token operator\">=</span> <span class=\"token string\">\"This is an <span class=\"token interpolation variable\">#{a}</span>\"</span>\n\n<span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>b<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># a ends up as \"this is an example\", b is \"example\"</span></code></pre></div>\n<p>It’s easy to see that the EcmaScript 6 spec has been greatly influenced by CoffeeScript.  Features like classes, arrow functions, and splats/spreads are all parts of CoffeeScript that are going to be melded into the future of the language.  So why use it instead of something like Traceur which allows us to write ES6 code now?  The best answer I’ve seen was <a href=\"https://github.com/raganwald-deprecated/homoiconic/blob/master/2011/12/jargon.md\">this short piece</a> by Reg Brathwaite.  He argues that CoffeeScript is essentially a tool for writing good JavaScript.  The structure of the language encourages you to take advantage of JavaScript’s good parts, and the compilation process is able to encode many JavaScript best practices.  CoffeeScript features don’t add new capabilities to JavaScript, instead they encode accepted design patterns.</p>\n<p>In terms of tooling, CoffeeScript has been around a while, and has built up a good base of support in the JavaScript community.  It’s the recommended JavaScript syntax for Ruby on Rails projects and has wide support in the NodeJS community.  This community adoption means that many tools offer integrations for it.  You can also find some Coffeescript specific tooling.  For instance, there’s a <a href=\"http://www.coffeelint.org/\">CoffeeLint</a> tool that provides linting similar to JSHint.  CoffeeScript still doesn’t have the ecosystem that basic JavaScript enjoys in this area, but it has established itself enough that most common scenarios are addressed.</p>\n<p><strong>Why use Coffeescript:</strong> You like the transformed syntax, you want concise shorthand for common JavaScript design patterns, and you want to be able to write more readable code <sup id=\"fnref:1\"><a href=\"#fn:1\">2</a></sup></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.23076923076923%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVQoz32SW0tUURTHt/rQVesl6LGXoCfp9gX6GH2BIExLHXXKoqDAyLIIJHqIHIKIiMJgjCxnztzUcRgzTpinGs/MOJdz5px9W3ufKU0o9vGCRgj/h703+7cu/7UQIeCB8EBgAoQA9iW4AKZeKFXCBBhdP1MKhILgULAo4gz0Ap7LY6kAkBwkwNclUrSY4AITbrscuKi5fDOQByJl2K13Z9AvIcZ0ezBSnDXdV7NWWFd6nCp9mLe1hdrzTCWUrozOWU+mypwBJhwYFC165NYUao8gD4RRIk+ny8OJ0qNk6dq7/ANtKazbN8cLL7PVULrcFzZHpssj02Vg4BJeFyKbc/ZfSaCAhggFxiBhOOmcGzNqDualGstbrGizisNXPDmm24sVWnUYJhwTqIOYM52W/iTq0tBaJy7mjAJwZQxnKtyylONfqsOaKUF5sdGwyvzJdJq3wlvNVH4SqAtx5mEWnf8486O2LKXnh3D/C9Ptk6B+/lNDGdQ2cT38fbUuU4ZtVilnyuqd4DUeuDh9P4MuRA5dTaa+2cfvpJ9NFv6seJILPe+27ABjoqZ6ciiDOiJ7gokD/tdjt9NnQ7rl8mHNRJ1aQyCG/mGIv2d1ED+FVGVfjDb2xFC31tgbQx3Rg71xzkXgzQJqm2jqjaNNhzDmHgjpr+rrbDmbc07c24ADSg2+Bt7nekYN1B5p6tnIzBms1r3Ppju76Pz25LkX87v64ruDcdS9Tq6rS9sbiB2+MYm6t5RtuTz41th3OdHcn2wdnDk6kEaXog2B7aQvlbBTW7v+BToPg4VE6S8LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TypeScript logo\"\n        title=\"TypeScript logo\"\n        src=\"/static/64a6bd55e77a63b0c1c97bb9d90225b7/e17e5/typescriptlogo.png\"\n        srcset=\"/static/64a6bd55e77a63b0c1c97bb9d90225b7/a6b04/typescriptlogo.png 143w,\n/static/64a6bd55e77a63b0c1c97bb9d90225b7/0e2fe/typescriptlogo.png 285w,\n/static/64a6bd55e77a63b0c1c97bb9d90225b7/e17e5/typescriptlogo.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>TypeScript is a language created by Microsoft to provide static type checking for JavaScript.  It allows you to annotate variables with types, then validates your code when it’s compiled into JavaScript. The benefits are pretty obvious.  Type checking forces you to think about the values that will get passed into functions and help you catch bad logic at compile time rather than runtime.   Static types also allow for smart intellisense-style completion.  As a Microsoft creation, this is fully supported in Visual Studio, but it’s also available in other IDES like WebStorm, and there’s some support for making it work in text editors like Vim and Sublime Text as well.</p>\n<p>Although TypeScript is primarily about types, it also provides some other niceties that fit with it’s theme of tools for building large JavaScript applications.  It provides classes that matches JavaScript’s ES6 class syntax, and modules that can compile down to AMD or CommonJS format.  You also can use ES6 lambda functions.</p>\n<p>Unlike CoffeeScript, TypeScript is unlikely to shorten your code.  Instead writing type definitions will likely lead to a larger code base, but one that’s easier to reason about in a given context.</p>\n<p>The TypeScript Hello World program from their site doesn’t look too much different than the original Javascript.  The important thing to note is the ability to use ES6 features as well as the type annotations on functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">public</span> <span class=\"token literal-property property\">greeting</span><span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">greet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"&lt;h1>\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>greeting <span class=\"token operator\">+</span> <span class=\"token string\">\"&lt;/h1>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> greeter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> str <span class=\"token operator\">=</span> greeter<span class=\"token punctuation\">.</span><span class=\"token function\">greet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> str<span class=\"token punctuation\">;</span></code></pre></div>\n<p>TypeScript was obviously built to be tool friendly, and if you’re using an IDE like Visual Studio or WebStorm, they’ll be able to take full advantage of that.  But the tooling around the text editors used by most JavaScript developers is less advanced.  There’s a nice <a href=\"https://github.com/clausreinke/typescript-tools\">community effort</a> to build a TypeScript server that text editors can plug into for completion information and other IDE functions, similar to the way that <a href=\"http://ternjs.net/\">TernJS</a> works.  But there’s none of the official support that Microsoft has built into Visual Studio, and the lack of attention shows.  Still, the compiler itself fills many of the roles that linting tools play for normal JavaScript, and many developers interested in type safety are probably already using an IDE style editor that will provide full support.</p>\n<p><strong>Why Use TypeScript:</strong> You want static type checking as well as the option to use some ES6 syntax now.  Also a great choice if you’re using an IDE and want better “intellisense” while writing code.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.72027972027973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAARlAAAEZQAGA43XUAAADx0lEQVQ4yzWTS28cRRDH27viGHKBOxIfIIBP+QiR+AS8jnDiwgUhJMtCXHjkgATiAkTCxBgQiRJZJlgJFgeiWCjKwdjr3ZmemX53z2Nnd3ZnZ3a77I56HA6lHo36X/2vX1Wh+XyOJpMJqqpqrWma3mKx6FdV1S/Lcg0AUNM0yFqLVqsVWiwW/u6ls7OzK23bvjGbzT6TUv6rlNpkjCEhRN8LekdHR2vOuU64XC59clSWJWrb9lJd11estW+1bftFXdf3m6ZJ5vM5TKdTVxSFo5S6OI4PdnZ20NbW1lrnYDAYIOfc803TvLJYLN6s6/r6fD7fr6qKTqdTO5lM3Hg87hL4yLIM0jRtsyxrhBDnlFJmjLmcZRlCdV1vFkVxkOc5mUwm3ct5nntRF8YYMMa0SqlWa7XUWq+MMdYnLYrCaq2BUgpCiFcJIQhNp9MTpZTDGDvGGGitWyllK4RYCiFWSikrpbScMxBK2vQiEYzHYx/WO+WcO631O0op5Fl9Y4zxHBZhGFpKqWWMWc4YcM67EEpbmRdWkQSM1pDiEPIwgLIsvVPv3imlrmOMkW/Au75ExlgbBEFnX0kJQhvLpbJSCODDU6CP/gH803dnihAgv/wIYvd3KLIM8qJYMsYc5/yv4XCI/Dhc9cB9eXEcW6U1qNEQknt3Ibj5PeDtGxBv3wB88weg9/8AuncHyJ3fQA+OIU9TyPN85UumlNKqqi77UXmxLEvty04IWUnOIbn1M4Rff36W/P0A6JPHICMMWggwUgK5vQM6wpBVM5ulKWRZ9owxPxuPx6+hw8NDVBTFQ88hiqKlZyZxCEoIUFlupUlBaW11mloRjEAOT8FkGWilfPdBGwNCyNbPo5TybZQkCcqy7FvPAWPcJkkCyl+SsmPZ8RTiIqQEqbUVnHesCSFWK2HLQi8Y6xJ++f/avSeE8J1uMca+hIsOCy9k4Nn6/0EQWByGqyAI2lEQtJKT5fbth+cffLrropg4rdUT5Hd5Pp9f9SV74XA4tJRQG0WRDS/Ey9Fo1PhvjPF5HMeOEOLiOHFGC3f3z8ezza/2j4MA3xKCv+9XDgHAC8YYQwgBjHETx/EyiqLzKIqeiWPP1581DsP/kiT+lXP+cRDia861Lzvn+nv3DpAUDKH19XW0sbGBtNaPPFifwJ+U0hml9JhS6sUfGWNeF0K85Jx77uTkGJ0OBigIQuRc05na3XvQE4L1EWOsRylFeZ5/EsfxPiHkQ631NWtt97KfAr+jnDP/aCceDE56o9Gon8RxL8vytYQwNCkLZEyKngIVnDGNaY9VwQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Sweet.js logo\"\n        title=\"Sweet.js logo\"\n        src=\"/static/35aabaff7e0dd24e05847c09fc910aac/772e8/sweetjslogo.png\"\n        srcset=\"/static/35aabaff7e0dd24e05847c09fc910aac/a6b04/sweetjslogo.png 143w,\n/static/35aabaff7e0dd24e05847c09fc910aac/772e8/sweetjslogo.png 200w\"\n        sizes=\"(max-width: 200px) 100vw, 200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Sweet.js is a very different animal than the other syntaxes I’m covering here.  Strictly speaking it’s not an alternative syntax at all.  It’s a toolkit to building your own your own alternate syntax.  You do that by defining <em>macros</em>, which the compiler then loads and uses to transform your code.  For instance the example from <a href=\"http://sweetjs.org/\">their website</a> shows how you can define ES6 style classes in your code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Define the class macro here...</span>\nmacro <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n\n  rule <span class=\"token punctuation\">{</span>\n\n    $className <span class=\"token punctuation\">{</span>\n        constructor $cparams $cbody\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>$mname $mparams $mbody<span class=\"token punctuation\">)</span> <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">function</span> $className $cparams $cbody\n\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">$className</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$mname</span>\n      <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> $mname $mparams $mbody<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">...</span>\n\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// And now classes are in JavaScript!</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" says: \"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> bob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bob\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbob<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Macros are sweet!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Sweet.js basically removes limits in terms of what your JavaScript syntax looks like.  If you can programatically define a syntax, you can use it.  And because Sweet.js macros are hygienic you can have confidence that you can use them without side effects.  This means that you can wipe away boilerplate, hiding it behind a new operator or keyword.  The modular nature of macros is also a big plus.  Rather than being locked into a syntax and set of capabilities <sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>, using macros allows you to mix and match the syntax you need.</p>\n<p>Relative to the other languages on this list though, Sweet.js lacks a lot of the benefits of a community standard. Any macros you write will only be documented to the extent you document them, and while you can run linting tools on the output, pretty much any other tooling out there, including basic stuff like syntax highlighting, is likely to be unable to parse the non-standard syntax created by macros.</p>\n<p><strong>Why use Sweet.js:</strong> You want your JavaScript syntax to work in a very specific way, and none of the existing options appeal to you, or you find yourself writing a lot of repetitive boilerplate that you can remove with a syntax change.</p>\n<h3>Traceur</h3>\n<p>The last alternate syntax that I’m going to be going in depth on is a bit different, because it’s technically just JavaScript syntax.  But it’s a form of JavaScript syntax that’s not supported everywhere yet.  <a href=\"https://github.com/google/traceur-compiler\">Traceur</a> is a project by Google that allows you to write code that’s valid in EcmaScript 6, and transpile it down into browser-compatible ES5 JavaScript.  Effectively it’s tomorrow’s JavaScript a bit early.  This has some obvious advantages.  First, it will eventually obsolete the compile step as all of the features of ES6 will be supported in browsers someday, and the changing world of browser release policies seem likely to make that sooner than you might expect.  Secondly, tools and other support around ES6 is shaping up nicely, and it’s guaranteed to get better, because this is just JavaScript.  It’s the future of the web platform.</p>\n<p>The case against using Traceur?  Besides the repeated themes of weaker tooling and an additional build step, Traceur simply doesn’t offer as much as the other syntaxes mentioned here.  It doesn’t significantly change the feel of the language like CoffeeScript, provide any clear new features like Typescript, or offer the flexibility of Sweet.js.  In the end it’s “just Javascript”, arriving a little bit early.  The question you need to answer is whether that’s enough to justify the compile step.</p>\n<p><strong>Why use Traceur:</strong> You like JavaScript but are frustrated by slow standards adoption.  You want to use the newest features of the language now while still supporting a variety of platforms.</p>\n<p><strong>Update:</strong> <em>Since I originally wrote this post, <a href=\"babeljs.io\">Babel</a> (formally 6to5) has exploded in usage and popularity as a tool for using future JavaScript features today. There are very good reasons for this.  It is much better documented than Traceur, supports more features, and generally aims to be a tool that people are using to build things, whereas Traceur has always felt like more of a tool for learning about the future of JavaScript.  I would highly recommend Babel for anyone looking to use future JavaScript features in their web projects.</em></p>\n<h3>Other Options</h3>\n<p>I chose to highlight the 4 syntaxes above because they’re the most popular general purpose alternate syntaxes for JavaScript.  But there are a few others worth mentioning here, for the sake of completeness if nothing else.</p>\n<p><a href=\"http://facebook.github.io/react/docs/jsx-in-depth.html\">JSX</a> is seemingly becoming quite popular as an extension to the JavaScript syntax, but I chose not to highlight it here because it is currently so tightly knit to <a href=\"http://facebook.github.io/react/\">React</a>.  While it is <a href=\"http://blog.vjeux.com/2013/javascript/jsx-for-the-real-dom.html\">technically possible</a> to use JSX for things other than React apps, in practice JSX has a limited enough scope <sup id=\"fnref:3\"><a href=\"#fn:3\">3</a></sup> that there’s no real motivation to do so.  If you’re building a React application though, JSX is certainly worth exploring, as is the next syntax.</p>\n<p><a href=\"http://flowtype.org/\">Flow</a> is a new JavaScript syntax created by Facebook that uses the same type annotations as TypeScript, but does so in a way that aims to provide better type inference as well as supporting JSX.  I’m very interested to see where it goes, but for now it’s still early days as it was only announced <a href=\"https://code.facebook.com/posts/1505962329687926/flow-a-new-static-type-checker-for-javascript/\">last week</a>.</p>\n<p><a href=\"https://docs.google.com/document/d/11YUzC-1d0V1-Q3V0fQ7KSit97HnZoKVygDxpWzEYW0U/edit\">AtScript</a> also uses TypeScript’s type annotations, is mostly tied to a single framework, and in terms of public usage doesn’t really even exist yet <sup id=\"fnref:4\"><a href=\"#fn:4\">4</a></sup>.  So why is it worth a mention?  Because it is the syntax that AngularJS 2.0 is being developed in, and will be the first class “recommended syntax” for that framework when it is released next year.  Since Angular is currently the <a href=\"http://www.google.com/trends/explore#q=AngularJS%2C%20BackboneJS%2C%20KnockoutJS%2C%20EmberJS%2C%20ReactJS&#x26;date=1%2F2012%2035m&#x26;cmpt=q\">most popular</a> JavaScript MV* framework, that carries some weight and makes AtScript worth tracking, especially for Angular developers. But in today’s world it’s not a real contender to be used in a project.</p>\n<h3>Decisions</h3>\n<p>So how do you decide what JavaScript syntax to use?  My recommendation is to start by assuming ES5 JavaScript as a default.  Then examine any problems you’ve run into while using it.  Does your team struggle with JavaScript gotchas?  Has your project become large enough that a strong type system would provide more benefits than cost?  Do you really need some domain specific syntax to clean up your code?  Or are you happy and productive as is?  At that point you can decide whether a different syntax could help you get around those problems, or if the hassle of compilation steps and overhead of a new syntax would just end up making things worse.  You don’t want to use CoffeeScript or Traceur because they’re cool or different.  You’ll want to use them if they solve your problems.</p>\n<h3>More Resources</h3>\n<ul>\n<li>I linked to Reg Brathwaite’s <a href=\"https://github.com/raganwald-deprecated/homoiconic/blob/master/2011/12/jargon.md\">CoffeeScript is not a language worth learning</a> above, but I want to reiterate that it’s worth a read for anyone who’s interested in CoffeeScript, or who wants to understand why people would be excited to use it.</li>\n<li>Steve Sanderson’s vide on <a href=\"http://vimeo.com/97519516\">Architecting large Single Page Applications with Knockout.js</a> covers a lot of stuff and it’s worth watching the whole thing.  But if you skip to the 49:30 mark, he has a nice 10 minute discussion of TypeScript, his teams experience building a large application in it, and the pros and cons they found.</li>\n<li>I’m admittedly a bit skeptical about the value of Sweet.JS, but if you want to hear the case for it from somebody who really believes in it, take a look at this essay: <a href=\"http://jlongster.com/Stop-Writing-JavaScript-Compilers--Make-Macros-Instead\">Stop Writing JavaScript Compilers! Make Macros Instead</a>.  It does a great job of laying out the case for composable macros as an alternative to “monolithic” compilers.</li>\n<li>Finally, Axel Rauschmayer has a <a href=\"http://www.2ality.com/2014/10/typed-javascript.html\">great roundup</a> of the various languages looking to add type systems to JavaScript, diving pretty deep into each and clearly explaining the differences between TypeScript, Flow and AtScript.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:0\">\n        <p>\n        <a href=\"http://en.wikipedia.org/wiki/ECMAScript\">EcmaScript</a> is the \"official\" name for the JavaScript language as described in its specification.  EcmaScript 5 was the most recent finalized spec, published in December 2009. In practice though, JavaScript environements are never strict implementations of a specific spec.  Instead they gradually bring in features over time alongside the standards process.\n        </p>\n        <a href=\"#fnref:0\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        Yes readable is a \"beauty is in the eye of the beholder thing\".  But readability is certainly a reason that many people are interested in CoffeeScript, and many of it's operators are designed as meaningful shorthand for operations that are more bloated in JavaScript.  While that  may present an initial readability barrier, in the long term it can make for a more to the point code base.\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:2\">\n        <p>\n        For instance it's taken CoffeeScript a looong time to implement support for generators.\n        </p>\n        <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:3\">\n        <p>\n        Effectively all JSX does is allow for a convenient representation of the DOM within JavaScript.  While this is very important for React, and may be useful in some other cases, it does not provide the level of general purpose value of any of the other syntaxes mentioned in this article.\n        </p>\n        <a href=\"#fnref:3\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:4\">\n        <p>\n        You can use it and get it to compile by passing an option to Traceur, but as far as I know nobody is actually doing so yet outside of the Angular 2.0 team.\n        </p>\n        <a href=\"#fnref:4\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/11/24/alternative-javascript"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-es6-1","topics":["backbone","marionette","javascript"],"category":"frameworks","key":null,"title":"Building Complex Layouts With Marionette.js","description":"How to build complex UIs with Marionette.js","layout":"post","path":"/2014/12/22/building-complex-layouts-with-marionette-js","date":"2014-12-22T04:43:47+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the third post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>.  For more background on what Marionette is, check out the first post in the series, <a href=\"http://benmccormick.org/2014/12/02/the-case-for-marionette-js/\">The Case For Marionette</a>  Also note that this article was written about Marionette v2.  The current latest version of Marionette is v3, and while most of the high level concepts remain the same, the specific syntax has changed in some cases.</em></p>\n<p>When building complex web applications, many of the first decisions you have to make revolve around the structure and layout of your application. Most applications will have some static portions like navigations or footers, and some dynamic portions holding content or page specific controls.  A good layout manager will allow you to easily control these layouts, helping you keep structure consistent between pages and actions while swapping out content on changes in routes or data.</p>\n<p>Backbone provides Views as a way of managing the display of a web app’s UI.  But it doesn’t provide any guidance on how you should use them to construct complex layouts.  Should you have one view per page and control the layout with templates and jQuery?  Use one View for each section of the page?  Or have a top level view that creates child views to manage different sections?  All of these are possible with Backbone, and none of them are particularly encouraged or discouraged by the library design.  In fact because Backbone doesn’t provide any consistent conventions for managing subviews, rendering content, or attaching rendered content to the DOM, even projects that take the same approach to managing layout might implement these patterns quite differently.</p>\n<p>In my <a href=\"http://benmccormick.org/2014/12/02/the-case-for-marionette-js/\">first post</a>, I talked about how one of the strengths of Marionette is the way it helps remove many of the decisions that Backbone developers have to make for each project by providing components based on community-tested patterns.  Layout is another area where Marionette can give you a standardized solution.  Marionette does this by providing Regions and by making it easy to manage child Views.</p>\n<h3>Layout in Marionette</h3>\n<p>Regions are the primary tool Marionette provides for defining layouts.  A Region is a defined portion of the page, held within a root DOM element. You can swap different Views in and out of Regions, or show one View and let it stay there permanently.  Like everything in Backbone applications, Regions emit events, which allow you to design functionality that is triggered before or after a region’s content changes.  Regions map very well to low fidelity layout wireframes like the one below, but they also can be used for organizing smaller components.  They’re an organization tool for attaching and removing Views in a consistent way.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.02797202797203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAABYlAAAWJQFJUiTwAAABP0lEQVQoz5WRy07CQBSG+3omldJS0GKBRFQMcamJ8XW0nZahCIQNxqULNl5KvLQxCvgW/3FjZri0iQRt8q1O5zuXv8rdaHT/8jGOv17fZ5+TWRjNxvGKaRhNHyVP0TSMEx7eJuFzpDR6sAPYATUHdDb83uNUC6gqqQS0f02HPTrqUb1LlQ5VJbUOWZzOb6CoDjQX6hVMD/Uucg7y7gLNRdFHuS0otZCTFc1FnmHrEqdDUgwGg4mnFsfJgAwPpp9Q8DB/UEjVi7LRxS0pOoMu5aL8kJONV+gp0kXVwUE3JZd8lLnYSmd/YDBsOzjuL2VNylYWudEnxfRht0XgFscuFytkkOdhFDzstIScnpxnomi3Ue2I1qu+ibx5bRHykjWT04Gtvfl38hnkTTfrbvKfMwdm+oubLS6C+edk1UFzQD/mRjCUIr7VpQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Regions image\"\n        title=\"Regions image\"\n        src=\"/static/331a9e83c26d8624a64ca39ca049925c/432e7/marionette_regions-1.png\"\n        srcset=\"/static/331a9e83c26d8624a64ca39ca049925c/a6b04/marionette_regions-1.png 143w,\n/static/331a9e83c26d8624a64ca39ca049925c/0e2fe/marionette_regions-1.png 285w,\n/static/331a9e83c26d8624a64ca39ca049925c/432e7/marionette_regions-1.png 570w,\n/static/331a9e83c26d8624a64ca39ca049925c/77800/marionette_regions-1.png 855w,\n/static/331a9e83c26d8624a64ca39ca049925c/b5cea/marionette_regions-1.png 1140w,\n/static/331a9e83c26d8624a64ca39ca049925c/1d7f7/marionette_regions-1.png 2038w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Regions really shine when it comes to child Views.  When you’re setting up Views in a normal Backbone application, you have to be very careful to avoid memory leaks by replacing a view without properly destroying it, especially for long-running SPA style apps. If you’re properly cleaning up Views when they’re destroyed, another thing that Marionette can help with, Regions remove that pain by ensuring that a View is properly destroyed if replaced in a Region, removing boilerplate and the opportunity for subtle memory bugs.  They also provide a clean central way to attach child Views, making it easier to maintain consistency across a project and promoting readability when moving into different code.</p>\n<h3>LayoutView</h3>\n<p>Regions are great, but for the most part you’re not going to want to use them directly.  Instead, Marionette provides a special View class, LayoutView.  LayoutViews allow you to build View tree hierarchies.  You can have one top level View that controls the entire page, or a section of the page that your Marionette app lives in.  That root view can then contain Regions which you use to show child Views.  Some of those child Views may themselves be LayoutViews, and so on for as many levels as you like.  This setup allows you to create modular View classes with few responsibilities that you can easily replace or update without having to write a lot of boilerplate code.</p>\n<p>That’s the high level overview, but let’s dig into what the code looks like.  To use regions in a LayoutView, we don’t have to directly create them.  Instead we define a regions object that works similarly to the events object on normal Backbone Views.  The regions object takes a Region name as a key and a jQuery selector as a value, and then create Region objects for each key-value pair and attach them to the View.  If you need to do something more complicated you can create a regions function that returns an object with the key-value pairs that you would like.  Here’s an example of what a LayoutView might look like in practice.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Mn <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.marionette'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> Radio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.radio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> FooterView <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/footer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> HeaderView <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/header'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> IndexView <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> RootView <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>LayoutView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  <span class=\"token literal-property property\">regions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">header</span><span class=\"token operator\">:</span> <span class=\"token string\">'#navbar'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token string\">'.content-area'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">footer</span><span class=\"token operator\">:</span> <span class=\"token string\">'footer'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">initialize</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Radio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'set:content'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">contentView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span>contentView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">onBeforeShow</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'header'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HeaderView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'footer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FooterView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRegion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This is an example of a RootView that could be shown in a standalone Region and used as the top-level of a View hierarchy.  There are a few things to note about this example.  It defines 3 regions, a header and footer that render static Views, and a content area that originally contains an index View.  The initialize function uses Backbone.Radio to listen for commands and can swap out the View held in the content region when commanded. Those views could be swapped based on users navigating to a new route, with the routes initializing the Views and passing the commands, or based on a data change of some type.  We can also see that the child Views are shown within the onBeforeShow callback.  I’ll be discussing View life-cycle methods more in my next post, but for now just know that onBeforeShow runs immediately before a View is shown in a region.  You can use it when nesting your Views in order to make sure your Views are only attached to the DOM once, which prevents the browser from having to repaint the window multiple times.</p>\n<h3>It’s Turtles All The Way Down</h3>\n<p>The great thing about Marionette’s View system is that you can take the 3 Views I’ve gone over in my last 2 posts, ItemView, CollectionView, and LayoutView, and use them to represent pretty much any layout you’d like.  The basic rules: LayoutViews are used to structure the page into regions and regions into subregions. ItemViews are used to bind data to a UI, and CollectionViews are used to iterate over a Collection when each item in a Collection has complex data or behaviors associated with it and should be bound to an individual View or View tree<sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>. This consistency makes it easy to learn how to structure Marionette apps, and makes it simple for experienced Marionette developers to jump into a new project quickly and get their bearings.  That’s really the promise of Marionette in a nutshell: consistent patterns that allow for a better development experience.</p>\n<h3>More Resources</h3>\n<ul>\n<li>For more on nesting Marionette Views, you can check out <a href=\"https://www.youtube.com/watch?v=CTr-tTwRH3o\">this talk</a> by Marionette core team member Sam Saccone.  It’s a quick 10 minute video covering much of the same stuff I went through here.</li>\n<li>I’ll talk more about this in a future post, but if you have a Marionette app and want to visualize your View hierarchy, <a href=\"https://github.com/marionettejs/marionette.inspector\">Marionette Inspector</a> is a great new tool for debugging Marionette apps, and it’s primary developer, Jason Lastner gave a <a href=\"https://www.youtube.com/watch?v=jbGm3mJXh_s\">great talk</a> describing how to use it at BackboneConf this week.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        Marionette also contains a 4th View type, CompositeView.  But it's essentially a helper for the case where you want to display a CollectionView inside a region of a LayoutView, and isn't strictly necessary.  Technically you can also use LayoutViews to replace ItemViews, but the semantic difference is useful for encouraging readability.\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/12/22/building-complex-layouts-with-marionette-js"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","marionette","javascript"],"category":"frameworks","key":null,"title":"Marionette Explained: Connecting Data to Your Views","description":"How to bind data to your views in Marionette.js","layout":"post","path":"/2014/12/10/marionette-explained-connecting-your-data-to-your-views","date":"2014-12-10T12:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the second post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>.  For more background on what Marionette is, check out the first post in the series, <a href=\"http://benmccormick.org/2014/12/02/the-case-for-marionette-js/\">The Case For Marionette</a>.  Also note that this article was written about Marionette v2.  The current latest version of Marionette is v3, and while most of the high level concepts remain the same, the specific syntax has changed in some cases.</em></p>\n<p>One of the most interesting design choices of <a href=\"http://backbonejs.org/\">Backbone</a> was the decision to not provide a default render function for Views. Backbone Views by default are an empty function that adds nothing to the DOM when rendered.  Although a View can have a Model or Collection associated with it, there is no built in way to associate that with the generated View.  When you contrast that to other modern frameworks like Ember, Angular and KnockoutJS, and their emphasis on using 2 way bindings to associate a data object to a rendered View, Backbone can feel a bit incomplete.  The goal is to allow for a variety of rendering approaches, without making one of them a favored approach.  But it leaves a situation where choosing a rendering procedure is one of the first steps in any new Backbone project.  Marionette provides a structured approach for binding your data to your view layer, while still providing flexibility to introduce customization.</p>\n<h3>Rendering and Data-Binding in Marionette</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.75524475524475%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvklEQVQoz2P49P3X1H3XurZdPHLrxf/////9+/cfDCDU5gsP27dcWHjkFlwcGTA8fvtZp3qNbNGy1s3n/////+fvP4hOiNqshYelC5d69m7//ecv3ESE5ufvvzh3bjapXztp1+X//////QcCv//+g5hSseqEYd3a6Ol7fv35A9L89++/P38gCKT595+/N56+vvjg+etP38Ca/0IcCLHk6btPlx6+vP/qPUQK3dkg0d+////+++bb+3tvH/7////zj1+bzz88cfclRMXf7z/ff/1w9839////v7l68VRLxdnuhrM9jT/ev2P48P1j/9FZk4/ObdjXE7gs6fXXF62bLmpUrjRuWHf89uu99/Y375nQdnCSx4LwO1+eP9+7c7Wd9hZ/+w0e5p+fPGJ49+1926GJXUemlu1q9loc/eLz04qVp3SrVxvUrt539fm229uq93TW7euyne17/fPjZ7u2LTdT2hLgsNZBD6QZHj2vvry58erO////33/5Nu/A1R0XH4B9DpJ69+3D9Rc3//////LCmcPl2UdrC481lHx/9xakGRJ8oKD6/+8fanT8/ff3z98/f//9+fcfFpJIAQYAXODInkUKJD8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rendering diagram\"\n        title=\"rendering diagram\"\n        src=\"/static/c46f3a6beda389f53c3b773508f44dee/432e7/renderpattern-3.png\"\n        srcset=\"/static/c46f3a6beda389f53c3b773508f44dee/a6b04/renderpattern-3.png 143w,\n/static/c46f3a6beda389f53c3b773508f44dee/0e2fe/renderpattern-3.png 285w,\n/static/c46f3a6beda389f53c3b773508f44dee/432e7/renderpattern-3.png 570w,\n/static/c46f3a6beda389f53c3b773508f44dee/5a190/renderpattern-3.png 800w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Marionette.JS handles rendering in a way that is similar to the <a href=\"http://en.wikipedia.org/wiki/Model_View_ViewModel\">Model-View-ViewModel</a> pattern that developers who have used KnockoutJS or Durandal will be familiar with <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>. Marionette implements its render cycle through 2 primary methods available in all of its base View classes.  The first is <code class=\"language-text\">serializeData</code>. serializeData is a function that produces what is essentially a <code class=\"language-text\">ViewModel</code> in the sense of an MVVM application. It takes your data (a Backbone Model or Collection), and pulls it into a simplified form that a View can easily render.  By default Marionette will simply call the Model or Collection’s <code class=\"language-text\">toJSON</code> function to serialize the Backbone object down into a simple JavaScript object.  But it’s possible to override serializeData to provide more complicated logic.  For instance here’s an example from the <a href=\"https://github.com/tastejs/todomvc/tree/gh-pages/examples/backbone_marionette\">Marionette TodoMVC project</a> that takes a collection of todos and calculates a few values to show the number of completed todos.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">serializeData</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> active <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">getActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> total <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">activeCount</span><span class=\"token operator\">:</span> active<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">totalCount</span><span class=\"token operator\">:</span> total<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">completedCount</span><span class=\"token operator\">:</span> total <span class=\"token operator\">-</span> active\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Once the serialized data/view model has been prepared, data is passed to the render function which starts by looking for a template to render.  In Marionette, templates are defined by setting the template property on your View, or by setting a getTemplate method if you want to conditionally load your templates. The render function takes that template, passes it the serialized data, and renders it using a template engine.  The default Marionette template engine is Underscore, which makes sense since it’s a Backbone dependency already.  But it’s easy to switch to a different templating engine.  Here’s the entire chunk of code I wrote to use Handlebar templates in Windsor Circle’s Marionette app.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//render templates with Handlebars instead of Underscore</span>\nBackbone<span class=\"token punctuation\">.</span>Marionette<span class=\"token punctuation\">.</span>Renderer<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">render</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">template<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> renderer <span class=\"token operator\">=</span> Handlebars<span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span>template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">renderer</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>ItemView and CollectionView</h3>\n<p>Marionette provides several View classes that you can use as bases, but the core Views for representing data are ItemView and CollectionView.  An ItemView takes a single data object, either a Model or Collection and passes it to the template to render.  A CollectionView iterates over a Collection and renders a child View for each Model. You can either use the same View for every Collection, or mix and match Views based on the Model’s properties.</p>\n<p>So for instance, views for a simple todo list might look something like this <sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> TodoView<span class=\"token operator\">=</span> Marionette<span class=\"token punctuation\">.</span>ItemView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">tagName</span><span class=\"token operator\">:</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token string\">'&lt;span class=\"checkbox\" {{checked}}>&lt;/span>&lt;span class=\"text\">{{ text}}&lt;/span>&lt;span class=\"delete\">&lt;/span>'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">events</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'click .checkbox'</span><span class=\"token operator\">:</span> <span class=\"token string\">'toggleChecked'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'click .delete'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'deleteItem'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">serializeData</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">checked</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'checked'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">'checked'</span><span class=\"token operator\">:</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">toggleChecked</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//logic for checking the box</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">deleteItem</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//logic for deleting the todo</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> TodoListView <span class=\"token operator\">=</span> Marionette<span class=\"token punctuation\">.</span>CollectionView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">childView</span><span class=\"token operator\">:</span> TodoView<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">tagName</span><span class=\"token operator\">:</span> <span class=\"token string\">'ul'</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When the TodoListView is given a collection and rendered, it will display an unordered list of rendered TodoViews, with the data for each model bound to the template object associated with TodoView.</p>\n<h3>A brief note on 2 way data-binding</h3>\n<p>Marionette data-binding is one-way by default.  Over the last few years the discussion around data-binding has gone from “cool there’s structured data-binding” when Backbone first came out, to “how can you ship without 2-way data-bindings?” when Knockout, Angular and Ember popularized the 2-way approach, to “1 way bindings keep things simple and they’re cool again” based on the popularity of React.  I’m not going to go deep into that debate during this post, but the important takeaway is that Marionette generally prefers explicit bindings to implicit.  So when model values change, it will be based on code that you’ve written, not implicit library code.</p>\n<h3>Wrap-Up</h3>\n<p>I kept things pretty simple in this post, but consistent data binding is a core part of what Marionette provides.  Having a single documented system for attaching Model and Collection data to Views is a big win for keeping Backbone applications lean and readable.  When using these conventions you can move from View to View or project to project and quickly pick up on the intent and structure of the code.  Instead of trying to solve these problems for every  View, you can rely on the experience of others and focus on writing code to achieve your application’s goals.</p>\n<p>This was a short but important start to diving deeper into Marionette. I’ll talk more about layouts, view life-cycles, and other Marionette features in future posts, but at their heart, web applications are about exposing data in rich UIs.  Without that core, your web applications won’t have much function at all.  So make sure to understand and take advantage of this aspect of Marionette before you move on to anything else.</p>\n<h3>More Resources</h3>\n<ul>\n<li>If you absolutely must have 2 way data bindings in Backbone, <a href=\"http://nytimes.github.io/backbone.stickit/\">Backbone.stickit</a> is a good project to check out.  At Windsor Circle we use it for binding model data to forms (2 way data-binding’s best use case).  Rather than the template based approach most libaries use for 2 way data-binding, stickit allows you to configure bindings declaratively in your view code.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        MVVM is normally associated with 2 ways bindings though, which Backbone and Marionette do not provide\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:2\">\n        <p>\n        In practice Marionette developers would likely use a ui hash on the TodoView, pull the template out into a separate file, and might have the CollectionView be a CompositeView to provide structure around the list.  But I'll dive into all of those things in more detail in future posts.\n        </p>\n        <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/12/10/marionette-explained-connecting-your-data-to-your-views"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javascript"],"category":"frameworks","key":null,"title":"The Case For Marionette.js","description":"Making the case for Marionette.js as a framework for front end development","layout":"post","path":"/2014/12/02/the-case-for-marionette-js","date":"2014-12-02T01:53:52+00:00","dontfeature":null,"isDraft":null},"html":"<p>Building large web applications using <a href=\"http://backbonejs.org/\">Backbone.js</a> can be hard.  Backbone is a great tool, but it’s designed to be minimalist and useful in a wide variety of situations.  As a result, you get less guidance and support from the tool as you scale up than you do from more opinionated frameworks like <a href=\"https://angularjs.org/\">Angular</a> and <a href=\"http://emberjs.com/\">Ember</a>.  When a Backbone application grows, maintaining it requires adding structure, either through a custom set of conventions and components, or based on somebody elses framework.  There are a lot of different Backbone frameworks out there, but I want to make the case for using <a href=\"http://marionettejs.com/\">Marionette.js</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 355px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0c7dbedbcc10868db2db704e69cd9ad/526ee/marionettelogo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124.47552447552448%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGL0lEQVQ4y1WUeXATVRzHX1JE0RFUHCxJm+y+Pd6mSYo0KRRarkG8GHHwQIHxQGVEYFRUtGVAhmHoEXrnaktpG5q0KS1QwEK5WktJm7HNvraIx+DoiKKO4ljgD6U5nvM2aYE3s8fsfvez39/1AAAAdHWfB+e6etRnz31Jryu7v+wd7g8OrPzr2j/q/uAACMnDoP34CXC4/ThobmmjV2vrofbuEydPNzb6/KDO41Wd6+oBE+uLjk5QV38gqXZ/A/D6/Ov313lI26F2cur0ud96L/TnyvLwjI7OM5Pajhx7qbmlLVjv8RKHs4rU1nla33rnXfDGundULQcP3QZe+3sU7NqdDwqKisHuPYXJedt25Hz6ad6aikpnV1PzQdJx4tRf/oOHvq+t85CycvsPuXnbP8jN2569p8CW5nLXAIerWv3P6M3bQEIIcLprVA5XNX1pbvK3Tr02evMhb1OL0+6sIra9pdeLbCU/u6v2keNfnJQvX/4x+3wgONXhqp5VWm4HlQ63ioY+sZzuGuVhhd0FKuwuc01tvXZ/neeS3eG+UmQr2fLxJ59ply17+r78Attyp6v6qK+pJXb48NGXC2wlPDVT6XArh7IwREDmJNC+9o2kjVd+Ba7i8owDuwseKSwqtu7Y9jlTUlYJNm16H6xavRYUFu4FtwgBO3fteaJ2244H3CXlmSeeW3nPj0lT1KefXaGwgAxFMCikqb6Zngx6sheD3EA/TwAAH1DnjT5LHgCq/OJSdVF9vbrx31HgavbDA16f/thr68C23oCBavtmZ4I/E+YoUIUZAWBWhDKHVgcy51dh3tD6VSo30PjsS0XPEzI5mYaVuTQpP9kIijdvXd3JmQYuMvzxgCXLFxKNG7Cet4ZEoyoBRGp6gyE6I7MiGdTzZAiKJKgXiU+wkIblL6/0LngavF5WDTw7dz1YKmX9fDQFkYscIoN6gdBvMERhmRU1MkuBLAIhTpqMWXFkkDeQs9Z5Y8MMH77ASmPNGgPx60y/+/Xm1AadGTg0xiNlMyTSlmq4dYnhwz2z50SCaeljQ4xAQpxklVkxURSIpmNGuBoS0sj5nMXRkVQY6zZbSeOs7LB/pkT8elOfQ2ty2WcgUgotEX9GTuzrVDbW/3hmLGDJig7pOBLiDSviIbMiBaZgRrg5KBpJz7yFsRE9T7oZQ9Qzd2nMN3tBxK+RiPsxiVRylmhZ1lOxJjY9elHHkWB6RixgnRdRgJz05ngOaduwmBEiA5KZ9M7NocBYF2MgTRqJeDOXRLwZC6NuwRqpzHoyWqY1Ea9GIlQTTLeQcaDMSZsVID2FOInHjEC+SpsV652THRnW86QPSp0+nekn6s5rWTTqzHnmD7vGSMqSDdE2fVrrRT0XDqZnUGA4AfwoARSpwwnghTnZYaznyQiHCmpS0gW/znTDrzUQV7I0Zp+ZRmwzTW//IKDsIT1PgumW6B3ALfK4w7tCzloQpuIQRHVnGANo1RmFZp1pxK01/lepMa5p1xnAICe9kABG7gBuijtklSprMSveUKo8f+EYFcsQNf/C86A2xQw8KcZptVqjsDvZBL7jlIjWKEBzRjiQmSgKb3j9dlEgehgzwhUK7MlZEk4AT4dYBDr0aZPqU4xgn9YIOnTSvYkUbaSavow5Y32WueNt88xEDgdFoxqzYijEG0jAknWV5lOGKETfXeYEGrZqn9aoGoJikgKEaCfV9D+eeXUAmW4qek4yj1c5KeGyDdMxisMIZsXrMkQP0T7FEKnk+HjGx5QV2xQNI1Ad1V+jwzGk4xSgCtOPWJGXIVolQ7QRs2K+DFEVhkhDHSmaOHB8snZgVnTKEH0oQ7RWhmhu6/r3VB0vvjIxenEHcTAYv5dvg9R3HXdo6E7VP8sKShoOgMv3T0sUJR5WKqYzDZGAIZqc+BF9rqWdoHQDO+FQyX2INyR9P/VRcH7+IlDhrllhd7jL6X6YlHCxFbOoAUPUjiF6DUO0CkO0BrNoqwzRqxiiVzBEGzBEy2VWfBtDsVCGyIZZcR1mxbU1+bZVFe6aXcp+mHCyWoaoE7Nov8wiP4YIY4hyZYgqMURH6X6JWSWvZzEUT8oscmBWtMkQHcaM0DmiZaZvufTtlP8Bkk1G0xw1qEcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Marionette Logo\"\n        title=\"Marionette Logo\"\n        src=\"/static/a0c7dbedbcc10868db2db704e69cd9ad/526ee/marionettelogo.png\"\n        srcset=\"/static/a0c7dbedbcc10868db2db704e69cd9ad/a6b04/marionettelogo.png 143w,\n/static/a0c7dbedbcc10868db2db704e69cd9ad/0e2fe/marionettelogo.png 285w,\n/static/a0c7dbedbcc10868db2db704e69cd9ad/526ee/marionettelogo.png 355w\"\n        sizes=\"(max-width: 355px) 100vw, 355px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I’ve been using Marionette for the past year, and it’s been incredibly valuable.  It’s really helped ease a lot of the initial issues I found with scaling out Backbone.  But there was one big issue with Marionette when I started with it. It was not simple to figure out how exactly I should be using it.</p>\n<p>When I start to use a new piece of software, I’m always hoping to see 2 types of documentation.  The first is the nitty-gritty stuff that most people associate with documentation.  What are the APIs available, what can you pass to them, what components, features, or functions does it provide?  The second type is what I think of as the “story telling” documentation.  It overlaps a bit with marketing, but basically it’s the documentation that explains the value of the software, gives you ideas on how you might use it, and outlines the philosophy that lead to the tool.  Without the first type of documentation you end up with an exciting idea that you may struggle to implement.  Without the second type, you can end up with a lot of nice tools that you aren’t sure how to combine together.</p>\n<p>Marionette is great, but it’s a tool that doesn’t have much of the story telling documentation I mentioned above.  It gets off to a good start, with the following intro on its website:</p>\n<blockquote>\n<p>Backbone.Marionette is a composite application library for Backbone.js that aims to simplify the construction of large scale JavaScript applications.</p>\n</blockquote>\n<blockquote>\n<p>It is a Collection of common design and implementation patterns found in the applications that we have been building with Backbone, and includes pieces inspired by composite application architectures, event-driven architectures, messaging architectures, and more.</p>\n</blockquote>\n<p>But the site fails to follow through on explaining the values or philosophy that went into building it.  Instead, when you start with Marionette you’re left with a bunch of components that are well documented individually, without much guidance on how to put them together or use them.  Any explanation of the value added is scoped to an individual component in the docs, and there’s no real indication of why these particular components are bundled together. I’m going to try and provide this type of high level explanation of the value that Marionette can bring, laying out the big picture in this piece and then digging into each area of value in future posts.  To start, let’s look at the problems that Marionette is trying to solve.</p>\n<h3>Decisions, Decisions</h3>\n<p>Developing with Backbone is an exercise in decision making.  Backbone provides you with a minimalist set of Models and Collections that essentially serve as light wrappers around JavaScript objects synced over Ajax. It provides you lightweight Views that associate an object with a DOM node and some data.  It provides a router that associates URLs with function, and it provides helpers for managing events between all of these options.  That leaves Backbone developers with many questions to answer.</p>\n<ul>\n<li><strong>How do you render Views?</strong> - By default, Backbone’s render method does nothing. To use it, you need to fill in your own rendering function.  That could use a templating system like Underscore templates or Handlebars, jQuery manipulation of the DOM, or simple string inserts with <code class=\"language-text\">.innerHTML()</code>.  You could use the same method for every View, or mix it up and use different methods for different Views.</li>\n<li><strong>How do you manage relationships between objects?</strong> - By default Backbone provides a way to manage sets of Models as a Collection, but it doesn’t have any built-in utilities for handling nested Models or Collections.  And if you want to nest your Views you’re completely on your own.  You can have a View manage it’s child Views, have a single object that manages all Views, or let each View manage itself.</li>\n<li><strong>How do your Views communicate between each other?</strong> - Views will often need to communicate with each other.  If for instance one View needs to change the contents of another area of the page, it could do so directly through jQuery, could get a direct reference to a View managing that area and call a function on it, change a Model that another View listens to, adjust a URL that a router listens to, or fire an event that another View could respond to. Apps can use some combination of all of these methods.</li>\n<li><strong>How do you avoid repeating yourself?</strong> - If you’re not careful, Backbone can involve a lot of boilerplate.  Taking the naive approach, you could end up writing rendering code, View management code and event management code over and over again in every View.  If you try to get around that using inheritance, you can end up with brittle designs that require you to make calls down to a Views prototype when you want View specific code.  Avoiding that type of repetition and the maintenance overhead it brings is a challenge.</li>\n<li><strong>How do you manage a View’s life-cycle??</strong> - What code is responsible for rendering a View?  Does it render itself on creation?  Or is it the responsibility of the object creating it?  Does it get attached to the DOM immediately on render? Or is that a separate step?  When the View is removed from the DOM or deleted, how do you handle any cleanup that is needed?</li>\n<li><strong>How do you structure your application?</strong> - How do you get your app started?  Do you have a central object that starts everything, or is it more distributed?  If you do centralize, do you use the router to start things, or provide some other object for managing your code?</li>\n<li><strong>How do you prevent memory leaks?</strong> - If your application is a <a href=\"http://en.wikipedia.org/wiki/Single-page_application\">Single Page Application</a> or it contains long lasting interactive sections, another issue that you may need to deal with is memory leaks.  It can be easy to create “zombie Views” in Backbone if you’re not attentive to the need to unregister events attached to a View after you’re done with it.</li>\n</ul>\n<p>That’s just a small sample of the type of decision making that you have to make for a Backbone project.  Those questions signify flexibility, but they also represent mental overhead.  If you’re like me, you see these common problems and think that you can get better results relying on a shared solution that leverages the experience of the community.</p>\n<h3>What does Marionette Give You?</h3>\n<p>Marionette is an attempt to provide this type of shared solution, capturing Backbone best practices as a set of components and design patterns.  So what value does it provide?  Marionette gives you:</p>\n<ul>\n<li><strong>A Standardized Rendering process</strong> - Marionette takes an opinionated stand on how Views should be rendered.  Without any additional configuration, it will take a template that you specify with a View’s template property, compile it with Underscore’s templating function and pass it a model or collection.  If you need to pass it other data, or want to use a different template library, Marionette provides hooks to customize that process in a <a href=\"http://en.wikipedia.org/wiki/Don%27t_repeat_yourself\">DRY</a> way.</li>\n<li><strong>A consistent View lifecycle</strong> - Marionette defines a consistent View life cycle where Views are initialized, rendered, shown, refreshed, and destroyed.  Each of these events has events and callbacks associated it, and any common boilerplate associated with them is handled behind the scenes.</li>\n<li><strong>The ability to define and manage complex layouts</strong> - Marionette provides region objects that define portions of the DOM that can display and swap out Views.  Combined with utilities to manage child views, you can easily create deeply nested View structures with Marionette while minimizing complexity.</li>\n<li><strong>A central event bus with semantic events to simplify communication between Views</strong> - Marionette includes Backbone.Wreqr or Backbone Radio as an event bus to allow communication between Views without explicitly coupling them.</li>\n<li><strong>Helpers to help you write DRY Code</strong> - In addition to centralizing the rendering and view management code, Marionette provides hooks to allow you to abstract away details of the DOM and events in your View code, and a mechanism to pull common ui operations out into separate reusable objects</li>\n<li><strong>Helpers to avoid “Zombie Views” and memory leaks</strong> - Marionette’s lifecycle includes an explicit destroy phase that cleans up many common sources of memory leaks, and provides a hook for you to take care of the rest</li>\n<li><strong>A central Application object to initialize your application</strong> - Using Marionette, you’re able to specify a set of initializers that run any code that needs to be executed before your application starts, providing a clear structure and starting point to your app.</li>\n</ul>\n<p>That’s not the complete feature set, but it is the essential sales pitch.  I’ll be digging deeper into each of these advantages over my next few posts, but the important thing to understand is that Marionette provides a framework for building Backbone apps that builds on established practices from the community.  If you’re building a Backbone application and want to focus on the problems that are specific to your application, Marionette is a great way to move past common issues and focus on what’s unique to you.</p>\n<h3>More Resources</h3>\n<ul>\n<li>For a practical introduction to Marionette, you could do much worse than <a href=\"https://www.youtube.com/watch?v=PrQSpdWkN6Q\">this talk</a> from the recent Nodevember conference.  Jeremy Fairbank, a member of the Marionette core team, explained how you can use Marionette to improve the architecture of your Backbone apps.</li>\n<li>The resource that best helped me understand Marionette isn’t technically about Marionette at all.  Derek Bailey’s book <a href=\"https://leanpub.com/building-backbone-plugins?a=3a4Srv2pP9p87WQ_eoDoGp\">Building Backbone Plugins</a> lays out the philosophy and thinking behind Marionette without directly referencing it, explaining the challenges that he faced in building a useful abstraction over Backbone.  You can read my <a href=\"http://benmccormick.org/2014/07/09/understanding-the-backbone-mindset-a-review-of-building-backbone-plugins-by-derick-bailey/\">full review</a> if you’re interested, but I highly recommend it for any Backbone developer as a way of better understanding how to structure your Backbone applications.</li>\n</ul>","fields":{"slug":"/2014/12/02/the-case-for-marionette-js"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,mobx-first","topics":["lodash","javascript"],"category":"frameworks","key":"underscore-lodash","title":"Underscore vs Lo-Dash","description":"A comparison between Underscore and lodash","layout":"post","path":"/2014/11/12/underscore-vs-lodash","date":"2014-11-12T13:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>Last week was the time for my team’s quarterly “dependency update” where we go through all the third party libraries we’re using and keep up on any updates or maintenance that need to happen.  That presented the opportunity for me to do a bit more research into an alternative for one of our libraries, <a href=\"http://underscorejs.org/\">Underscore</a>.  Underscore is a JavaScript utility library that provides helper functions for common idioms with a focus on functional programming.  It’s a dependency for <a href=\"http://backbonejs.org/\">Backbone</a>, the MVC library that our web app is based on, and was originally created by Jeremy Ashkenas, who also wrote Backbone.  I love the functional style that Underscore subscribes to, and while the much improved browser support for ES5 functions like map, reduce and filter makes it less necessary than it used to be, Underscore still provides plenty of benefits.</p>\n<p>For a while now though, I’ve been hearing about <a href=\"https://lodash.com/\">Lo-Dash</a>.  Lo-Dash began its life as a fork of Underscore, and still tracks Underscore’s API enough to allow it to serve as a drop-in replacement.  But under the hood it’s been completely rewritten, and it’s also added a number of features and functions that Underscore does not provide.  About a year ago I saw a spurt of articles recommending that Underscore users switch to Lo-Dash, and it came up again recently when <a href=\"https://github.com/jashkenas/underscore/issues/1805\">Underscore’s decision to not follow semantic versioning</a> caused problems for some NodeJS applications. The <a href=\"http://stackoverflow.com/questions/13789618/differences-between-lodash-and-underscore\">definitive Stack Overflow question on the topic</a> seems to come down pretty solidly in favor of Lo-Dash.  And the Lo-Dash <a href=\"https://lodash.com/docs\">documentation</a> touted a prettier chaining syntax as a feature, something that caught my eye since I’ve always disliked Underscore’s chaining mechanism.  As I did my research though I noticed that most of the comparisons are at least a year old.  Both libraries have continued to evolve and improve since then, so I thought there’d be value in adding another writeup comparing the current iterations.</p>\n<h3>Why Do We Even Care?</h3>\n<p>Before I get into the weeds of comparisons, let me address why you’d want to use either of these libraries at all.  Underscore and Lo-Dash provide cross-browser compatible functional programming utility methods.  This post will be long enough without me trying to explain all the benefits of functional programming, but suffice it to say that if you’re manipulating and transforming data in any reasonably complex way, an Underscore style library will help you write performant readable code easier than you could with what Javascript natively provides.  We’ll touch more on performance later, but both Underscore and Lo-Dash perform better than native browser functional methods, and for complex data manipulations they’re significantly more readable than a series of for loops.  They let you write code that’s fast and reads like a description of what you intend to have happen.</p>\n<h3>How are Underscore and Lo-Dash similar?</h3>\n<p>As stated above, Underscore and Lo-Dash provide similar functionality.  Lo-Dash’s API is a superset of Underscore’s.  It provides everything that Underscore does, along with a few additional helper functions.  Lo-Dash can generally serve as a drop-in replacement for Underscore with no changes; it works just fine with Backbone.  So to some extent this question could be answered simply with a link to Underscore’s <a href=\"http://underscorejs.org/\">documentation</a>.</p>\n<h3>How are Underscore and Lo-Dash different?</h3>\n<p>This question could really be rephrased as “What has Lo-Dash added?“.  Lo-Dash answers that with a pretty extensive list on its site, but the claims really boils down to a few things:</p>\n<ul>\n<li>Usability Improvements</li>\n<li>Extra Functionality</li>\n<li>Performance Gains</li>\n</ul>\n<p>Let’s examine those one by one.</p>\n<h4>Usability</h4>\n<p>Lo-Dash makes a number of additions to Underscore that don’t add new capabilities, but increase usability for developers.  These include</p>\n<ol>\n<li><del>Built in Support for AMD Module Loaders</del></li>\n<li>Short hand syntaxes for chaining</li>\n<li>Custom Builds to only use what you need</li>\n<li>Semantic versioning and 100% code coverage</li>\n</ol>\n<p>Each of these are relatively small things that add up to time savings for developers.  <del>Supporting AMD natively saves a configuration step, allowing you to use Lo-Dash on requirejs-based projects without having to specify it as a shim.</del> <em>(<strong>Update</strong>: As of 1.6, Underscore also has native AMD support.)</em>  Lo-Dash also improves the syntax for chaining functions.  Underscore’s chaining syntax has always felt a bit clunky to me.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getLongNames</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">users</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">chain</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pluck</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span>  name<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Lo-Dash cleans that up a bit by not requiring the chain functionality and instead making the Lo-Dash object a function, jQuery style:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getLongNames</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">users</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pluck</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span>  name<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s a small nicety that clears away some syntactical noise.</p>\n<p>Lo-Dash also provides custom builds.  By default Lo-Dash is significantly larger than Underscore.  The full library weighs in at 33KB minified, double Underscore’s 16KB size<sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.  But you can negate that a bit by only pulling in the things you need.  The “modern version” that drops compatibility for IE8 and other older browsers weighs in at 29KB minified (but not gzipped).  If you want to drop the Lo-Dash extra functionality entirely, and only use it for performance and usability reasons, you can build an underscore compatible version and use only 20kb.  You can also go even further, and for instance use only the functionality required by Backbone.  That will get you down to 13kb, smaller than the original Underscore library.</p>\n<p>Finally, Lo-Dash provides semantic versioning and 100% code coverage.  To me these mostly serve as signals that this is a project interested in being disciplined about its engineering practices, which is a good sign.  But the semantic versioning issue seems to be particularly important for those using a utility library in Node, as Underscore’s versioning practices have <a href=\"https://github.com/jashkenas/underscore/issues/1805\">caused problems</a> for some.</p>\n<h4>Extra Functionality</h4>\n<p>Lo-Dash includes several functions not included in Underscore.  Some of these are simply syntactical shortcuts for common idioms.  <code class=\"language-text\">_.forOwn</code> allows you to iterate over an objects own properties, allowing you to skip the common practice of including a guard function in a loop to avoid touching items on an objects prototype chain.  Similarly <code class=\"language-text\">_.create</code> is a simplified syntax for <code class=\"language-text\">Object.create</code> and <code class=\"language-text\">_.parseInt</code> is a safe version of the built-in parseInt function <a href=\"http://stackoverflow.com/questions/14528397/strange-behavior-for-map-parseint\">which can have surprising behavior</a>.  Lo-Dash also provides helper function for deep cloning, merging and extensions, operations that are not available in most libraries.  Specifically <code class=\"language-text\">_.cloneDeep</code> and <code class=\"language-text\">_.merge</code> serve as “deep” versions of Underscore’s <code class=\"language-text\">_.clone</code> and <code class=\"language-text\">_.extend</code>, and <code class=\"language-text\">_.where</code> accepts an argument to support deep comparisons.  If you are routinely doing comparisons and copying of nested objects for equality, these functions will definitely have their place for you.</p>\n<h4>Performance</h4>\n<p>Lo-Dash has an impressive set of <a href=\"https://lodash.com/benchmarks\">benchmarks</a> that you can run on its site which highlight its speed advantage over Underscore on a variety of operations. This is great, but benchmarking against specific tests like this can lead to local optimizations that might not lead to real-world speed.  I also don’t have much interest in many of the functions tested; I use them rarely and can handle a speed dip if necessary.  I was mostly interested in how Underscore and Lo-Dash compared on their core functional methods.  So I set up some jsPerf tests that you can run yourself for <a href=\"http://jsperf.com/lodash-underscore-and-native-each\">_.each</a>, <a href=\"http://jsperf.com/lodash-underscore-and-native-contains\">_.contains</a>, <a href=\"http://jsperf.com/lodash-underscore-and-native-map\">_.map</a>, <a href=\"http://jsperf.com/lodash-underscore-and-native-reduce\">_.reduce</a>, and <a href=\"http://jsperf.com/lodash-underscore-and-native-filter\">_.filter</a>. Here’s a simplified version of the results, comparing Underscore and Lo-Dash performance in terms of their improvement over the speed of the browsers’ native functions.  Results in the chart are averaged across browsers.</p>\n<blockquote>\n<p><strong>Edit: There used to be a chart here. Unfortunately the 3rd party service I used to embed the chart lost my data.  A good reminder to own your own content.  At this point the exact performance data from 2014 would no longer be representative of the current state of things anyway.  The tests above will provide a more accurate look at current performance.</strong></p>\n</blockquote>\n<p>These tests are not incredibly scientific, and the chart especially is oversimplified, but they’re meant to represent real world usage in an easily digestible format.  Draw conclusions from them at your own risk.  That said, there were a few interesting results that I think are reasonably reliable.</p>\n<ol>\n<li>\n<p><strong>Both Underscore and Lo-Dash blow away the native functional methods.</strong></p>\n<p>With its latest versions Underscore has joined Lo-Dash in using loop based iteration to handle each, map, reduce and filter instead of proxying to the native code.  Counterintuitively this ends up being much faster.  Consistently across the board, Underscore and Lo-Dash beat native functions in terms of speed.  A little research indicates that this is because native functions optimize for sparse arrays and have more weird corner cases that they handle.  In any case, the performance difference is pretty startling across the board.</p>\n<p>You can still manage to beat the libraries’ performance by using simple for loops, which is what underscore and lo-dash use after they handle edge cases of their own.  The tradeoff at that point becomes about readability and reliability vs speed, and I’d suggest that using loops is an optimization step in most cases where you’d want to use a utility library, rather than a good starting point.</p>\n</li>\n<li>\n<p><strong>Lo-Dash is definitely not slower than Underscore</strong></p>\n<p>It’s hard to know how significant some of the results here are, as there are a mix of differences which change across browsers.  Again, it’s not a very scientific test.  But Lo-Dash is never significantly slower than Underscore on pretty much any test (the worst seems to be a ~7% difference on Firefox for <code class=\"language-text\">_.each()</code>).  And for several tests it came across as significantly faster (8x speed difference for contains on Firefox!).  I expect many of these differences would prove to be insignificant or inaccurate on a more rigorous test, but it would be very surprising if the net result was that Underscore was faster for common operations.</p>\n</li>\n</ol>\n<h3>Summary: What to use?</h3>\n<p>So to wrap it all up, if you need a utility library which one should you actually use?  I’ll stop just short of unreserved recommendations for Lo-Dash that I saw when I researched this.  I think Lo-Dash is the clear winner for NodeJS users.  Its biggest weakness (file size) doesn’t matter on the server, and its use of semantic versioning matters a lot more for developers depending on npm for dependency management.  So take the performance gains and extra capabilities and go with it.  However, there are more tradeoffs on the client.  Both Lo-Dash and Underscore are small, but optimizing page-weight still matters for many sites, especially on mobile devices.  Underscore has learned from Lo-Dash and improved its performance enough that the differences are often insignificant. And while Lo-Dash’s extras are convenient, none of them seem essential unless you are comparing and cloning a lot of deeply nested objects.  So I’d advise web developers to weigh the tradeoffs and pick the library that best meets their priorities.</p>\n<p><em>(<strong>Update:</strong> There’s been plenty of discussion on this post today.  Check out the comments below for a lot of helpful insight from <a href=\"https://twitter.com/jdalton\">John-David Dalton</a>, Lo-Dash’s creator and an Underscore contributor.  You can also check out the discussion on <a href=\"http://www.reddit.com/r/javascript/comments/2m2hs6/underscore_vs_lodash/\">Reddit</a>.)</em></p>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p><a href=\"http://kitcambridge.be/blog/say-hello-to-lo-dash/\">Say Hello to Lo-Dash</a>, a blog post written by Lo-Dash’s core team after they released 1.0 is a great summary of the advantages of Lo-Dash.  It’s a year and a half old now, but mostly holds up pretty well, with the only real difference being that Underscore has pulled in several of the features they mention here since then.</p>\n</li>\n<li>\n<p>I mentioned this in the post, but Lo-Dash provides a much more thorough benchmarking page than what I provided <a href=\"https://lodash.com/benchmarks\">on their site</a>.  They also provide a helpful <a href=\"https://github.com/lodash/lodash/wiki/Roadmap\">roadmap</a> to let users know about plans for Lo-Dash 3.0.</p>\n</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        These numbers are minified but not gzipped, based on the file size when I download the minified versions from the project site.\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2014/11/12/underscore-vs-lodash"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javascript","book-review"],"category":"reviews","key":null,"title":"Book Review: Building Backbone Plugins","description":"A book review of a great deep dive into Backbone best practices","layout":"review","path":"/2014/07/09/understanding-the-backbone-mindset-a-review-of-building-backbone-plugins-by-derick-bailey","date":"2014-07-09T11:38:40+00:00","dontfeature":null,"isDraft":null},"html":"<p>As the saying goes, judging a book by its cover is a dangerous business.  A lot of books have titles that promise great things, and content that under-delivers and disappoints.  Every once in a while, though, you find a gem that does the opposite. <a href=\"https://leanpub.com/building-backbone-plugins?a=3a4Srv2pP9p87WQ_eoDoGp\">Building Backbone Plugins</a> sounds like a niche book for library developers.  But it actually is the best resource on <a href=\"http://backbonejs.org/\">Backbone.JS</a> development I’ve found, a book that will benefit anyone who works with Backbone.</p>\n<p>So what’s the fuss about?  The book’s author, Derick Bailey, is the creator of <a href=\"http://marionettejs.com/\">Marionette.JS</a>, a popular application framework for Backbone Apps.  <em>Building Backbone Plugins</em> explores the problems that Derick tried to solve with Marionette and then explains the mindset behind Marionette’s solutions.  It is not a book exclusively about Marionette though.  The solutions in the book are example code that represents a simplified view of what Marionette does.  Instead the book looks at the common problems any developer will encounter in a Backbone project, and provides a possible solution, while working hard to generalize the lessons and concepts as much as possible.</p>\n<p>Building Backbone Plugins is divided into 4 parts.  The first two look at Backbone Views and dealing with the DOM.  The third looks at Models and Collections.  The last part deals with application structure and events.  These are followed by a series of appendices that read as stretched-out blog posts on a variety of related topics that didn’t quite fit into one of the 4 buckets that the rest of the book falls into.</p>\n<p>In my mind, the first two parts are the heart of the book.  They’re a step-by-step look at how you can remove repetitive code from your Backbone Views and structure your application to expose the developers intent in each file, rather than burying the purpose in boilerplate. I learned a lot about how I could improve my Backbone code, and these two sections actually inspired me to start integrating Marionette into a project at work. The application structure advice in the fourth part is also particularly strong, with quality information about events, and ideas on how to scale a Backbone application beyond TodoMVC sizes.</p>\n<p>On the other hand, the appendices feel a bit tacked on, and seem to be full of stuff the author wanted to add but couldn’t figure out how to weave into the rest of the book.  Since it’s legitimate content rather than simply greater detail on things that have been already covered, they don’t act as real appendices and leave the book feeling a bit unfocused at the end. When you combine that with some weaker content in part 3 (where the author moves away from Marionette into some other smaller examples), the book can feel a bit choppy and directionless.  But the goldmine of knowledge and perspective in Parts 1, 2 and 4 more than make up for it.</p>\n<p>I would not recommend BBP as a “first book” on Backbone.  It assumes plenty of knowledge, and doesn’t attempt to teach Backbone basics.  But for an intermediate level Backbone developer, or any Javascript developer who wants to grow their thinking about application structure, there is plenty of solid insight here. Meditations on handling nested views, cleaning up unused views, abstracting out repetitive boilerplate, and structuring genuinely large applications are all worth the price of the book.  Finally, if you’re writing code using Marionette already, this book is a must-have.  Marionette’s documentation does a great job of explaining the “what” and the “how” of Marionette.  But this book explains the all-important “why” of a framework that is based on encoding Backbone best practices into a library. It will help you think like an experienced Backbone developer.</p>\n<h3>More Resources</h3>\n<ul>\n<li><a href=\"https://leanpub.com/building-backbone-plugins?a=3a4Srv2pP9p87WQ_eoDoGp\">Building Backbone Plugins</a> - You can purchase the book on leanpub. (Note: Affiliate Link)</li>\n<li><a href=\"http://addyosmani.github.io/backbone-fundamentals/\">Developing Backbone Applications</a> - This book by Addy Osmani is a great resource for Backbone Beginners who want a more basic introduction to Backbone concepts.  It’s available as a free HTMl site on github, but you also can <a href=\"http://www.amazon.com/gp/product/1449328253/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1449328253&linkCode=as2&tag=productjavasc-20&linkId=5RQTSOTPFIGKMLJK\">purchase it as a paperback or ebook.</a><img src=\"http://ir-na.amazon-adsystem.com/e/ir?t=productjavasc-20&amp;l=as2&amp;o=1&amp;a=1449328253\" width=\"1\" height=\"1\" alt=\"\" style=\"border:none !important; margin:0px !important;\"></li>\n<li><a href=\"http://marionettejs.com/\">Marionette.js</a> - This framework serves as the inspiration for Derick’s book and is a great way to structure larger Backbone apps.</li>\n</ul>","fields":{"slug":"/2014/07/09/understanding-the-backbone-mindset-a-review-of-building-backbone-plugins-by-derick-bailey"}}},{"node":{"frontmatter":{"readNext":"bb-es6-2,backbone-eco,backbone-devs-react","topics":["javascript","backbone"],"category":"frameworks","key":"bb-es6-1","title":"Why Backbone.js and ES6 Classes Don't Mix","description":"A rundown of the challenges of using ES6 classes in Backbone","layout":"post","path":"/2015/04/07/es6-classes-and-backbone-js","date":"2015-04-07T03:19:44+00:00","dontfeature":null,"isDraft":null},"html":"<p>I’ve seen some confusion out there about how to use ES6 Classes with <a href=\"http://backbonejs.org/\">Backbone</a>.  In the original version of the ES6 class spec, this was actually a simple thing to do, though the syntax wasn’t great.  With the finalized specification for classes and subclassing though, it’s no longer practical to try and use the two together.  Here’s a short explanation of the issues, as well as a discussion on whether any of this matters.</p>\n<h3>What are ES6 Classes anyway?</h3>\n<p>ES6 <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup> is the newest version of JavaScript. It provides a variety of new features for JavaScript developers including native Promises, destructuring, modules and default function parameters.  One of these new features is a native JavaScript Class implementation.  It allows us to simplify class patterns that were formerly a bit verbose in JavaScript.  Take this example of JavaScript inheritance from <a href=\"http://www.amazon.com/gp/product/0596517742/ref=as_li_tl?ie=UTF8&#x26;camp=1789&#x26;creative=390957&#x26;creativeASIN=0596517742&#x26;linkCode=as2&#x26;tag=benmccormicko-20&#x26;linkId=XZEWUV7PCEO7DNTY\">Javascript: The Good Parts</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Mammal</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Mammal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get_name</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Mammal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">says</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Cat</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">=</span> <span class=\"token string\">'meow'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mammal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">purr</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> i<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            s <span class=\"token operator\">+=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        s <span class=\"token operator\">+=</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">get_name</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It’s a bit verbose.  With ES6 classes we can instead write:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Mammal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">get_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Cat</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Mammal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saying <span class=\"token operator\">=</span> <span class=\"token string\">'meow'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">purr</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> i<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                s <span class=\"token operator\">+=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            s <span class=\"token operator\">+=</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">get_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">says</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This allows us to clean things up a lot, removing some boilerplate and focusing the code on our intended functionality.  ES6 classes work quite nicely for simple JavaScript classes like that.  But what about Backbone objects like Models and Views?</p>\n<p>We might think that we can just treat them as classes and the new syntax will “just work”, similar to how CoffeeScript classes function.  So we’d take this example from the <a href=\"http://backbonejs.org/\">Backbone website</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> DocumentRow <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n  <span class=\"token literal-property property\">tagName</span><span class=\"token operator\">:</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token literal-property property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token literal-property property\">events</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"click .icon\"</span><span class=\"token operator\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"click .button.edit\"</span><span class=\"token operator\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"click .button.delete\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">initialize</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">render</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>and convert it to something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token literal-property property\">tagName</span><span class=\"token operator\">:</span> <span class=\"token string\">\"li\"</span>\n\n  <span class=\"token literal-property property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">\"document-row\"</span>\n\n  <span class=\"token literal-property property\">events</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"click .icon\"</span><span class=\"token operator\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"click .button.edit\"</span><span class=\"token operator\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"click .button.delete\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy\"</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately this errors out.  So what’s the problem?  It turns out that ES6 classes don’t support adding properties directly to the class instance, only functions/methods.  This makes sense when you understand what is actually happening.  With JavaScript inheritance, properties are generally meant to be set on an instance when its created, while methods are set on the prototype object and shared between every instance.  If properties are added to the prototype directly they will also get shared between every instance, creating problems if the property is an object with mutable state like an array.  You can see that in the following simple example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var testClass = function(){};\ntestClass.prototype.foo = [];\n\nvar testA = new testClass();\nvar testB = new testClass();\n\nconsole.log(testA.foo.length); //0\nconsole.log(testB.foo.length); //0\ntestA.foo.push('x');\nconsole.log(testA.foo.length); //1\nconsole.log(testB.foo.length); //1</code></pre></div>\n<p>When we place a property on the prototype it can cause unexpected side effects.  Instead most of the time, we want to use the class’ constructor to add any properties to each new instance.  <del>Since that is a bit unwieldy when adding many properties, Backbone abstracts away this difference with its extend function.</del> <strong>Edit: Backbone actually does add properties directly to the prototype, going against conventions a bit.</strong> But ES6 classes are focused on the prototype, and the code that is shared between instances. They make the opinionated default properties for instances are handled in the constructor. This maps very cleanly to the current semantics for existing JavaScript class creation, but is different than Backbone’s abstraction. So using ES6 classes for Backbone, we’ll need to give up this nicety.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span>  <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"click .icon\"</span><span class=\"token operator\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.edit\"</span><span class=\"token operator\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.delete\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Until recently, this was a valid way of defining a Backbone View with ES6 classes.  It’s questionable whether it was a real gain, given the relative ugliness of the syntax for defining instance properties, but it did work.   Unfortunately, in the final version of the ES6 spec for classes, this is no longer valid.  The final spec requires <code class=\"language-text\">super()</code> to be called before <code class=\"language-text\">this</code> is referenced in a constructor for classes that are extending another class.  So we have to change our constructor to look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span>  <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"click .icon\"</span><span class=\"token operator\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.edit\"</span><span class=\"token operator\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.delete\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately this doesn’t do what we expect. Backbone does significant initialization processing in its constructor, and most properties that Backbone expects to be defined on a Model or View need to be pulled in prior to the constructor executing in order to be used properly.  So with the final ES6 spec we no longer have any way of using declarative properties on subclasses if we want them to be processed by the constructor.</p>\n<h3>So what are our options?</h3>\n<p>There are a few workarounds here, but they’re ugly.  First, Backbone allows any of of its instance properties to also be defined as methods.  So we can rewrite our View like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">className</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">events</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"click .icon\"</span><span class=\"token operator\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.edit\"</span><span class=\"token operator\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.delete\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">\"change\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’re starting to get ridiculous here though.  First, this isn’t a one to one conversion, so if we’re converting existing code, we could develop bugs from any code that directly referenced a View’s properties.  And if that code modified those properties, its no longer as simple to modify them again.  Of course if it’s a property that isn’t processed within the constructor like the <code class=\"language-text\">url</code> property for Models, we can simply leave it as is.  But suddenly we’re requiring ourselves to know what properties are processed in the constructor or not, as well as wrapping and rewrapping properties in functions.  We’ve added a lot of complexity, and it’s not totally clear what we’ve gained.</p>\n<p>The second option is to simply re-run the Backbone View or Model constructor a second time after adding the initialization properties.  This has a few issues though.  First, it’s ugly.  Nobody wants to do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DocumentRow</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span>  <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">\"document-row\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"click .icon\"</span><span class=\"token operator\">:</span>          <span class=\"token string\">\"open\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.edit\"</span><span class=\"token operator\">:</span>   <span class=\"token string\">\"openEditDialog\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"click .button.delete\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"destroy\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        Backbone<span class=\"token punctuation\">.</span><span class=\"token function\">View</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But it also opens an opportunity for more subtle bugs.  Constructors aren’t meant to be run twice.  Doing so, will among other things cause the Views initialization function to run twice, with a different <code class=\"language-text\">cid</code> (Backbone’s internal unique id system) set on the View each time. That violates a ton of expectations, again for no clear gain.  So the long and the short of it is that there’s no longer any viable way to use ES6 classes for Backbone objects without a clear loss in functionality and predictability.</p>\n<h3>So Does Any Of This Matter?</h3>\n<p>The idea of using ES6 classes for Backbone has some appeal.  The “class” keyword is nice syntax and there’s an appeal to using more standardized code and fewer library extensions.  Right now, many developers are also just curious about ES6 and how it fits into their workflow.  But does it really matter that this doesn’t work?  I think a case can be made either way, with 2 clear points in each sides favor.  The case for this being a problem:</p>\n<ol>\n<li>\n<p><strong>ES6 Classes are becoming the standard</strong></p>\n<p>By pretty much any standard, Backbone is currently one of the 4 most popular JavaScript frameworks/libraries for building web applications, along with <a href=\"https://angular.io/\">Angular</a>, <a href=\"http://emberjs.com/\">Ember</a>, and <a href=\"https://facebook.github.io/react/\">React</a>.  What do the Angular, Ember, and React teams all have in common?  They’re each working to make sure that current or future versions of their frameworks use ES6 classes to define objects.  As this style of code becomes ubiquitous, Backbone will start to look even more boilerplate heavy and non-standard.  Developers will also start learning about ES6 classes as part of standard JavaScript training, requiring them to map their knowledge about prototypes and class syntax to Backbone’s concepts, rather than just using things they already understand as in other libraries.</p>\n</li>\n<li>\n<p><strong>More Native == Less Library code</strong></p>\n<p>This is more of a far-future advantage, but at some point ES6 classes will be usable everywhere without library support, allowing libraries based on it to include less code for handling this themselves.<sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup></p>\n</li>\n</ol>\n<p>And the case that it doesn’t really matter:</p>\n<ol>\n<li>\n<p><strong>Just because its standardized doesn’t make it reusable</strong></p>\n<p>While it’s true that ES6 classes are a standard, realistically Backbone code written using a class syntax isn’t going to be easier or harder to convert to equivalent code using React for example.  Backbone’s way of using it’s standard functions and properties is a much bigger obstacle to code reuse than the particular way it defines classes.  ES6 classes and Backbone objects are in the end just different syntactic sugar over the same prototypical inheritance concepts.  A developer who understands the concepts will be able to use both, and code written in either style will not be easy to reuse outside the Backbone ecosystem.</p>\n</li>\n<li>\n<p><strong>Sometimes doing it yourself is just better</strong></p>\n<p>The truth is that sometimes there are advantages to writing your own APIs.  Backbone’s class code makes the things that are important to using Backbone easy, without any of the trade offs discussed in this article.  There’s something to be said for using the right interface for the job.  There are trade offs for this, just as their are trade offs in other libraries choice to require or encourage a build step for their code.  Both these choices improve the developer API at a cost (complexity, extra code, extra process, etc).  Whether those trade offs are worth it is a judgment call.</p>\n</li>\n</ol>\n<p>It will be interesting to see how the lack of standardization here effects Backbone in the long run, if it does at all.  Along with native Promises, ES6 now offers 2 major features that are similar to but incompatible with important Backbone features <sup id=\"fnref:3\"><a href=\"#fn:3\">3</a></sup>. Along with ES5’s get and set capabilities and ES7’s Object.Observe <sup id=\"fnref:4\"><a href=\"#fn:4\">4</a></sup>, a significant number of Backbone features that once required library code will someday soon be natively supported. Of course Backbone has never been a set of features as much as a way of writing programs.  Since Backbone is essentially finished and there are <a href=\"https://github.com/jashkenas/backbone/issues/3405\">no plans to significantly change the interface</a>, the continued improvements to the standard language serve as both a validation of Backbone’s core concepts as well as a challenge to its future.</p>\n<p><strong>Update:</strong> <em>There’s been a <a href=\"https://github.com/jashkenas/backbone/issues/3560\">great discussion of this issue</a> on Backbone’s Github issue tracker.  Feel free to weigh in there if you’re interested in figuring this out.</em></p>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>If you do want to use ES6 now, <a href=\"https://babeljs.io/\">Babel</a> is the best tool for making that happen.  The Babel website also contains a <a href=\"https://babeljs.io/docs/learn-es6/\">great rundown</a> of the various features that make up ES6.</p>\n</li>\n<li>\n<p>Axel Rauschmayer has <a href=\"http://www.2ality.com/2015/02/es6-classes-final.html\">a great article</a> describing the final spec for ES6 classes, including a description of the changes that made them incompatible with Backbone.</p>\n</li>\n<li>\n<p>React Developers have noted the same issues with property initializers that Backbone users encounter.  As part of version 0.13 of React, they’re supporting a special property initialization syntax for classes, which may eventually be standardized.  There’s more info on that in <a href=\"https://esdiscuss.org/topic/es7-property-initializers\">this ESDiscuss thread</a>.  This standard is still being worked out but an experimental support version is available in Babel 5.0.0.  Unfortunately that version defines class properties as being instantiated after the superclass constructor is run, so this doesn’t solve Backbone’s issues here.</p>\n</li>\n<li>\n<p>If you were confused by the discussion of prototypes and the code examples of non-ES6 JavaScript classes, I wrote a quick explanation of <a href=\"http://benmccormick.org/2013/01/12/explaining-javascript-object-oriented-programming/\">Object Oriented Programming in Javascript</a> back in 2012.</p>\n</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        ECMAScript version 6, now officially ECMAScript 2015\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n        <li class=\"footnote\" id=\"fn:2\">\n            <p>\n            This is admittedly a bigger advantage for Ember, Angular 2.0, and React, which all encourage using a build step to convert ES6/Typescript/JSX to ES5 JavaScript.  That means they can all rely on ES6 class support now, since older browser support is handled through compilation.  \n            </p><p>\n            Backbone doesn't require or encourage a transpilation step (although CoffeeScript works very nicely for this case), and so it's more important for it to have a top-notch API supported by all JavaScript engines that it is likely to be run on.  It will be a long time before that is true of ES6 classes.\n            <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n        </li>\n    <li class=\"footnote\" id=\"fn:3\">\n        <p>\n        Promises are similar to jQuery deferreds, which are technically not a Backbone feature, but are a key part of Backbone development for many developers because they're used with Backbone sync.\n        <a href=\"#fnref:3\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2015/04/07/es6-classes-and-backbone-js"}}},{"node":{"frontmatter":{"readNext":"following-js-roadmap,callbacks-to-promises,clean-higher-order-functions","topics":["javascript"],"category":"javascript","key":"ecma-explanation","title":"ES5, ES6, ES2016, ES.Next: What's going on with JavaScript versioning?","description":"A summary of the naming conventions for the JavaScript language","layout":"post","path":"/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning","date":"2015-09-14T03:11:34+00:00","dontfeature":"true","isDraft":null},"html":"<p>JavaScript has a strange naming history. For its initial release in 1995 as part of Netscape Navigator, Netscape labeled their new language LiveScript, before renaming it to JavaScript a year later, hoping to capitalize on Java’s popularity at the time (<a href=\"http://www.coderanch.com/t/456377/a/401/javascript-java.jpg\">JavaScript has no actual relationship to Java</a>). In 1996 Netscape submitted JavaScript to <a href=\"http://www.ecma-international.org/\">ECMA International</a> for standardization.  This eventually resulted in a new language standard, labeled ECMAScript.  All major JavaScript implementations since have actually been implementations of the ECMAScript standard, but the term JavaScript has stuck for historical and marketing reasons <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.  In the real world ECMAScript is usually used to refer to the standard while JavaScript is used when talking about the language in practice.</p>\n<p>This has mostly been trivia for JavaScript developers, because ECMAScript didn’t change much for the first 15 years of its existence, and real world implementations often differed significantly from the standard.  After the initial version of ECMAScript, work on the language continued and two more versions were quickly published.  But after ECMASCript 3 came out in 1999, there were no changes made to the official standard for a decade.  Instead various browser vendors made their own custom extensions to the language, and web developers were left to try and support multiple APIs.  Even after ECMAScript 5 was published in 2009, it took several years for wide browser support of the new spec, and most developers continued to write code in ECMAScript 3 style, without necessarily being aware of the standard.</p>\n<p>Around 2012 things started to change.  There was more of a push to stop supporting old Internet Explorer versions, and writing code in ECMAScript 5 (ES5) style became much more feasible.  At the same time work was underway on a new ECMAScript standard, at which point it became much more common to start referring to JavaScript implementations in terms of their support for different ECMAScript standards.  The new standard was originally named ES.Harmony, before eventually being referred to as ECMAScript 6th Edition (ES6). In 2015 TC39, the committee responsible for drafting the ECMAScript specifications, made the decision to move to a yearly model for defining new standards, where new features would be added as they were approved, rather than drafting complete planned out specs that would only be finalized when all features were ready.  As a result ECMAScript 6th edition was renamed ECMAScript 2015 (ES2015) before it was published in June.</p>\n<p>Currently there are several proposals for new features or syntax to be added to JavaScript.  These include <a href=\"https://github.com/wycats/javascript-decorators\">decorators</a>, <a href=\"https://github.com/lukehoban/ecmascript-asyncawait\">async-await</a>, and <a href=\"https://gist.github.com/jeffmo/054df782c05639da2adb\">static class properties</a>.  These are often refered to as ES7, ES2016, or ES.Next features, but should realistically be called proposals or possibilities, since the ECMAScript 2016 specification hasn’t been written yet, and might include all or none of those features.  TC39 divides proposals into 4 stages.  You can see the current state of various proposals on <a href=\"https://github.com/tc39/proposals\">the TC39 Github repo</a>.</p>\n<p>So where does that leave us in terms of terminology?  The following list might be helpful:</p>\n<ul>\n<li><strong>ECMAScript</strong>: A language standardized by ECMA International and overseen by the TC39 committee.  This term is usually used to refer to the standard itself.</li>\n<li><strong>JavaScript</strong>: The commonly used name for implementations of the ECMAScript standard.  This term isn’t tied to a particular version of the ECMAScript standard, and may be used to refer to implementations that implement all or part of any particular ECMASCript edition.</li>\n<li><strong>ECMAScript 5 (ES5)</strong>: The 5th edition of ECMAScript, standardized in 2009.  This standard has been implemented fairly completely in all modern browsers</li>\n<li><strong>ECMAScript 6 (ES6)/ ECMAScript 2015 (ES2015)</strong>: The 6th edition of ECMAScript, standardized in 2015.  This standard has been partially implemented in most modern browsers.  To see the state of implementation by different browsers and tools, check out <a href=\"http://kangax.github.io/compat-table/es6/\">these compatibility tables</a>.</li>\n<li><strong>ECMAScript 2016</strong>: The expected 7th edition of ECMAScript. This is scheduled to be released next summer.  The details of what the spec will contain have not been finalized yet</li>\n<li><strong>ECMAScript Proposals</strong>: Proposed features or syntax that are being considered for future versions of the ECMAScript standard.  These move through a process of five stages: Strawman, Proposal, Draft, Candidate and Finished.</li>\n</ul>\n<p>Going forward in this blog, I’ll be referring to the recent ECMAScript version as ES6 (since that is how it is best known by most developers), next years spec as ES2016 (since that will be what it is called the whole way through its standardization process, unlike ES6/ES2015) and future language ideas that are not yet part of a draft or finalized spec as ECMAScript proposals or JavaScript proposals.  I’ll do my best to point back to this post in any cases that might be confusing.</p>\n<h3>More Resources</h3>\n<ul>\n<li>If you’re wondering about the best way to keep up with JavaScript language changes, check out the resources <a href=\"/2017/07/10/how-to-follow-the-javascript-roadmap/\">in this post</a></li>\n<li>TC39 has a <a href=\"https://github.com/tc39/ecma262\">github repo</a> tracking all of their current open proposals.</li>\n<li>If you aren’t familiar with ES6 yet, Babel has a <a href=\"https://babeljs.io/docs/learn-es2015/\">great rundown of its features</a></li>\n<li>If you want to go deeper with ES6 I’ve heard great things  about 2 books on the subject: <a href=\"http://exploringjs.com/\">Exploring ES6</a> by Axel Rauschmayer and <a href=\"https://leanpub.com/understandinges6\">Understanding ECMAScript 6</a> by Nicholas Zakas<sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>.  Axel’s blog <a href=\"http://www.2ality.com/\">2ality</a> is also a great ES6 resource.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        And obviously because ECMAScript is an awful language name\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n    <li class=\"footnote\" id=\"fn:2\">\n        <p>\n        Note that I have not read either of these books yet, though I have read plenty of other content from both authors and consider them experts on the JavaScript language. So take that recommendation with an appropriate grain of salt.\n        </p>\n        <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning"}}},{"node":{"frontmatter":{"readNext":"ecma-explanation,callbacks-to-promises,what-are-hocs","topics":["javascript"],"category":"javascript","key":"clean-higher-order-functions","title":"ES6 Patterns: Clean Higher Order Functions","description":"A quick tip for clean functional syntax in ES6","layout":"post","path":"/2015/11/30/es6-patterns-clean-higher-order-functions","date":"2015-11-30T05:06:03+00:00","dontfeature":null,"isDraft":null},"html":"<div class=\"explanation\">\nI've been writing code using the new features defined in the ECMAScript 2015 version of JavaScript (<a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">more commonly known as ES6</a>) since January.  Throughout the year I've seen myself start using a few new patterns that I think make my code better.  I'm going to share them here with a few quick hitter articles, starting with a simpler way of writing higher order functions\n</div>\n<p>A higher order function is a function that either</p>\n<ol>\n<li>\n<p>Takes another function as an argument or</p>\n</li>\n<li>\n<p>Returns a function when called</p>\n</li>\n</ol>\n<p>Although many people have never heard of them, higher order functions are a key part of JavaScript development and something that most JavaScript developers will encounter every day, whether they know the term or not.  jQuery, Underscore, and many other JavaScript libraries are built on higher order functions.  Many of the core JavaScript APIs, like map, filter, forEach, and setTimeout are functions that take functions as arguments.  If you’re not comfortable with these patterns, learning about them can help you understand the JavaScript ecosystem better.  Hopefully this article will pique your interest.</p>\n<p>For this pattern, I’ll be focused on the second class of higher-order functions, functions that return other functions.  They can be useful in a variety of cases.  As an example, let’s consider a blog commenting application with a list of users.  Our task is to get a list of comments for each user.  We can do that with the builtin <code class=\"language-text\">map</code> and <code class=\"language-text\">filter</code> functions and a simple helper function like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> commentList <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./comments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCommentFromUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">comments</span><span class=\"token operator\">:</span>commentList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">comment</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> comment<span class=\"token punctuation\">.</span>user <span class=\"token operator\">===</span> userId\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> userIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    userComments <span class=\"token operator\">=</span> userIds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getCommentFromUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//do stuff with comments</span></code></pre></div>\n<p>We’ve now written some simple, working code.  We take a list of user ids and return a list of users with the ids mapped to their comments.  Everything is fine, and we can move forward to do things with the comments.  If we don’t need to maintain this code base, we could probably stop here.</p>\n<p>The problem is, while this example works for the simple case, it isn’t very flexible.  We pull the comments directly from a single source that we’ve made available to all of the code in our module.  We can’t add any additional filters on the comments used or pull comments from additional sources without rewriting our mapping logic. If we decide we only want comments that were written in the past year for instance, we’ll need to rewrite our function or mutate commentList in a way that could effect code in the rest of the file. That feels pretty sloppy, since mapping comments to users should be unrelated to determining what comments we’re including in our groupings.  Fortunately we can solve this using a higher order function.  If we rewrite the code so that <code class=\"language-text\">getCommentFromUser</code> takes a list of comments and returns a function that takes an id, we can then control exactly what comments are included in the grouping.  For now we’ll leave our full list, but it could be rewritten later to be a filtered list or to pull comments from multiple sources, without re-writing this logic.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> commentList <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./comments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCommentFromUser</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">comments</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">comments</span><span class=\"token operator\">:</span> comments<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">comment</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> comment<span class=\"token punctuation\">.</span>user <span class=\"token operator\">===</span> userId\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> userIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    userComments <span class=\"token operator\">=</span> userIds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">getCommentFromUser</span><span class=\"token punctuation\">(</span>commentList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//do stuff with comments</span></code></pre></div>\n<p>Our code has gotten much more flexible, but at the cost of readability.  Most developers without significant functional programming experience will have to look twice at the 4 levels of nesting and multiple return statements in our helper function definition to understand what is going on.  We’ve added significant boilerplate in a way that muddies up the meaning of our function, when all we’re really trying to do is provide a way to make the comments list used in the function configurable.  That is extremely “beginner-unfriendly”.  At the same time using higher order functions like this is a useful pattern that serves a real need in the design of our application.  Fortunately, ES6 gives us the opportunity to clean up our syntax.</p>\n<p>ES6 provides “arrow functions”, a shorthand for functions that have 2 main differences from the JavaScript <code class=\"language-text\">function</code> keyword.  First, they don’t bind a <code class=\"language-text\">this</code> value as a context, instead using the <code class=\"language-text\">this</code> of the parent scope.  Secondly, they can be written inline, with no parentheses and an implicit return.  So you can write a squaring function as <code class=\"language-text\">const square = (x) => x * x;</code>.  The first property of these functions has many consequences that have been covered in depth elsewhere around the internet.  But when writing non object oriented functions that don’t use <code class=\"language-text\">this</code> like our example above, it is mostly not relevant.  In this case though, the cleaner syntax that arrow functions provide allow us to write a clear and clean higher order function to solve our use case.  With arrow functions, our example from above now looks like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> commentList <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./comments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getCommentFromUser</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">comments</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">comments</span><span class=\"token operator\">:</span> comments<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">comment</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> comment<span class=\"token punctuation\">.</span>user <span class=\"token operator\">===</span> userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> userIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    userComments <span class=\"token operator\">=</span> userIds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">getCommentFromUser</span><span class=\"token punctuation\">(</span>commentList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//do stuff with comments</span></code></pre></div>\n<p>I like to call the <code class=\"language-text\">() => () =></code> pattern a “double function”, and have found it popping up all over the code I write since I began using ES6, especially when I’m using <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, and <code class=\"language-text\">reduce</code>.  Array transformations using those functions often require contextual information beyond the contents of the array.  A naive approach to this would involve having the function reference variables in the outer scope directly, like we did with commentList above.  More commonly that happens when a user inlines a function inside of a <code class=\"language-text\">map</code> call and references variables in the parent scope.  I’ve found that it is much clearer and less error prone to use a higher order function that takes only the variables that are needed for the transformation in, and returns a new function that can be used for the transformation.  This reduces the number of things that can effect the output of the function, allows for greater configurability without directly changing the transformation logic, and makes it clear to readers what values are expected to be used in the function.  Double functions make this easy, and they’ve easily been one of my favorite new code patterns with ES6.</p>\n<h3>More Resources</h3>\n<ul>\n<li>If you’re interested in higher order functions and JavaScript, I know of no better reference than <a href=\"https://leanpub.com/javascriptallongesix\">JavaScript Allongé</a>.  It’s a fantastic deep dive into the JavaScript language with a functional flavor, building understanding from the bottom up and providing many ideas for code recipes along the way.  And it’s recently been rewritten to reflect the changes to the language that ES6 brought.</li>\n<li>Here’s a nice <a href=\"http://www.2ality.com/2012/04/arrow-functions.html\">deep dive on arrow functions at 2ality</a> by Axel Rauschmayer.  If you haven’t seen his blog, it’s a fantastic reference on ES6 and JavaScript in general</li>\n</ul>","fields":{"slug":"/2015/11/30/es6-patterns-clean-higher-order-functions"}}},{"node":{"frontmatter":{"readNext":"ecma-explanation,clean-higher-order-functions,backbone-devs-react","topics":["javascript"],"category":"javascript","key":"callbacks-to-promises","title":"ES6 Patterns: Converting Callbacks to Promises","description":"How to convert a callback driven API to a Promise-based one","layout":"post","path":"/2015/12/30/es6-patterns-converting-callbacks-to-promises","date":"2015-12-30T03:30:47+00:00","dontfeature":null,"isDraft":null},"html":"<div class=\"explanation\">\nI've been writing code using the new features defined in the ECMAScript 2015 version of JavaScript (<a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">more commonly known as ES6</a>) since January.  Throughout the year I've seen myself start using a few new patterns that I think make my code better.  I'm going to share them here with a few quick hitter articles.  If you missed it, I wrote about <a href=\"http://benmccormick.org/2015/11/30/es6-patterns-clean-higher-order-functions/\">clean higher order functions</a> earlier this week.  This post focuses on working with asynchronous code in ES6.  \n</div>\n<h3>Background</h3>\n<p>One of the nicest new features of ES6 JavaScript is the standardization of Promises.  Promises are a method for managing asynchronous code that serve as an alternative to the standard callback function syntax that has been the JavaScript standard for years.  If you’re unfamiliar with them, a good example of a Promise based API is the new <code class=\"language-text\">fetch</code> api provided by browsers.  <code class=\"language-text\">fetch</code> is a replacement for the older callback based XMLHttpRequest API.  A quick example of an HTTP request with the 2 APIs provides a nice comparison of how Promises can lead to clearer code.</p>\n<p>A simple get request with XMLHttpRequest looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">reqListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reqError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fetch Error :-S'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \nrequest<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token comment\">//do stuff with data</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \n\nrequest<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'There was a problem with the request'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nrequest<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/api/foo/bar'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \nrequest<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>whereas with fetch we get this instead</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/foo/bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">jsonData</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//do stuff with the data</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'There was a problem with the request'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This is admittedly a slightly unfair example due to XMLHttpRequest’s clunky object oriented API, but the key take away here is that promises allow for easier visualization of a program’s flow, as well as the ability to easily chain both synchronous and asynchronous operations together into a unified API.</p>\n<p>Promises have been around for a little while in user-land.  There are a bunch of Promise libraries out there that eventually standardized on a spec called <code class=\"language-text\">Promises/A+</code>.  Promises/A+ compliant libraries include <a href=\"https://github.com/kriskowal/q\">Q</a>, <a href=\"https://github.com/petkaantonov/bluebird\">Bluebird</a>, and <a href=\"https://github.com/tildeio/rsvp.js\">rsvp</a>.  There are also many older libraries that provide Promise-like capabilities but are not completely spec compatible, most notably <a href=\"https://api.jquery.com/category/deferred-object/\">jQuery deferreds</a>.  But with ES6 Promises are being standardized.  Happily, since the implementation uses the standard that user-land libaries have agreed upon, the Promise spec is compatible with existing implementations, and existing code bases can remove their existing libraries in favor of the browser supplied version, or have code written to use the browser version interop cleanly with their existing code.  Support for Promises now exists in the latest versions of all major browsers, but it never made it to Internet Explorer and is Edge only for Microsoft browsers.  So most developers will still want to consider using a polyfill for the time being.</p>\n<h3>Converting callback-driven code to use Promises</h3>\n<p>If you believe that Promises are worthwhile, you’ll immediately encounter a problem in today’s JavaScript world.  Many JavaScript APIs, including most standard browser APIs and older but still popular libraries like jQuery and Backbone are heavily callback driven.  Rather than mixing 2 different styles of asynchronous code, wouldn’t it be nice if we could easily convert callback-based APIs to use Promises?  It turns out that it’s not that hard.  Let’s take the simplest example possible to start.  <code class=\"language-text\">setTimeout</code> is a straightforward browser API that waits for a specified period of time and then executes a callback.  A standard use looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>doStuff<span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A Promise-based API for this function would likely look something like this code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>doStuff<span class=\"token punctuation\">)</span></code></pre></div>\n<p>We can create an API like that using setTimeout.  To do that, we’ll need a function <code class=\"language-text\">timeout</code> which takes a timeout variable and returns a Promise.</p>\n<p>You can define A+ compliant Promises using the Promise constructor, which expects a single function as an argument.  That function takes 2 arguments, a <code class=\"language-text\">resolve</code> function and a <code class=\"language-text\">reject</code> function.  The wonderful thing is that under the covers these are just callback functions that the Promise api glosses over.</p>\n<p>Since we already have an API that can handle callbacks, the implementation of our <code class=\"language-text\">timeout</code> function is pretty simple.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">delay</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We don’t use the reject callback, since setTimeout doesn’t provide any hooks for an error state. So we pass resolve as the callback to setTimeout, and that is all we need.  Now we have a great chainable setTimeout function that we could include in a Promise chain.</p>\n<p>Moving on to a more complicated example, let’s take our <code class=\"language-text\">XMLHttpRequest</code> code from above and see if we can create a simplified version of the <code class=\"language-text\">fetch</code> API using <code class=\"language-text\">XMLHttpRequest</code> under the covers.  In this case I’m going to use ES6 style arrow functions to reduce the boilerplate a bit.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fetch <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    request<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> resolve\n    request<span class=\"token punctuation\">.</span>onerror <span class=\"token operator\">=</span> reject<span class=\"token punctuation\">;</span>\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    request<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is a simplified implementation that doesn’t come close to covering all the use cases of fetch, but it provides a great example of how simple it can be to transform a callback based api to a Promise based one, without having to rewrite the existing code<sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.</p>\n<p>For what it’s worth, it is equally easy to convert functions in the other direction.  For instance a callback based implementation of fetch can be a one liner.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callbackFetch</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> succ<span class=\"token punctuation\">,</span> err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>succ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It’s useful to know that the various syntaxes for asynchronous code in JavaScript are effectively equivalent and interoperable.  When designing APIs for your code, both for public libraries with external libraries and components that you use in an application, these patterns can be useful for providing a consistent API, even if you’re using code under the covers that presents it’s asynchronous code in a different way than your API.</p>\n<h3>More Resources</h3>\n<ul>\n<li>The free online version of Exploring ES6 by Axel Rauschmayer has a <a href=\"http://exploringjs.com/es6/ch_promises.html\">great chapter</a> on ES6 Promises explaining the API and how they fit in with the A+ standard.</li>\n<li>There was also a <a href=\"http://blogs.msdn.com/b/eternalcoding/archive/2015/09/30/javascript-goes-to-asynchronous-city.aspx\">great post by David Catuhe on one of the MSDN blogs</a> earlier this year highlighting how asynchronous code has evolved in JavaScript over the years, including a look at the new <code class=\"language-text\">async/await</code> patterns proposed for ES2016.</li>\n</ul>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        And even a full implementation of fetch using XMLHttpRequest is only<a href=\"https://github.com/github/fetch/blob/master/fetch.js\"> ~300 lines</a>\n        </p>\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n</ol>\n</div>","fields":{"slug":"/2015/12/30/es6-patterns-converting-callbacks-to-promises"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-radio","topics":["backbone","javascript"],"category":"frameworks","key":null,"title":"marionette-service: Service Objects for Marionette","description":"Introducing marionette-service, a services library for Marionette apps","layout":"post","path":"/2015/05/25/marionette-service-service-objects-for-marionette","date":"2015-05-25T14:02:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><a href=\"http://backbonejs.org/\">Backbone.js</a> is a great way to structure web applications.  Its built in Models, Collections, Views and Routers are a very reasonable “minimum common ground” that pretty much any web project will be able to put to good use.  But more sophisticated applications have needs that extend beyond these basic concepts.  In addition to having some data that needs to be displayed, rich web apps often have resources and functionality that need to be shared across many different Views and Models.  There’s no definitive way to implement this consistently, but a common pattern is to create “services” of some type that Views and Models can communicate with.</p>\n<p>This pattern is easiest to show with an example.  Let’s take a look at a simple logging implementation.  We might start out just using simple console commands throughout our code like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Do a thing</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'We did Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s fine for a while, but what if we wanted to switch to a logging library like <a href=\"http://js.jsnlog.com/\">JSNLog</a> or some 3rd party service?  We’d have a huge find and replace job to work through.  It’s better to centralize.  <a href=\"https://github.com/marionettejs/backbone.radio\">Backbone.Radio</a> is perfect for this purpose.  We can use it to centralize our logic and create a logging module:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Radio <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone.radio'</span>\n\n<span class=\"token keyword\">let</span> loggingChannel <span class=\"token operator\">=</span> Radio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'logError'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nloggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'logWarning'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We could then log a message like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Do a thing</span>\n  loggingChannel<span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'We did Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There are 2 main use cases for this sort of service pattern: centralizing common tasks and UI actions like logging or displaying an alert, and requesting a resource without having to worry about where it came from.  Both are easily possible using Backbone Radio, using code very similar to whats above.</p>\n<p>Using Backbone Radio like this is a useful pattern, but it’s very ad hoc and imperative.  Not very Backbone-like.  What if we could follow the Marionette route of pulling a useful pattern into an object and allow it to be configured declaratively?  We could instead create a “Service Object” like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Mn <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone.marionette'</span>\n\n<span class=\"token keyword\">let</span> LoggingService <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>Service<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token literal-property property\">radioCommands</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'log log'</span><span class=\"token operator\">:</span> <span class=\"token string\">'logMessage'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'log logError'</span><span class=\"token operator\">:</span> <span class=\"token string\">'logError'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'log logWarning'</span><span class=\"token operator\">:</span> <span class=\"token string\">'logWarning'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">logMessage</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">logError</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">logWarning</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LoggingService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is much more in the Backbone and Marionette style, with a declarative hash to delegate to different functions based on channels and the events passed.  It makes it much easier to create “service objects” to make functionality available in a decoupled way.</p>\n<p>Declarative radio handling will be <a href=\"https://github.com/marionettejs/backbone.marionette/pull/2431\">coming to Marionette Core</a> as part of Marionette version 3, but for now I’ve written a small library to make it available in the short term.</p>\n<p><a href=\"https://github.com/benmccormick/marionette-service\">marionette-service</a> provides the above Service Object to Marionette.  It allows you to listen to Radio Events, Commands or Requests, and associate them with callback functions.  It’s compatible with plans for Marionette v3, so all that will be required to remove it when upgrading will be a name change for service objects to use Marionette.Object rather than Marionette.Service. I’m excited to see how people use it.</p>\n<p>Marionette-service is available to install both on <a href=\"https://www.npmjs.com/package/marionette-service\">npm</a>, and <a href=\"http://bower.io/search/?q=marionette%20service\">bower</a>.  Or you can clone the repo directly from <a href=\"https://github.com/benmccormick/marionette-service\">Github</a>.</p>\n<h3>More Resources</h3>\n<ul>\n<li>If you’re new to Backbone.Radio you can learn more about it from <a href=\"http://benmccormick.org/2015/01/26/backbone-radio/\">my post</a>, or from the <a href=\"https://github.com/marionettejs/backbone.radio\">official docs</a>.</li>\n<li>If you’re confused why somebody would want to separate out the implementation of a service through Radio rather than passing a service object directly, <a href=\"http://arguments.callee.info/2009/05/18/javascript-design-patterns--mediator/\">this is a nice piece by HB Stone</a> on the power of loose coupling and the Mediator Pattern</li>\n</ul>","fields":{"slug":"/2015/05/25/marionette-service-service-objects-for-marionette"}}},{"node":{"frontmatter":{"readNext":null,"topics":["javascript","ecmascript"],"category":"javascript","key":"rauchg-on-es6","title":"Guillermo Rauch on ECMAScript 6","description":"A link-log of Guillermo Rauch's look at ES6","layout":"post","path":"/2015/02/22/rauchg-on-es6","date":"2015-02-22T21:38:46+00:00","dontfeature":null,"isDraft":null},"html":"<blockquote>\n<p>ECMAScript 6, henceforth ES6 and formerly ES.next, is the latest version of the specification. As of August 2014 no new features are being discussed, but details and edge cases are still being sorted out. It’s expected to be completed and published mid-2015.</p>\n</blockquote>\n<blockquote>\n<p>Adopting ES6 has simultaneously resulted in increased productivity (by making my code more succinct) and eliminated entire classes of bugs by addressing common JavaScript gotchas.</p>\n</blockquote>\n<blockquote>\n<p>More importantly, however, it’s reaffirmed my belief in an evolutionary approach towards language and software design as opposed to clean-slate recreation.</p>\n</blockquote>\n<p><a href=\"http://rauchg.com/2015/ecmascript-6/\">http://rauchg.com/2015/ecmascript-6/</a></p>\n<p>A really great look at the highlights of ES6 in practice.  I’ve been working heavily with ES6 for the last month or so, and agree with him on the highlights.  The standardized module syntax (which I transpile to AMD modules), Promises and destructuring particularly stand out as useful syntax that produces better code than what I had before.  I also enjoy the <code class=\"language-text\">=></code> syntax, though I wish the language authors hadn’t combined a syntactic convenience (shorter syntax) with a semantic difference (fat arrow functions are bound to the current context by default, normal functions are not).</p>\n<p>Also of note is his repeated oblique references to <a href=\"https://babeljs.io/\">Babel</a> (formerly 6to5).  Since I wrote my post on  <a href=\"http://benmccormick.org/2014/11/24/alternative-javascript/\">Alternative JavaScript</a> 2 months ago, Babel has clearly emerged as the best way to use JavaScript features that are not yet widely supported today.  It integrates with a wide variety of tools, is reasonably performant speed-wise, and produces roughly 1-1 output, Coffeescript style.  Highly recommended for anyone looking to get started using or learning about new JavaScript features.</p>","fields":{"slug":"/2015/02/22/rauchg-on-es6"}}},{"node":{"frontmatter":{"readNext":"bb-es6-1,backbone-devs-react,mn-series","topics":["javascript","backbone"],"category":"frameworks","key":"bb-es6-2","title":"Backbone and ES6 Classes Revisited","description":"A second look at using ES6 classes with Backbone","layout":"post","path":"/2015/07/06/backbone-and-es6-classes-revisited","date":"2015-07-06T11:22:22+00:00","dontfeature":null,"isDraft":null},"html":"<p>A few weeks ago I wrote <a href=\"http://benmccormick.org/2015/04/07/es6-classes-and-backbone-js/\">an article</a> explaining why the final spec for classes in the ES6/ES2015 version of JavaScript was not usable in Backbone applications.  That post got a lot of great feedback, including this <a href=\"https://github.com/jashkenas/backbone/issues/3560\">discussion</a> with the Backbone core team. The gist of that discussion has been that there are several ways to make ES6 classes work with Backbone now, though they may be less clean than the current <em>Backbone.extend</em> syntax.  But there’s hope for a really great experience: decorators, a <a href=\"https://github.com/wycats/javascript-decorators\">proposed feature for the ES7/ES2016 spec</a>, provide a much cleaner interface when working with Backbone and native classes.</p>\n<p>Let’s start with a quick reminder on the problem that Backbone developers face when adapting ES6 classes.  Both <em>Backbone.extend</em> and ES6 classes serve as syntactic sugar around traditional JavaScript inheritance methods.  So the following code snippets are effectively equivalent:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> ExampleView <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">foo</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and each corresponds roughly to this vanilla ES5 snippet</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">ExampleView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Backbone<span class=\"token punctuation\">.</span><span class=\"token function\">View</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">ExampleView</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ExampleView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>View<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ExampleView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">foo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>All of that works fine.  The problem is that even though these abstractions are similar, they’re not quite the same.  Specifically ES6 class syntax supports an opinionated subset of what you can accomplish with plain prototype inheritance.  There’s good reason for this, since many developers don’t understand prototype inheritance and can shoot themselves in the foot.  But ES6 class restrictions don’t mesh well with Backbone’s conventions.  Specifically, Backbone relies on adding properties to a class’ prototype before a class’ constructor is invoked <sup id=\"fnref:1\"><a href=\"#fn:1\">1</a></sup>.  ES6 classes don’t provide any way to define properties on the prototype as part of the class definition.  They also do not allow you to add instance properties to a constructor prior to calling super() to run a parent class’ constructor.  As a result, properties that are processed within Backbone objects’ constructors like <code class=\"language-text\">events</code>, <code class=\"language-text\">className</code>, <code class=\"language-text\">urlRoot</code> and others can’t be set within an ES6 class definition without resorting to some less than beautiful syntax.  There are however at least 3 different ways of dealing with this problem under the ES6 spec.  I’ll take a look at each of them.</p>\n<h3>ES6 solutions</h3>\n<p>The 3 main solutions I’ve seen proposed for using the current ES6 class spec with Backbone classes are passing properties to the <code class=\"language-text\">super</code> function, creating everything as a method, and adding properties to the prototype outside of the class definition.  I’ll go through those one by one, using <a href=\"https://github.com/tastejs/todomvc/blob/gh-pages/examples/backbone_require/js/views/todos.js\">a view from one of the Backbone TodoMVC implementations</a> as an example.</p>\n<h4>Pass properties to the super constructor</h4>\n<p>The first solution is to define a constructor function for each Backbone object that has properties, and pass the properties directly to the constructor.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Backbone <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'underscore'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> todosTemplate <span class=\"token keyword\">from</span> <span class=\"token string\">'text!templates/todos.html'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Common <span class=\"token keyword\">from</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">tagName</span><span class=\"token operator\">:</span>  <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token literal-property property\">events</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">'click .toggle'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'dblclick label'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'click .destroy'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'keypress .edit'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'keydown .edit'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'blur .edit'</span><span class=\"token operator\">:</span>       <span class=\"token string\">'close'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> isCompleted <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">// hidden cases only</span>\n            <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n            <span class=\"token punctuation\">(</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'active'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleCompleted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> trimmedValue <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> trimmedValue <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">!==</span> trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">updateOnEnter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>keyCode <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ENTER_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">revertOnEscape</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>which <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ESCAPE_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Also reset the hidden input back to the original value.</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>There are a few advantages to this approach.  It keeps everything within the class definition, and lets Backbone itself manage attaching properties to the prototype, assuring compatibility with existing code.  However it adds a constructor call to a class that otherwise wouldn’t need one, making it less obvious when a developer is actually modifying the constructor to do something important.  It also isolates properties from methods, whereas Backbone philosophically has always treated them interchangeably.  In fact that philosophy is the key to the next solution.</p>\n<h4>Treat everything like a method</h4>\n<p>Backbone evaluates all of its properties using Underscore’s <code class=\"language-text\">_.result</code> function <sup id=\"fnref:2\"><a href=\"#fn:2\">2</a></sup>. <code class=\"language-text\">_.result</code> checks to see if an object property is a function. If it is then <code class=\"language-text\">_.result</code> will evaluate it and return the result.  This allows Backbone to accept its properties as either an object or a function.  Very handy.  So one workaround to the constructor problem is to make everything a method, including properties.  We can actually go one better than this, and use the <code class=\"language-text\">get</code> keyword to make our methods serve as <em>getters</em> for a property.  This means they will be accessible as properties, but defined as methods, retaining compatibility with any existing references if you’re converting existing code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">events</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">'click .toggle'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">'dblclick label'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">'click .destroy'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">'keypress .edit'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">'keydown .edit'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">'blur .edit'</span><span class=\"token operator\">:</span>       <span class=\"token string\">'close'</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... etc</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>This approach uses only standard class syntax, which is great.  Getters and methods are highly idiomatic class structures, and work fine with Backbone right now.  They also enforce the immutability of these properties, a design concern with the current Backbone property implementation <sup id=\"fnref:3\"><a href=\"#fn:3\">3</a></sup>.  But lets be real, <code class=\"language-text\">get tagName() { return 'li'}</code> is a significantly less clean interface than the <code class=\"language-text\">tagName: 'li'</code> syntax you get with <em>Backbone.extend</em>.</p>\n<h4>Defining properties directly on the prototype</h4>\n<p>The final example is the most straightforward.  Since there’s no special class syntax for adding properties to the prototype, we can just do so directly after we’ve defined the class.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... etc</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">TodoView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">TodoView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>template <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">TodoView</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'click .toggle'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'dblclick label'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'click .destroy'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'keypress .edit'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'keydown .edit'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'blur .edit'</span><span class=\"token operator\">:</span>       <span class=\"token string\">'close'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>This approach is unambiguous, but its also removes the advantages of using abstracted syntax to begin with.  Adding directly to the prototype takes properties out of the context of the class definition, making it harder to view the class as a holistic unit.  Forcing properties to appear after the class definition also breaks with Backbone community conventions.  Almost all examples of Backbone code that I’ve seen put properties at the top of Backbone class declarations, above any methods, since they’re usually important to read when trying to understand the purpose and role of an object.  They’re then followed by methods, which often contain extensive logic that is less helpful in understanding a class’ overall purpose.</p>\n<p>Of these 3 solutions, I personally prefer using methods and getters.  However I don’t see any of them as an improvement on the existing <em>Backbone.extend</em> syntax.</p>\n<h3>ES7 and Decorators</h3>\n<p>JavaScript is not staying stagnant however.  The TC39 committee recently approved the final spec for ES6 and is aiming to release a new spec on a yearly basis going forward.  One proposed feature for a future spec is <a href=\"https://github.com/wycats/javascript-decorators\">JavaScript decorators</a>.  Decorators are a declarative way of adding extra behavior to a class or class method.  They’re simple functions that take a class or method as an argument and then return an augmented version.</p>\n<p>For instance here’s a simple example from the proposal of a decorator that adds an isTestable property to classes that it decorates.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">@<span class=\"token function\">isTestable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">isTestable</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      target<span class=\"token punctuation\">.</span>isTestable <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Based on that example, it’s not hard to see how this is relevant to the syntax struggle we experienced above.  Here’s a naive solution to our properties problem that utilizes a <code class=\"language-text\">props</code> decorator to add a Backbone-esque hash of properties to the prototype.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//decorators.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">props</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Backbone <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'underscore'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> todosTemplate <span class=\"token keyword\">from</span> <span class=\"token string\">'text!templates/todos.html'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Common <span class=\"token keyword\">from</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'decorators'</span>\n\n@<span class=\"token function\">props</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token literal-property property\">tagName</span><span class=\"token operator\">:</span>  <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token literal-property property\">events</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'click .toggle'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'toggleCompleted'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'dblclick label'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'click .destroy'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'keypress .edit'</span><span class=\"token operator\">:</span>   <span class=\"token string\">'updateOnEnter'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'keydown .edit'</span><span class=\"token operator\">:</span>    <span class=\"token string\">'revertOnEscape'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'blur .edit'</span><span class=\"token operator\">:</span>       <span class=\"token string\">'close'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... etc</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s a big improvement over our ES6 solutions above.  Our properties are added declaratively at the top of the class and are still clearly associated with the class.  Everything lines up reasonably well with both Backbone and native idioms. This is also reminiscent of the <a href=\"https://angular.io/docs/js/latest/quickstart.html#section-angular-create-account\">approach that Angular 2 is taking</a> with its interface, using decorators heavily for component configuration.  It turns out though that we can actually do better.</p>\n<p>I got a tweet from Steven Langbroek last week asking me to look at his <a href=\"https://gist.github.com/StevenLangbroek/6bd28d8201839434b843\">idea for using decorators to provide a cool new syntax for event binding in Backbone</a>.  I thought it was awesome and it inspired me to think in a more fine grained way about using decorators with Backbone.  How can we make the syntax better, as opposed to just replicating the current experience.  Here’s what a more “fine grained” decorators approach might look like with our example.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//decorators.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>tagName <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">decorator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>template <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">eventName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> descriptor</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>target<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span>events <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The on decorator is not compatible with an events method'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>eventName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The on decorator requires an eventName argument'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    target<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">[</span>eventName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> descriptor<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Backbone <span class=\"token keyword\">from</span> <span class=\"token string\">'backbone'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'underscore'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> todosTemplate <span class=\"token keyword\">from</span> <span class=\"token string\">'text!templates/todos.html'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Common <span class=\"token keyword\">from</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>tagName<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">,</span> on<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'decorators'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">tagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'li'</span><span class=\"token punctuation\">)</span>\n@<span class=\"token function\">template</span><span class=\"token punctuation\">(</span>todosTemplate<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.edit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">toggleVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> isCompleted <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">// hidden cases only</span>\n            <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n            <span class=\"token punctuation\">(</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> Common<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'active'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">toggleCompleted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dblclick label'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'blur .edit'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> trimmedValue <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> trimmedValue <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">!==</span> trimmedValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keypress .edit'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">updateOnEnter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>keyCode <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ENTER_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown .edit'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">revertOnEscape</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>which <span class=\"token operator\">===</span> Common<span class=\"token punctuation\">.</span><span class=\"token constant\">ESCAPE_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Also reset the hidden input back to the original value.</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$input<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now we’re getting somewhere.  Steven’s <code class=\"language-text\">on</code> decorator provides a really nice upgrade to Backbone’s event system.  Event handlers are now in the context of the methods they refer to, making it much easier to get context as you scroll through a large view.  Our tagName gets a nice declarative setter at the top of the view rather than being bundled into an object hash.  And our template processing gets standardized, with the call to <code class=\"language-text\">_.template</code> abstracted away into the decorator.  That last decorator would probably be project specific, but the other 2 could easily be incorporated into a general Backbone decorator library.</p>\n<p>The main downside I see to this is one shared by a few of the other approaches.  Specifically that declaring a property like tagName as a method or as a property requires different implementation styles.  Backbone philosophically treats these scenarios as equivalent, and its not unusual to start with a static property for keys like <code class=\"language-text\">className</code>, <code class=\"language-text\">url</code>, or <code class=\"language-text\">template</code> and then refactor to use a function as code is reused in different situations.  Artificially separating out those scenarios is not very Backbone-like and might discourage that type of refactoring.</p>\n<h3>Recommendations</h3>\n<p>If you want to use ES6 classes with Backbone in production today, you should probably make everything a method, and make liberal use of the getter functionality.  That seems to be the most Backbone-like, with everything contained in a single class definition, and easy refactoring when a property begins to require logic around it.  If you’re experimenting though, you should definitely consider playing with decorators and see how you can make Backbone’s interface better.</p>\n<p><em>If you have ideas about this, feel free to contribute on the <a href=\"https://github.com/jashkenas/backbone/issues/3560\">github issue</a></em></p>\n<div class=\"footnotes\">\n<ol>\n    <li class=\"footnote\" id=\"fn:1\">\n        <p>\n        I completely screwed up explaining this in my first piece.  I was under the mistaken impression that Backbone was adding properties like `className` and `events` to each instance rather than to the prototype.  Which makes no sense in retrospect, since those properties need to be present before the Backbone.View is run.\n        <a href=\"#fnref:1\" title=\"return to article\"> ↩</a></p>\n    </li>\n        <li class=\"footnote\" id=\"fn:2\">\n            <p>\n            Well, almost all. iDAttribute <a href=\"https://github.com/jashkenas/backbone/pull/3684\">is still catching up</a>.\n            <a href=\"#fnref:2\" title=\"return to article\"> ↩</a></p>\n        </li>\n        <li class=\"footnote\" id=\"fn:3\">\n            <p>\n            Oh you didn't realize that adding an item to the event hash for your view would add it to every instance of that View?  Whoops.\n            <a href=\"#fnref:3\" title=\"return to article\"> ↩</a></p>\n        </li>\n</ol>\n</div>","fields":{"slug":"/2015/07/06/backbone-and-es6-classes-revisited"}}},{"node":{"frontmatter":{"readNext":null,"topics":["lodash","javascript"],"category":"frameworks","key":null,"title":"Quick Tip: Take advantage of lodash collections","description":"A quick look at the benefits of using lodash collection methods","layout":"post","path":"/2016/06/26/quick-tip-take-advantage-of-lodash-collections-2","date":"2016-06-26T21:27:55+00:00","dontfeature":null,"isDraft":null},"html":"<p>One of the more frustrating things about using JavaScript in the browser is the number of different collection types that you need to deal with.  When using native APIs and 3rd party libraries, it’s easy to encounter 3 or more different types of collections, including <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/NodeList\">NodeLists</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCollection\">HTMLCollections</a>, <a href=\"https://learn.jquery.com/using-jquery-core/jquery-object/\">jQuery Objects</a>, and plain arrays.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span>\na instanceOf NodeList <span class=\"token comment\">//true</span>\n\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span>\nb instanceOf HTMLCollection <span class=\"token comment\">//true</span>\n\n<span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span>\nc instanceOf jQuery <span class=\"token comment\">// true</span>\n\n<span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'button1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'button2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'button3'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span> <span class=\"token operator\">=></span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nd instance <span class=\"token keyword\">of</span> Array <span class=\"token comment\">//true</span></code></pre></div>\n<p>This ends up mattering in practice because not every function that is available on Array is available on NodeList, HTMLCollections, and jQuery objects.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> ids <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Uncaught TypeError: document.querySelectorAll(...).map is not a function</span>\n\nids <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Uncaught TypeError: document.getElementsByTagName(...).map is not a function</span>\n\n<span class=\"token keyword\">let</span> numDivs <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">count<span class=\"token punctuation\">,</span> el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Uncaught TypeError: $(...).reduce is not a function</span></code></pre></div>\n<p>Since we can’t use native array methods on these alternate collections, we end up having to be very careful about knowing where we’ve retrieved data from, and how to convert those collections or how to work around their limitations.</p>\n<p>It’s useful to know about these distinctions, but in practice dealing with them is a pain.  One of the nice properties of <a href=\"https://lodash.com/docs\">lodash</a> is that it abstracts over these incompatibilities.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> ids <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ['container', 'left-box', 'right-box']</span>\n\nids <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementssByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ['container', 'left-box', 'right-box']</span>\n\n<span class=\"token keyword\">let</span> numDivs <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">count<span class=\"token punctuation\">,</span> el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 3</span></code></pre></div>\n<p>For methods that iterate over a collection lodash treats all array-like objects (essentially anything with a length property) the same and iterates over their numerical properties from 0 to length-1.  This provides a nice consistency when working with DOM APIs and removes the mental overhead from managing their inconsistencies.</p>","fields":{"slug":"/2016/06/26/quick-tip-take-advantage-of-lodash-collections-2"}}},{"node":{"frontmatter":{"readNext":"jest-first,backbone-devs-react,callbacks-to-promises","topics":["react","javascript"],"category":"frameworks","key":"react-component-styles","title":"Digging Into React: Choosing Component Styles","description":"An examination of the various styles for defining React components","layout":"post","path":"/2016/05/02/digging-into-react-choosing-component-styles","date":"2016-05-02T02:32:36+00:00","dontfeature":null,"isDraft":null},"html":"<p>Over the past month I’ve been building my first production features using React.  One of the first things I’ve noticed is the amount of choices that come into a new React project.  A lot of this is about the ecosystem around React (Webpack vs Browserify? Redux vs Relay? Do I need CSS modules or Immutable.js?) but many of the choices are just part of the library, figuring out the best, or at least a consistent, way to do things.</p>\n<p>One such choice is the syntax for defining components that you choose to use.  In React, you can define components in at least 3 different styles: the React.createClass style, the ES6 class style, and the pure functional style <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>. Each has some advantages and disadvantages.</p>\n<h3>React.createClass</h3>\n<p>React.createClass is the original style for defining React components, and is still the preferred style in the React documentation.</p>\n<p>Here’s what a theoretical SaveButton component looks like in this style.  It is a simple component that listens for clicks and then uses a separate dispatcher object to send a request to save the data on the page.  After saving the button will either show some specified saved text or “Saved”.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React from ‘react’<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>dispatcher<span class=\"token punctuation\">}</span> from ‘<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>dispatcher’<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> SaveButton <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token literal-property property\">propTypes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//text to show after the component is saved</span>\n        <span class=\"token literal-property property\">savedText</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">//primary text to show on the button</span>\n        <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">getDefaultProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n             <span class=\"token literal-property property\">savedText</span><span class=\"token operator\">:</span> ‘Saved’<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">getInitialState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">saved</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        dispatcher<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>‘saveData’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">saved</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>text<span class=\"token punctuation\">,</span> savedText<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span>“button” onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n           <span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>saved <span class=\"token operator\">?</span> savedText <span class=\"token operator\">:</span> text<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>One of the best things about this style is its cohesive nature.  Everything about the component is described as a single object passed to React.createClass.  Since it is just an object that React processes, it is also able to accommodate more usage styles than ES6 classes and functional components.  Specifically we can use <a href=\"https://facebook.github.io/react/docs/reusable-components.html#mixins\">mixins</a> and add declarative properties like propTypes directly to the component definition.</p>\n<p>The downside of the createClass approach is the custom nature of it.  External tools can’t inspect a component declaration and know what functions and methods will be available on the final component without either some deep inspection of the React source code or pre-existing knowledge of React.createClass that somebody has to document and maintain.</p>\n<h3>ES6 Classes</h3>\n<p>Last March, with React v0.13, the React team introduced a second syntax for React components using ES6 classes.  The constraints of the ES6 class definition change the component API in a few ways.  With ES6 classes there is no way to add properties to the class property as part of the main definition, they need to be added afterwards <sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.  Some niceties that are possible with React.createClass don’t work with ES6 classes as well.  Mixins aren’t possible, and React will no longer “autobind” your functions to the component instance, so when passing class methods as callbacks in your components it is necessary to bind it to the current context, either by using arrow functions like\n<code class=\"language-text\">&lt;span onClick= {() => this.save()} ></code> or by binding the function like <code class=\"language-text\">this.save = this.save.bind(this)</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React from ‘react’<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>dispatcher<span class=\"token punctuation\">}</span> from ‘<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>dispatcher’<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SaveButton</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">saved</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        dispatcher<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>‘saveData’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">saved</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>text<span class=\"token punctuation\">,</span> savedText<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> <span class=\"token operator\">></span>\n           <span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>saved <span class=\"token operator\">?</span> savedText <span class=\"token operator\">:</span> text<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nSaveButton<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">savedText</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nSaveButton<span class=\"token punctuation\">.</span>defaultProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">savedText</span><span class=\"token operator\">:</span> ‘Saved’<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>While this approach makes some syntactic compromises and loses mixins, it has the advantage of standardization and tooling support.  A good JavaScript tool can easily tell that a SaveButton should have render and save methods, as well as detecting the methods it inherits from React.Component.  This is useful for things like auto-complete and linting, as well as (theoretically) run-time performance.</p>\n<h3>Pure Functional Components</h3>\n<p>Last fall with React 0.14, React added a 3rd component style.  Functional components dispose of many of the secondary features of React, and focus on the <code class=\"language-text\">render</code> function.  They are the least powerful of all the component syntaxes.  In addition to losing mixins, pure functional components don’t have the life-cycle functions of the class based syntaxes and also don’t have any internal state.  For these components, all state must be managed externally through something like Redux, or parent components that do have state.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React from ‘react’<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>dispatcher<span class=\"token punctuation\">}</span> from ‘<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>dispatcher’<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SaveButton</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>text<span class=\"token punctuation\">,</span> savedText<span class=\"token punctuation\">,</span> isSaved<span class=\"token punctuation\">,</span> setSaved<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">save</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        dispatcher<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>‘saveData’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setSaved</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span>“button” onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>save<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n       <span class=\"token punctuation\">{</span>isSaved <span class=\"token operator\">?</span> savedText <span class=\"token operator\">:</span> text<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nSaveButton<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//text to show after the component is saved</span>\n    <span class=\"token literal-property property\">savedText</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">//primary text to show on the button</span>\n    <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// has the data already been saved?</span>\n    <span class=\"token literal-property property\">isSaved</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>bool<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// a function to update the application state and mark the page as saved</span>\n    <span class=\"token literal-property property\">setSaved</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nSaveButton<span class=\"token punctuation\">.</span>defaultProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">savedText</span><span class=\"token operator\">:</span> ‘Saved’<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Despite being the least powerful of the 3 component styles, functional components do have some advantages.  First of all, they’re very simple.  It is easy to see what is going on with them, and easy for React to optimize for them.  Like ES6 classes, they’re easy to understand for 3rd party tools since they’re “just functions”, and easy to explain to new developers for the same reason.  They also work well with systems like Redux which already encourages pulling state out of components into global stores.</p>\n<h2>Choosing a component style</h2>\n<p>So given these 3 styles, how do you choose which style to use for a component?  Balance a desire for consistency with a respect for the <a href=\"https://en.wikipedia.org/wiki/Rule_of_least_power\">Principle of Least Power</a>.</p>\n<p>For consistency purposes, don’t use more than 2 of these styles within a single project.  This mostly breaks down to “don’t use createClass and ES6 classes” together in the same project.  There are significant differences in capability and complexity between the first 2 styles and functional components. But the class based styles are similar enough that using both adds complexity but fails to do much in terms of signaling intent.  Switching between 2 different styles of communicating a concept should also indicate a meaningful difference in intent.</p>\n<p>Of course the most consistent approach would be to always use createClass, since it is the most powerful and any component that can be implemented in the other 2 styles can be implemented using createClass.  This is where the principle of least power comes in.  Here is Tim Berners-Lee’s initial description of that principle:</p>\n<blockquote>\n<p>Computer Science in the 1960s to 80s spent a lot of effort making languages which were as powerful as possible. Nowadays we have to appreciate the reasons for picking not the most powerful solution but the least powerful. The reason for this is that the less powerful the language, the more you can do with the data stored in that language. If you write it in a simple declarative from, anyone can write a program to analyze it in many ways. The Semantic Web is an attempt, largely, to map large quantities of existing data onto a common language so that the data can be analyzed in ways never dreamed of by its creators. If, for example, a web page with weather data has RDF describing that data, a user can retrieve it as a table, perhaps average it, plot it, deduce things from it in combination with other information. At the other end of the scale is the weather information portrayed by the cunning Java applet. While this might allow a very cool user interface, it cannot be analyzed at all. The search engine finding the page will have no idea of what the data is or what it is about. This the only way to find out what a Java applet means is to set it running in front of a person.</p>\n</blockquote>\n<p>The less powerful react components styles are the more readable styles, both for humans and computers. That readability also limits the classes of errors and unexpected behaviors we can enact. So we should strive for simple components where we can, while balancing that with our desire for consistency.</p>\n<p>For projects looking into this, there are a few simple questions that you can answer to decide which style to use.</p>\n<ol>\n<li>Do you need to integrate with non-React libraries that modify the DOM?</li>\n<li>Do you need to manage state within your components (IE are you not using an external state management library like Redux)?</li>\n<li>Do you need to use mixins for anything in your project?</li>\n</ol>\n<p>If you answered yes to any of these questions, then you need to include a class based component style in your options for your projects.  If you answered yes to #3, then you will need to use React.createClass.</p>\n<p>Once you’ve made those decisions at the project level, the decisions are easy for an individual component.  If you answered no to all of the questions above (unlikely for a large project, but possible), you should always use functional components.  If not, you can ask the same 3 questions for each new component.  If the answer to all of the questions are no for a component, use a functional component, otherwise use the class based style you’ve chosen for your project.</p>\n<h3>More Resources</h3>\n<ul>\n<li><a href=\"https://facebook.github.io/react/docs/reusable-components.html#es6-classes\">The React documentation</a> is the best place to look at the benefits and tradeoffs of the different component styles</li>\n<li><a href=\"http://jamesknelson.com/should-i-use-react-createclass-es6-classes-or-stateless-functional-components/\">James Nelson wrote a similar guide last year</a> focused on the decision tree of what style to use for a component.  He dismisses the createClass style completely and has a similar but slightly different set of questions to ask.</li>\n<li><a href=\"https://github.com/facebook/react/issues/5677\">This github thread</a> makes the important distinction that functional components are not yet optimized in any special way, though they may be in the future.</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">Technically you can also use an ES5 class based style, but I’m going to ignore that.  It is not a common idiom for React programs as far as I can tell.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">There is a proposal for adding static properties to ES6 classes, but it is still in early stages right now and is not guaranteed to end up as part of the ECMAScript spec.<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2016/05/02/digging-into-react-choosing-component-styles"}}},{"node":{"frontmatter":{"readNext":"ecma-explanation,orthogonality-css-js,atom-tips","topics":["javascript"],"category":"javascript","key":"following-js-roadmap","title":"How to follow the JavaScript roadmap","description":"Keeping up with the language's progress","layout":"post","path":"/2017/07/10/how-to-follow-the-javascript-roadmap/","date":"2017-07-10T12:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>It can be difficult to keep up with all the things going on in web development, especially since the JavaScript language itself has been changing over the last several years.  After several years of relative stability<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>, the ECMAScript spec (<a href=\"https://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">ECMAScript is the specification for the JavaScript language</a>) has changed quite a bit over the last 3 years, with more changes on the way.  In this post I wanted to highlight a few of the resources I can recommend for keeping up with the language changes.</p>\n<h3>Learning ES6/ES2015</h3>\n<p>If you haven’t paid attention to any features that aren’t ready in all browsers yet, or you’re getting back to JavaScript development after being away for a while, you probably could use a resource to catchup on the ES6 JavaScript release from 2015.  ES6 is now <a href=\"https://kangax.github.io/compat-table/es6/\">almost completely</a> implemented in the latest versions of all major browsers, so if you’ve been ignoring it due to compatibility concerns, now is the time to learn.  Fortunately there are a lot of great resources for learning about ES6.  My favorite quick reference is the <a href=\"https://babeljs.io/learn-es2015/\">Learn ES2015 page</a> from <a href=\"https://babeljs.io/\">Babel</a>.  It’s a short, example filled page with explanations of all the major features of the language update. If you want something meatier, there have been several resources created by JS experts.  <a href=\"http://amzn.to/2tVcwaW\">Understanding ECMAScript 6</a> by <a href=\"https://www.nczonline.net/about/\">Nicholas Zakas</a> and <a href=\"http://exploringjs.com/es6.html\">Exploring ES6</a> by <a href=\"http://2ality.com/\">Axel Rauschmayer</a> are books that go through the new features in detail.  If you prefer video tutorials, <a href=\"http://wesbos.com/\">Wes Bos</a> has a <a href=\"https://es6.io/\">whole video course on ES6</a>.</p>\n<h3>Keeping up with new features</h3>\n<p>Things haven’t been changing as fast since the ES6 release.  The first 2 “annual releases” of the ECMAScript spec contained only a <a href=\"http://2ality.com/2016/01/ecmascript-2016.html\">combined</a> <a href=\"http://2ality.com/2016/02/ecmascript-2017.html\">8 features</a>. but there are still a lot of new features working their way through the ECMAScript pipeline.  If you want to get a quick overview of the features being considered for future releases, the best place to look is the <a href=\"https://github.com/tc39/proposals\">TC39 proposals repo on Github</a>.  TC39 is the organization that guides the future of the ECMAScript spec.  Proposals go through a 4 stage process, where stage 1 can best be understood as “ideas”, and stage 4 is “confirmed for the next ECMAScript release”.  <a href=\"https://ponyfoo.com/contributors/ponyfoo\">Nicolás Bevacqua</a> put up a <a href=\"https://ponyfoo.com/articles/tc39-ecmascript-proposals-future-of-javascript\">good post</a> last week describing this process in depth, as well as giving a brief description of the more advanced proposals in the queue. If you’re interested in keeping up with new proposals but want somebody to walk you through them, I recommend subscribing to Axel Rauschmayer’s <a href=\"http://2ality.com/\">2ality</a> blog.  In addition to writing the ES6 book mentioned above, he regularly writes blog posts highlighting new proposals with detailed explanations of the feature implementation and motivation.</p>\n<h3>Testing new features</h3>\n<p>Almost all of the higher stage proposals on the TC39 list have been implemented by <a href=\"https://babeljs.io/\">Babel</a> and you can try them out in the Babel <a href=\"https://babeljs.io/repl/#?babili=false&#x26;evaluate=true&#x26;lineWrap=false&#x26;presets=es2015%2Creact%2Cstage-2&#x26;targets=&#x26;browsers=&#x26;builtIns=false&#x26;debug=false&#x26;code_lz=Q\">REPL</a> or by setting up a small project that loads in Babel.</p>\n<h3>Keeping up with the conversation</h3>\n<p>If you’re a twitter user, probably the easiest way to keep up with language evolution is to follow the people who are shaping and teaching the new language features.  Some twitter follow recommendations:</p>\n<ul>\n<li><a href=\"https://twitter.com/wycats\">Yehuda Katz</a> - TC39 member, Ember core developer</li>\n<li><a href=\"https://twitter.com/rauschma\">Axel Rauschmayer</a> - JS blogger and trainer</li>\n<li><a href=\"https://twitter.com/wesbos\">Wes Bos</a> - JS blogger and trainer</li>\n<li><a href=\"https://twitter.com/sebmarkbage\">Sebastian Markbåge</a> - TC39 member, React core developer</li>\n<li><a href=\"https://twitter.com/left_pad\">Henry Zhu</a> - Babel maintainer</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">From the release of the ECMAScript 5 spec to the ES6/ECMAScript2015 spec, the language wasn’t exactly stable in practice because browser implementations didn’t always move quickly, and there were still many incompatibilities.  But standard language syntax stayed stable for quite a while, which allowed the browser ecosystem to iron out some of those kinks prior to the adoption of ES6.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2017/07/10/how-to-follow-the-javascript-roadmap/"}}},{"node":{"frontmatter":{"readNext":"jest-first,backbone-devs-react,react-component-styles","topics":["javascript","react"],"category":"frameworks","key":"mobx-first","title":"MobX: First Impressions","description":"First impression of managing data with MobX","layout":"post","path":"/2017/01/09/mobx-first-impressions/","date":"2017-01-09T13:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>I spent some time around the holidays this year playing with <a href=\"https://mobx.js.org/\">MobX</a>, a state management library for JavaScript.  MobX is an unopinionated library that provides a layer over normal JavaScript data structures that allow other code to efficiently observe data changes and update based on what has changed.  It’s an interesting tool for handling state in web applications, especially in existing projects that might need to update state handling iteratively.  Here are some first impressions.</p>\n<h3>What is MobX?</h3>\n<p>MobX has 3 core concepts developers need to understand:</p>\n<ol>\n<li><strong>Observable state</strong> - MobX provides functions to make data <em>observable</em>.  Observable data can be watched by other pieces of code which may efficiently update when the state changes.  Observable data is primarily created in MobX using the <code class=\"language-text\">observable</code> function.</li>\n<li><strong>Derivations</strong> - Functions that <em>watch</em> observable data are called derivations.  MobX has 2 primary types of derivations: <em>computed values</em> and <em>reactions</em>.  Computed values update a value based on other data, while reactions produce side effects: updates to a UI, a network call, or a logging statement for example. MobX provides a <code class=\"language-text\">computed</code> function for defining computed values; in most cases reactions will likely be mostly defined using a framework specific helper library like <a href=\"https://github.com/mobxjs/mobx-react\">mobx-react</a> or <a href=\"https://github.com/500tech/ng2-mobx\">ng2-mobx</a>.  MobX does provide some lower level libraries for reactions though, including <code class=\"language-text\">autorun</code> and <code class=\"language-text\">when</code>.</li>\n<li><strong>Actions</strong> - Code that updates observable state is known as an action.  MobX has a formalized version of actions which can be defined using the <code class=\"language-text\">action</code> function, but it is also possible to modify state directly using any normal JavaScript code and maintain observable behavior.</li>\n</ol>\n<p>In practice this looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>observable<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>observer<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx-react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> digits <span class=\"token operator\">=</span> <span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> DigitPrinter <span class=\"token operator\">=</span> <span class=\"token function\">observer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>digits<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>digits<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">', '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">&lt;</span>DigitPrinter digits <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>digits<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* prints 1, 2 */</span>\n\n\ndigits<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* DOM re-renders to print 1, 2, 3 */</span>\n\ndigits<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* DOM re-renders to print 1, 2, 4 */</span>\n</code></pre></div>\n<p>The component is able to passively <em>observe</em> changes in the data, and re-render when it changes.  But MobX is actually even smarter than this example shows.  Let’s look at another example, this time using a more complex data structure (a class).</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>extendObservable<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>observer<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx-react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> moment <span class=\"token keyword\">from</span> <span class=\"token string\">'moment'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Appointment</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">dueDate</span><span class=\"token operator\">:</span> <span class=\"token string\">'01-01-2017'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">'Dinner with Joe'</span>\n      <span class=\"token literal-property property\">location</span><span class=\"token operator\">:</span> <span class=\"token string\">'Chik-Fil-A'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">isToday</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span>dueDate<span class=\"token punctuation\">,</span> <span class=\"token string\">'MM-DD-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span>moment<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'days'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> @ </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">const</span> TodayBox <span class=\"token operator\">=</span> <span class=\"token function\">observer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">class</span> <span class=\"token class-name\">TodayBox</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>appointments<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>appointments<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span>isToday<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>a<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>     \n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> appointment <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Appointment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">&lt;</span>TodayBox appointments <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>appointment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* prints an empty div */</span>\n\nappointment<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Dinner with Bob'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Nothing relevant has changed. The component does not re-render */</span>\n\nappointment<span class=\"token punctuation\">.</span>dueDate <span class=\"token operator\">=</span> <span class=\"token string\">'01-09-2017'</span><span class=\"token punctuation\">;</span>  \n\n<span class=\"token comment\">/*  assume that 01-09-2017 is \"today\" */</span></code></pre></div>\n<p>MobX has the “magical” ability to determine what changes actually affect the observer and not make unnecessary calls of reaction functions.  In practice, that magic allows you to write less, more efficient code for updating your UI based on data.</p>\n<h3>How Does MobX work?</h3>\n<p>I have a learned skepticism of magical solutions like this.  Generally I find that time-saving magic like this ends up costing time when it comes to maintenance, and explicit relationships between code saves time over less-boilerplate heavy code. Fortunately, while the libraries code itself is fairly complex, it isn’t too hard to understand the logic behind how MobX works.</p>\n<p>On the Observer side, MobX uses <a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">ES5</a> setters and getters to proxy updates to observable data structure and listen in when data is updated.  This allows the type of event listening that <a href=\"http://backbonejs.org/\">Backbone</a> and other libraries provide, without requiring the user to go through special <code class=\"language-text\">set</code> or <code class=\"language-text\">get</code> methods to update an object’s properties.  Most of the time you should be able to just be able to write code as you normally would, and MobX will make it work.  There are some exceptions though that mean its important to actually understand how the library work.  Getters and Setters only work when looking up an existing property on an object, so when using primitive values or adding new values to an existing object, some special syntax (the return of <code class=\"language-text\">get</code> and <code class=\"language-text\">set</code> methods) may be required.  In Mobx primitive observables are referred to as <em>boxed</em> values, and objects that require new values over time can be handled by using observable Maps, which use the API of <a href=\"http://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">ES6</a> Maps.</p>\n<p>On the derivative side, reactions and computed values are always defined as functions.  MobX wraps these functions and is able to determine (through the method described above) what properties were accessed during each function run.  It then only listens for changes to these properties.  Thus it doesn’t matter if you theoretically could access thousands of observable properties in a function, if you wrap those references in an if statement to a single property, and that property returns false on first run, the derivative function will only listen for changes on that property before running again. When an observable is updated, all derivative code is run synchronously and atomically so there is no concern of getting into bad intermediate states.</p>\n<p>Most of the “magic” is covered by the 2 paragraphs above, and once you understand the ideas behind them (see the resources at the bottom of this post for more in-depth explanations), it is fairly easy to understand the reasoning behind the cases where the magic fails.</p>\n<h3>Decorators</h3>\n<p>Developers who actually use MobX are probably questioning my examples by now, because I’ve been using a different syntax than the primary MobX documentation for showing my examples.  So let’s talk about decorators.  The preferred way (according to the documentation) to write MobX code is to use decorators to define observers and observables.  Decorators are a <a href=\"http://tc39.github.io/proposal-decorators/\">proposed new JavaScript feature</a> for declaratively adding extra behavior to classes, class properties and class methods.  Using them with MobX, my above example would look like this <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Appointment</span> <span class=\"token punctuation\">{</span>\n\n  @observable dueDate <span class=\"token operator\">=</span> <span class=\"token string\">'01-01-2017'</span>\n  @observable title <span class=\"token operator\">=</span> <span class=\"token string\">'Dinner with Joe'</span>\n  @observable location <span class=\"token operator\">=</span> <span class=\"token string\">'Chik-Fil-A'</span>\n\n  @computed <span class=\"token keyword\">get</span> <span class=\"token function\">isToday</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span>dueDate<span class=\"token punctuation\">,</span> <span class=\"token string\">'MM-DD-YYYY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span>moment<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'days'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> @ </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>location<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n@observer <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodayBox</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>appointments<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>appointments<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span>isToday<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>a<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>     \n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That obviously looks a lot cleaner than my example.  So what’s the problem?  Again, decorators are a <em>proposed</em> JavaScript feature.  Currently they’re in Stage 2, which means roughly that they are very likely to eventually make it into the language, but may change in non-trivial ways before that happens.  Currently decorators are implemented in <a href=\"https://www.typescriptlang.org/docs/handbook/decorators.html\">TypeScript</a>, as well as a <a href=\"https://github.com/loganfsmyth/babel-plugin-transform-decorators-legacy\">3rd party babel plugin</a>, but as of January 2017 <a href=\"http://kangax.github.io/compat-table/esnext/#test-class_decorators\">are not implemented in any browser engines</a>, and are not implemented in any first party babel plugins <a href=\"https://github.com/babel/babel/issues/2645\">due to spec instability</a>.  Decorators are a key part of Angular2, and are used by other frameworks including <a href=\"http://aurelia.io/\">Aurelia</a> and <a href=\"https://github.com/rwjblue/ember-computed-decorators\">Ember</a>, so I don’t think they’re going away.  But I also don’t see them as ready for production use for teams that don’t have the capacity to dedicate the time to update existing code if/when the spec changes<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.  If for one reason or other you’re comfortable with the risks however, decorators are a great way to clean up the MobX API, and I’m excited for the spec to get to the point where I can use them.</p>\n<h3>Comparison to Redux and setState</h3>\n<p>As a state management library that was built to be used with React, the obvious questions to ask about MobX are how it improves over React’s built in state handling, and how it compares to <a href=\"http://redux.js.org/\">Redux</a>, the current most popular state management solution for React. MobX takes a different approach to each.</p>\n<p>It’s important to say at the start that MobX isn’t mutually exclusive with using setState.  It’s possible to use them together, with MobX managing application data and setState handling individual component/UI state.  But there is some advantages to using MobX for UI state as well.  The biggest reason is that MobX is smarter than setState about when re-rendering is required.  By default React Components re-render on any call to setState, regardless of whether the state change actually affects what is rendered or not. MobX’s creator <a href=\"https://medium.com/@mweststrate/3-reasons-why-i-stopped-using-react-setstate-ab73fc67a42e#.x0o6y4rxv\">wrote more about this on Medium</a>.</p>\n<p>Comparing MobX and Redux could be a whole article on its own, so I’m not going to go too deep here, but suffice it to say that MobX is more flexible than Redux, but as a result loses some of the benefits of Redux’s structured approach.  Specifically, it is easy to convert a single object to become a MobX observable and use it in an existing React component.  It can be easily inlined in an existing file and used for one component even.  You also don’t have to deal with the ceremony of using <a href=\"http://benmccormick.org/2016/06/04/what-are-mutable-and-immutable-data-structures-2/\">immutable data</a>.  Redux is intended as a solution that will take over all your state, and doesn’t scale down nearly as well or mix with other solutions <sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup>.  However, Redux’s structure also has benefits.  It allows easy testings of each component of an app individually, the creation of powerful tooling that will work with any Redux app, and reliable guarantees of how state will be updated.  These things are mostly possible with MobX <sup id=\"fnref-4\"><a href=\"#fn-4\" class=\"footnote-ref\">4</a></sup>, but require more developer discipline, and/or can’t be written as easily as universal tools. Overgeneralizing, I would prefer Redux in a new application, but would look to MobX for improving data management in an existing application.  MobX also has advantages in applications where you’re displaying a large amount of UI elements based on a relatively small amount of data, or have a lot of derived data (something like a spreadsheet), whereas Redux has benefits for applications that need to be extremely reliable and well tested.</p>\n<h3>Stray Thoughts</h3>\n<ul>\n<li>If you do want more discipline in MobX, make sure to use <code class=\"language-text\">useStrict</code> to require updates to use Actions</li>\n<li>MobX has a nice set of <a href=\"https://github.com/mobxjs/mobx-react-devtools\">devtools</a> that are useful if you’re opting in to using actions, and using React with MobX.</li>\n<li>If this isn’t clear yet, I definitely recommend hacking around with Mobx’s low level APIs to learn more about how it works before integrating it straight into a framework</li>\n<li><del>Also note that MobX 3.0 is imminent, there is a release candidate that you can play with now.</del> <strong>Update:</strong> That didn’t take long.  <a href=\"https://medium.com/@mweststrate/mobx-3-released-unpeeling-the-onion-ca877382f443#.mk6mdypt2\">MobX 3.0 is out</a>.</li>\n</ul>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>The two most helpful resources I found for conceptually understanding MobX were in-depth articles by the library’s author <a href=\"\">Michael Westrate</a>: <a href=\"https://medium.com/@mweststrate/becoming-fully-reactive-an-in-depth-explanation-of-mobservable-55995262a254#.jd4hgh2zi\">Becoming fully reactive: an in-depth explanation of MobX</a> on Medium and <a href=\"https://mobx.js.org/intro/concepts.html\">Concepts &#x26; Principles</a> from the MobX documentation</p>\n</li>\n<li>\n<p>This <a href=\"https://twitter.com/AdamRackis/status/775706291259908096\">tweet thread</a> and the linked article, are a good breakdown of the tradeoffs between MobX and Redux</p>\n</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">Technically this also uses class properties as well, another proposal that works well with decorators<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">It’s possible any spec changes will be trivially fixable with a code mod script, but right now there is more uncertainty than I am personally comfortable with.  I’m grateful to people who are willing to take more risks here than me, they push the language forward.<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-3\">I’m talking here about what is encouraged and easy, not what is possible.  It is of course possible to mix in Redux with other solutions.<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-4\">MobX has some nice <a href=\"https://github.com/mobxjs/mobx-react-devtools\">devtools!</a><a href=\"#fnref-4\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2017/01/09/mobx-first-impressions/"}}},{"node":{"frontmatter":{"readNext":"ten-things-js,following-js-roadmap,proposals-in-production","topics":["javascript"],"category":"javascript","key":"es6-the-bad-parts","title":"ES6: The Bad Parts","description":"Three years later, what parts of ES6 have I stopped using?","layout":"post","path":"/2018/06/05/es6-the-bad-parts/","date":"2018/06/05","dontfeature":null,"isDraft":null},"html":"<p>This month is the 3 year anniversary of the ECMAScript2015 spec, <a href=\"https://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning\">better known as ES6</a>.  It was a spec update that brought a ton of features to the JavaScript language, and the start of a new era of improving the language.  It was also the last “big bang” release of JavaScript, as TC39 has now moved to a pattern of annual small releases rather than making large multi-year language releases.</p>\n<p>There has been a boatload of justified hype around ES6 over the last 4 years.  I’ve been writing all of my code using the modern spec during that time<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>. So this is a good time to step back and evaluate the features that were added.  Specifically there are some features that I used for a while that I’ve stopped using, because they made my code worse.</p>\n<p>In his book <a href=\"https://amzn.to/2LJBY9z\">JavaScript: The Good Parts</a> Douglas Crockford dedicated a chapter to the <em>Bad Parts</em> of JavaScript.  <em>The Bad Parts</em> are the features of JavaScript that he felt shouldn’t be used.  Fortunately there is nothing as bad in ES6 as some of the old JavaScript stinkers like coercive equality, eval or the <code class=\"language-text\">with</code> statement.  ES6 was a well-designed release. But there are some features and patterns that I avoid. A JavaScript feature makes my <em>Bad Parts</em> list because:</p>\n<ol>\n<li><strong>It’s a trap.</strong>  The feature looks like it does one thing, but has unexpected behavior in some cases that can easily lead to bugs</li>\n<li><strong>It increases the scope of the language for little benefit.</strong> The feature provides some small advantage, but requires the readers of my code to know about obscure features.  This is doubly true for <em>API features</em> where using the feature means that other code that interacts with my code must know about the feature.</li>\n</ol>\n<p>In that spirit, here are my <em>Bad Parts</em> of ES6.</p>\n<h4>const</h4>\n<p>In older versions of JavaScript, we declared variables with the var keyword<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.  This was mostly fine, but <code class=\"language-text\">var</code> has peculiarities.  It creates variables that are added to the global object, or scoped to a function, but don’t respect other block boundaries.  It is also possible to reference a <code class=\"language-text\">var</code> declared variable before it is declared. These oddities occasionally come back to bite developers.  In response ES6 introduced 2 new keywords for declaring variables: <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code>.  These solve the primary quirks of <code class=\"language-text\">var</code>; they are block-scoped, so a variable declared inside of a loop is not referencable outside of that loop, and trying to access the variable before it is declared in code results in a reference error. This was a big step forward.  It was also confusing, because we were given 2 solutions.</p>\n<p>A <code class=\"language-text\">const</code> variable cannot be re-assigned after it has been declared. This is the only difference between <code class=\"language-text\">const</code> and <code class=\"language-text\">let</code>. This seems useful, and it can be.  The problem is the name. What it guarantees doesn’t match what most people expect from a <em>constant</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">CONSTANT</span> <span class=\"token operator\">=</span> <span class=\"token number\">123</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// this will cause \"TypeError: invalid assignment to const `CONSTANT`\"</span>\n<span class=\"token constant\">CONSTANT</span> <span class=\"token operator\">=</span> <span class=\"token number\">345</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CONSTANT_ARR</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token constant\">CONSTANT_ARR</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// this will print [1] without an error</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONSTANT_ARR</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">const</code> prevents reassignment, but it doesn’t make objects immutable.  This is a fairly weak guarantee for most value types.  Because this feature invites confusion, and <code class=\"language-text\">const</code> is otherwise redundant with <code class=\"language-text\">let</code>, I choose to always use <code class=\"language-text\">let</code>.</p>\n<h4>Template Literal Tags</h4>\n<p><code class=\"language-text\">const</code> is an example of the spec creating too many solutions to too few problems. Template literals are the inverse.  The template literal syntax was TC39’s way of tackling string interpolation and multi-line strings.  Then they decided to give it a string macro feature as well.</p>\n<p>If you’ve never seen a template literal tag, they’re a little like <a href=\"https://github.com/tc39/proposal-decorators\">decorators</a> for strings.  Here’s an example from <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals\">MDN</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> person <span class=\"token operator\">=</span> <span class=\"token string\">'Mike'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> age <span class=\"token operator\">=</span> <span class=\"token number\">28</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">myTag</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">strings<span class=\"token punctuation\">,</span> personExp<span class=\"token punctuation\">,</span> ageExp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> str0 <span class=\"token operator\">=</span> strings<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"that \"</span>\n  <span class=\"token keyword\">var</span> str1 <span class=\"token operator\">=</span> strings<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \" is a \"</span>\n\n  <span class=\"token comment\">// There is technically a string after</span>\n  <span class=\"token comment\">// the final expression (in our example),</span>\n  <span class=\"token comment\">// but it is empty (\"\"), so disregard.</span>\n  <span class=\"token comment\">// var str2 = strings[2];</span>\n\n  <span class=\"token keyword\">var</span> ageStr<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ageExp <span class=\"token operator\">></span> <span class=\"token number\">99</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    ageStr <span class=\"token operator\">=</span> <span class=\"token string\">'centenarian'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    ageStr <span class=\"token operator\">=</span> <span class=\"token string\">'youngster'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> str0 <span class=\"token operator\">+</span> personExp <span class=\"token operator\">+</span> str1 <span class=\"token operator\">+</span> ageStr<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> output <span class=\"token operator\">=</span> myTag<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">that </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span> person <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> is a </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span> age <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// that Mike is a youngster</span></code></pre></div>\n<p>This isn’t totally useless. <a href=\"https://codeburst.io/javascript-es6-tagged-template-literals-a45c26e54761\">Here’s a roundup of some use cases</a>.  HTML sanitization is a useful trait.  And this is the currently the cleanest way to do things when you’re having to perform the same operation on all inputs to an arbitrary string template.  But that’s a relatively rare scenario, and you can also accomplish the same use cases with a (more verbose) function API rather than using tagged literals.  And for most things, the function API won’t even be worse.  This feature is not adding new capabilities, but is adding new concepts that future readers of my code have to be familiar with.  So I plan on staying clear as much as possible.</p>\n<h4>Overly crazy destructuring expressions</h4>\n<p>Some features are fine when used simply, but can spiral out of controls.  For instance, I am happy to write ternary statements like</p>\n<p><code class=\"language-text\">let conferenceCost = isStudent ? 50 : 200</code></p>\n<p>but they become tough to follow if you start nesting them:</p>\n<p><code class=\"language-text\">let conferenceCost = isStudent ? hasDiscountCode ? 25 : 50 : hasDiscountCode ? 100 : 200</code>;</p>\n<p>This is how I feel about destructuring.  Destructuring lets you pull variables out of objects or arrays</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>a<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>b<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2, 4</span></code></pre></div>\n<p>and also lets you rename variables, get nested values, and set defaults.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> val1<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>b<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">c</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">d</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>c<span class=\"token operator\">=</span><span class=\"token number\">6</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">c</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>d<span class=\"token operator\">=</span><span class=\"token number\">6</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">c</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>val1<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2, 4, 5, 6</span></code></pre></div>\n<p>All of which is great, until you start combining those features.  For instance, this expression declares 4 variables, userName, eventType, eventDate, and eventId pulled out of different spots in the object structure of <code class=\"language-text\">eventRecord</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> eventRecord <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Ben M\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">email</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ben@m.com\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">event</span><span class=\"token operator\">:</span> <span class=\"token string\">\"logged in\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">metadata</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10-10-2017\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> userName <span class=\"token operator\">=</span> <span class=\"token string\">\"Unknown\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">event</span><span class=\"token operator\">:</span> eventType <span class=\"token operator\">=</span> <span class=\"token string\">\"Unknown Event\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">metadata</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>date<span class=\"token operator\">:</span> eventDate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> eventId\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>It’s pretty much impossible to follow.  Code like this is much easier to read with the destructuring split into parts or eliminated.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> eventRecord <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Ben M\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">email</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ben@m.com\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">event</span><span class=\"token operator\">:</span> <span class=\"token string\">\"logged in\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">metadata</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10-10-2017\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> userName <span class=\"token operator\">=</span> eventRecord<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>userName <span class=\"token operator\">||</span> <span class=\"token string\">'Unknown'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> eventDate <span class=\"token operator\">=</span> eventRecord<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">event</span><span class=\"token operator\">:</span>eventType<span class=\"token operator\">=</span><span class=\"token string\">'UnknownEvent'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span>eventId<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> eventRecord<span class=\"token punctuation\">;</span></code></pre></div>\n<p>I don’t have a clear line for when destructuring has gone too far, but anytime I can’t look at it and instantly know what variables are being declared, I know it’s time to break things down for readability.</p>\n<h4>Default Exports</h4>\n<p>One nice thing about ES6 was the way it standardized things that had been accomplished using competing libraries.  Classes, Promises and modules all benefited from being folded into the spec after the community had time to absorb lessons learned from competitive user-land implementations.  ES6 modules are a great replacement for the AMD/CommonJS format wars, and provide a nice clean syntax for imports.</p>\n<p>ES6 modules provide 2 main ways of exporting values: <em>named exports</em>, and <em>default exports</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mainValue <span class=\"token operator\">=</span> 'This is the <span class=\"token keyword\">default</span> <span class=\"token keyword\">export</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> mainValue\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> secondaryValue <span class=\"token operator\">=</span> 'This is a secondary value<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> secondaryValue2 <span class=\"token operator\">=</span> 'This is another secondary value<span class=\"token punctuation\">;</span></code></pre></div>\n<p>A module can define multiple named exports, but only a single default export.  When importing default exports, the importing file can give the default export any name as there isn’t any lookup on name.  Named exports are imported by using the name of the variable in the exporting file, though renaming is possible.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// default import</span>\n<span class=\"token keyword\">import</span> renamedMainValue <span class=\"token keyword\">from</span> <span class=\"token string\">'./the-above-example'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// named import</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>secondaryValue<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./the-above-example'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// named import with a rename</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>secondaryValue <span class=\"token keyword\">as</span> otherValue<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./the-above-example'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Default exports <a href=\"https://esdiscuss.org/topic/moduleimport#content-0\">were the preferred syntax of the folks designing ES6</a> and they intentionally gave it the cleanest syntax.  But in practice I’ve found named exports to be better.</p>\n<ol>\n<li>Named exports match the names of the imported variable by default, making searching easier for those not using intelligent tooling.</li>\n<li>Named exports can be matched to variables in other values prior to an import statement being written, allowing niceties like <a href=\"https://code.visualstudio.com/updates/v1_18#_auto-import-for-javascript-and-typescript\">auto-import</a> for those using intelligent tooling.</li>\n<li>It’s possible to use named imports consistently for everything, but that’s only possible with default imports if you never want to export multiple values from a file.<sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup> Using only named modules keep things simpler.</li>\n</ol>\n<p>Naming things is good.  It promotes consistency in discussion and code.  I use named exports because I like clarity.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">Thanks <a href=\"https://babeljs.io/learn-es2015/\">Babel</a>!<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">Or global scope, or a property on an object, or a function declaration<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-3\">Exporting objects with multiple values as properties seems like a workaround here, but that loses the tree-shaking value that ES6 Modules provide for bundlers like webpack.<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/06/05/es6-the-bad-parts/"}}},{"node":{"frontmatter":{"readNext":"es6-the-bad-parts,javascript-stale-practices,mobx-state-machine-flags","topics":["javascript"],"category":"javascript","key":"evil-js","title":"Evil JavaScript","description":"The code you write when you don't care about people","layout":"post","path":"/2018/07/04/evil-javascript/","date":"2018/07/04","dontfeature":null,"isDraft":null},"html":"<p>JavaScript developers sometimes complain that their language is unjustly maligned for having too many confusing features.  Plenty of other people are out there explaining why this is misguided, but for this post I want to lean in.  Rather than falling into the <em>traps</em> that JavaScript exposes you to, what if we embrace our language’s reputation instead, and see what code we can write if we don’t care about the feelings of others?</p>\n<p>The “Evil JavaScript” you’ll see today takes advantage of an array of language features. Many of these techniques still work in other languages, so please don’t worry that I’m limiting your pursuit of the dark side. But JavaScript certainly has a flair for evil that is hard to match.  If you write code that other people have to work with, the opportunities to annoy, confuse, aggravate and bamboozle are limitless.  The following is a small selection of choice techniques.</p>\n<h4>Modify objects in your getters</h4>\n<p>JavaScript objects can define <code class=\"language-text\">getters</code>, functions that let you access the result of a function as a property.  Used normally, that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> greeter <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Bob'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">get</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeter<span class=\"token punctuation\">.</span>hello<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Hello Bob</span>\ngreeter<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'World'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>greeter<span class=\"token punctuation\">.</span>hello<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Hello World</span></code></pre></div>\n<p>Used evilly though, we can come up with fun self-destructing objects!</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n   <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n   <span class=\"token literal-property property\">baz</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n   <span class=\"token keyword\">get</span> <span class=\"token function\">evil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> keys <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>keys<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token keyword\">delete</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span>keys<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> <span class=\"token string\">'Nothing to see here'</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, every time we read <code class=\"language-text\">obj.evil</code>, we delete one of the other properties on the object, with no indication to the code accessing <code class=\"language-text\">obj.evil</code> that anything extraordinary is happening.  But this is just the start of how we can introduce unexpected side effects.</p>\n<h4>Nobody expects a Proxy!</h4>\n<p>Getters are cool and all, but they’ve been around for years, and many developers know about them.  We now have an even more powerful variation on the same theme with Proxies.  Proxies are an ES6 feature that let you put a wrapper class around an object that lets you control what happens when a user accesses or updates any property.  So we can, for instance define an object that will, one third of the time return a value from a random key whenever a user tries to access a key.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">c</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> handler <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj<span class=\"token punctuation\">,</span> prop</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.33</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> keys <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> keys<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>keys<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> evilObj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// this is example output that I received running the code</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>evilObj<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span></code></pre></div>\n<p>Our sneakiness is undermined a bit by devtools, where evilObj will be identified as a Proxy, but we can still lead other developers on a merry chase before we’re caught.</p>\n<h4>Contagious functions</h4>\n<p>So far we’ve talked about how objects can modify themselves, but we can also create innocuous looking functions that infect the objects that are passed to them with strange behavior.  For instance lets say we had a simple <code class=\"language-text\">get</code> function to do safe property lookups on an object that may not exist:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">obj<span class=\"token punctuation\">,</span> property<span class=\"token punctuation\">,</span> <span class=\"token keyword\">default</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It would be easy to make that function contagious by subtly changing the object it was passed.  For instance we could make it so the retrieved property no longer showed up when the user enumerates the keys.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">obj<span class=\"token punctuation\">,</span> property<span class=\"token punctuation\">,</span> defaultValue</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>obj <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>property <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> defaultValue<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">delete</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> property<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      value<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">enumerable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span><span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ['a', 'b']</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ['b']</span></code></pre></div>\n<p>This is super subtle, since enumeration is neither rare nor particularly common.  Since the actual bug wouldn’t be tied to the infected object at all, it could persist in a code base for a long time.</p>\n<h4>Messing with Prototypes</h4>\n<p>Sometimes the old ways are best.  One of the most criticized features of the JavaScript language is the ability to modify built-in prototypes.  This was used in the early days of JavaScript to enhance built in objects like arrays.  For instance we can add a <code class=\"language-text\">contains</code> function for arrays like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">contains</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It turns out that doing this in real libraries can <a href=\"http://2ality.com/2016/02/array-prototype-includes.html#frequently-asked-questions\">ruin the language for everyone else</a>.  So providing additional useful prototype methods is a good long con for malicious developers with patience.  But for the impatient sociopaths reading along, we also have some short term fun we can unleash.  The fun thing about prototype manipulation is that it affects all code running in an environment, even if that code is running in modules or closures.  So if we introduce the following code as a 3rd party script (maybe an ad or analytics script?), we can introduce subtle bugs throughout a site.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">let</span> arr2 <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">,</span> idx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         idx <span class=\"token operator\">=</span> idx <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> acc<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">===</span> idx <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>idx <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> idx\n      acc<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> acc<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">return</span> arr2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’ve rewritten <code class=\"language-text\">Array.prototype.map</code> to work just like normal <code class=\"language-text\">map</code> with the exception that we will randomly switch the order of 2 values 1/20th of the time.  An example result:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span><span class=\"token number\">12</span><span class=\"token punctuation\">,</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span><span class=\"token number\">14</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">square</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>square<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// [1,4,9,16,25,36,49,64,100,81,121,144,169,196,225</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>square<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// [1,4,9,16,25,36,49,64,81,100,121,144,169,196,225]</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>square<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// [1,4,9,16,25,36,49,64,81,100,121,144,169,196,225]</span></code></pre></div>\n<p>We ran map 3 times, and the first was subtly different than the next 2 runs.  It’s subtle enough that it won’t always cause anything to happen, and the crazy thing about this hack is that there’s no real way to know it’s happening without actually reading the source code that caused it.  Our function doesn’t show up weirdly in devtools, and it doesn’t error under strict mode or anything else.  This is how developers go mad.</p>\n<h4>Naming things is hard</h4>\n<p>As one of the 2 hard problems in Computer Science, you don’t have to be evil to come up with bad names<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  But it certainly doesn’t hurt.  We’ll pass over the chump change of misleading names and outdated comments.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// initialize a date</span>\n<span class=\"token keyword\">let</span> arrayOfNumbers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">userid</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Darth Vader'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>No let’s get to the good stuff.  Did you know that much of unicode can be used to name variables in JavaScript?  If you’re into fun and games of course, this means that emoji are in play:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> 💩 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">postid</span><span class=\"token operator\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">postName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Evil JavaScript'</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>But we want evil JavaScript, so let’s go straight to lookalike characters.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oｂj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Error!</span></code></pre></div>\n<p>The <code class=\"language-text\">ｂ</code> in <code class=\"language-text\">oｂj</code> may look normal, but it is actually a <em>fullwidth latin small letter b</em> instead of a <em>latin small letter b</em>, and that distinction means that anyone typing in the variable directly is probably going to be very confused.</p>\n<h3>Don’t be evil</h3>\n<p>Despite appearances, it is the official position of this blog that evil JavaScript should not be encouraged and may in fact be harmful.  That said, it’s always good to know the ways things can go wrong. Each of these patterns exist out in the wild somewhere.  Hopefully in less malicious forms than I’ve shown here.  But lack of intent doesn’t make them easier to debug, and knowing just how bad things can get is a good start to seeing these bugs coming.  You never know what bug is sitting out there waiting to strike. Just because you’re paranoid doesn’t mean that they’re not out to get you.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">This may be hard to believe for old time Linux folks of course. They’ve had years to associate the worst naming offender in the industry (Microsoft) with the deepest forms of evil.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/07/04/evil-javascript/"}}},{"node":{"frontmatter":{"readNext":"ecma-explanation,following-js-roadmap,ten-things-js","topics":["javascript"],"category":"javascript","key":"proposals-in-production","title":"JavaScript Proposals In Production","description":"The problems with using proposed JavaScript features in production","layout":"post","path":"/2018/03/16/proposals-in-production/","date":"2018/03/16","dontfeature":null,"isDraft":null},"html":"<p><em>This post was adopted from a twitter thread that outgrew it’s medium today.  You can see the original thread <a href=\"https://twitter.com/_benmccormick/status/974670479905705984\">here</a>.</em></p>\n<p>This morning I saw the following tweet:</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">*TC39 proposes Array.flatten feature that breaks code that was working fine for 10 years*<br>&quot;IT&#39;S THEIR FAULT FOR DOING NONSTANDARD STUFF&quot;<br><br>*TC39 proposes changing classes feature not yet in standard*<br>&quot;IT&#39;S NOT FAIR I WROTE CODE USING THAT&quot;</p>&mdash; Dave Methvin (@davemethvin) <a href=\"https://twitter.com/davemethvin/status/974037352384430080?ref_src=twsrc%5Etfw\">March 14, 2018</a></blockquote>\n<p>The tweet refers to <a href=\"https://github.com/allenwb/js-classes-1.1\">this proposal</a> for replacing a number of other proposals for augmenting JS’s current class syntax, as well as recent backlash on twitter over <a href=\"https://github.com/tc39/proposal-flatMap/pull/56\">a proposal </a> to not use flatten or flatmap for future JS standard syntax due to their previous use in mootools.</p>\n<p>Because people have been using Babel or other tools to transpile their code and use the proposed class syntax today, it would be frustrating for many devs if the proposal shifted under them.  I’ve been there.  And thus, story time:</p>\n<p>A few years ago I used a polyfill for a browser API that wasn’t yet fully supported in all browsers.  And I used it in production code.  Browser support didn’t pick up nearly as quickly as I expected, and then the spec changed.  Supporting that code has caused me problems repeatedly since, and there isn’t a lot of support, given that the syntax isn’t standardized.  Because <a href=\"https://benmccormick.org/2018/01/07/large-improvements-small-team/\">I am working with limited resources</a> I  still haven’t been able to get rid of the polyfill code completely.  It’s baked into one of the most critical portions of my production application.  And so I’ve had to live with it and deal with some of it’s non-ideal aspects for a long time.  Since then I’ve avoided putting anything in production that isn’t in a spec.  And I have absolutely no regrets about that.</p>\n<p><strong>The lesson I’ve learned:</strong> Polyfilling a partially supported spec for compatibility is fine.  Playing around with new proposals is fine (and actually a great idea if you want to influence the future of the language).  But I never want to use polyfills/transpiling for a <em>proposed spec</em> in production code. And yes that means no decorators/class properties/pipeline operators in my code for now.  But that’s ok.  JavaScript is a pretty decent language today.  A little patience will help you in the end.  Even libraries like MobX that encourage the use of “future specs” will still work without them if they’re reasonably well maintained.</p>\n<h3>Why Does This Happen?</h3>\n<p>To some folks the lesson of “Don’t use language features that aren’t standardized yet” probably looks obvious.  So why does this happen? I think there’s a community/culture aspect to some of this.  For instance, many of the early adopters of React really wanted to push the language forward to achieve better developer experience, and were more likely to propose and advocate for new syntax.  This was fine for them, because many of these folks were either</p>\n<p>a. Employees at large companies who had the resources to support whatever code extensions they wanted, and dedicate time to a large refactor if they got it wrong (not typical of most devs)\nb. Consultants/teachers who are always trying to stay on the bleeding edge for teaching purposes and who don’t build projects intended to be maintained long term (not typical of most devs)\nc. Involved in the language standards process and experimenting with new syntax for the purpose of influencing the language, rather than writing production code with it (not typical of most devs)</p>\n<p>Because of this, the need to compile JS for JSX purposes anyway and the heavy emphasis in the early React community on rethinking best practices, I’ve seen a lot more of this type of pre-standardization use of features in the React community than elsewhere.  The Ember community for instance doesn’t seem to have the same problems. But it started with early adopters in React, and spread when folks who were less informed about the standards process cargo-culted the code examples.  So here we are.</p>\n<h3>My suggestions</h3>\n<ol>\n<li><strong>Learn about the ECMAScript standards process.</strong>  <a href=\"https://benmccormick.org/2017/07/10/how-to-follow-the-javascript-roadmap/\">This post</a> can get you started.</li>\n<li><strong>Don’t use non-standard code in production.</strong>  It just isn’t worth the headaches you may get later.</li>\n</ol>","fields":{"slug":"/2018/03/16/proposals-in-production/"}}},{"node":{"frontmatter":{"readNext":"large-improvements-small-team,ten-things-js,ll-context","topics":["react","architecture","javascript"],"category":"fe-architecture","key":"react-confessions","title":"React Architecture Confessions","description":"The mistakes I made while learning React and why I made them","layout":"post","path":"/2018/02/07/react-confessions/","date":"2018/02/07","dontfeature":null,"isDraft":null},"html":"<p>I’ve been reading through <a href=\"http://amzn.to/2mKoejo\">Clean Architecture</a> by Robert “Uncle Bob” Martin this month<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>, and while it is great it has had the unpleasant effect of reminding me of all of the mistakes I’ve made over the past few years while learning and using <a href=\"https://reactjs.org/\">React</a>.  I’ve absolutely loved using React at work, and it has made so many things easier.  But it’s a very unopinionated tool when it comes to structuring applications, and I made a lot of mistakes as I was using it to build some small side projects, and then transitioned a major production app to React from Backbone/Marionette.  These mistakes are all architectural; how I broke out components, communicated between components, and managed data and dependencies within components.</p>\n<p>I thought it would be useful to lay out the architecture mistakes I made as I was learning React, both as a solid reflection exercise for myself, and a warning to those of you who are just starting down the “component based UI” road.</p>\n<h3>My Mistakes</h3>\n<h4>1. Including API calls directly in components</h4>\n<p><strong>What I did wrong</strong>: This is an embarrassing one, but essentially in several places I had components directly fetching data from the server in their constructors or mount calls, and using that information to determine what to render.</p>\n<p><strong>Why I did it</strong>: This was to some extent a lack of planning.  I had all my core “business objects” modeled in some sort of separate object oriented way (either as Backbone or MobX objects) and was able to coordinate syncing them to the server outside of the component layer.  But some data in the system hadn’t been modeled in that way, and when I encountered a need for those components (such as some types of system configurations) instead of stepping back and coming up with a design for modeling those configurations on the front end, I instead sometimes fell back to an ad-hoc API call.   This was also sometimes a result of lazily copying legacy code that had bad patterns while converting components to React, and other developers copying bad patterns when trying to figure out the new React code.</p>\n<p><strong>What I should have done instead</strong>: This could be a whole series of blog posts in itself, but essentially I should have been observing a few principles that would have set off alarm bells.</p>\n<ol>\n<li>Components in a system of any size shouldn’t know about the server. UI Components are about as “low level detail” as it gets in a UI architecture, and should be passed the data they need from a higher level portion of the system.</li>\n<li>If the front end code needs data from the server, it is worth the time to properly model that data in terms of whatever data layer the front end is using.</li>\n</ol>\n<h4>2. Breaking the “props as the component interface” abstraction</h4>\n<p><strong>What I did wrong</strong>: One of the best things about React is the clear interfaces components provide with their list of props.  If properly documented with PropTypes or a type system like Flow or Typescript, it’s easy to look at any React component and tell what data it expects to receive, and therefore how other code is expected to interact with it.  99% of the time, good React components act as a function of <code class=\"language-text\">(props, state) => UI</code>.  It is however, possible to get access to a component instance, and call functions on them.  There are  rare situations where this is the right way to do things, for instance <a href=\"https://stackoverflow.com/questions/28889826/react-set-focus-on-input-after-render\">focusing an input</a>.</p>\n<p>When I first started creating React components though, I overused that pattern, and accessed the interface directly to access or change its internal state.  I’d have components like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SpecialInput</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">inputValue</span><span class=\"token operator\">:</span> <span class=\"token string\">'abc'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">inputValue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>inputValue<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input\n      className<span class=\"token operator\">=</span><span class=\"token string\">'fancy-input'</span>\n      defaultValue<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">}</span>\n      onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">inputValue</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>inputValue<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>that I would access from parent container like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">InputUser</span>\n\n  <span class=\"token function\">methodThatGotCalledOnSomeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>SpecialInput ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>input <span class=\"token operator\">=</span> el<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Why I did it</strong>:  Early on I was using this pattern in a way that copied other frameworks I was familiar with.  A parent component would need the state of it’s child component, so it would maintain a reference to the child and query the child about the state.  When I converted Backbone components to React, sometimes I was basically just copy and pasting existing code, and making it work.</p>\n<p><strong>What I should have done instead</strong>:  React doesn’t really encourage parents pulling state from their children.  Instead, if there is state that needs to be shared between components, it should be moved up to the parent component and then the state and an updater function should be passed down to the child component.  So my example above would look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SpecialInput</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>input\n      className<span class=\"token operator\">=</span><span class=\"token string\">'fancy-input'</span>\n      defaultValue<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span>\n      onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">updateValue</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>that I would access from parent container like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">InputUser</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">inputValue</span><span class=\"token operator\">:</span> <span class=\"token string\">'abc'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">methodThatGotCalledOnSomeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>SpecialInput\n             value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>inputValue<span class=\"token punctuation\">}</span>\n             updateValue<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">inputValue</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>inputValue<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>3. Interacting with 3rd party components directly</h4>\n<p><strong>What I did wrong</strong>: My first year and a half using React, when I was using 3rd party UI components like <a href=\"https://github.com/facebookarchive/fixed-data-table\">react-fixed-data-table</a> I would always use them directly in my components, and take full advantage of their APIs.</p>\n<p><strong>Why I did it</strong>: Because every React library in the world has documentation showing how to use its components directly in code for a variety of different use cases, and nobody ever tells you to put an abstraction around their code</p>\n<p><strong>What I should have done instead</strong>: I should have wrapped the 3rd party libraries in one or more wrapper components.  This has a few advantages:</p>\n<ol>\n<li>When we’re using a UI component like a table in a new place in our App, if I’ve created a wrapper component that has presets for most common settings, I only need to configure the things that are meaningful to this new use case in my app</li>\n<li>Targeted wrapper components like a <code class=\"language-text\">SortableTable</code> component or a <code class=\"language-text\">DropdownWithAutoComplete</code> component are easy to understand to a new reader of the code.  Instead of digging through configuration props, they can read the component name and understand the purpose of that component then focus on the data being passed to it</li>\n<li>When making updates to a library it is much easier to test that the changes are safe if the uses of the library are limited to a few focused components, rather than being spread across a whole application</li>\n<li>Similarly, if we need to switch to a new library, that is much easier with a limited footprint</li>\n<li>It can be easier to create reliable automatic tests using a wrapper component, since you have more control of things like how mocking works and when the component interface changes than you do for 3rd party code</li>\n</ol>\n<h4>4. Importing other parts of the system directly into display components</h4>\n<p><strong>What I did wrong</strong>: The main application I work on uses a messaging system to allow communication between different parts of the system.  It’s a legacy piece from when it existed as a Backbone application, and isn’t a very React-y way of doing things, but that isn’t really a problem.  This situation would be the same for a logging component or a data store.  What isn’t great is that when I need to use the messaging system, I always import it directly into the component file.</p>\n<p><strong>Why I did it</strong>: Direct imports are convenient, the messaging system is a core part of my system, and it seemed like a normal way of accessing it.  I also wasn’t aware of any better way to do it.</p>\n<p><strong>What I should have done instead</strong>:  The disadvantage of direct imports is that they’re harder to test.  If I had passed my messaging system as a prop to whatever component needed it, it would be much easier to test that it was called in the way I expected, without having to mock out the whole messaging system library.  I also could abstract away the whole power of the messaging system, and only provide the specific functionality needed by a component.  When I first began working on this system though, I didn’t know a practical way to do this.  The messenger system was often used by deeply nested components, and it seemed bad to pass it down a whole component tree.</p>\n<p>The answer is to use the <a href=\"https://www.robinwieruch.de/react-provider-pattern-context/\">Provider pattern</a>.  The provider pattern is a way to use React’s context API to provide top level properties from a high level parent component to deeply nested child components.  It is a perfect pattern for providing important high level pieces of your application to low level components without tightly coupling them, while maintaining testability.<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></p>\n<h4>5. Changing too many things at once</h4>\n<p><strong>What I did wrong</strong>: When my team began converting our application from Backbone to React, it was tempting to try and change many things at once.  All the React examples you see online are using Babel/ES6, Webpack, Redux, React Router and tons of other shiny but complicated things.  Trying to implement it all in an existing project<sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup> can be overwhelming and lead to <a href=\"http://mikehadlow.blogspot.com/2014/12/the-lava-layer-anti-pattern.html\">lava layers</a>.  We actually started out with good discipline and converted files to use ES6 first, then added Webpack, then slowly started to convert UI components to React.  Unfortunately as we continued to convert React, we began replacing our Backbone data models with MobX, and began using CSS Modules in some places.  When our team size was reduced last year, we were left in a situation where the same functions were performed in different ways throughout the codebase.</p>\n<p><strong>Why I did it</strong>: It’s easy to see things that could be better in a web application and immediately want to fix them!  Especially if parts of that change seem easier than other changes you’re working on</p>\n<p><strong>What I should have done instead</strong>: I wrote about this <a href=\"https://benmccormick.org/2018/01/07/large-improvements-small-team/\">at length</a> last month, but there really is no substitute for taking things one at a time.  While it’s tempting to think that it will be easier to convert to React if you’re using other “react-y” tools and libraries, your code will ultimately be more maintainable if it is consistent throughout an application.  The only reliable way to do that is to make changes completely before you start making other changes.  It isn’t sexy, and it will leave you at least a little ways off the bleeding edge, but it’s the way to build large, reliable systems and keep them up to date.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">At the time of writing this, it was super on sale on <a href=\"http://amzn.to/2mKoejo\">Amazon</a><a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">Note that the Context API that the provider pattern is based on is changing, so I’d isolating out any provider code you write into a reusable component so that it is easy to update later<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-3\">Or even a new project for that matter!<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/02/07/react-confessions/"}}},{"node":{"frontmatter":{"readNext":"new-hello-world,ten-things-js,es6-the-bad-parts","topics":["javascript"],"category":"javascript","key":"javascript-stale-practices","title":"JavaScript “Stale Practices”","description":"Looking at a few previous JavaScript best practices that are now out of date.","layout":"post","path":"/2018/06/26/javascript-stale-practices/","date":"2018/06/26","dontfeature":null,"isDraft":null},"html":"<p>Best practices don’t last forever. This is especially true when a field is changing fast, and JavaScript development has changed a lot over the past 10 years.  The old best practices go stale, and new ones take their place.  Here are 5 JavaScript best practices that have gone stale recently.</p>\n<h4>Using the strict mode pragma to opt in to a sane JavaScript subset</h4>\n<p>When <a href=\"https://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning\">ECMAScript 5</a> was released, it introduced a special <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode\">strict mode</a> that tweaks the behavior of some obscure features of the language.  Now, when a function or script file starts with the string <code class=\"language-text\">'use strict'</code>, code in that scope works differently than the same code without the <code class=\"language-text\">'use strict'</code> string.  Expressions that look like a mistake are flagged as an error instead of being ignored, code is restricted in ways that make it easier to optimize performance, and terms that may be used in future JavaScript versions are reserved as keywords and you can’t use them as names for variables.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> objWithDuplicates <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Fine normally, an error in strict mode</span>\n<span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span>objWithDuplicates<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// with expressions are syntax errors in strict mode</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> <span class=\"token keyword\">private</span> <span class=\"token operator\">=</span> <span class=\"token string\">'top secret'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// this is a ReferenceError in strict mode</span></code></pre></div>\n<p>Strict mode was a nice small improvement in JavaScript, and a good way to move past some of the mistakes of the past like <code class=\"language-text\">with</code> expressions.  But even though it was a good idea to use, and I was adding the silly <code class=\"language-text\">'use strict'</code> string to the start of all my functions for a few years, this is no longer necessary for many people.</p>\n<p>The <code class=\"language-text\">use strict</code> string was necessary because the language designers wanted to maintain backwards compatibility, and they needed a way for developers to signal that they were writing new code that they were comfortable holding to a higher standard.  ECMAScript 2015 (<a href=\"https://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning\">ES6</a>) provided a better way of doing that.  <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export\">JavaScript Modules</a> are a new type of script, and browsers can be confident that scripts loaded that way have been edited in a ES2015+ world.  Because of that confidence, JavaScript modules are strict mode by default.  So if you are using <code class=\"language-text\">import</code> and <code class=\"language-text\">export</code> in your code, you can stop adding <code class=\"language-text\">'use strict'</code> everywhere and just rely on the browser to do the right thing.  If you’re compiling through <a href=\"https://babeljs.io/\">Babel</a> or other tools you’ll still be ok, as they add the strict mode pragma for you when they compile your classes down to ES5 code.</p>\n<h4>Using anonymous functions when dealing with async code in loops</h4>\n<p>For many years, JavaScript’s many async use cases combined with the way <code class=\"language-text\">var</code> works to create a classic programmer trap.  Here’s some jQuery code to put a listener on a series of buttons and alert a different number for each one of them.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> buttons<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>buttons<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The idea is that if we have a list of 10 buttons, after we run this code clicking the first one will alert <code class=\"language-text\">1</code>, the next one <code class=\"language-text\">2</code>, and so on.  The problem is… it doesn’t work.  If there is a list of 10 buttons, all of them will alert <code class=\"language-text\">10</code> when clicked.  But why?   The problem is that <code class=\"language-text\">var</code> doesn’t create a new variable for each run of the loop.  The technical term here is that <code class=\"language-text\">var</code> isn’t <em>block-scoped</em>.  It isn’t limited by a set of curly braces, when <code class=\"language-text\">var</code> is called, it creates a variable that is accessible anywhere inside the function that contains it, or it creates a property on the global object if there is no containing function.  So when we run our loop, we aren’t creating 10 separate <code class=\"language-text\">i</code> values, we’re creating 1 <code class=\"language-text\">i</code> value and updating it 9 times.  Since the click handlers don’t run until the user has clicked the button, <code class=\"language-text\">i</code> has been updated all the way to 9, and every button references it and alerts <code class=\"language-text\">10</code>.</p>\n<p>For years, the recommended way of working around issues like this was to create an inner function.  Because JavaScript variables are function scoped, we can create a new function, pass it the current i value, and execute the function immediately.  When the click handler executes, it will have a reference to the arguments from the inner function, and will receive the correct variable value.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> buttons<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">innerI</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>buttons<span class=\"token punctuation\">[</span>innerI<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>innerI <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This example works, but it’s obviously a bit convoluted, and would not look straightforward to a new JavaScript programmer who came across it.  It gives off some unmistakable “magic function” vibe.  Fortunately we can do better nowadays.</p>\n<p>ECMAScript 2015 introduced the block scoped variable types <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code>.  Now we can create loop iterators that stay scoped to the loop portion that they were assigned in.  This allows us to re-simplify our code, but have it actually work.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> buttons<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>buttons<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Using closures for all of our private variables</h4>\n<p>JavaScript has never had a first class method for creating objects with private state.  Any normal object you create will have all its properties available for reading and editing by any code that has access to it.  But there has always been a workaround.  We can once again take advantage of JavaScript’s function scope.  This time we can write a function that creates an object.  The methods of that object will have access to any other variables inside that function.  This is called a closure.  A closure is a function that returns another function that maintains access to the outer function state.  In this case the returned function will be a method on an object.  Here’s an example with a user, where the id is only readable and the name can only be updated with explicit get and set commands, which won’t accept a falsy value:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> <span class=\"token function\">uuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">getID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> name <span class=\"token operator\">=</span> _name <span class=\"token operator\">||</span> <span class=\"token string\">'Unknown'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This object factory pattern is still useful today, but sometimes we want something a bit more object oriented.  Fortunately there are now more ways of doing these things. ES2015 introduced the <code class=\"language-text\">Symbol</code> keyword.  Symbols are unique values that can only be accessed by code that has a reference to the symbol.  So we can use a symbol as a more advanced version of our factory code above, creating a class that accesses it’s private state via a symbol.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token constant\">ID</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token constant\">NAME</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span><span class=\"token constant\">ID</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">uuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span><span class=\"token constant\">NAME</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">get</span> <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span><span class=\"token constant\">ID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">get</span> <span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span><span class=\"token constant\">NAME</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">set</span> <span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">[</span><span class=\"token constant\">NAME</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">||</span> <span class=\"token string\">'Unkown'</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This allows us to keep all of our private state local to the object rather than in a separate closure, and our objects with private state can be created with class constructor syntax when that is preferred or required.</p>\n<p>I want to note that this new best practice will likely become stale itself soon.  TC39 is considering a proposal to add explicit private state to classes.  It is currently in <a href=\"https://ponyfoo.com/articles/tc39-ecmascript-proposals-future-of-javascript#stage-3\">stage 3</a> with TC39 and is likely to become a part of the language.  In the proposal, private state would look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    #id <span class=\"token operator\">=</span> <span class=\"token function\">uuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    #name <span class=\"token operator\">=</span> <span class=\"token string\">'Unknown'</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span>#name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">get</span> <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#id<span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">get</span> <span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#name<span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">set</span> <span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#name <span class=\"token operator\">=</span> name <span class=\"token operator\">||</span> <span class=\"token string\">'Unkown'</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Reading <code class=\"language-text\">arguments</code> to create variadic functions</h4>\n<p>Variadic functions are functions that may contain  different numbers of arguments when called.  For instance, a sum function that takes multiple arguments and adds them all together.  Prior to ES6, this was accomplished by using the special <code class=\"language-text\">arguments</code> variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> arguments<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token string\">'Sum requires at least 2 arguments'</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// convert arguments to a \"real array\"</span>\n    <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> args<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// sum(1,2) === 3</span>\n<span class=\"token comment\">// sum(1, 10, 20) === 31</span></code></pre></div>\n<p>Using arguments is a bit messy.  First, it’s a magic variable like <code class=\"language-text\">this</code> that is automatically available in the scope of any function.  This isn’t obvious to people who don’t know about it.  Second, it’s not a “real array”, it’s an “array-like object”, and thus it doesn’t have useful methods like <code class=\"language-text\">map</code>, <code class=\"language-text\">filter</code>, <code class=\"language-text\">reduce</code> available on its prototype.  You always have to deal with the whole object, even if you have some named arguments and some unnamed ones.   But ES6 provided a better solution with rest parameters.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>nums</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nums<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token string\">'Sum requires at least 2 arguments'</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> nums<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Rest parameters allow us to capture a varying-length group of arguments and read them as a real array with a meaningful name we choose. Because it captures a varying-length list of arguments, rest parameters must be the final parameter defined for a function, but they don’t have to be the first.  You can define a few static parameters and leave a rest parameter to capture the remainder.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">createBlogPost</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>tags</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token function\">uuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">metadata</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        date<span class=\"token punctuation\">,</span>\n        tags<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Rest parameters can do everything arguments do<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>, but they do it in a less magic way, without the confusion of managing a fake array.  At this point arguments should be considered an anti-pattern.</p>\n<h4>Using slice to convert something to an array</h4>\n<p>The previous snippet contained an extra outdated practice.  Did you notice this line?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That was previously the best way to handle fake arrays like <code class=\"language-text\">arguments</code>, NodeLists, or just <code class=\"language-text\">{3: 1, length: 4}</code>. <code class=\"language-text\">slice</code> makes a copy of an array, optionally adding or deleting elements.  Here we’re only passing <code class=\"language-text\">arguments</code> as the <code class=\"language-text\">this</code> value of the function, so it works the same as <code class=\"language-text\">arr.slice()</code>.  When called without arguments, <code class=\"language-text\">slice</code> is essentially a clone function.  But this code looks pretty bizarre if you haven’t seen it before.  It also slides into the “wait did I mean slice or splice?” vortex of array method confusion. So it isn’t a particularly readable solution.</p>\n<p>ES6 introduced the <code class=\"language-text\">Array.from</code> method to improve this situation.  <code class=\"language-text\">Array.from</code> takes an array-like object and creates a real array copy of it.  So it can be a clone method for existing arrays, or a conversion method for fakes like <code class=\"language-text\">arguments</code>.  <code class=\"language-text\">Array.from(arguments)</code> certainly reads a lot cleaner than the slice method.  It should be noted that they aren’t completely equivalent.  <code class=\"language-text\">slice</code> will leave missing indices as holes, while <code class=\"language-text\">Array.from</code> will add those indices and set them to undefined.  So you can see the following difference</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> fakeArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">length</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// convert object to a real array</span>\n<span class=\"token keyword\">let</span> slicedArray <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>fakeArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> frommedArray <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>fakeArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// filter Out 5s</span>\n<span class=\"token keyword\">let</span> slicedArrayNoFives <span class=\"token operator\">=</span> slicedArray<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">!==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> frommedArrayNoFives <span class=\"token operator\">=</span> frommedArray<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">!==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>slicedArrayNoFives<span class=\"token punctuation\">)</span> <span class=\"token comment\">// [3]</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>frommedArrayNoFives<span class=\"token punctuation\">)</span> <span class=\"token comment\">// [undefined, 3, undefined]</span></code></pre></div>\n<p>You can see my <a href=\"https://benmccormick.org/2018/06/19/code-golf-sparse-arrays/\">last post</a> for more on holes in arrays.</p>\n<h3>Moving Forward</h3>\n<p>The fun of this industry is that everything is always changing.  The frustration of this industry is that everything is always changing.  I’m sure ES2020 or whatever they call it by then will give us plenty of new “best practices”.  In the meantime, no need to throw away all your code right away.  But if you’re setting an example for others, it would be a great time to update some visible examples of stale practices to point to the newer, more friendly solutions.  Even if you don’t have your own blog posts or documentation to change, you can update public documentation.  Did you know that anyone can update the MDN JavaScript documentation?  I was able to add information about module strict mode to the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode\">MDN article</a> while working on this post.  And you can upvote modern answers to popular old questions on StackOverflow.</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/a/960870/1424361\">Using <code class=\"language-text\">Array.from</code> to convert <code class=\"language-text\">arguments</code></a></li>\n<li><a href=\"https://stackoverflow.com/a/16661498/1424361\">let instead of closures in loops</a> <sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></li>\n</ul>\n<p>Or just do some refactoring of high traffic code in your own code bases, so that older code isn’t copy and pasted, and you have good examples of the better way to do things.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">Ok technically arguments has an <code class=\"language-text\">arguments.callee</code> property that gives you a reference to the calling function, but you can recreate this by giving your function a name, and using <code class=\"language-text\">arguments.callee</code> is an error in strict mode.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">Yeah… that one is my answer.  I promise I’m not just trolling for upvotes :)<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/06/26/javascript-stale-practices/"}}},{"node":{"frontmatter":{"readNext":"feedback-loops,react-confessions,orthogonality-css-js","topics":["architecture","javascript"],"category":"fe-architecture","key":"fe-concerns","title":"What's involved in Front End Architecture?","description":"6 areas of interest in front end software design discussions","layout":"post","path":"/2019/01/07/the-concerns-of-fe-architecture/","date":"2019/01/07","dontfeature":null,"isDraft":null},"html":"<p>The word “architecture” gets thrown around a lot in software discussions.  But we don’t seem to always use it the same way.  Some example usages:</p>\n<blockquote>\n<p>Our app uses Redux for our architecture.</p>\n</blockquote>\n<p>Sometimes we assume that because we are using a framework or data management library, that must be our architecture.</p>\n<blockquote>\n<p>I created a diagram of our dependency graph, showing all the imports in the code, as a way of seeing our architecture.</p>\n</blockquote>\n<p>We could also say the way your program is structured (which files depend on which other files) represents your architecture.  If we’re fancy, then maybe we have <a href=\"https://en.wikipedia.org/wiki/Unified_Modeling_Language\">UML diagrams</a> representing this structure.</p>\n<blockquote>\n<p>Bob is our architecture guy: he decides what dependencies we can bring in, is always asking us to refactor code to make it “cleaner”, and runs a design meeting before each feature to decide how to structure the code</p>\n</blockquote>\n<p>This final quote sounds like architecture is more about the decisions you’re making as you go through a project.</p>\n<h3>Appealing to authority?</h3>\n<p>So if the community isn’t using the term consistently, let’s ask the experts.  Here are 2 definitions from folks who have written popular books on software architecture.</p>\n<p>Robert Martin (Uncle Bob) uses the following definition in <a href=\"https://amzn.to/2rROcEA\">Clean Architecture</a>:</p>\n<blockquote>\n<p>The goal of software architecture is to minimize the human resources required to build and maintain the required system.</p>\n</blockquote>\n<p>Martin Fowler gave his definition in a talk titled <a href=\"https://www.youtube.com/watch?v=DngAZyWMGR0\">Making Architecture Matter</a>. It is worth watching in full, but paraphrased, his definition is:</p>\n<blockquote>\n<p>Software architecture is those decisions which are both important and hard to change</p>\n</blockquote>\n<p>These 2 definitions turn out to be complementary.  Uncle Bob motivates architecture: we’re focused on minimizing the work put into the system.  Martin Fowler’s definition shows what parts of the system architecture is concerned with: the parts that are “important” and hard to change.</p>\n<p>The next question of course is… what is important?  The unsatisfactory answer is that it depends.  It will change between projects, and will change within a project over time.  But when we scope the question to the domain of front end development, common themes emerge.  Specifically there are 6 areas of concern that I see coming up again and again in public and private front end architecture discussions.  They’re not exclusive to the front end, but they’re a good starting point for anyone thinking about building web applications.</p>\n<h4>Ease of Change</h4>\n<p>When new requirements arrive, how quickly are developers able to make changes and release new code to production?  When there are bugs, how easy is it to find the problem and fix it?  Are developers able to consistently deliver correct code?  Or are multiple iterations often required?</p>\n<h4>Security</h4>\n<p>Can a malicious user inject code into your site?  Are you unnecessarily exposing information about your users or code structure? And you are working with your API developers to use secure authentication and authorization practices right?</p>\n<h4>Accessibility</h4>\n<p>This concern is broader than the way the word is often used in web dev circles.  Is the full audience of this site or application able to use it with as few limitations as possible?  Users with disabilities?  Users with older but supported browsers?  How about international users or those with slow connections?  Does your site work on mobile?  Offline?  On Apple Watch?  Do you support AMP? And do your pages appear nicely on social media?  Do you even care about any of these audiences? Maybe you’re optimizing for people who aren’t your users?</p>\n<h4>Reliability</h4>\n<p>Is a site or  application consistently available to users?  Does it often fail, and if so how does it recover?  If things are breaking, are the developers aware of it quickly?  Do different users in different scenarios receive a consistent experience?</p>\n<h4>Performance</h4>\n<p>Is a site or application consistently quick to load and interact with?  If there are animations or highly interactive elements, are they responsive and usable, or do they freeze/jank? Is the user disrupted in their tasks by strange loading behavior?</p>\n<h4>Capability</h4>\n<p>Is your site limited in fulfilling its purpose because of foundational decisions or tradeoffs with the other concerns?  Have you made decisions that let you serve your audience in unique ways because of your tech stack or development processes?  Do your technical decisions even make sense in the context of your site or application’s purpose?</p>\n<h3>Coming Soon</h3>\n<p>I’m hoping to look at each of these areas more in depth in the coming weeks, as well as exploring how we make decisions that impact multiple areas simultaneously.  In the meantime, as you’re looking at decisions and tools that will impact the long term structure of your front end application, consider how they’ll impact each of these areas.</p>\n<p><strong>TL;DR</strong></p>\n<ul>\n<li><strong>Architecture is about decisions that are important and hard to change, with a goal of improving the efficiency of a project</strong></li>\n<li><strong>Front End architecture is often concerned with the areas of Ease of Change, Security, Accessibility, Reliability, Performance and Capability</strong></li>\n</ul>","fields":{"slug":"/2019/01/07/the-concerns-of-fe-architecture/"}}},{"node":{"frontmatter":{"readNext":"fe-concerns,react-confessions,feedback-loops","topics":["architecture","javascript"],"category":"fe-architecture","key":"reliability-design","title":"Designing Front End Apps For Reliability","description":"Principles for creating more robust applications","layout":"post","path":"/2019/01/21/designing-for-reliability","date":"2019/01/21","dontfeature":null,"isDraft":null},"html":"<p>In my recent <a href=\"https://benmccormick.org/2019/01/07/the-concerns-of-fe-architecture/\">post on Front End Architecture</a> I identified <em>Reliability</em> as a key concern of front end architecture.  I define reliability as follows:</p>\n<blockquote>\n<p>An application’s ability to provide a consistent functional experience to all users in the intended audience over time.</p>\n</blockquote>\n<p>Let’s break that down a bit:</p>\n<p><strong>Consistent</strong> - Reliable applications function the same way over time or degrade gracefully, even on days with heavy load, leap years, and weekends.</p>\n<p><strong>Functional</strong> - Reliable applications allow the users to do the things they need to do, and are forgiving when a user attempts actions that weren’t part of an ideal use case.</p>\n<p><strong>All Users In The Intended Audience</strong> - Reliable applications work for users with strange data who live in different locales, and those with bad network connections and old browsers, at least within the limits of what what the business intends to support.  There is some overlap here with the concept of <strong>accessibility</strong>.</p>\n<p><strong>Over Time</strong> - In the real world, no application is ever completely reliable.  Things break down, there are bugs, and new edge cases are discovered.  What we can aspire to though, is an application where things that are working consistently stay working consistently, and as bugs, regressions and edge cases are discovered they get fixed in permanent ways.</p>\n<h3>Things Break Down</h3>\n<p>So why are applications often unreliable?  There are a fairly predictable set of issues that most applications run into that degrade reliability.</p>\n<h4>Unexpected Usage Patterns</h4>\n<p>Users are agents of chaos and the real world is stranger than expected.  Your sample database and QA testing doesn’t come close to giving you a true idea of how your application will be used.</p>\n<h4>External Failures</h4>\n<p>Google never has bugs right?  Good luck with that.  Even if the rest of the world always wrote perfect software, front end code usually has to deal with the network, even when your user is on a plane, accessing your site over 2G in the mountains, or just dealing with crappy coffeeshop wifi.</p>\n<h4>Bugs</h4>\n<p>Bugs happen.  When they happen consistently and repeat themselves, you have a reliability problem.</p>\n<h4>Scaling Problems</h4>\n<p>Some things work great on small data sets or with a few users but break down when things get popular.  This isn’t just a backend issue.  Data scales as well as people, and your program needs to be robust to slower backend responses when under load.</p>\n<h3>Keeping Things Running</h3>\n<p>I’d like to offer some practical strategies for overcoming the challenges I’ve listed.  These are things you can consider during code reviews and when setting up your dev processes.</p>\n<h4>1. Consider all states, and limit them if you can</h4>\n<p>One of the big leaps in JavaScript based UI development over the past decade has been moving from systems that we modeled as an initial UI state followed by a series of mutations (server generated HTML + jQuery) to systems that were modeled as partially driven with event systems that caused mutations to the UI (Backbone, Angular 1, Knockout), to systems that model the UI as a function of state (React, Vue, Angular2+, Modern Ember) State-driven systems tend to be more robust, because it is often more clear when a particular state might cause a problem, and it is more obvious when a problematic state occurs for a user how it happened.</p>\n<p>Visibility into state is a huge step forward.  The next step is to define the possible states.  You can do this in your head, but it’s much easier when using types or by thinking in terms of <a href=\"https://benmccormick.org/2018/05/14/mobx-state-machines-and-flags/\">state machines</a>.  If you can map out different portions of your applications into a limited set of states and define behavior for each of them, reliability will be much easier to achieve.</p>\n<p>The final step is to limit these states where possible.  Some interfaces depend on user input or external data enough that they naturally are effectively “infinite state machines”, but when you can limit states by cutting scope, rearranging components or cordoning “infinite state machines” off into a smaller area of your application, you gain a lot of benefits.</p>\n<h4>2. Don’t trust the network</h4>\n<p>This one is straightforward, and easy to check in code reviews.  Don’t assume that anything over a network will return quickly.  Don’t assume it will return correctly.  And in fact, don’t assume it will return at all.  You may be limited in how you can handle these possibilities, but the baseline competence here is handling them.  Have strategies for loading states, timeouts, error handling and bad formats.  Things like service workers can help here, but also make the problems around the network even more complicated by introducing a new caching layer.  When you start making calls over a network, you’re entering the realm of distributed systems and things get tricky fast.  But the least you can do is recognize the complexity and make a plan for it.</p>\n<h4>3. Consider variations in data</h4>\n<p>Do you have a test data set that you develop against?  Is that your primary source of validation before you send code off into the wild?  Some of that may be unavoidable and out of your control, but remember that users are agents of chaos.  You will encounter data you didn’t expect, so plan ahead for challenges.  How would your data visualization function if the dataset you ended up displaying was 2x the size of your test database?  10x? 1000x?  What if the list of products to display in your table contained product names 200 characters long?  Or if some of them were empty?  The real world is strange and you should be ready.</p>\n<h4>4. You should have testing</h4>\n<p>This is another topic that’s too big to cover fully here, but basically there’s a reason that QA engineers have jobs.  You should have a plan for testing.  That plan will be better if it contains meaningful amounts of automated regression testing, with a clear process for making sure bugs are tested automatically once they’ve been discovered and fixed.  If you don’t know where to start, always focus on testing the most important things well over testing everything mediocrely. And if you’re not in a position to do meaningful automated testing, consider what it will take to get there.</p>\n<h4>5. Monitoring</h4>\n<p>Finally, sometimes it’s just not possible to catch problems before they ship.  But you can still catch them before too many of your customers do if you put in the work.  I’ll be honest, I’ve never had a monitoring setup that I’ve been happy with at work, but on the front end good monitoring can mean sending console logs over the network so that they’re shared with whatever backend logging solution you’re using, tracking feature usage through analytics to look for any large problems or lack of usage that may indicate bugs, and even more advanced stuff like session recording in some cases.</p>\n<p><strong>TL;DR</strong></p>\n<ul>\n<li><strong>Reliability is an application’s ability to provide a consistent functional experience to all users in the intended audience over time.</strong></li>\n<li><strong>Reliability breaks down due to unexpected usage, external failures, bugs, and scaling problems</strong></li>\n<li><strong>You can boost reliability by defining and limiting application states, distrusting the network, thinking about variation in data, testing and monitoring</strong></li>\n</ul>","fields":{"slug":"/2019/01/21/designing-for-reliability"}}},{"node":{"frontmatter":{"readNext":"reliability-design,fe-concerns,valuable-code-reviews","topics":["architecture","javascript"],"category":"fe-architecture","key":"perf-design","title":"Designing Front End Apps For Performance","description":"Principles for creating more responsive applications","layout":"post","path":"/2019/01/28/designing-for-perf","date":"2019/01/28","dontfeature":null,"isDraft":null},"html":"<p>Performance is a tricky topic to give generalized advice about.  Moreso than any of the other <a href=\"https://benmccormick.org/2019/01/07/the-concerns-of-fe-architecture/\">front end concerns</a> I discussed in my post at the beginning of the year, it is remarkably tied into the details of what an app is doing and how it is built.  That said, here are some general principles for designing performant applications that I’ve picked up over the years:</p>\n<h4>1. Measure First</h4>\n<p>One of the most tempting things with performance is to start making changes before you have a specific slow measurement to improve.  Maybe you’re writing your code up front with a major focus on performance because you know you’ll need it, or diving in to make changes the first time a user complains about slowness.  Regardless it can be tempting to “performance tune” before you get detailed performance measurements.</p>\n<p>This is problematic for 2 reasons: First, we often don’t know what good enough system performance is until users start using the system.  Secondly, programmers’ data-free intuitions on what parts of a system will be slow tend to be universally awful.</p>\n<p>Measuring different aspects of your system first provides several benefits:</p>\n<ol>\n<li>It gives you micro-benchmarks to improve upon, rather than waiting till “it feels good”</li>\n<li>It lets you determine which parts of the system are actually slow, so you can focus on bottlenecks</li>\n<li>It may help you justify performance focused work to project stakeholders.</li>\n<li>It will allow you to test for regressions later on</li>\n<li>It may reveal that the system performance is actually adequate in most situations, and help you narrow down edge cases to optimize or restrict</li>\n</ol>\n<p>Note that this advice encompasses two often quoted pieces of advice: Donald Knuth’s “Premature optimization is the root of all evil” and Kent Beck’s “Make it work, make it right, make it fast”.  When you only optimize based off of measurements, those things are going to naturally fall into place.</p>\n<p>So what should you measure? On the front end Google’s <a href=\"https://developers.google.com/web/fundamentals/performance/rail\">RAIL model</a> is a good place to start.  For loading you can look at benchmarks like first paint, first meaningful paint, and Time To Interactive (TTI) as useful benchmarks. They also provide similar guidance for input responsiveness and animation. Google is a bit preachy about specific perf benchmarks to my mind, but their analysis of <em>what</em> to measure is fantastic.</p>\n<p>It’s also useful to be able to communicate to backend developers when slowness comes from backend requests, so it’s good to familiarize yourself with the network panel in your favorite browser’s developer tools.  That will let you see how long different requests are taking and help evaluate when a performance problem is actually a network problem.</p>\n<h4>2. Assume the network is slow</h4>\n<p>Related to the end of the last point, one of the defining attributes of front end development is that it always involves a network.  You can think of network requests as a giant chaos machine at the heart of your web application.  Network requests will fail, they will be slow… and they’ll almost always look better to you in local development than they will be to your users, assuming like many developers that you’re operating on reasonably good hardware and decent wifi.</p>\n<p>So the network can be a bit of a performance trap for devs.  While I still advocate measuring first, with the network it’s worth assuming that your local setup is not a good proxy for the user and either finding ways to do better tests or simply expecting that the user will have a slower or flakier connection and designing for that.  Firefox and Chrome are very helpful here, as they will allow you to simulate slower connections from within their network panel, allowing you to experience your app the way your users do.  This is especially important if you’re targeting mobile users.</p>\n<h4>3. You can do things more efficiently or you can do less</h4>\n<p>This is ultimately the heart of performance.  When an operation is slow, it is ultimately because your user’s computer is performing too many operations to fit them all into the time you want them to.  To speed things up, you either have to reduce the number of operations by making your code more efficient, or by removing some work completely.  When people talk about compiled languages being faster than non-compiled languages, this is usually what they mean: compilers are very proficient at optimizing code for efficiency and removing wasted operations.</p>\n<p>On the front end there are several major areas of potential waste: we can send too many things over the network, we can cause the browser to repaint or layout thrash unnecessarily, and we can block critical actions like responding to a users input with less critical actions like re-rendering an item offscreen.  Each of those could merit a series of articles on their own, but are great starting points when thinking about how to improve performance when no one component is obviously slow.</p>\n<p>But it is worth remembering that sometime the only way out is doing less. Maybe you need to delay rendering some parts of the screen, or remove an expensive to render visualization. Maybe you should be using built in components instead of shipping a fancy UI component library.  I have no idea what your use case is, but it’s always worth thinking about what you can do less of.</p>\n<h4>4. Perception matters more than reality</h4>\n<p>Engineers like to deal with data and reality.  My first 3 points played right into that.  Now it’s time to go against the grain.  The truth is that users aren’t pulling up devtools to check and see if your site is slow.  It either feels slow to them or it doesn’t.  And the actual numbers are only part of that perception.  Here are some things that can make fast sites seem sluggish and slow sites seem broken:</p>\n<ol>\n<li>\n<p><strong>Not showing a visual response to user interaction</strong></p>\n<p>When a user clicks a button that triggers a network request, and the system does nothing till that request completes, it will lead to the user thinking the system is slow at best and broken at worst.</p>\n</li>\n<li>\n<p><strong>Freezing the interface while waiting on a response to a previous interaction</strong></p>\n<p>It’s always important to keep the screen interactive while waiting on a request, even if some options are disabled or limited.  The user should be able to access navigation and other standard elements of the interface as normal.  In a scenario where the request is saving data, it may be necessary to add prompts to check whether they want to interrupt the save however.</p>\n</li>\n<li>\n<p><strong>Loading states without any movement or animation</strong></p>\n<p>Sometimes people just want to know that you’re doing something.  Animation communicates that something is happening.  It can be a spinner, a flowing placeholder block, or a progress bar.  The important thing is to show the user “things are happening”.  Of course the more relevant your loading state is the better.  Facebook’s placeholder items in their newsfeed create an illusion of content coming in even faster since the loading state itself helps frame the screen for the user.  Much more effective than a loading spinner that serves to remind the user that they’re having to wait for something.</p>\n</li>\n</ol>\n<h3>Performance Is All About Effort</h3>\n<p>To quote <a href=\"https://hackernoon.com/10-things-i-learned-making-the-fastest-site-in-the-world-18a0e1cdf4a7\">David Gilbertson’s great post on performance</a>:</p>\n<blockquote>\n<p>It’s really easy to make a slow site, all you have to do is not try to make a fast one.</p>\n</blockquote>\n<p>Performance comes down to caring, measuring and investing.  If you set reasonable benchmarks, and track them as you make changes, you’re likely to find ways to achieve them.  If you set unreasonable benchmarks and make the space to work at them, you’re likely to do better than anyone who isn’t trying that hard would expect.</p>\n<p><strong>TL;DR</strong></p>\n<ul>\n<li><strong>Measure First</strong></li>\n<li><strong>Assume The Network is Slow</strong></li>\n<li><strong>You can do things more efficiently or you can do less</strong></li>\n<li><strong>Perception > Reality</strong></li>\n<li><strong>Performance is all about effort</strong></li>\n</ul>","fields":{"slug":"/2019/01/28/designing-for-perf"}}},{"node":{"frontmatter":{"readNext":"following-js-roadmap,fe-concerns,ten-things-js","topics":["javascript","career","productivity"],"category":"soft-skills","key":"how-to-learn","title":"How To Keep Learning JavaScript","description":"What you can do to keep getting better once you have a solid baseline.","layout":"post","path":"/2019/02/18/how-to-keep-learning-js","date":"2019/02/18","dontfeature":null,"isDraft":null},"html":"<p><em>A member of my team at work asked me last week how I continue to learn things about JavaScript.  This is my answer. Note that it is focused on leveling up for folks with existing programming experience, not giving the best pathway into the field.</em></p>\n<p>I’m going to break this up into 3 parts.</p>\n<ol>\n<li>The different ways people tackle learning new programming things</li>\n<li>An inventory of the different types of resources out there for learning programming</li>\n<li>My specific recommendations for JavaScript and React resources</li>\n</ol>\n<p>The first 3 are going to be generalizable to any type of learning about programming you want to pursue (and probably other fields as well).  The last one is necessarily more specific.</p>\n<h4>Learning Strategies</h4>\n<p>It’s helpful to start by talking about the different ways that people learn programming concepts.  We can break things up into 3 categories:</p>\n<ul>\n<li><strong>Practical</strong>:  This is where you work on projects and pursue goals, and learn the things you need as you need them.</li>\n<li><strong>Topical</strong>: This is when you commit to learning something about a certain set of topics that you think will be valuable.  This may be related to work you’re doing, but your goal is a deep understanding of the topic moreso than trying to solve a specific problem.</li>\n<li><strong>Serendipitous</strong>: This type of learning isn’t directed at all.  You’re just diving into learning as you encounter new terms or concepts, trying to absorb and understand everything.</li>\n</ul>\n<p>So which one is best?  You’ll hear arguments for all three, but personally I see learning like investing; it’s a long term game that you can’t win in a day, the gains accumulate slowly until suddenly you’re a long way from where you started, and one of the keys is diversifying.</p>\n<p>Practical knowledge is safe; when you focus on learning things you need, you’ll rarely waste your time, will likely get more done, and will put yourself in a position to learn more interesting things as you develop a reputation for doing good work.  However focusing solely on learning the things you need to do your current job may blind you to trends and eventually leave you with an out of date skill set. In addition, while you may be looking for answers to practical problems, if your knowledge base is narrow to start you may miss out on innovative ideas because you don’t have exposure to solutions that might not “google well” for the way you think of your current needs.</p>\n<p>Topical knowledge can be very useful when jumping into a new area of work: sometimes you just need a level of exposure to the syntax, concepts and tools behind a language, framework or project before you can effectively work with it.  But learning about a topic divorced from a project can sometimes feel more productive in the moment than it actually ends up being: without practical experience of the pain points that the topic is solving for and/or causing, it can be hard to know what is important and make the connections that you really need. Topical learning can also devolve into a purely academic exercise where you never really learn to apply what you know.</p>\n<p>Serendipitous learning on the face of it is the most easily wasted; trying to learn everything can be overwhelming in programming, a field based on layers of abstractions, with a plethora of different subfields that can be explored for years without learning everything. However sometimes it is the dash of inspiration that comes from bringing previously disconnected ideas together that leads to the creation of something novel and great.  And those types of connection only come from somebody who is learning broadly as well as deeply.  Being curious also prevents the pitfalls of purely practical learning: dead-ends and blind spots. So there is a place for serendipitous learning too.</p>\n<p>The best approach is a mix of the 3: have real problems that you’re trying to solve, but make sure to keep an eye out for interesting things, and don’t be afraid of the occasional deep dive into a useful sounding topic.</p>\n<h3>Resource Types</h3>\n<p>There are so many ways to learn things in the programming world.  Below is a brief roundup of resource types, ordered roughly in terms of stability and how rapidly they produce new material.</p>\n<ul>\n<li><strong>Academic Courses</strong> - College, bootcamps, Coursera, etc:  These are the ultimate in topical learning.  Not something that most people are doing every day, but can be great for rebooting a career if you want to head in a new direction or refresh after being away from the field for a while.</li>\n<li><strong>Books</strong> - People are still writing programming books.  These tend to fall into 2 categories: books about a specific framework or technique and more “timeless” books about some fundamental part of how we write software. The first group tends. to age fast but can be great for topical learning, the second are an essential resource for “higher level” thinking about our field.</li>\n<li><strong>Video Courses</strong> - In recent years, video courses seem to have grown in popularity as a way of teaching programming.  They’ve never been my cup of tea, but they can be great topical guides to new subjects for visual learners who don’t want to commit to a full academic course.</li>\n<li><strong>Wikis</strong> - There are several places online where developers aggregate documentation in an open way.  <a href=\"https://stackoverflow.com/\">Stack Overflow</a> and <a href=\"https://www.wikipedia.org/\">Wikipedia</a> are the most prominent.  These can be an excellent authoritative source to start looking for answers that still are able to remain relevant as best practices and trends change.</li>\n<li><strong>Blogs</strong> -  Blogs come in a variety of flavors.  They can be focused profitable publishing platforms with multiple authors like <a href=\"https://css-tricks.com/\">CSS Tricks</a> or occasionally updates on a variety of topics from an individual developer.  They tend to be the best source for in depth “how tos” on niche topics that might not justify a book or be fully covered by a wiki.</li>\n<li><strong>Podcasts</strong> - There are lots of developer podcasts out there.  Due to the audio nature of the medium, they tend to be more focused on high level ideas and less likely to drift into the nitty gritty of code.</li>\n<li><strong>Newsletters</strong> - Newsletters like this one can be a great way to get regular updates from knowledgeable developers or receive aggregations of interesting links. I’ve personally found them more and more valuable in recent years as a way of bringing the best content to the surface.</li>\n<li><strong>Github/Looking at code</strong> - Sometimes the best way to learn is to go straight to the source.  We live in a golden age of open source software, where billions of lines of code are available for anyone to look at online.  Code is ultimately the source of truth.</li>\n<li><strong>Forums, Mailing Lists &#x26; Chat Groups</strong> - Many technologies, geographic areas and interest groups have vibrant online communities that can be a great source of learning.  In the past these groups tended to exist as mailing groups, IRC channels or forum sites.  But nowadays the most popular form of community seems to be chat groups implemented with Slack or Discord.</li>\n<li><strong>Conferences</strong> - These aren’t something that most of us can do regularly, but conferences are a great place to be introduced to new ideas and make connections with people in a tech community.</li>\n<li><strong>Meetup Groups</strong> - A more accessible option than conferences for many people, most mid-sized and larger cities have multiple tech meetup groups that can be a good place to grow a tech community and be introduced to new concepts</li>\n<li><strong>Aggregators</strong> - Aggregator sites like <a href=\"https://www.reddit.com/\">Reddit</a> and <a href=\"https://news.ycombinator.com/\">Hacker News</a> are useful places to encounter new ideas.  Compared to the options above, they’re much noisier; you’ll encounter a mix of content quality and topics.  But it can be a great way to find serendipitous ideas and find new blogs, podcasts and communities to follow.</li>\n<li><strong>Social Media</strong> - Social Media sites (especially Twitter) can be a great way to get a sense of whats on a tech communities collective mind, and encounter concepts and ideas while they’re still being formed.  But it also can be a distracting mess of noise.  So consider moderating your intake.</li>\n</ul>\n<p>I’d generally recommend a mix of the resources above, though you’ll find some are more helpful to you than others I personally have found that books, blogs, newsletters, wikis and aggregators have been the most useful for me personally, as well as finding ways to teach others through meetup groups, conferences and my own blog.  There is real truth in the idea that the best way to learn something well is to teach it.</p>\n<h3>Specific Resources</h3>\n<p>So the above stuff is all pretty generic.  I’ll end by listing some resources that I’ve found personally helpful in learning and keeping up with the JavaScript and React world.  This isn’t exhaustive, and I know there are a lot of great resources out there that I haven’t personally used.  But this is my list:</p>\n<h4>Books</h4>\n<ul>\n<li>\n<p><a href=\"https://leanpub.com/javascriptallongesix\">JavaScript Allongé</a> is a great ebook about functional JavaScript.  It was very influential for me in terms of how I structure my code.</p>\n</li>\n<li>\n<p><a href=\"https://amzn.to/2TTXlZt\">Effective JavaScript</a> is a bit dated now; it was written pre-ES6.  But it’s the best non-beginner book I’ve read about the JavaScript language.</p>\n</li>\n<li>\n<p><a href=\"https://amzn.to/2GNviXY\">Clean Architecture</a> is my favorite book on Software Architecture.  If you want to think about how we structure programs at a higher level, it is worth a read</p>\n</li>\n<li>\n<p><a href=\"https://amzn.to/2GPi6ll\">A Philosophy of Software Design</a> is a book I’ve mentioned a few times recently here; Its my new recommendation for a first “writing better code” book because its so concise.  <a href=\"https://amzn.to/2TRAPAl\">The Pragmatic Programmer</a> played that role for me personally though, and I’d still recommend it as well for any developer who hasn’t read it.</p>\n</li>\n<li>\n<p><a href=\"http://atomicdesign.bradfrost.com/\">Atomic Design</a> is a great book on building modern design systems, and has been useful for me as I think about how to break down UIs in my development work.</p>\n</li>\n</ul>\n<h4>Video Courses</h4>\n<ul>\n<li><a href=\"https://egghead.io/\">Egghead.io</a> is the best source for dev video content I’ve found.  Video has never really been my jam, I prefer text content where I can go through it at my pace and easily reference back and forth between it and code.  But it can be great to get a focused intro to a topic, and Egghead seems to have nailed the format with its collection of short focused snippets. It’s mostly a paid service, but there is a bunch of great free content on there, especially beginner React stuff.</li>\n</ul>\n<h4>Wikis</h4>\n<p>These are maybe stupid obvious, but I’ve learned more from these 3 sites than probably anything else listed here:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/\">Stack Overflow</a> is the single best source for software development information on the internet.  Note that I would advise most people to use it as more of a googleable resource than a place to ask questions; they’re focused on documenting canonical answers to common problems moreso than chasing down situational issues, and for popular technologies they are fairly comprehensive.</li>\n<li><a href=\"https://developer.mozilla.org/en-US/\">MDN</a> is my site of choice for learning about browser APIs and JavaScript/CSS/HTML language features.  It’s extremely reliable, and generally very readable (although some articles are much more detailed than others).</li>\n<li><a href=\"https://www.wikipedia.org/\">Wikipedia</a> is a surprisingly great place to learn about general computer science concepts.  I wouldn’t use it for front end specific stuff, there are better resources there, but if I want to learn about a classical computer science concept like a <a href=\"https://en.wikipedia.org/wiki/Priority_queue\">priority queue</a> or <a href=\"https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm\">Dijkstra’s algorithm</a> wikipedia usually has a pretty robust article giving the basic background.</li>\n</ul>\n<h4>Blogs</h4>\n<p>For blogs, I highly recommend getting a good RSS reader so you can keep up with posts as they come.  My tool of choice here is <a href=\"https://feedbin.com/\">Feedbin</a> for which I pay a very small monthly fee, but there are good free alternatives like <a href=\"/https://feedly.com/\">Feedly</a> as well.</p>\n<ul>\n<li><a href=\"http://2ality.com/\">2ality</a> is a blog focused on new JavaScript features as they work their way through the TC39 development process.  It’s the best resource I know of for understanding what is coming down the language pipeline, and also learning about new features when they are released.</li>\n<li><a href=\"https://overreacted.io/\">Overreacted</a> is Dan Abramov’s “Advanced React” blog.  It’s the best single source of knowledge on React that I’ve seen.</li>\n<li><a href=\"https://css-tricks.com/\">CSS Tricks</a> is more of a mega-blog, with multiple articles published a day by a variety of authors.  It’s consistently high quality content, and even though it leans more towards “web site development” than “web app development” there is stuff here that anyone will find interesting.  It’s also been around a long time and has great historical resources for learning newish CSS standards like CSS Grid and Flexbox.</li>\n<li><a href=\"https://reactjs.org/blog/\">The official React Blog</a> is excellent and a great place to get “official news” about React.  The same applies for other frameworks like Ember, Vue, and Angular; you always want to be following the official source and not just getting your news from the community.  It greatly reduces the chances of misunderstanding and <a href=\"https://en.wikipedia.org/wiki/Cargo_cult_programming\">cargo culting</a>.</li>\n<li><a href=\"https://benmccormick.org\">benmccormick.org</a>.  Ok I’m sort of kidding here, but the truth is that having my own blog has been one of the best ways for me to learn; I learn when I write, I can reference back to older posts when I’m re-engaging with a topic, and things stick better when you write them down.  Plus when I write posts like this where I’m linking other resources, its easier for me to find those resources later. (but uh… feel free to tell everyone to <a href=\"https://benmccormick.org/subscribe\">subscribe</a> to my blog anyway)</li>\n</ul>\n<h4>Newsletter</h4>\n<ul>\n<li><a href=\"https://javascriptweekly.com/\">JavaScript Weekly</a> is a great “list of links” style newsletter every week.  If you just want a pulse of the weekly news in the JS community, I think this is the best place to find it.</li>\n<li><a href=\"https://kentcdodds.com/subscribe/\">Kent C Dodds’ Newsletter</a> is a great resource for React and JavaScript testing.</li>\n<li><a href=\"https://hackernewsletter.com/\">Hacker Newsletter</a> is a roundup of the top <a href=\"https://news.ycombinator.com/\">Hacker News</a> posts each week.  Hacker News can be a bit of a mess (the comments are often written from deep within the startup bubble and the quality of links at any given time on the site is mixed) but it’s an amazing source of interesting content if you’re willing to wade through it.  This newsletter lets somebody else do that for you.</li>\n<li><a href=\"https://this-week-in-react.org/\">This week in React</a> is another source of advanced React content.  It’s actually just a summary of the interesting things going on in the React repo itself.  So if you’re interested in contributing to React or want to see how they’re progressing against their roadmap, it’s an interesting and quick read each week.</li>\n</ul>\n<h4>Aggregators &#x26; Social Media</h4>\n<p>Honestly, 2 years ago I probably would have led with this section; Twitter and Hacker News were a huge part of how I have found interesting content and built my skills over the past 5 years.  But I’ve gotten disenchanted with them over time as they became part of a broader issue of my increasing inability to focus on things because of the abundance of technology related distractions in my life.  So… caveat emptor.  That said here are some people I’d recommend following on Twitter if you’re interested in React and JavaScript.</p>\n<ul>\n<li><strong>React</strong> - <a href=\"https://twitter.com/dan_abramov\">Dan Abramov</a>, <a href=\"https://twitter.com/kentcdodds\">Kent C Dodds</a>, <a href=\"https://twitter.com/ryanflorence\">Ryan Florence</a>, <a href=\"https://twitter.com/acemarke\">Mark Erikson</a>, <a href=\"https://twitter.com/swyx\">Shawn Wang</a>, <a href=\"https://twitter.com/rauchg\">Guillermo Rauch</a></li>\n<li><strong>JavaScript</strong> - <a href=\"https://twitter.com/ladyleet\">Tracy Lee</a>, <a href=\"https://twitter.com/_developit\">Jason Miller</a>, <a href=\"https://twitter.com/slicknet\">Nicholas Zakas</a>, <a href=\"https://twitter.com/sarah_edo\">Sarah Drasner</a></li>\n</ul>\n<h3>A final note</h3>\n<p>I just want to end where I started, and encourage you to not rush out and try to absorb all of these things at once, but instead work on projects and find the resources that give you what you need.  And then explore a bit on the side to help yourself grow.  Your resources will probably be different than mine.  The internet is huge, the world is even bigger. Explore and have fun!</p>","fields":{"slug":"/2019/02/18/how-to-keep-learning-js"}}},{"node":{"frontmatter":{"readNext":"philosophy-of-software-design-book,fe-concerns,feedback-loops","topics":["architecture","javascript"],"category":"fe-architecture","key":"strategies-tactics-moves","title":"Strategic Coding","description":"Thinking about architectural concerns is a full time occupation","layout":"post","path":"/2019/02/18/strategic-coding","date":"2019/02/18","dontfeature":null,"isDraft":null},"html":"<p>I recently read <a href=\"https://amzn.to/2Elk5g8\">A Philosophy Of Software Design</a> by John Ousterhout.  In an early chapter he paints a picture of a “tactical tornado” programmer, a programmer who is always focused on solving the current problem by the most expedient method possible, with no thought to the long term implications.  I suspect anyone with even a few years in the programming has seen programmers like this, and has also from time to time written “tactical” code like this themselves.  Ousterhout’s recommendation is instead to write code strategically rather than tactically, taking more up front time to plan the structure for the benefit of longer term productivity.</p>\n<p>Ousterhout focuses his examination of tactical vs strategic coding on the issue of complexity.  Complexity as he defines it is anything that makes the system difficult to work with.  It is the root issue behind much of the <em>ease of change</em> concern I identified in my <a href=\"https://benmccormick.org/2019/01/07/the-concerns-of-fe-architecture/\">recent post</a>.  But we can expand this to encompass all of the front end concerns.  We can easily impact reliability, performance, ease of change, accessibility, security and capability when we make short hand tradeoffs.</p>\n<p>Let’s consider the problem of getting a new sign up page set up for a site.  There are several different approaches we could take.  By far the simplest is a basic HTML page using normal CSS and little or no JavaScript, that posts to a backend service after the signup and then redirects to a different static page.  We could set this up on S3 or any other service that will host static files.  On the other extreme, we could set up a new server side rendered Typescript-based React application that uses Next.js to give us server side rendering, which we deploy using Docker and a fully automated CI build system with chatbot ops.  Which one of these approaches is better?</p>\n<p>A tactical tornado would likely prefer the first solution.  They could get the whole thing up and running in an hour, stamp it and call it done.  Other developers might be attracted to the <em>cool</em> approach and want to avoid the “outdated” approach.  But we can only really answer the question by stepping back and asking some questions:</p>\n<ul>\n<li>What is the future of this application?  Is this a standalone page, or the first page in a larger application?</li>\n<li>What feature requests are we likely to get for the page?  Is it probable that we’ll eventually need form validation, dynamic success and failure states, complex behavior that depends on the use case?</li>\n<li>What browsers are we supporting</li>\n<li>What are our performance benchmarks?</li>\n</ul>\n<p>Questions like that can tell us when we’ll benefit from an up front investment in certain areas, and when it’s wiser to be quick and dirty.  They also allow us to evaluate whether any options we’re considering might cut us off from achieving long term goals.  For instance, if we know that we’ll eventually need to scale this site into a large application with responsive interactions, personalized content and information maintained between page loads, building this out as a series of static pages which POST to a backend would eventually limit our capabilities or require a refactor.  But if this is only a one-off landing page for an event happening next week that won’t be maintained beyond that point, developing a long-term maintenance strategy would be wasted effort.  This is <em>strategic coding</em>, and it doesn’t stop at the beginning of a project, it’s an ongoing mindset that you can take as you add each new feature to an application.</p>\n<p>Ousterhout makes a case that aligns with my experience, that strategic programming is a long term winner.  I’ve seen that over time improvements to ease of change will often help a team save time lost, significant hits to performance, security, reliability may hurt them more than a fast solution saves them, and solutions that unreasonably limit us in terms of system capability or accessibility will ultimately get rejected.  The weasel words there exist for a reason… sometimes it really is the best idea to just get something working.  But a strategic programmer will understand the context of their project, and make wise choices about where and how to invest in the codebase.</p>\n<p><strong>TL;DR</strong></p>\n<ul>\n<li><strong>It is possible to program either tactically or strategically</strong></li>\n<li><strong>Tactical programming is focused on solving the immediate problem as quickly as possible</strong></li>\n<li><strong>Strategic coding considers the context of the problem, and any architectural concerns involved in a change</strong></li>\n<li><strong>Strategic coding doesn’t mean never hacking and always investing, it means letting context inform the amount and direction of investment in a codebase</strong></li>\n</ul>\n<p>PS: I put a <a href=\"https://benmccormick.org/2018/12/31/book-review-philosophy-of-software-design/\">full review of A Philosophy of Software Design</a> up on the site a few weeks ago.  Check it out :)</p>","fields":{"slug":"/2019/02/18/strategic-coding"}}},{"node":{"frontmatter":{"readNext":"callbacks-to-promises,fe-concerns,valuable-code-reviews","topics":["javascript"],"category":"javascript","key":"readable-async","title":"Improving Code Readability With Async/Await","description":"How async await can improve code maintainability","layout":"post","path":"/2019/01/28/readable-async","date":"2019/01/28","dontfeature":null,"isDraft":null},"html":"<p>When it first became a part of JavaScript, I wasn’t sure how much I was going to use async-await.  I could see that it made things prettier in some cases, but I was pretty happy with my promise chains and thought that async-await might just be some extra language baggage.  Since then I’ve fully converted; it’s one of my favorite features added to the language in recent years.  The reason?  It helps you write code in a linear manner.</p>\n<p>A principle of readable code:</p>\n<blockquote>\n<p>Code should where possible be written in the order in which a reader needs to understand it.1</p>\n</blockquote>\n<p>For complex classes, this ideally means that the “entry points” are towards the top, with the helper methods below to be read as needed<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>. But for “linear” code that reflects a workflow, we want the code to progress in chronological order as much as possible.  With imperative code that tends to happen by default.  But JavaScript’s asynchronous constructs have tended to obscure chronological orders.</p>\n<p>As an example, here is a React component that displays the time remaining in a user session based off of some cookie values.  It checks a cookie on a regular interval to see whether it should display a warning about the session timeout.  Once it is showing the warning, it begins checking the cookie more frequently in order to show a timeout.  Once the session expires, it can stop checking.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token comment\">// When time is less than this, we should show warning</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// intervals in seconds to update timeout count</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span> <span class=\"token operator\">=</span> <span class=\"token number\">30</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ShowSessionTime</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">timeRemaining</span><span class=\"token operator\">:</span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n   <span class=\"token comment\">/* Update the remaining time till session timeout */</span>\n    <span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> currentTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> timeRemaining <span class=\"token operator\">=</span> <span class=\"token function\">getCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serverExpiry'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> currentTime<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            timeRemaining<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> timeRemaining<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// while the modal is open, update every cycle but stop when the time remaining is 0</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">whileOpenCheck</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> timeRemaining <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timeRemaining <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileOpenCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// while the modal is closed, update every cycle but switch to the open cycle when we reach the threshold</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">whileClosedCheck</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> timeRemaining <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timeRemaining <span class=\"token operator\">></span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileClosedCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileOpenCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// kick off our timeout loop</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileClosedCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>timeRemaining<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> showWarning <span class=\"token operator\">=</span> timeRemaining <span class=\"token operator\">></span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> showWarning <span class=\"token operator\">?</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Time Remaining In Session<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>timeRemaining<span class=\"token punctuation\">}</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">componentDidMount</code> method is the interesting part here.  Notice how the setTimeout based flow has resulted in the flow being reversed?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// THIS PART HAPPENS LAST IF AT ALL</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">whileOpenCheck</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> timeRemaining <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timeRemaining <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileOpenCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// THIS IS THE FIRST RECURSIVE LOOP</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">whileClosedCheck</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> timeRemaining <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timeRemaining <span class=\"token operator\">></span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileClosedCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileOpenCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// THIS IS THE ENTRY POINT</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>whileClosedCheck<span class=\"token punctuation\">,</span> <span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The code is super hard to follow because its defined all out of order.  You have to understand the whole thing before you can wrap your mind around any piece of it, and your eye is going to be wandering back and forth.  Compare that to this reimplementation with async/await:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">async</span> <span class=\"token function\">checkRemainingAtIntervals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkRemainingAtIntervals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’ve pulled the logic out into a separate async function and suddenly everything is so much simpler: we’re just using basic loops, with each loop condition updating the remaining time and then checking to see if we should keep looping.  Sleep in this case is just a <a href=\"https://benmccormick.org/2015/12/30/es6-patterns-converting-callbacks-to-promises\">promisified</a> setTimeout:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">millisecs</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> millisecs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In fact this version is so much simpler that when I originally wrote the code that this post is based on, I immediately saw a bug that I had missed in the complex version: the time remaining in a session can go up as well as down.  If a user makes a request after I show the warning, the interval will go up and we should re-hide the warning.  But my first few takes both ignored that complexity.  Fortunately it’s easy enough to add:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">async</span> <span class=\"token function\">checkRemainingAtIntervals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> remaining <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// keep checking until the session expires</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>remaining <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> warningIsShowing <span class=\"token operator\">=</span> remaining <span class=\"token operator\">></span> <span class=\"token constant\">MAX_TIME_TO_HIDE_WARNING</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> interval <span class=\"token operator\">=</span>  warningIsShowing <span class=\"token operator\">?</span>\n                <span class=\"token constant\">CHECK_INTERVAL_WHEN_HIDING</span> <span class=\"token operator\">:</span>\n                <span class=\"token constant\">CHECK_INTERVAL_WHEN_SHOWING</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            remaining <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’ve actually gotten even simpler here, with a single loop that runs until the session\nexpires.  Each time the loop runs, it checks to see whether it should wait for a long or short interval before updating the remaining time again.  Everything happens in ~8 highly readable lines that will be easy to follow for anyone who has used a while loop.</p>\n<p>Compared to our original version we have</p>\n<ol>\n<li>Cut out several “intermediary variables” that were mostly managing complexity around async, but weren’t part of the core problem</li>\n<li>Matched the visual flow to the workflow</li>\n<li>Simplified enough to catch a bug that I missed originally</li>\n</ol>\n<p>I’m going to continue to use async-await as the basis for most of my asynchronous code going forward for benefits like this.  If you’ve been holding out, browser support has gotten very good and this is a great time to jump in.</p>\n<p><strong>TL;DR</strong></p>\n<ul>\n<li><strong>Async Await can help readability by matching code structure to the program workflow</strong></li>\n<li><strong>Code that is structured more naturally can be easier to debug and see errors in</strong></li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">React’s convention of putting render at the bottom of class components has always annoyed me as a result of this.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2019/01/28/readable-async"}}},{"node":{"frontmatter":{"readNext":"ten-things-js,following-js-roadmap,proposals-in-production","topics":["javascript"],"category":"javascript","key":"new-hello-world","title":"The New Hello World","description":"JavaScript's learning curve is getting better again","layout":"post","path":"/2018/04/25/the-new-hello-world/","date":"2018/04/25","dontfeature":null,"isDraft":null},"html":"<p>JavaScript has had a weird reputation inversion over the past decade.  For years it was the stripped down toy language that could.  It didn’t have the features people wanted, and it did have the features they didn’t want, but it ran everywhere and it was easy to just start building things.  The last decade has shown that you can actually build some serious applications in JavaScript.  But it has also eaten away at the ability to start simple and try new things.  State of the art for JavaScript apps now involves compile steps, a long tooling chain, and a million choices for developers to make.  So the folks who are helping new developers get started have a few options for teaching JavaScript:</p>\n<ol>\n<li><strong>Embrace The Complexity</strong> - Want to learn to write Web Apps?  Let’s just toss you into a boilerplate that’s using node, webpack, react, redux, redux-saga, react router, glamorous, eslint, prettier, npm scripts, lodash, and babel.  This is what production apps look like, so you might as well start learning in a realistic environment.</li>\n<li><strong>Hide The Complexity</strong> - This is where we maybe use something like <a href=\"https://codepen.io/\">Codepen</a> to provide a sandboxed area where we may be using Babel/React/etc, but the user doesn’t have to configure or think about them too much.  My understanding is that <a href=\"https://glitch.com/\">Glitch</a> tries to go down this route to some extent as well.</li>\n<li><strong>Discard The Complexity</strong> - Teach coding like it’s 2010 all over again!  This approach is to focus more on the JavaScript language as it’s implemented in the browser, using script tags without a build step, and maybe even an older/simpler library like jQuery to explain DOM concepts and CSS.  This approach can eventually evolve towards introducing more complexity.</li>\n</ol>\n<p>For the past few years I’ve seen a blend of all of these approaches when I’ve looked at other folks’ beginner level resources.  It’s been hard to determine the best way to prepare new developers for the complexities of the development process. But good news, I think that era is finally coming to an end.</p>\n<h3>The Ideal Intro</h3>\n<p>In an ideal world, we’d be able to introduce new developers to the concepts that undergird modern web apps, and teach them syntax that is as up to date as possible without having to entangle them in the implementation details and distractions of production grade tools like Babel and Webpack.  So we want them to start out writing JavaScript code that is:</p>\n<ol>\n<li>Modular</li>\n<li>Cross-environment</li>\n<li>Modern (ES6+ syntax as appropriate)</li>\n<li>Simple to start with</li>\n</ol>\n<p>The last 10 years of tool build up have been primarily focused on making it easy to achieve the first 3 goals in production (along with prioritizing other needs of large scale applications).  But production tooling is by nature less concerned with #4.  Fortunately native environments are starting to catch up on the first 3, and that means we can do better.</p>\n<h3>The New Hello World</h3>\n<p>Let’s say we want to frame an intro through the classic “hello world” program.  Our goals are to create a JavaScript function that can print “Hello World”, and then expand on that a bit.  And we want to teach this in a way that will still look familiar when our learners get themselves into a production JavaScript code base.</p>\n<h4>Bare Bones</h4>\n<p>We might start with something super simple like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- index.html --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>name-display<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">let</span> displayArea <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name-display'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      displayArea<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World'</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>That’s about as simple as a JavaScript hello world gets.  You can access it by opening the file directly from the file system in your browser, and it’s easy enough to edit the text and see changes on refresh.</p>\n<p>But in 2018, we can do something cool next.  We want to be modular and separate concerns, so lets create a hello world module.  This is an opportunity to introduce functions and modules.  It introduces our only small tooling step: adding a simple web server.</p>\n<h4>Hello Modules</h4>\n<p>On OSX, it’s easy enough to set up a simple web server with <code class=\"language-text\">python -m SimpleHTTPServer 8080</code>.  We can do that with our existing index.html and verify that we can now see it at <code class=\"language-text\">localhost:8080</code> in our browsers<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.</p>\n<p>After that, we can start doing cool stuff, starting with creating a new module:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//hello.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> sayHello <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'World'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is our first function.  Depending on your audience, you may want to strip this down a bit and remove the default parameter, or spend some time explaining the different concepts in play here. But the focus can be on the concept of functions, as well as the ability to export them from a module.</p>\n<p>Now we can update our index.js file to use the new function.  Assuming both files are in the same directory, that will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- index.html --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>name-display<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>sayHello<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./hello.js'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">let</span> displayArea <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name-display'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      displayArea<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Now we have a hello world built on a foundation that can scale towards modern JavaScript environments.  We have modules and modern syntax, and the only difficult setup step has been a lightweight web server so far.  The rest is just script tags.</p>\n<h3>Interactive</h3>\n<p>It’s easy enough now to take our module and turn it into something interactive:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- index.html --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>container<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span> Enter a Name and Hit The Button<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>name<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>change-name<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>Say Hello<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>name-display<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>module<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>sayHello<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./hello.mjs'</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">let</span> displayArea <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name-display'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">let</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">let</span> button <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change-name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      button<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        displayArea<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This example introduces DOM events and let’s the user decide who to say hello to.  It also is a good jumping off point for further experimentation for a new dev.</p>\n<h3>Crossing Environments</h3>\n<p>Going from the browser to node, even though it is simpler in some ways, is always going to be a bigger jump for newcomers because of most people’s unfamiliarity with the command line, and the base hurdle of installing node itself.  But once we’re ready to move past browsers, our new hello world can be easily translated to node land.  The biggest hurdle is in the file names.  We will have to rename or copy <code class=\"language-text\">hello.js</code> to be named <code class=\"language-text\">hello.mjs</code> (Node’s way of differentiating between files using ES6 syntax).  After that, we can write a simple script to start out:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//node.mjs</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>sayHello<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./hello.mjs'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And then, as long as we’re on an up to date version of Node, we can run it with <code class=\"language-text\">node --experimental-modules node.mjs</code>.  And we will see our Hello World.</p>\n<p>There are some annoyances for beginners here.  Node only recently added module support, and beginners must</p>\n<ol>\n<li>Rename their modules to the currently non-standard mjs ending</li>\n<li>Have a recent version of Node (v8.5+)</li>\n<li>add the experimental-modules flag and learn to ignore the warning it gives</li>\n</ol>\n<p>But overall it isn’t meaningfully harder than learning to use node has been in the past.</p>\n<h3>Interactive Again</h3>\n<p>We can make our node.js version accept a command line arg easily enough, along with more opportunities to learn about functions, arrays and conditionals.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//node.mjs</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>sayHello<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./hello.mjs'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getLast</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">list</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">[</span>list<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token function\">getLast</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>The Future</h3>\n<p>I’m excited to see the new dev experience moving back closer to alignment with the production web app experience.  I think that can only be a positive things.  Some steps that will help even more if/when they happen:</p>\n<ol>\n<li><strong>Module file format standardization</strong> - The .mjs extension seems to still be controversial, but it also seems a bit inevitable.  So the question will be whether it becomes more standard to use across all modular JS on the browser and node.  The current split and experimental support makes for a confusing distraction for new learners</li>\n<li><strong>De-flagging</strong> - Right now Firefox and Node still require flags for using modules.  That reduces beginner friendliness.</li>\n<li><strong>Where is the jQuery of 2018</strong> - This is more speculative, but I think the next step to a beginner friendly hello world is a “beginner friendly framework” that is based on the “one way data flow/declarative translation of state to UI” paradigm that has swept across pretty much all modern JS frameworks.  That’s an important concept to understand, and there isn’t anything I’m aware of out there right now that let’s you build with those concepts but is as approachable to newcomers as jQuery is.  jQuery was a gateway to DOM manipulation, AJAX, and functional array manipulation for a generation of developers.  React and create-react-app is probably the closest to that concept today, but it isn’t nearly as simple.</li>\n</ol>\n<p>That’s all for now.  Code samples for this are <a href=\"https://github.com/benmccormick/hello-new\">on github</a>.  Goodbye World.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">This should work in the latest Chrome, Safari and Edge out of the box.  I encountered a bit of slowness and flakiness on Chrome, but it worked like a charm in Safari.  Firefox still has this stuff behind a flag.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/04/25/the-new-hello-world/"}}},{"node":{"frontmatter":{"readNext":"readable-async,how-to-learn,react-confessions","topics":["javascript","react"],"category":"software-productivity","key":"utility-functions","title":"Utility Functions","description":"A few helpful functions that I bring along to all of my projects","layout":"post","path":"/2019/03/11/utility-functions","date":"2019/03/11","dontfeature":null,"isDraft":null},"html":"<p>As I’ve gone through projects over time, I’ve found a few functions that I end up creating for every significant project that I’ve worked on.  Some of the details differ from project to project, but the basic function remains the same.  I thought it would be helpful to do a rundown:</p>\n<h3>React/JSX</h3>\n<p>Some of my utils are focused on making JSX nicer to deal with.  2 situations that I’ve run into a lot in JSX are conditionally showing an item in JSX, and determining which of several classes to add to an element based on logic.  Scenarios like these:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>shouldShowCreateButton <span class=\"token operator\">?</span> <span class=\"token operator\">&lt;</span>Button\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>createWidget<span class=\"token punctuation\">}</span>\n            type <span class=\"token operator\">=</span> <span class=\"token string\">'primary'</span>\n            size <span class=\"token operator\">=</span> <span class=\"token string\">'Large'</span>\n            disabled <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>createEnabled<span class=\"token punctuation\">}</span>\n            className<span class=\"token operator\">=</span><span class=\"token string\">'create-button'</span>\n        <span class=\"token operator\">></span>\n            Create Widget\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> classNames <span class=\"token operator\">=</span> <span class=\"token string\">'create-button'</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>extraClass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    classNames <span class=\"token operator\">+=</span> <span class=\"token string\">' '</span> <span class=\"token operator\">+</span> extraClass<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>createEnabled<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    classNames <span class=\"token operator\">+=</span> <span class=\"token string\">' is-disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasCreateError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    classNames <span class=\"token operator\">+=</span> <span class=\"token string\">' has-error'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Button\n        onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>createWidget<span class=\"token punctuation\">}</span>\n        type <span class=\"token operator\">=</span> <span class=\"token string\">'primary'</span>\n        size <span class=\"token operator\">=</span> <span class=\"token string\">'Large'</span>\n        disabled <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>createEnabled<span class=\"token punctuation\">}</span>\n        className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classNames<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n        Create Widget\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span></code></pre></div>\n<p>These are both ok, and you’ll see plenty of examples of code like them out there, but the first puts a big chunk of code in a ternary, and it’s not always going to be clear to a reader where that <code class=\"language-text\">: null</code> came from at the end, or why it’s there by the time they reach the end.</p>\n<p>In the second example, we’re dealing with a lot of ugly string concatenation.  There are other ways to handle this, like using template strings + ternaries but generally they each provide their own messy pieces.</p>\n<p>To solve these situations, I like to define these 2 small functions:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> isString <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash-es/isString'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> filter <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash-es/filter'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// A helper for React Components to reduce ternary use</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">showIf</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">condition<span class=\"token punctuation\">,</span> element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>condition <span class=\"token operator\">?</span> element <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// A helper for handling class lists where some values may be undefined</span>\n<span class=\"token comment\">// filters out anything that isn't a string and then adds spaces</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">classes</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">classList</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>classList<span class=\"token punctuation\">,</span> <span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> c<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The first just formalizes the most common use of ternaries in JSX (conditionally showing an item) and adds an easy to understand name to it.</p>\n<p>The second lets us work with an array of classNames instead of handling string concat ourselves, and will automatically filter out undefined or empty classNames.  This implementation does silently swallow errors on anything that is not a string, which may not be your preference.  Usage looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span><span class=\"token function\">showIf</span><span class=\"token punctuation\">(</span>shouldShowCreateButton<span class=\"token punctuation\">,</span> <span class=\"token operator\">&lt;</span>Button\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>createWidget<span class=\"token punctuation\">}</span>\n            type <span class=\"token operator\">=</span> <span class=\"token string\">'primary'</span>\n            size <span class=\"token operator\">=</span> <span class=\"token string\">'Large'</span>\n            disabled <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>createEnabled<span class=\"token punctuation\">}</span>\n            className<span class=\"token operator\">=</span><span class=\"token string\">'create-button'</span>\n        <span class=\"token operator\">></span>\n            Create Widget\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></code></pre></div>\n<p>the showIf reads much more clearly than the previous ternary, especially for language newbies who might not be used to ternaries.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> classNames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'create-button'</span><span class=\"token punctuation\">,</span> extraClass<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>createEnabled<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    classNames<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasCreateError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    classNames<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'has-error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Button\n        onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>createWidget<span class=\"token punctuation\">}</span>\n        type <span class=\"token operator\">=</span> <span class=\"token string\">'primary'</span>\n        size <span class=\"token operator\">=</span> <span class=\"token string\">'Large'</span>\n        disabled <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>createEnabled<span class=\"token punctuation\">}</span>\n        className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">classes</span><span class=\"token punctuation\">(</span>classNames<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n        Create Widget\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span></code></pre></div>\n<p>Here we’ve gotten rid of the extra string code and are working on arrays, which is a nicer data structure for dealing with lists of stuff. Also since we’re auto-filtering falsy stuff, we don’t have to worry about whether extraClass was defined if it was passed as a prop to our component or something.</p>\n<h3>Formatting</h3>\n<p>So the next few may be different for everyone.  The details here aren’t important, the important thing is that you centralize your formatting of numbers and dates.  For instance, here are functions for formatting dates, normal numbers and percentages from a current project:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> format <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> isNumber <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash-es/isNumber'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// takes either a string or a date object and formats it as a standard date with time</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">stdFormat</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">dateStr</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>dateStr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> dateStr<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">let</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>dateStr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">format</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> <span class=\"token string\">'MM/DD/YY hh:mm A'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">commafy</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">num<span class=\"token punctuation\">,</span> minDecimals <span class=\"token operator\">=</span> <span class=\"token number\">0</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNumber</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'en-US'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">minimumFractionDigits</span><span class=\"token operator\">:</span> minDecimals<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> num<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">percentify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">num<span class=\"token punctuation\">,</span> minDecimals <span class=\"token operator\">=</span> <span class=\"token number\">0</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNumber</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'en-US'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token string\">'percent'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">minimumFractionDigits</span><span class=\"token operator\">:</span> minDecimals<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> num<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The first one will take a date object and format it to something like <code class=\"language-text\">05/30/17 01:16 PM</code>.  The second will take a number and return a string formatted with appropriate commas: <code class=\"language-text\">1234567 -> '1,234,567'</code>.  The last one will convert a decimal to a percentage string: <code class=\"language-text\">0.5 -> '50%'</code>.</p>\n<p>Note that none of these functions are very long.  I’m relying on a date library for the first piece and <code class=\"language-text\">toLocaleString</code> for the other 2.  So I could inline this in most places and not have it get much longer.  The benefit of these types of functions is not in saving typing.  It’s in standardizing how you format or don’t format things throughout an application.  This has 2 benefits:</p>\n<ol>\n<li>It’s easy to fix bugs, add features or switch between libraries for these common tasks across your application because all of the logic is centralized.  If I needed to start supporting more locales than just the US for percentage formatting, or use moment for my date formatting library I could easily do so with edits to only one file.  That file is also well unit tested, so those transitions would be safe.</li>\n<li>It lets us control which formats are allowed.  For instance we’re allowing the function caller to specify how many decimal points to show for the numeric functions, but not giving options to change the date format for the formatting function, because we want that to be the same everywhere.  If we need to support multiple formats for different scenarios, like a date-only format or a format for communicating with the API, we can add options for that which don’t open up all formats, or expose them as separate functions.  With dates in particular, I want imports of libraries like moment or date-fns to be limited to 2 or 3 files at the most, and not used ad-hoc throughout the codebase.</li>\n</ol>\n<p>Note that all my examples so far have utilized other utility libraries like lodash and date-fns.  The best utility functions are those that you don’t have to maintain yourself.  I do recommend looking for libraries that you can tree-shake and only take what you need though.  Other ones like moment.js can make a big difference on your JavaScript bundle size if you let them.</p>\n<h3>Timing</h3>\n<p>Timeout functions are useful, but the browsers built in functions are callback based and don’t play well with promises or async await.  We can fix that:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">secs</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> secs <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pause</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I now have a promisified version of setTimeout (<code class=\"language-text\">sleep</code>) and a special case version with a 0 timeout (useful for things that should happen as soon as possible after the current event loop executes. I prefer dealing with things in seconds over milliseconds, so I changed the API to use that.  That is probably not everyone’s cup of tea, so feel free to copy and modify.</p>\n<p>Usage looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// function to kick off a \"job\" of some type and then</span>\n<span class=\"token comment\">// check every 30 seconds to see if the job is complete</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createJobAndShowResults</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// don't do this without a timeout/failure</span>\n    <span class=\"token comment\">// condition in real life!</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> jobStatus <span class=\"token operator\">=</span> <span class=\"token function\">checkIfJobIsCompleted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>jobStatus<span class=\"token punctuation\">.</span>complete<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> jobStatus<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>And Even More!</h3>\n<p>This is just a sample of the small functions I usually create in projects.  Pretty much all of them exist for one or more of the reasons that were already discussed:</p>\n<ol>\n<li>Smoothing over awkward library syntax like multiple classes in JSX or HTML templates</li>\n<li>Making user intention clear with a well named function, like showIf or stdDateFormat</li>\n<li>Ensuring consistent application-specific behavior across common low-level operations like formatting or logging</li>\n<li>Making it easy to replace 3rd party utility libraries  like date-fns by wrapping them in an application specific function</li>\n<li>Improving browser level APIs, or shaping them to have useful defaults for the current application, like we did with toLocaleString and setTimeout.</li>\n</ol>","fields":{"slug":"/2019/03/11/utility-functions"}}},{"node":{"frontmatter":{"readNext":null,"topics":["javascript","atom"],"category":"opinion","key":"weekly-links-12-15-17","title":"Weekly Links: December 15th 2017","description":"The state of JavaScript, Glimmer, and updates to some cool software","layout":"weekly-links","path":"/2017/12/15/weekly-links-12-15-17/","date":"2017/12/15","dontfeature":null,"isDraft":null},"html":"<h3>JavaScript And The Web</h3>\n<p><a href=\"https://stateofjs.com/\">The State Of JavaScript 2017</a> - This annual survey of JavaScript developers always has lots of interesting insights.  Since it is an internet survey, I view it less as a full snapshot of the industry, but more as a place to see what is new and trending in the JS world.  This year <a href=\"https://code.visualstudio.com/\">Visual Studio Code</a>, <a href=\"https://prettier.io/\">Prettier</a> and <a href=\"https://vuejs.org/\">Vue</a> caught my eye as spiking in popularity.</p>\n<p><a href=\"https://engineering.linkedin.com/blog/2017/12/the-glimmer-binary-experience\">The Glimmer Binary Experience | LinkedIn Engineering</a> - I had the privilege of seeing Yehuda Katz, one of the Ember core developers, give a talk about <a href=\"https://glimmerjs.com/\">Glimmer</a> and bytecode at this year’s All Things Open conference.  They’re doing some pretty serious software engineering in the Ember community right now.  This write-up covers a lot of the same ground and is worth a read.</p>\n<h3>Programming Tools and Practices</h3>\n<p><a href=\"http://blog.atom.io/2017/12/12/atom-1-23.html\">Atom 1.23</a> and <a href=\"https://code.visualstudio.com/updates/v1_19\">Visual Studio Code 1.19</a> were released this week, making this a big week for Electron based text editors.  If you use either of them, you’ll get to enjoy a nice set of performance improvements when you upgrade.</p>\n<p><a href=\"https://blog.bear-writer.com/bear-1-4-the-tags-edition-298d6fdc55dd\">Bear 1.4</a> - Speaking of software that I love to use getting updates, I’ve been using Bear as my primary notes app for the last year, and it is a delight.  Getting autocomplete on tags this week solved it’s last real annoyance for me, and I would definitely recommend it to anyone interested in a simple notes app.  It’s more powerful than Apple’s notes or text files, but cleaner and more elegant than <a href=\"https://evernote.com/\">Evernote</a>.  And even the paid level is very affordable.</p>","fields":{"slug":"/2017/12/15/weekly-links-12-15-17/"}}},{"node":{"frontmatter":{"readNext":"mn-series,backbone-devs-react,bb-es6-1","topics":["backbone","javascript"],"category":"frameworks","key":"bb-radio","title":"Building Modular Web Apps With Backbone.Radio","description":"An overview of using Backbone.Radio in Marionette apps","layout":"post","path":"/2015/01/26/backbone-radio","date":"2015-01-26T12:00:00+00:00","dontfeature":null,"isDraft":null},"html":"<p><em>This is the fifth post in a series on <a href=\"http://marionettejs.com/\">Marionette.js</a>.  For more background on what Marionette is, check out the series page, <a href=\"http://benmccormick.org/marionette-explained/\">Marionette Explained</a></em></p>\n<p>One of the great things about Backbone is how it encourages a modular approach to building UIs.  Different portions of the pages are separated into individual Views, allowing you to simplify your reasoning about your code by focusing on bite-sized chunks at a time.  Easier said than done though, right?  In practice, it’s not hard to create Backbone applications with large views that have tight dependencies on each other.  This usually isn’t an intentional decision, but part of a slow decay as developers work to connect the various aspects of their applications.</p>\n<p>So far in this series I’ve talked about how Marionette makes it easier to create maintainable Views.  Now I’m going to look at <a href=\"https://github.com/marionettejs/backbone.radio\">Backbone.Radio</a>, Marionette’s tool for communication between application components.</p>\n<h3>What’s so hard about modular architecture?</h3>\n<p>There are many advantages to designing your web UI in a modular or component-based fashion.  Your code tends to be easier to reason about and test, it’s easier to swap out one piece of code for another, and it greatly increases the chances that you’ll be able to reuse your code in other places.  Unfortunately for all except the most basic applications, different components of a UI always have to be aware of the things that happen in other areas of the UI.  It may be something simple like responding to a button click by showing a modal, or more complicated like updating multiple dashboard items when the user applies a filter, but these connections will exist.  At this point you have options.  You can begin having components reference each other directly for example, or you could try to capture state within a shared data object that each component watches.  But there’s another solution that borrows from many years of development best practice on backend systems.  You can use a message bus.</p>\n<h3>A simple Message Bus</h3>\n<p>A message bus is a software architecture model for communicating between two systems.  The idea is that instead of referencing each other directly, system components are able to send messages through a shared mediator object.  It’s quite straightforward to create a simple message bus using Backbone.</p>\n<p>Backbone.Events is Backbone’s event object, which gets mixed into the various Backbone classes to provide the Backbone event functions (<code class=\"language-text\">on</code>, <code class=\"language-text\">off</code>, <code class=\"language-text\">listenTo</code>, <code class=\"language-text\">trigger</code>, etc).  It’s easy and common to mix it into a separate object.  That’s all you need to create a message bus: something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> mediator <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>Backbone<span class=\"token punctuation\">.</span>Events<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now Models and Views can listen to or trigger events on the mediator object, allowing them to communicate without having to be directly aware of each other.  This is a great pattern, and quite useful as is, but there are some limitations.  With a mediator object, all events are global.  Any object can listen to any event, and you have to be careful to avoid naming collisions when using common terms.  It’s also a single object for multiple types of communication.</p>\n<h3>The Backbone.Radio API</h3>\n<p>Backbone.Radio builds on this concept to provide a more powerful message bus.  Instead of a single object, Radio provides multiple “channels” each of which can correspond to a page or functional section of your web app. Also, instead of a single events API, Radio provides three, Events, Commands, and Requests, each built for a different use case.</p>\n<h4>Events</h4>\n<p>Radio Events are the exact same as our simple message bus.  When you create a channel with Radio, they extend Backbone.Events.  That means you can call any Backbone.Events function on them, or pass them to the <code class=\"language-text\">listenTo</code> method of other Backbone objects.  Events provide Radio’s publish-subscribe functionality.  Multiple objects can subscribe to an event using <code class=\"language-text\">on</code> or <code class=\"language-text\">listenTo</code>.  And any object can publish an event using <code class=\"language-text\">trigger</code>.  For those of you unfamiliar with Backbone’s events, they have two features that you might not expect.  First, unlike native browser events or jQuery events, Backbone events are synchronous; when you trigger an event, all callbacks that are registered on that event run immediately.  Second, it’s easy to pass data with Backbone events.  Unlike native browser events which tend to simply consist of an event and a target, any data you pass when you trigger an event gets passed directly to the callback function, making it a true messaging system.</p>\n<p><img src=\"/b0d8f4148e5c2054b5aa69db422ca94a/events.svg\" alt=\"events diagram\"></p>\n<p><strong>Functions Provided</strong> - <code class=\"language-text\">on</code>, <code class=\"language-text\">off</code>, <code class=\"language-text\">trigger</code>, <code class=\"language-text\">once</code>, <code class=\"language-text\">listenTo</code>, <code class=\"language-text\">listenToOnce</code>, <code class=\"language-text\">stopListening</code></p>\n<h4>Commands</h4>\n<p><strong>Update January 2016</strong> - <em>During 2015, Commands were deprecated from Backbone.Radio as part of their 1.0.0 release.  From a code level, they’re simply a request that doesn’t return a value, so feel free to keep any existing code, but change command to request and comply to reply</em></p>\n<p>Radio Commands are similar to Events, with the distinction that only a single callback can handle or “comply” to a given command.  Commands do not add any functionality on top of events; instead, they provide a semantic distinction and enforce simpler logic.  When <code class=\"language-text\">exampleChannel.command('something')</code> is called, you know that it is requesting an action be performed, and you can be confident that there will be no side effects.  Only one object will comply to the command.  Commands are a maintenance-friendly tool; they make your code easier to follow by doing less and doing it more obviously.</p>\n<p><img src=\"/0d940b905285467c9345d4608fafbaa2/commands.svg\" alt=\"commands diagram\"></p>\n<p><strong>Functions Provided</strong> - <code class=\"language-text\">comply</code>, <code class=\"language-text\">stopComplying</code>, <code class=\"language-text\">command</code>, <code class=\"language-text\">complyOnce</code></p>\n<h4>Requests</h4>\n<p>Radio Requests share the one-to-one nature of Commands, but provide functionality not seen in Backbone.Events.  You can use Requests to retrieve information from other objects.  Each request can be serviced by a single response callback, with the request receiving the return value of the callback function.  This is very useful for providing resources in a decoupled manner, where a View or other object doesn’t have to know the details of how an object is stored or retrieved.</p>\n<p><img src=\"/1c9139c16fb2e5f48ac88fba8a3f8116/requests.svg\" alt=\"requests diagram\"></p>\n<p><strong>Functions Provided</strong> - <code class=\"language-text\">reply</code>, <code class=\"language-text\">stopReplying</code>, <code class=\"language-text\">request</code>, <code class=\"language-text\">replyOnce</code></p>\n<h4>Channels</h4>\n<p>Radio Channels are a method of segmenting out your messaging across functions.  Instead of holding every event inside a global namespace, objects can interact with a Channel that’s limited to the functionality they need.  This minimizes the chances of naming collisions across the app, and provides additional semantic guidance for future readers of the code.  It’s much easier to trace through small, focused messaging networks than a large, global one when you’re trying to understand a complex behavior.</p>\n<h3>Backbone.Radio in practice</h3>\n<p>Radio’s API is fairly small and simple.  Its power comes from the development patterns it enables.  The following are examples from my own code of how Radio assists in building modular testable UI code.</p>\n<h4>Decouple your Views with Radio Events</h4>\n<p><a href=\"http://en.wikipedia.org/wiki/Loose_coupling\">Loose coupling</a> is one of the most commonly cited design principles in Object Oriented Programming.  In Backbone, loose coupling can be applied to mean that your Views should know as little about each other as possible.  In my own work I implement this by allowing Views to know about and reference their own child Views, but do not allow them to directly reference any other Views.  If Views need to communicate up or across a tree of Views, I use Radio.</p>\n<p>Radio Events are great for alerting other parts of the application about a change of state.  For instance, in an application where we have a main content area and a sidebar that provides context for the main area (for instance, a mail app like Gmail that shows contact info in the sidebar next to an open email), we could use Radio Events to keep our sidebar in sync with the main content.  That might look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Mn <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.marionette'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> Radio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.radio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> inboxChannel <span class=\"token operator\">=</span> Radio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inbox'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> ContactView <span class=\"token operator\">=</span> Mn<span class=\"token punctuation\">.</span>ItemView<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token string\">'#contact-template'</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">initialize</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>inboxChannel<span class=\"token punctuation\">,</span> <span class=\"token string\">'show:email'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>showContact<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>inboxChannel<span class=\"token punctuation\">,</span> <span class=\"token string\">'show:inbox'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>showAd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">showContact</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">emailObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//show the contact for the emailObject</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function-variable function\">showAd</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//when we don't have a contact to show, show an ad instead</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> ContactView<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Note that our sidebar View doesn’t need to know anything about the inbox area.  The <code class=\"language-text\">show:email</code> event could be fired by our inbox view, by a navigation View, or by our router on page load.  The sidebar doesn’t know and doesn’t care.</p>\n<p>It’s also important to note that the event represents a change in state external to our component.  Something else changed (the state of the inbox), and the sidebar component is reacting to this.  There might be many coponents that react to this state change, or just this one.  Our View doesn’t know or care.</p>\n<h4>Centralize UI Logic with Commands</h4>\n<p>While Events are a way of notifying other components about a change in state, commands are useful when you want to cause a change in state without having to know the implementation.  For instance, in an application that I work on, we have a centralized event-logging module that can take application events that we want logged and send them to a backend API and also to Google Analytics.  We use commands for this.  In practice the logging module looks a bit like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Radio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backbone.radio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Send event to the backend API and Google Analytics</span>\n<span class=\"token punctuation\">}</span>\n\nRadio<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'appEvents'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">comply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span>log<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Then we can run <code class=\"language-text\">Radio.channel('appEvents').command('log', event)</code> anywhere we want to log an application event.  We could use events for this, but there’s value in using commands.  We’re explicitly saying that we want our application to log a specific piece of data, whereas a similar event would have the connotation that an event had occured, and anything that wanted to respond to it could.  We can be more confident of what’s happening here.</p>\n<h4>Share Resources Across Nested Views with Requests</h4>\n<p>One of the challenges of nested View architectures like Marionette or ReactJS is deciding how to pass data down to deeply nested View components.  One approach is to pass all necessary data into the top level view and then pass it down along the View tree to whatever View needs it.  That has the advantage of a clear data flow, but the disadvantage of cluttering up parent Views with data they don’t need and tightly coupling the parent Views to the implementation of their children.  Another approach is simply making the data available globally, which has all the disadvantages that global data normally brings.  Radio requests provide a nice solution to this problem.  You can define “data providers” that are responsible for providing any data you need that is not passed directly down a view chain. These could be separate modules similar to Angular’s service objects.  They could be other UI components like a datepicker.  Or they could just be models and collections you define at the root of your application but don’t pass directly to your Views.  In the same application as above, I have a set of task views that can have users assigned to them.  Because these tasks are deeply nested in the UI, I don’t pass the collection of possible Users to assign down the View tree.  Instead, I define that collection within my top level application object and then request it when the user opens up the user-picker View.  I use jQuery deferreds to make sure that the collection has been populated before the picker appears.  That all looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//in app.js</span>\n<span class=\"token keyword\">var</span> usersDeferred <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">UserCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nresourceChannel<span class=\"token punctuation\">.</span><span class=\"token function\">reply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'userlist'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> usersDeferred<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//in task.js</span>\n<span class=\"token keyword\">var</span> usersDeferred <span class=\"token operator\">=</span> resourceChannel<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'userlist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nusersDeferred<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>showUserPicker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>A Quick Note on Backbone.Radio and Marionette</h3>\n<p>Those of you who have used Marionette before may be a bit confused as to why this post is part of my Marionette article.  As of version 2.3, the current shipping version of Marionette, Radio is not distributed as part of the library.  Marionette instead ships with <a href=\"https://github.com/marionettejs/backbone.wreqr\">Backbone.Wreqr</a> as its message bus implementation.  Wreqr is a precursor to Radio with a significantly more confusing API.  Radio provides a cleaner approach, as well as a more intuitive name.  However, because Marionette follows semantic versioning, they’re waiting for 3.0 to make Radio the default.</p>\n<p>In the meantime, though, it’s easy to replace Wreqr with Radio.  You can simply make sure that you’re loading in Radio instead of Wreqr, and then implement the following <a href=\"https://gist.github.com/thejameskyle/48afb443b8c8c6ee4f46\">shim</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(function(root, factory) {\n  if (typeof define === 'function' &amp;&amp; define.amd) {\n    define(['backbone.marionette', 'backbone.radio', 'underscore'], factory);\n  } else if (typeof exports !== 'undefined') {\n    module.exports = factory(require('backbone.marionette'), require('backbone.radio'), require('underscore'));\n  } else {\n    factory(root.Backbone.Marionette, root.Backbone.Radio, root._);\n  }\n}(this, function(Marionette, Radio, _) {\n  'use strict';\n\n  Marionette.Application.prototype._initChannel = function () {\n    this.channelName = _.result(this, 'channelName') || 'global';\n    this.channel = _.result(this, 'channel') || Radio.channel(this.channelName);\n  }\n}));</code></pre></div>\n<p>It’s also worth pointing out that Radio has no direct dependency on Marionette, and can be used on any Backbone project.  For example, it might be an interesting tool to implement a Flux-style dispatcher in an application using Backbone and React. All of the benefits Radio provides can help any application with decoupled View components.</p>\n<p><strong>Thanks to the Marionette Teams for the diagrams above, which come directly from the Backbone.Radio <a href=\"https://github.com/marionettejs/backbone.radio\">README</a>.</strong></p>\n<h3>More Resources</h3>\n<ul>\n<li>Although it’s focused on Node and backend use cases, <a href=\"https://www.youtube.com/watch?v=rWz8OoVuDls\">this video</a> is a great rundown of semantic messaging patterns.</li>\n</ul>","fields":{"slug":"/2015/01/26/backbone-radio"}}},{"node":{"frontmatter":{"readNext":"jest-first,react-component-styles,mobx-first","topics":["javascript","highcharts","math"],"category":"frameworks","key":"highcharts-normal","title":"Building Normal Distribution Charts Using Highcharts","description":"Creating a statistical visualization in JavaScript","layout":"post","path":"/2017/05/11/building-normal-curves-highcharts/","date":"2017-05-12T02:30:00+00:00","dontfeature":null,"isDraft":null},"html":"<p>This week I got to have a little fun remembering some High School math, and using one of my favorite libraries: <a href=\"https://www.highcharts.com/\">Highcharts</a>.  Highcharts is a commercial JavaScript data-viz library, and it makes most standard charts and graphs a breeze to implement.  I was using it to plot a normal distribution in order to display a 95% confidence interval.  It’s a pretty straightforward problem, but its a nice example of a practical use of Highcharts, and comes with a little stats math that many of us may have learned and forgotten.</p>\n<h3>The Problem</h3>\n<p>The goal was to display a <a href=\"https://en.wikipedia.org/wiki/Normal_distribution\">normal distribution</a> to represent a 95% confidence interval, given the upper and lower bounds of the confidence interval.  A normal distribution is the classic bell curve, where the area under any section of the graph represents the probability that the true value of the measure being tracked is within that range.  These curves are usually represented something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 499px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c13198254a7cdabc416bd2aa060cb7b/119c7/confidence-interval.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.43356643356644%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB20lEQVQoz41RXU/aYBTuTzFLDG4XGHCU+R+M80/sahdmv8Bll2ZXM/EDq8goyaY3ziVbtjeOYkVmKYtRkY9uUF6wvQBLGyq0s33fpW0EFiXbycmbJ+c9z3lynkPgEYF+Gy8/HFBMzsEjeoi7JQs5ze/SJ2PLSf8KyJUrGGMboX+TkdtkXutPoyBI84+i3+d3kg73f5Qt28YYg5PCxPI3kuaC8Sy5CsoivFf8jrL7PN9mHm5x4UQunODHI+wbcNxfZyTZm12o1snIfmCDnVz6HFjd97/lZzZBR1P7S91P9ma/2mN9Uc6/+P7B/OLEwsYUdeBbS+2kf7hL/U1Gt3FjWRhjAV5Or4EpOhuKZR67ScYy/hg3t/nFE7csq08hhk2+ue48i3/1RY9DdDYYH2QowY+vp19/TGFkDUsT3W5XVdVms3mez1dKxdmV3QCVekIxYYohqWTYBdMUMxlJvaA/VYoXZUFQFEXTNMMwCFVVJUkSRVGSZU3TTgulM6FaqjWEupTLF89/iWV4Wao1LqqwIPxstVr1egNCKMuyrusDw0zTrELIc0dplvUqNVGUZdnDrSslc3QIABj2fGAYQqhnGGq7faUotvvf0fVur4fcE/ZMo6044VzUtj3D/gC6GKTGiLOHagAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Normal Distribution image\"\n        title=\"Normal Distribution image\"\n        src=\"/static/3c13198254a7cdabc416bd2aa060cb7b/119c7/confidence-interval.png\"\n        srcset=\"/static/3c13198254a7cdabc416bd2aa060cb7b/a6b04/confidence-interval.png 143w,\n/static/3c13198254a7cdabc416bd2aa060cb7b/0e2fe/confidence-interval.png 285w,\n/static/3c13198254a7cdabc416bd2aa060cb7b/119c7/confidence-interval.png 499w\"\n        sizes=\"(max-width: 499px) 100vw, 499px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The x axis of the curve represents the range of values, while the y axis is a function of x that shows the relative probability for different areas.  Data sets that are normally distributed conform to the above bell curve and the <a href=\"https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule\">68-95-99.7 rule</a>. There’s a 68% chance that the true value is within 1 standard deviation of the middle of the curve (the mean), a 95% chance that the true value is within 2 standard deviations, and a 99.7% chance that the true value is within 3 standard deviations.</p>\n<h3>Step 1: Generating a Dataset</h3>\n<p>Highcharts operates by plotting a set of data points, not by handling equations directly.  So our first step is computing a set of data points to plot.  We can find the equation for calculating a normal distribution’s probability density on <a href=\"https://en.wikipedia.org/wiki/Normal_distribution\">Wikipedia</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 510px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a389461177782c04eacef4eb7226e50/0abdd/equation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.16083916083916%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVQoz52R2U7DMBRE8/8fxwuRQFBQksZZnN1L4qRND7JRK+AFykgjX+tKM1czkagVb0dNIjTHypIUirqqqKqKoigQQpCmKWmW0XUdl8sFj+v7E5Exhm3bmOc5cN93rLWcz2emaSLLsjBfRX4VbNuWYRhomgatNeM4EccxUkqcc8HkKvQXRtM4fXM4bRtGq9tV9yIqyxK7bLj1xOJWlnUPnBeH0RqlPFWIwRqDj8jP2q4o8xmVNi78w4VCFByykdek45B2PDy1PL70NN2IlDV+n+cCWdd4c19UIyVFrUlLE6IqpSKvVMg/8i0mec/z+0hSaMrW0k+O/yIyRtMPmrKZGdV6W9xTxNdSPgAShmyoqYaeFQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Normal Distribution equation\"\n        title=\"Normal Distribution equation\"\n        src=\"/static/6a389461177782c04eacef4eb7226e50/0abdd/equation.png\"\n        srcset=\"/static/6a389461177782c04eacef4eb7226e50/a6b04/equation.png 143w,\n/static/6a389461177782c04eacef4eb7226e50/0e2fe/equation.png 285w,\n/static/6a389461177782c04eacef4eb7226e50/0abdd/equation.png 510w\"\n        sizes=\"(max-width: 510px) 100vw, 510px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Yep, we get to play with an equation that has both π and e in it.  I hope this feels sufficiently like a high school math class now.  But we can actually choose to drop the left side of the equation.  It is the <a href=\"https://en.wikipedia.org/wiki/Normalizing_constant\">normalization constant</a> for the equation: it ensures that the total area under the curve equals 1, but doesn’t change the shape of the curve.  Since we’re simply displaying the shape of the graph and care primarily about showing the range along the x axis, we can ignore it and instead use this function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">normalY</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> mean<span class=\"token punctuation\">,</span> stdDev</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">exp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-</span> mean<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> stdDev<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s a good start, but right now we only have an upper and lower bound value for a 95% confidence interval.  So before we can apply the equation, we need to find a mean, a standard deviation, and a set of x values to run the formula against.  The mean and standard deviation are fairly straightforward, and we can use lodash to generate a set of points.  For the sake of this example, we’ll plan on generating 100 points ranging from +/- 5 standard deviations from the mean, which should allow us to see all meaningful parts of the distribution, and still have a bit of padding.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getMean</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">lowerBound<span class=\"token punctuation\">,</span> upperBound</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>upperBound <span class=\"token operator\">+</span> lowerBound<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// distance between mean and each bound of a 95% confidence interval</span>\n<span class=\"token comment\">// is 2 stdDeviation, so distance between the bounds is 4</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getStdDeviation</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">lowerBound<span class=\"token punctuation\">,</span> upperBound</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>upperBound <span class=\"token operator\">-</span> lowerBound<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generatePoints</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">lowerBound<span class=\"token punctuation\">,</span> upperBound</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> stdDev <span class=\"token operator\">=</span> <span class=\"token function\">getStdDeviation</span><span class=\"token punctuation\">(</span>lowerBound<span class=\"token punctuation\">,</span> upperBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> min <span class=\"token operator\">=</span> lowerBound <span class=\"token operator\">-</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> stdDev<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> upperBound <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> stdDev<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> unit <span class=\"token operator\">=</span> max <span class=\"token operator\">-</span> min <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span>min<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> unit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now that we have the x axis locations for the points, we can generate a whole data series.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> mean <span class=\"token operator\">=</span> <span class=\"token function\">getMean</span><span class=\"token punctuation\">(</span>lowerBound<span class=\"token punctuation\">,</span> upperBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> stdDev <span class=\"token operator\">=</span> <span class=\"token function\">getStdDeviation</span><span class=\"token punctuation\">(</span>lowerBound<span class=\"token punctuation\">,</span> upperBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> points <span class=\"token operator\">=</span> <span class=\"token function\">generatePoints</span><span class=\"token punctuation\">(</span>lowerBound<span class=\"token punctuation\">,</span> upperBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">let</span> seriesData <span class=\"token operator\">=</span> points<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token function\">normalY</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> mean<span class=\"token punctuation\">,</span> stdDev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Step 2: Creating the Chart</h3>\n<p>Now we have what we need to generate a chart!  Given the data, It’s easy to make a simple normal distribution curve with highcharts.  All we need to do is create a <code class=\"language-text\">&lt;div id=\"container\"></code> element and then run this JavaScript:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Highcharts<span class=\"token punctuation\">.</span><span class=\"token function\">chart</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">chart</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'area'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">series</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> seriesData<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Which produces the following graph:</p>\n<iframe width=\"100%\" height=\"400\" src=\"//jsfiddle.net/ben336/8bgm1m18/embedded/result,js/\"\nallowfullscreen=\"allowfullscreen\" frameborder=\"0\"></iframe>\n<p>Thats a good start, but contains a lot of “stuff” that Highcharts provides by default that we don’t necessarily want for our normal distribution illustration.  Let’s cut the title, legend, y-axis, and tooltips/mouse action.  To do that we need a bit more configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Highcharts<span class=\"token punctuation\">.</span><span class=\"token function\">chart</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">chart</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'area'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">yAxis</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">labels</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">enabled</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>   \n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">gridLineWidth</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">tooltip</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token literal-property property\">enabled</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">legend</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">enabled</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">series</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> seriesData<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">plotOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">area</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">enableMouseTracking</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<iframe width=\"100%\" height=\"400\" src=\"//jsfiddle.net/ben336/w7165m2u/embedded/result,js/\" allowfullscreen=\"allowfullscreen\" frameborder=\"0\"></iframe>\n<p>This is pretty great, but we still want to show our confidence interval like the wikipedia image at the top.  Ideally we’d only be filling in the areas within the 95% curve.  Thats pretty easy to do with Highcharts.  We can use <em>zones</em>, Highcharts way of applying different styles to different sections of the chart.  We want our zones to apply to the x axis, and we’ll define 3 zones: 0 to the lower bound, lower bound to the upper bound, and everything else.  In Highcharts that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">plotOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">area</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">zones</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//fillColor gets the inside of the graph, color would change the lines</span>\n        <span class=\"token literal-property property\">fillColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// everything below this value has this style applied to it</span>\n        <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> lowerBound<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> upperBound<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">fillColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We also want to show a 95% label on the graph like the image at the start.  There are multiple ways to do that in Highcharts, but for this simple case we’ll just abuse the title attribute and move it down into the middle of the chart:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">'95%'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<iframe width=\"100%\" height=\"400\" src=\"//jsfiddle.net/ben336/81kb997x/embedded/result,js/\" allowfullscreen=\"allowfullscreen\" frameborder=\"0\"></iframe>\n<p>And with that we’ve taken our original inputs and produced a dynamic illustration of a confidence interval that matches the image we started with.</p>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>Highcharts has great <a href=\"http://api.highcharts.com/highcharts/\">documentation</a> and you can see more <a href=\"https://www.highcharts.com/demo\">demos</a> on their site, both for Highcharts and their stock and map chart variants.  Note that Highcharts is not free for commercial use.  I’ve found that it is well worth the money though for any team that is going to be doing many data visualizations, especially if its using relatively standard forms of data visualizations on variable data.</p>\n</li>\n<li>\n<p>If you need more freeform visualizations, <a href=\"https://d3js.org/\">d3</a> is a great place to look.  Here’s an example of D3 being used to draw a similar chart: <a href=\"http://bl.ocks.org/phil-pedruco/88cb8a51cdce45f13c7e\">http://bl.ocks.org/phil-pedruco/88cb8a51cdce45f13c7e</a>  It’s more involved than the Highcharts example, but allows for more flexibility as a result.  And unlike Highcharts, its free to use for anything.</p>\n</li>\n</ul>","fields":{"slug":"/2017/05/11/building-normal-curves-highcharts/"}}},{"node":{"frontmatter":{"readNext":"evil-js,javascript-stale-practices,ten-things-js","topics":["javascript"],"category":"platform","key":"quick-logging-breakpoints","title":"Quick Tip: Logging In Breakpoints","description":"Did you know breakpoints can have side effects?","layout":"post","path":"/2018/07/17/quick-tip-logging-breakpoints/","date":"2018/07/17","dontfeature":null,"isDraft":null},"html":"<p>Stop me if this sounds familiar: you see a bug on your site.  You want to know what’s going on.  You fire up the developer tools, put a breakpoint in the area you think is a problem, and… the error doesn’t occur while it’s being debugged.  Probably it’s a timing issue, but I’ve also seen situations where pausing on certain breakpoints will actually cause a browser tab to freeze up.  Whatever weirdness you’re dealing with, you can’t get a breakpoint running in the right spot to see the error.  These are known colloquially as <a href=\"https://en.wikipedia.org/wiki/Heisenbug\">Heisenbugs</a>, bugs that disappear when measured.  Ideally at this point you would add some logging, but if the issue is on production, and you don’t know exactly what needs to be logged, that could delay a fix by an unacceptable amount.</p>\n<p>I actually ran into this last night, and decided to test out a tactic I’d heard about in a <a href=\"https://changelog.com/jsparty/30\">recent JS Party episode</a>.  Did you know that you can use conditional break points to add temporary logging to a live application?</p>\n<p>Conditional breakpoints are a browser debugger feature where you set a breakpoint, and specify a condition.  The breakpoint only stops the program execution when that condition is truthy.  Here’s a video describing the feature in Firefox:</p>\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden; \" > <iframe src=\"https://www.youtube.com/embed/pVPlMhfrMwM\" frameborder=\"0\" encrypted-media\"=\"\" allowfullscreen=\"\" style=\" position: absolute; top: 0; left: 0; width: 100%; height: 100%; \"></iframe> </div>\n<p>Conditional breakpoints are useful when you’re running through a code path many times during program execution, but you want to stop during a specific run.  But they can also be used to solve our heisenbug problem.  Because the conditional breakpoint executes the code inside of it in the context of the line we’re trying to break on, we can actually put logging inside the breakpoint.</p>\n<p><a href=\"log-example.png\">An example of a console.log inside a breakpoint</a></p>\n<p>That <code class=\"language-text\">console.log</code> will execute, and because <code class=\"language-text\">console.log</code> returns false, the breakpoint will never actually stop.  It’s a heisenbug-safe version of watching variables when you’re at a breakpoint, and there’s no redeploys required.</p>\n<p><strong>Update January 2019: Chrome will soon be building this hack right into the devtools with a new “logpoint” option for breakpoints that formalizes this method.  Very cool!</strong></p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">New feature in Chrome 73: Logpoints. Log messages to the Console without cluttering up your code with console.log() calls. <a href=\"https://t.co/aFl2e6GmnF\">https://t.co/aFl2e6GmnF</a> <a href=\"https://t.co/fJ6CUNN0Lg\">https://t.co/fJ6CUNN0Lg</a></p>&mdash; Chrome DevTools (@ChromeDevTools) <a href=\"https://twitter.com/ChromeDevTools/status/1088463799886200832?ref_src=twsrc%5Etfw\">January 24, 2019</a></blockquote>","fields":{"slug":"/2018/07/17/quick-tip-logging-breakpoints/"}}},{"node":{"frontmatter":{"readNext":"ten-things-js,following-js-roadmap,proposals-in-production","topics":["javascript"],"category":"javascript","key":"codemod-survival","title":"A Codemod Survival Guide","description":"Getting started with jscodeshift","layout":"post","path":"/2018/06/18/codemod-survival/","date":"2018/06/18","dontfeature":null,"isDraft":null},"html":"<p>Do you like making repetitive syntax updates across many files?  Enjoy the thrill of painstakingly combing through 1000 line diffs that all look the same to see if you made any typos?  Relish that feeling of doubt in the back of your head as you wonder whether you actually caught all instances of the syntax you needed to update when you switched to the next major version of a library?  If so, you should probably stop reading now, because you won’t like codemods at all.  For the rest of us, codemods are a tool for assisting in large refactoring; they save you time and reduce typos.</p>\n<p>Codemods originated at Facebook, first with a tool named <a href=\"https://github.com/facebook/codemod\">codemod</a> that served as a helper for regex or python based refactoring, allowing you to make iterative changes with pretty diffs, then with <a href=\"https://github.com/facebook/jscodeshift\">jscodeshift</a> a tool for doing more advanced JavaScript refactors that work directly against a data model representation of the code, rather than relying on regex or direct programmatic changes to text.  jscodeshift is extremely powerful, but I found it intimidating to approach.  Once I took the plunge though, it wasn’t that hard to start writing codemods.  So here are a few quick tips for anyone else who might be interested.</p>\n<h4>1. Start with a goal in mind</h4>\n<p>It’s always helpful to dive into a new technology by trying to solve a concrete problem.  That’s especially useful for codemods, because the ideas behind them can seem abstract and poorly documented until you begin focusing on a specific issue.  In my case I was originally motivated to look at codemods when updating an application from using MobX version 3 to MobX version 5.  In MobX3, when you write code without using decorators, a typical model class will look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extendObservable<span class=\"token punctuation\">,</span> computed<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Example</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">currentData</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">otherData</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">setFoo</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">setBar</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">unrelatedMethod</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> key<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I was updating an app with dozens of these model classes.  Unfortunately, in Mobx5, the syntax for these classes has changed, and it now needs to be rewritten like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extendObservable<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'mobx'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Example</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">get</span> <span class=\"token function\">currentData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">get</span> <span class=\"token function\">otherData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function-variable function\">setFoo</span><span class=\"token operator\">:</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function-variable function\">setBar</span><span class=\"token operator\">:</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">setFoo</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">setBar</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">unrelatedMethod</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> key<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Computeds must be shifted to gets, action functions have to be pulled out of their wrapper function calls, but the wrapper and action names have to be moved down to a new second object.  This is really finicky to do by hand or with a text editor macro, because it’s a lot more complicated than just find and replace.  I’d usually be converting from arrow functions that might or might not have blocks and return statements currently, and I’d have to move the actions down to the new object correctly even though some of the models had 10+ action functions.   Facing several hours worth of finicky manual or script assisted refactoring work was enough to convince me it was time to learn about codemods.</p>\n<h4>2. Create a small example and learn about its AST</h4>\n<p>My first productive step towards creating a Mobx3to5 codemod for my codebase was creating the example code above.  I iterated on it a bit as I found new things I cared about; I didn’t realize at first that computeds needed to be changed as well as actions, and I eventually realized I needed to handle 2 types of arrow function syntax. But the initial version I wrote got me going.  Having a stripped down example of the code I cared about without the baggage of my real codebase was valuable, and being able to update it to include all the cases I cared about during testing was even better.</p>\n<p>Once I created the example, I was able to understand better what I was trying to do by examining its AST.  An AST (Abstract Syntax Tree) is a representation of a JavaScript file’s source code as a tree data structure.  For instance here’s a portion of the AST for a basic Hello World program:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Program\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"body\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ExpressionStatement\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"expression\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CallExpression\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"callee\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MemberExpression\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"object\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"console\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"property\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"log\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"computed\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MemberExpression\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"arguments\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Literal\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"rawValue\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"raw\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"'Hello World'\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Literal\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CallExpression\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"_babelType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ExpressionStatement\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is a simplified example that looks only at the semantic structure of the syntax.  The full version also contains information about the indenting and exact text of the code, and comes out to about 600 lines when represented as formatted JSON.   All of this from <code class=\"language-text\">console.log('Hello World');</code>.  Fortunately there’s a nice tool for exploring ASTs.</p>\n<p><a href=\"http://astexplorer.net/\">AST Explorer</a> is a site that lets you enter some JavaScript code, and then visualize the AST that represents the code.  When I put my example code above, in, I was able to see that the computed expressions in my original code showed as a <code class=\"language-text\">CallExpression</code> with an <code class=\"language-text\">ArrowFunctionExpression</code> as an argument.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/566c7da27d68ddf6d09c7859481c3a91/b5dee/computed-ast.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.74825174825175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVQoz32RO4/UMBRG5/93FIh/QEOJhCiXkldDAYPQshPnndi+2TycSTLJQXGWaECrsfTJLu49Pr4+NFWLFC1B6DBywTlwPUzjQpoWfPr8leOv3wRBQBzHKKVIkgSlAqIoJAgVURRhrUVrzeF8bnFO83D/gyg44VrFZTKs6zwMVFWFiGCM2eOb85goVnwPU1SW+5o1h65NgSNF+o0wOBIGHxFzomka2qb1zSJ2b9hSYXVOGAecck2mDVbE1x66znkbqyvy3FLpmqG74M4TvXNPwK14j9SIeaCMX6OSd+jyLbXcYe1q2HUsy8w4DAzngXEcmefZX9L3/Q78CxUPranknsfsBWn2itq8pJM3m2HTtrR1iy4tnRu5Xs8BN8NHxETk6XuS7I6s+ICYL9sMnXMs88I4XpiXBZaFZd2fAe6W69kKYZwSJpooE7SpN+A0Tf9YLTeA+5NF0LpAG40VSyXGf5yf4Tqz/0E3gU97kKTEWUZRlj7amM3wGnhteQtorOGnylBJSpbnPmVZeuAfT8/3RUfo6kkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AST explorer screenshot showing the CallExpression syntax\"\n        title=\"AST explorer screenshot showing the CallExpression syntax\"\n        src=\"/static/566c7da27d68ddf6d09c7859481c3a91/432e7/computed-ast.png\"\n        srcset=\"/static/566c7da27d68ddf6d09c7859481c3a91/a6b04/computed-ast.png 143w,\n/static/566c7da27d68ddf6d09c7859481c3a91/0e2fe/computed-ast.png 285w,\n/static/566c7da27d68ddf6d09c7859481c3a91/432e7/computed-ast.png 570w,\n/static/566c7da27d68ddf6d09c7859481c3a91/77800/computed-ast.png 855w,\n/static/566c7da27d68ddf6d09c7859481c3a91/b5cea/computed-ast.png 1140w,\n/static/566c7da27d68ddf6d09c7859481c3a91/b5dee/computed-ast.png 1237w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When I put the result code I wanted in, I could see that I would need to switch the property that contained the callexpression to have a type <code class=\"language-text\">get</code> and would need to replace the call expression with a function expression.</p>\n<h4>3. Start with a small edit</h4>\n<p>As a starting point, I decided I wanted to write a script that could find MobX classes and just add the second object argument to extendObservable, with a dummy property.  So this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">currentData</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">otherData</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">setFoo</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">setBar</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>would become this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">extendObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">currentData</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> foo <span class=\"token operator\">||</span> bar<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">otherData</span><span class=\"token operator\">:</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> foo <span class=\"token operator\">&amp;&amp;</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">setFoo</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>foo <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">setBar</span><span class=\"token operator\">:</span> <span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Set Bar'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bar <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To do this, I took an existing script that I found in <a href=\"https://github.com/jhgg/js-transforms\">this repo of small codemod examples</a> and modified it to lookup <code class=\"language-text\">extendObservable</code> calls and add a second argument.  I filtered it to only include calls with 2 arguments, in case I ran the code a second time<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token punctuation\">,</span> api</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span>jscodeshift<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token function\">j</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We're looking for a CallExpression for extend observable</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>CallExpression<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">callee</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'extendObservable'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">\"ObjectExpression\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Now we want to</span>\n            <span class=\"token comment\">// 1. Add a 3rd argument object</span>\n            <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>\n            args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">objectExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">property</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init'</span><span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">identifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">literal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// TODO: 2. Move action declarations to that argument</span>\n            <span class=\"token comment\">// TODO: 3. Convert action statements to plain functions</span>\n            <span class=\"token comment\">// TODO: 4. Convert computeds to get statements</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is a working script to achieve my simple goal.  To break it down:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">j</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>CallExpression<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">callee</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'extendObservable'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>jscodeshift provides a jQuery style api for traversing a tree.  Here we’re looking for <code class=\"language-text\">CallExpression</code>s that have the name <code class=\"language-text\">extendObservable</code>.  We now have a collection of these expressions, and we can filter it down to only the expressions that have 2 arguments.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">\"ObjectExpression\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Next we want to go through each callExpression and transform it.  In this case by finding it’s arguments list and pushing a new one, using the jsCodeshift API to simply generate the AST objects neededed to represent <code class=\"language-text\">{foo: bar}</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Now we want to</span>\n            <span class=\"token comment\">// 1. Add a 3rd argument object</span>\n            <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>\n            args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">objectExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">property</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init'</span><span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">identifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">literal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// TODO: 2. Move action declarations to that argument</span>\n            <span class=\"token comment\">// TODO: 3. Convert action statements to plain functions</span>\n            <span class=\"token comment\">// TODO: 4. Convert computeds to get statements</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Finally, we call <code class=\"language-text\">.toSource()</code> to write the tranformed AST back to the file.</p>\n<h4>4. Test your edit</h4>\n<p>Because this type of coding lends itself to experimentation, it’s important to develop a good feedback loop while working on your codemod.  If you have a simple example you’re off to a good start.  The next step is to find a good way to run your script and see the output.  Simply running your test is a bit frustrating, because jscodeshift is destructive.  It overwrites your file in place, and doesn’t save a copy.  You can get around this though by adding <code class=\"language-text\">--dry --print</code> flags to your command line call</p>\n<p><code class=\"language-text\">jscodeshift -t my-codemod.js example.js</code></p>\n<p>will run the transform defined in <code class=\"language-text\">my-codemod.js</code> against <code class=\"language-text\">example.js</code> and modify it in place.</p>\n<p><code class=\"language-text\">jscodeshift --dry --print -t my-codemod.js example.js</code></p>\n<p>will print the transformed file to the console and not update example.js.</p>\n<p>For simple codemods and small example files, this is a nice way to iterate quickly.  For more extensive codemods with multiple test cases, I’m excited to try out jscodeshift’s Jest support<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.  It has helper methods for working with transforms, and a workflow of Jest watch checking the output of several inputs against several expected outputs would be lovely.</p>\n<h4>5. Iterate</h4>\n<p>After I got that first edit working, it was simply a matter of working through my list.  I needed to remove the experimental <code class=\"language-text\">foo:bar</code> and then</p>\n<ol>\n<li>Move action declarations to the new argument object</li>\n<li>Convert action declarations to plain functions in the existing object</li>\n<li>Convert computeds to get statements</li>\n</ol>\n<p>I was able to take those one at a time, and my final script looked something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token punctuation\">,</span> api</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span>jscodeshift<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">buildDecoratorPropertiesFromCurrentObject</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">currentObj</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">let</span> decoratorProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        currentObj<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prop</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CallExpression'</span> <span class=\"token operator\">&amp;&amp;</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'computed'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                prop<span class=\"token punctuation\">.</span>kind <span class=\"token operator\">=</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">let</span> fnBody <span class=\"token operator\">=</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fnBody<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowFunctionExpression'</span> <span class=\"token operator\">&amp;&amp;</span> fnBody<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>type <span class=\"token operator\">!==</span> <span class=\"token string\">'BlockStatement'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    prop<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">functionExpression</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> fnBody<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">,</span>\n                        j<span class=\"token punctuation\">.</span><span class=\"token function\">blockStatement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">returnStatement</span><span class=\"token punctuation\">(</span>fnBody<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                    prop<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> j<span class=\"token punctuation\">.</span><span class=\"token function\">functionExpression</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> fnBody<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">,</span> fnBody<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> dataProps <span class=\"token operator\">=</span> currentObj<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prop</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CallExpression'</span> <span class=\"token operator\">&amp;&amp;</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'computed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dataProps<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prop</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CallExpression'</span> <span class=\"token operator\">&amp;&amp;</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'action'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// copy action to the decorator area first...</span>\n                <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> prop<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">let</span> dupProp <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> prop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                dupProp<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> dupProp<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                dupProp<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> args<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                decoratorProps<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>dupProp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// then flatten things out</span>\n                prop<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>dataProps<span class=\"token punctuation\">,</span> decoratorProps<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">j</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We're looking for a CallExpression for extend observable</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>CallExpression<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">callee</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'extendObservable'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">\"ObjectExpression\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Now we want to</span>\n            <span class=\"token comment\">// 1. Add a 3rd argument</span>\n            <span class=\"token comment\">// 2. Move action declarations to that argument</span>\n            <span class=\"token comment\">// 3. Convert action statements to plain functions</span>\n            <span class=\"token comment\">// 4. Convert computeds to get statements, or just move them down to the second object?</span>\n            <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>arguments<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>dataProps<span class=\"token punctuation\">,</span> decoratorProps<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">buildDecoratorPropertiesFromCurrentObject</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>properties <span class=\"token operator\">=</span> dataProps<span class=\"token punctuation\">;</span>\n            args<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span><span class=\"token function\">objectExpression</span><span class=\"token punctuation\">(</span>decoratorProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That looks rather crazy, but the <code class=\"language-text\">buildDecoratorPropertiesFromCurrentObject</code> is mostly straightforward data manipulation, looking for some patterns in the data, and replacing them with a different pattern.  Everything else is just the same base code from our initial example.</p>\n<h4>6. Use version control and code reviews!</h4>\n<p>Actually running a finished transform against a codebase is crazy easy.  Just give it a base folder, and <code class=\"language-text\">jscodeshift</code> will run your script against all JavaScript files in the directory.  This is definitely a “With great power comes great responsibility” tool though.  Before running jscodeshift across a large code base, make sure you are using version control and that you’ve checked in any other changes.  Because the script will update many files at once, you want to be able to isolate the change and review it carefully afterwards, to make sure that you see what is different, and that those changes look right.  In my case, I got to be <em>done</em> with my script twice, because the first time I thought it was ready to execute across all of the app files, things still went wrong.  It was easy to fix though, since I was able to just checkout my changes and try again.</p>\n<h3>Resources</h3>\n<p>If you have a change that you want to make to your codebase, but have been holding off because you think it would take forever, I definitely encourage you to check codemods out.  They’re not as scary as you think!  Here are some more resources to get started:</p>\n<ul>\n<li><a href=\"https://github.com/facebook/jscodeshift\">facebook/jscodeshift</a></li>\n<li><a href=\"http://astexplorer.net/\">AST Explorer</a></li>\n<li><a href=\"https://medium.com/@andrew_levine/writing-your-very-first-codemod-with-jscodeshift-7a24c4ede31b\">Writing Your First codemod with jscodeshift</a></li>\n<li><a href=\"https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb\">Effective JavaScript Codemods</a></li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">This is one of many assumptions I made that won’t be true for MobX classes generally.  I was writing a script to convert my app to MobX5 compatible syntax, not write a general case update tool.  In the end there were a few examples that violated my assumptions in the codebase, and I had to update 2 files by hand.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">jscodeshift was created by Christoph Pojer who is also one of the primary maintainers of Jest.<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/06/18/codemod-survival/"}}},{"node":{"frontmatter":{"readNext":"ten-things-js,favorite-interview,following-js-roadmap","topics":["javascript","math"],"category":"javascript","key":"sieveoferatosthenes","title":"Implementing The Sieve Of Eratosthenes in JavaScript","description":"Generating a series of prime numbers","layout":"post","path":"/2017/11/28/sieveoferatosthenes/","date":"2017/11/28","dontfeature":null,"isDraft":null},"html":"<p>As a way of keeping my math skills sharp, I’ve recently started to work through the <a href=\"https://projecteuler.net/\">Project Euler</a> set of computational math problems.  They ask you not to post your work publicly, so I won’t be posting about any of my specific solutions, but I did think it would be fun to share about a helper method I’ve been using.</p>\n<p>For several of the Project Euler problems I’ve worked on, I needed to be able to generate a list of prime numbers.  To do that, I borrowed a Python implementation of the Sieve Of Erathosthenes from <a href=\"https://stackoverflow.com/a/568618/1424361\">this StackOverflow answer</a>.  Since I haven’t had much reason to use generators in JavaScript yet, I thought it would be fun to translate that algorithm to JavaScript and share that here.</p>\n<h3>Sieve of Eratosthenes</h3>\n<p>The Sieve of Erathosthenes is a very old<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> simple algorithm for identifying prime numbers.  In its normal implementation it is a useful way of finding small primes up to a certain number.  Beginning at 2, the algorithm iterates upward.  For the current number, if the number has not been marked, we identify it as a prime, and then mark all multiples of that number up to our target number.  So to find all primes up to 12, we would</p>\n<ul>\n<li>start at 2, note <strong>2</strong> as prime, and mark 4, 6, 8, 10 and 12 as non-prime</li>\n<li>move to 3, note <strong>3</strong> as prime, and mark 6, 9, 12 as non-prime</li>\n<li>move to 4, see that it is marked, and skip it</li>\n<li>move to 5, note <strong>5</strong> as prime and mark 10 as non-prime</li>\n<li>move to 6, see that it is marked and skip it</li>\n<li>move to 7 , note <strong>7</strong> as prime</li>\n<li>see that 8-10 are marked and skip them</li>\n<li>move to 11, note <strong>11</strong> as prime</li>\n<li>move to 12, see that it is marked and skip it</li>\n</ul>\n<p>You can see it graphically with this visualization from <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\">Wikipedia</a>:</p>\n<p><img src=\"/6420e3488e509dce176a1e957ea07ff5/sieve-animation.gif\" alt=\"sieve animation, shows the numbers being marked visually\"></p>\n<h3>Python Implementation</h3>\n<p>The Python implementation that I used makes some modifications to the classic version of the algorithm that lets it generate an indefinite number of primes while being memory efficient</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">gen_primes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\" Generate an infinite sequence of prime numbers.\"\"\"</span>\n    marked_not_prime <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    value_to_check <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> value_to_check <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> marked_not_prime<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">yield</span> value_to_check\n            marked_not_prime<span class=\"token punctuation\">[</span>value_to_check <span class=\"token operator\">*</span> value_to_check<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>value_to_check<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">for</span> prime <span class=\"token keyword\">in</span> marked_not_prime<span class=\"token punctuation\">[</span>value_to_check<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n                marked_not_prime<span class=\"token punctuation\">.</span>setdefault<span class=\"token punctuation\">(</span>prime <span class=\"token operator\">+</span> value_to_check<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">del</span> marked_not_prime<span class=\"token punctuation\">[</span>value_to_check<span class=\"token punctuation\">]</span>\n        value_to_check <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></code></pre></div>\n<p>This version of the algorithm keeps a running set of the relevant matches, and keeps only the ones it needs.  We can translate it more or less directly to JavaScript like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">generatePrimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> markedNotPrime <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> valueToCheck <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>valueToCheck <span class=\"token keyword\">in</span> markedNotPrime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">yield</span> valueToCheck\n            markedNotPrime<span class=\"token punctuation\">[</span>valueToCheck<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> primes <span class=\"token operator\">=</span>markedNotPrime<span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            primes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prime</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">let</span> nextMultipleOfPrime <span class=\"token operator\">=</span> prime <span class=\"token operator\">+</span> valueToCheck<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextMultipleOfPrime <span class=\"token keyword\">in</span> markedNotPrime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    markedNotPrime<span class=\"token punctuation\">[</span>nextMultipleOfPrime<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                    markedNotPrime<span class=\"token punctuation\">[</span>nextMultipleOfPrime<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>prime<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">delete</span> markedNotPrime<span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        valueToCheck <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s break down what this is doing.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">generatePrimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">generatePrimes</code> is a JavaScript <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator\">generator</a>.  Generators “generate” a series of values in a “just in time” fashion; they only calculate the next value when it is needed, making them an efficient solution for working with large or infinite series.  You specify a generator function by adding the <code class=\"language-text\">*</code> to the function declaration.  Generators then use the <code class=\"language-text\">yield</code> keyword rather than <code class=\"language-text\">return</code> to return their values, and can <code class=\"language-text\">yield</code> multiple times. After a generator yields, it pauses execution until it is asked for another value.  For our <code class=\"language-text\">generatePrimes</code> function, we are operating inside an infinite loop and will yield continuously without stopping<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> markedNotPrime <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> valueToCheck <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    valueToCheck <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>We’re using a plain object to keep track of our marked numbers, and using <code class=\"language-text\">valueToCheck</code> to keep track of where we are in iterating through numbers. As noted, we will iterate it forever if the generator continues to be called.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>valueToCheck <span class=\"token keyword\">in</span> markedNotPrime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">yield</span> valueToCheck\n    markedNotPrime<span class=\"token punctuation\">[</span>valueToCheck<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As in the original algorithm, if we get to a number that isn’t marked, we know that it is a prime.  So we <code class=\"language-text\">yield</code> it, which pauses execution.  If the generator is queried again, when we resume execution we mark the prime squared as not-prime, and we do that by assigning it an array with the current prime value in it.  Using arrays for markers will make more sense in a moment. For now its worth noting that we only need to mark prime-squared as non-prime since every multiple below that is the current prime multiplied by a number less than it, which means it will already be covered, as we will see below.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>valueToCheck <span class=\"token keyword\">in</span> markedNotPrime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> primes <span class=\"token operator\">=</span> markedNotPrime<span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    primes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prime</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> nextMultipleOfPrime <span class=\"token operator\">=</span> prime <span class=\"token operator\">+</span> valueToCheck<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextMultipleOfPrime <span class=\"token keyword\">in</span> markedNotPrime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            markedNotPrime<span class=\"token punctuation\">[</span>nextMultipleOfPrime<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            markedNotPrime<span class=\"token punctuation\">[</span>nextMultipleOfPrime<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>prime<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">delete</span> markedNotPrime<span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here’s the clever part of this implementation.  When we hit a number that is marked as not-prime, instead of just skipping it and moving on, we use some logic to keep our list of marked values small and memory efficient. This is also what allows us to get an infinite list of primes instead of settling for those under a particular value.  What we want to do is keep a list of all the primes that are factors of each marked number.  Then when we hit a number that is marked, we mark the next multiple for each prime (<code class=\"language-text\">valueToCheck + prime</code>), and remove the current value from the object.  That keeps checks fairly cheap by eliminating the number of marked numbers, and allows us to only add values to the marked list as we need them.</p>\n<p>We can then use this code to get the 1,000,001st prime like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> gen <span class=\"token operator\">=</span> <span class=\"token function\">generatePrimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>gen<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></code></pre></div>\n<p>That executed on my laptop in ~20seconds, approximately the same as the python implementation in python2, a little slower than running it under python3.  I was curious whether using a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\">Map</a> for our marked prime list would speed things up:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">generatePrimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> markedNotPrimeMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> valueToCheck <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>valueToCheck<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">yield</span> valueToCheck\n            markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>valueToCheck<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>valueToCheck<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> primes <span class=\"token operator\">=</span>markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>valueToCheck<span class=\"token punctuation\">)</span>\n            primes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prime</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">let</span> nextMultipleOfPrime <span class=\"token operator\">=</span> prime <span class=\"token operator\">+</span> valueToCheck<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>nextMultipleOfPrime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>nextMultipleOfPrime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                    markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>nextMultipleOfPrime<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>prime<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            markedNotPrimeMap<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>valueToCheck<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        valueToCheck <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This version of the code runs about 25% faster, in 15 seconds on my machine. Not bad.</p>\n<h3>More Resources</h3>\n<ul>\n<li>You can dig in more on the Sieve of Erosthenes on <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\">Wikipedia</a></li>\n<li>Check out <a href=\"https://projecteuler.net/\">Project Euler</a> for some fun computational math problems.</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">There are references as old as ~100 AD<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">At least until we hit system boundaries for memory/number size/etc.<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2017/11/28/sieveoferatosthenes/"}}},{"node":{"frontmatter":{"readNext":"cs-basics-variables,cs-for-fe,ten-things-js","topics":["computer-science","javascript"],"category":"computer-science","key":"cs-basics-boolean","title":"Front End Computer Science Basics: Boolean Logic","description":"Breaking down a math concept at the center of programming","layout":"post","path":"/2018/03/27/cs-basics-boolean/","date":"2018/03/27","dontfeature":null,"isDraft":null},"html":"<p><em>This is the second post in a series of posts on Computer Science basics for front end developers.  The goal is to focus on the practical implications of basic CS theory for JavaScript development.</em></p>\n<p>Modern programmers owe a lot to the efforts of many head in the sky theoretical mathematicians from the 1800s and early 1900s who were searching for mathematical truths and ended up making discoveries that serve as the basis of many modern computing inventions.  Boolean Algebra is one of a few branches of mathematics that was developed for purely theoretical reasons that has ended up shaping the computer revolution.  It fortunately has the virtue of being a relatively approachable to mathematical newbies.</p>\n<p>Boolean algebra is a study of operations on logical values. Or in more understandable language, it is studying the rules of logic when we’re limited to dealing with only 2 types of values, true or false.  The basic building blocks of boolean algebra are incredibly simple: in addition to the true and false values, usually encoded as 0 for false and 1 for true, boolean algebra considers 3 basic operations:</p>\n<ul>\n<li><strong>The “AND” operator (<code class=\"language-text\">∧</code>)</strong> - <code class=\"language-text\">a∧b</code> is true if and only if <code class=\"language-text\">a</code> and <code class=\"language-text\">b</code> are both true.</li>\n<li><strong>The “OR” operator (<code class=\"language-text\">∨</code>)</strong> - <code class=\"language-text\">a∨b</code> is true if at least one of <code class=\"language-text\">a</code> or <code class=\"language-text\">b</code> are true and false otherwise.</li>\n<li><strong>The “NOT” operator (<code class=\"language-text\">¬</code>)</strong> - <code class=\"language-text\">¬</code> is a unary operator. It only affects a single value.  <code class=\"language-text\">¬a</code> is true if <code class=\"language-text\">a</code> is false, and false if <code class=\"language-text\">a</code> is true.</li>\n</ul>\n<p>Of course this is a whole field of mathematics, so the interesting part comes as you start combining these pieces.  Mathematicians have discovered many “laws” that apply to boolean logic.  Some of these will probably look familiar to those of you who took high school algebra.  Here’s a sample of the laws from <a href=\"https://en.wikipedia.org/wiki/Boolean_algebra\">Wikipedia</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/34dcd023c2ef64ea72d2412bb100a68a/394f7/boolean-laws.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.52447552447552%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQ4y5WUiY7CMAxE+f9PBJpCb6UHtAV6AYPGrKuwWqAbKaKY+mU8jlkdDgeEYYgsy9B3HbimaUJd12iaBm3b4ng84nw+y2/3+33ef61VUeQwxiAKwznper0KkIfxs6qq5UAm+b4PYzxR4i5+5z6dTi/xd7AfhQU8z5OSVcntdpNyVaGWf7lcRP0n6CrPWbKPum7kJcLUR1VHCOPcCnoLLMsSu90OZVG+vMRnVaeHLCq5bRokSQyW7pYzDIOoo1K3EV8VPrvsIYqiuZNcfKZv7iHfYE8PrcVms0GaZuj7XoLjOAqMHlKhC/kEmz3cbrfSUS7tMOOMucBFCpnoGwNrcwFpqYTppHAzTuVfgUxK0xTWWrmLmth1nTRFr8q/FK7Xaxk/TgyBBFEVPf2dvMjD/X6POI5lEghx/xj0Di5WSK+CIECSJHJF1EOq5BQt8c0FPgDvi5PAMo702AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Boolean logic laws\"\n        title=\"Boolean logic laws\"\n        src=\"/static/34dcd023c2ef64ea72d2412bb100a68a/432e7/boolean-laws.png\"\n        srcset=\"/static/34dcd023c2ef64ea72d2412bb100a68a/a6b04/boolean-laws.png 143w,\n/static/34dcd023c2ef64ea72d2412bb100a68a/0e2fe/boolean-laws.png 285w,\n/static/34dcd023c2ef64ea72d2412bb100a68a/432e7/boolean-laws.png 570w,\n/static/34dcd023c2ef64ea72d2412bb100a68a/394f7/boolean-laws.png 707w\"\n        sizes=\"(max-width: 570px) 100vw, 570px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The last 3 especially are worth remembering.  Taking them out of mathematical notation for a second and using pseudocode instead, the rules are:</p>\n<ul>\n<li>Double Negation: <code class=\"language-text\">not not x == x</code></li>\n<li>De Morgan 1 <code class=\"language-text\">(not x) and (not y) === not (x or y)</code></li>\n<li>De Morgan 2 <code class=\"language-text\">(not x) or (not y) === not (x and y)</code></li>\n</ul>\n<h3>Boolean Algebra in JavaScript</h3>\n<p>For most JavaScript developers, the preceding description of boolean algebra probably seemed suspiciously familiar.  It turns out that JavaScript has all the base units of boolean algebra in its core language.  True and false are represented by the appropriately named boolean primitives <code class=\"language-text\">true</code> and <code class=\"language-text\">false</code>.  AND, OR, and NOT are represented by <code class=\"language-text\">&amp;&amp;</code>, <code class=\"language-text\">||</code> and <code class=\"language-text\">!</code> respectively.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 305px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6d15c0e5ac4df9209df25439414c2043/a3e09/boolean-mappings.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.545454545454554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbUlEQVQoz62S2W6DQAxF+f/fyluJWMuisqQsSagKZYkEYb2Vnc4oTd6qWhqNjT3H1zMo+Edb1xWK4zjQNB2maaAoPrBXVQRBiKI4Y7fbwbJM6LoOy7JhGgY8z0dxPsN5taGqe46Jkec5tm2DQo7julBfXhjkuS6yLEfbNPB9H0mSMDCOD4iiEGmaoSxLxFEEy7LgeR7X0TdWKOSejkdomoZlWTlelkWOMs/zr9FICdkwDDjEET7LStYpdLBrW064ns/qyMZxxDxN7J9PR9R1w6BpmvjgssxIkneEQcBjE4eWQkmSmqUJNF1H3/fyoFDZti36fuDvVE+LfKo1DANV9SVzihgnT1MYpslwWgJIhZfLRTa6B9JuWzbGcXoGNnWNKIyw/dyfBGJD13VPCqkp7U3Tch3FcmSyMHjj579XSDtBrtcrx49Aiuk6RE4CKaBnr6pKdrpd/K0zPZBoIC5f5KZplA0YeP8bPPp/yX0DG1RN0jALEdYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"mapping of operators between pseudocode, mathematical and JavaScript notation\"\n        title=\"mapping of operators between pseudocode, mathematical and JavaScript notation\"\n        src=\"/static/6d15c0e5ac4df9209df25439414c2043/a3e09/boolean-mappings.png\"\n        srcset=\"/static/6d15c0e5ac4df9209df25439414c2043/a6b04/boolean-mappings.png 143w,\n/static/6d15c0e5ac4df9209df25439414c2043/0e2fe/boolean-mappings.png 285w,\n/static/6d15c0e5ac4df9209df25439414c2043/a3e09/boolean-mappings.png 305w\"\n        sizes=\"(max-width: 305px) 100vw, 305px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>So a JavaScript statement like</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">&amp;&amp;</span> y<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  <span class=\"token comment\">// false</span>\n  <span class=\"token function\">willNeverHappen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>is equivalent to <code class=\"language-text\">x∧y</code> in boolean algebra notation.  But this being JavaScript, there are some quirks and things to know about.</p>\n<p>First of all it’s worth noting that boolean logic in JavaScript is lazy by default.  That means that JavaScript will only evaluate enough of a boolean expression to know what the result will be.  So in an expression like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">alwaysReturnTrue</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">alwaysReturnFalse</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token function\">alwaysReturnFalse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">alwaysReturnTrue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>the function <code class=\"language-text\">alwaysReturnTrue</code> will never be called.  This will matter when we start talking about real world takeaways.</p>\n<p>The second JavaScript quirk gets its own section.  Because booleans get more complicated when they interact with the rest of the JavaScript world.</p>\n<h3>Truthy and Falsy</h3>\n<p>When JavaScript conditionals like the if statement evaluate an expression, they aren’t strictly evaluating to see if something is the boolean values <code class=\"language-text\">true</code> or <code class=\"language-text\">false</code>.   Instead they’re looking to see if the expression is <em>truthy</em> or <em>falsy</em>.  This isn’t the kindergarten version of booleans, instead it’s JavaScript’s way of handling the fact that not all expressions are boolean.  Rather than requiring you to cast your values to boolean or use a statement that produces a boolean, JavaScript instead treats every value as either truthy or falsy.  The rules for this are reasonably consistent and easy to follow once you understand what is happening<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.  It turns out that most values are truthy, so it is easiest to just learn the falsy values.  In JavaScript the falsy values are:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">NaN</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// or \"\"</span>\ndocument<span class=\"token punctuation\">.</span>all <span class=\"token comment\">// Special case browser hack just for fun</span></code></pre></div>\n<p>If an expression that evaluates to one of these values is read into a boolean context like an if statement or ternary, it will be treated as false.  Any other value will be read as true.</p>\n<h3>Implications and Hacks</h3>\n<p>So far we’ve gone through some theory, as well as JavaScript’s own quirks.  But now let’s talk about 3 different implications of this stuff for day to day JavaScript programming.</p>\n<ol>\n<li>\n<p><strong>Shortcuts using the  &#x26;&#x26; and || operators</strong> - It’s fairly common, especially in special context like minified code and JSX expressions in React, to run into code that get’s clever with the lazy behavior of JavaScript boolean operators.  Specifically the <code class=\"language-text\">&amp;&amp;</code> statement often get’s used as an inline if statement like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> userID <span class=\"token operator\">=</span> showID <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">getUserID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>which is equivalent to</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> userID<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showID<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  userID <span class=\"token operator\">=</span> <span class=\"token function\">getUserID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  userID <span class=\"token operator\">=</span> showID<span class=\"token punctuation\">;</span> <span class=\"token comment\">//presumably false or null</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">||</code> statement can be used for a similar purpose, usually to provide a fallback value.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token operator\">=</span> <span class=\"token function\">createNewUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">providedRole</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span>  userRole <span class=\"token operator\">=</span> providedRole <span class=\"token operator\">||</span> <span class=\"token string\">'basic-user'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s important to be careful with this type of use though, because if it would be valid for the user input to be a falsy value like <code class=\"language-text\">''</code>, <code class=\"language-text\">null</code> or <code class=\"language-text\">0</code>, this can introduce subtle bugs.  More on that in a second.</p>\n<p>I wouldn’t personally relying too heavily on this technique.  Besides the possibility of subtle bugs, it isn’t very approachable for new developers, especially if you try nesting logic this way.  But you should know how it works since you will see it, especially in minified code you may need to debug and JSX.</p>\n</li>\n<li>\n<p><strong>!! for casting</strong> - Another common idiom to be aware of is the use of double negation to cast values to a boolean.  It is fairly common when you have code that is expecting a boolean and not just a truthy/falsy value to convert the value to a boolean.  One way to do that is using the <code class=\"language-text\">Boolean</code> constructor, like <code class=\"language-text\">var bool = Boolean(value)</code>, but another method is to use double negation.  The first negation evaluates to the boolean that is opposite the truthy/falsy value, and the second one flips it back to the original truthy/falsy state, but as a boolean.</p>\n<p>I personally find this notation to be less confusing than the <code class=\"language-text\">&amp;&amp;</code>/<code class=\"language-text\">||</code> shortcuts, but your mileage may vary.  Either way, it’s important to understand its role since it is common to find <code class=\"language-text\">!!</code>s in real world code.</p>\n</li>\n<li>\n<p><strong>0s and empty strings are dangerous</strong> - For our last quirk, let’s imagine a code example function <code class=\"language-text\">getCountFromServer</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUserCountFromServer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">let</span> users <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> users<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// if we can't get the count, return null</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This function makes a request from the server, and then returns the number of users, or <code class=\"language-text\">null</code> if it can’t get the value from the server for whatever reason.  Maybe not the best error handling, but certainly something you could see in real world code.  If we want to test to see if this function got data correctly, we have to be careful.  We might want to simplify our testing by taking advantage of <code class=\"language-text\">null</code>’s falsiness like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> userCount <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getUserCountFromServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do something with the info</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//handle the case where the number failed to load</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Do you see the bug?  It’s subtle.  With code written like this, if there are no users it will be treated the same as if the number had failed to load at all.  This is a pretty common bug in situations where a value might be undefined or null, but could also be a number.  Strings have a similar issue.</p>\n<p>It’s important to understand that if 0 or empty strings are a valid value for a variable, you can’t rely on a general falsiness check to see if the value is defined.  Instead it’s better to either define the exact falsy value you expect for “no value” (null in this case) or to check based on type.  For instance in this case, you could rewrite the code to look for a number:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> userCount <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getUserCountFromServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> userCount <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do something with the info</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//handle the case where the number failed to load</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<h3>Feedback Welcome</h3>\n<p>This is the second post in a new series, and I’d love to hear whether it is helpful for you, and any other topics you’d like to see covered. Feel free to reach out on <a href=\"https://twitter.com/_benmccormick\">Twitter</a> or <a href=\"mailto:ben@benmccormick.org\">email</a>.  And if you see anything that looks wrong or misleading to you, don’t hesitate to <a href=\"https://github.com/benmccormick/benmccormickorg/issues/new\">open an issue</a> on my blog’s github repo.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">The exception for me are empty arrays.  They get evaluated as truthy in JavaScript and falsy in Python, and I can never remember which is which without testing.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/03/27/cs-basics-boolean/"}}},{"node":{"frontmatter":{"readNext":"cs-for-fe,large-improvements-small-team,ten-things-js","topics":["Computer Science","javascript"],"category":"computer-science","key":"cs-basics-variables","title":"Front End Computer Science Basics: Variables and Memory","description":"A look at one of the most fundamental building blocks of programming","layout":"post","path":"/2018/03/21/cs-basics-variables/","date":"2018/03/21","dontfeature":null,"isDraft":null},"html":"<p>A few weeks ago, I asked for input on the idea of <a href=\"https://benmccormick.org/2018/02/20/cs-for-fe/\">resources on Computer Science for front end developers</a>.  Because there was a decent amount of interest, I’m planning on fleshing out the idea a bit with a small series of posts on CS basics.  These posts will cover some concepts that would usually be covered in an intro level CS course.  If folks find them helpful I may move on to more advanced topics like Data Structures &#x26; Algorithms, the software abstractions that modern web development is built on top of, and other math/theory topics.</p>\n<p>With these posts I’m not trying to replicate a CS intro course and won’t cover everything.  I’m not trying to teach anyone how to program.  Instead I’m covering the ideas and details behind concepts that FE devs may have learned by doing but never been exposed to from an theory point of view.  I am not an academic, so the goal will be to keep a casual tone focused on the practical implications of theory to a Front End developer.  If I’m successful, these posts will give you a better set of mental models when working to understand the code you’re reading and writing every day.  That’s plenty of throat-clearing, so now I’m going to jump into one of the most fundamental building blocks of any programming language: variables.</p>\n<h3>What are Variables? (Not as obvious as it sounds)</h3>\n<p>Variables in programming languages are symbols that we assign to represent a value.  That seems simple enough, but that sentence is too vague to properly account for the complexity of reality.  When dealing with variables in the real world, it’s important to have a good mental model of how they really behave, or you may become confused by how your programs act.  For instance if you believe that variables are always live references to whatever other variable they were assigned to, you may be surprised by the behavior of this snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// prints 1</span></code></pre></div>\n<p>and if you believe that variables always point to a unique value that is created when you assign to them, you might be surprised by this one:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// prints [1, 2, 3, 4]</span></code></pre></div>\n<p>Knowing generally that a variable points to a value is a great start.  But a proper understanding of the model that a programming language uses for variables can help you avoid subtle bugs.</p>\n<h3>How Variables Work</h3>\n<p>Here’s the most important sentence for gaining a proper understanding of how variables work: “A variable points to a location in memory.”  Explaining how memory is organized and allocated is outside the scope of this post, but for now it’s sufficient to just understand memory as a long list of blocks, each of which has it’s own address.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 465px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13e99029e891d957a0e14cbc732767cc/9ff85/memory1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.97202797202797%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3ElEQVQY03WQSRKCUAxEuaAo+FUGLYeNAzKJlrpXgc+gcuFYHYGNuGigkvRLB2Wwe1CX+ts7LS8Vra4Vzc8vGu4Trv2bbzwKHl1SN3danN8MBHjoJqT+mW0EqKI5MVlRQdNjySbIjkqyo4J66xsJNyEjyFgwWIeC+8JLSd/HPAfpTvxNCMDIl3zS2JcsNCeBZLgR5gwyw5wBbd+XNPLS1ifqCxQUkA5bGyA2zk5PNiK9ech5BtfgjdokyBho19cByAmxHUmEm5JW/1xRn45vQNFDOhgQAH3N+Z0F8AOARRI9bP1W+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"memory as a series of boxes\"\n        title=\"memory as a series of boxes\"\n        src=\"/static/13e99029e891d957a0e14cbc732767cc/9ff85/memory1.png\"\n        srcset=\"/static/13e99029e891d957a0e14cbc732767cc/a6b04/memory1.png 143w,\n/static/13e99029e891d957a0e14cbc732767cc/0e2fe/memory1.png 285w,\n/static/13e99029e891d957a0e14cbc732767cc/9ff85/memory1.png 465w\"\n        sizes=\"(max-width: 465px) 100vw, 465px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When a variable is assigned to, it points to the address of whatever value is on the right hand side of the assignment expression (if newly created, the value is assigned an open address in memory first).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 455px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4599a599b587196cefdcc17831af3d56/379c3/memory2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.05594405594406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVQoz3VSa2+CQBDkBxoV1IJQ01fS1iIFRWPsVxGQV1v7g7eZ4Y7Wpn4Y9jF7c7u3GKNFLtYiE9PPZPiSEoP5gZacn8koyMX0U9ZYv+r+g3G/O8nD25d464bC/fmBghAD58U1+XFwlNnmnT7EB6ruLwyQELL8H+jb0JEJSz9teVVrXoBhR6XYYSF21OIqLNjZ9bqhT75DoXKXYaDN/jOQ0Pae9nK3O8nt9lN6j3tp+aTFWa2Ok+4sRx6qcfBmAJLOspSb7Uc3uub0M+hFIoZFrJfKDt1VzZHcuJbJ65HjYuzZpmGMxQAY111VvNCLmy7WZ9khPtNVxS5RAEAQ24SFoM4DzrLiUiAKoUlYsDsId4LjIGehE5VnwhAzebiSqRJCDr6tamHB47eC4DcPRpusH2qjegAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"assignment of a variable\"\n        title=\"assignment of a variable\"\n        src=\"/static/4599a599b587196cefdcc17831af3d56/379c3/memory2.png\"\n        srcset=\"/static/4599a599b587196cefdcc17831af3d56/a6b04/memory2.png 143w,\n/static/4599a599b587196cefdcc17831af3d56/0e2fe/memory2.png 285w,\n/static/4599a599b587196cefdcc17831af3d56/379c3/memory2.png 455w\"\n        sizes=\"(max-width: 455px) 100vw, 455px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If another variable is assigned to the first variable, it too will point to that same address in memory</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5cfb4d0d375cb6e1a2b69134b5f4a330/3c5de/memory3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.34965034965035%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQoz21SXVPCMBDsH7RaaGlRR+n4YBEoRRysPvhU6BeoxRn/7jp7TVJw+nCTS26ze7eJZUcZLh4z2NEWl9Mtrp52EsylFnU15qeYvrAmrw3CtMHN+gBnlhuiIKnB2iRtJPfiEg/vP7LairgvLD+pMV7tMVpWGC4KDOY5nNkOblzKGcOLK7iLEsGqhresBDOcF71hEcigMsNPKty+fAoRxa7XB1PTuFakFHItqDFWO2LrD4M+hOlRxh8/73G3+VIeZ7CnHc7+57HsOTIJeZlK7ICX7zffiD5+Eb4dRWCkxmSuO2FOi1jT3sujMBFv4lLMJ4Ajs0ue++qMufaUnbsKzyb4BmeEPOBDaN9awsbsaTYv+zJFYUS4JwkFzgjZeqBeWo9P8GCWS+cU5Mo9O2U4ygreo4gh7D5xa2rf39If2+DU3j6paZ4/r4XH9ex1sqQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"assignment of a variable to the value of another variable\"\n        title=\"assignment of a variable to the value of another variable\"\n        src=\"/static/5cfb4d0d375cb6e1a2b69134b5f4a330/3c5de/memory3.png\"\n        srcset=\"/static/5cfb4d0d375cb6e1a2b69134b5f4a330/a6b04/memory3.png 143w,\n/static/5cfb4d0d375cb6e1a2b69134b5f4a330/0e2fe/memory3.png 285w,\n/static/5cfb4d0d375cb6e1a2b69134b5f4a330/3c5de/memory3.png 472w\"\n        sizes=\"(max-width: 472px) 100vw, 472px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Finally if we reassign the original variable, it will point to a new location in memory, and the second variable will continue to point to the same location.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b7783b49ae41d39f74131e6becf25f4/71ce0/memory4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.95104895104895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVQoz6WSWU8CQRCE5we6qwjICgISRUDYlUMQRZ/k2OVG8fe2+ZpZJEYTEx8qPUd1TXf1mJPbsbjVkRCPa7sYI94TQaI+/pF3CHM92Erp8U2y7YUk6hMlO9WhZNtzKfU3UuiupNBbS9IP5erpXfLdlbjV4f6R7zDpIJKzu6mk/EhBIsIpP5RUEMlpYyJw9D6I7Dr8FQbSnmjFL/sbjV5zJsWHtd79FcatjbQFx4JWaZHyicXeWo4qr8pxrR1OZai+u3bt2DtgSEw2QkWus5Sblw81F6/Kz1sVzjRn2jLnsUXYgh0Z7Aqir6GQkOsstBJESGTPMGgZMZLOW3NNJHKGKDEdTHcDtdNXwXx3KeXBVi7ulyqION55rZ2gVmJFAINjzz1fyWvN9z9EBWnDswkQlGyFeIAKOKMKkvEZi5gqa7jx3zSHH/e/QPATYvfJGewo3VQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reassigning the original variable\"\n        title=\"reassigning the original variable\"\n        src=\"/static/2b7783b49ae41d39f74131e6becf25f4/71ce0/memory4.png\"\n        srcset=\"/static/2b7783b49ae41d39f74131e6becf25f4/a6b04/memory4.png 143w,\n/static/2b7783b49ae41d39f74131e6becf25f4/0e2fe/memory4.png 285w,\n/static/2b7783b49ae41d39f74131e6becf25f4/71ce0/memory4.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Function arguments are based on these same concepts.  When a function is called, the argument variables are assigned to point at the memory address of the value passed into the function.</p>\n<h3>Mutable vs Immutable Variables</h3>\n<p>This memory address stuff can seem pretty abstract, and not very useful, but it’s a great gateway to understanding more practical topics.  A while back I wrote a post about <a href=\"https://benmccormick.org/2016/06/04/what-are-mutable-and-immutable-data-structures-2/\">mutable and immutable data</a>.  If you’re unfamiliar with the concepts you can read the original article for background.  But basically, JavaScript values are divided into 2 categories: primitives like booleans, strings, and numbers which are immutable, and objects which are mutable.  Immutable primitives can’t be changed, when they’re operated on they can only be replaced with a new value.  Mutable objects can be changed in place.  That “in place” qualifier can seem a bit hazy without understanding the underlying memory situation, but now we can explain this more clearly: the value for a primitive will never change within a memory location, a variable will instead have to point to a new location in memory.  A mutable variable can be modified without changing it’s location in memory.  This is the explanation behind our confusing example from earlier.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// prints [1, 2, 3, 4]</span></code></pre></div>\n<p>Because <code class=\"language-text\">b</code> points to the same location in memory as <code class=\"language-text\">a</code>, when we mutate <code class=\"language-text\">a</code>, <code class=\"language-text\">b</code> continues to point to the same array as <code class=\"language-text\">a</code> and sees the same changes we performed on <code class=\"language-text\">a</code>.</p>\n<h3>Implications and Gotchas</h3>\n<p>There are a few practical implications of these concepts, and gotchas that folks with the wrong mental model around variables tend to run into.</p>\n<ol>\n<li><strong><code class=\"language-text\">===</code> is based on location in memory for objects</strong> - While it does compare primitive values directly to see if they’re the same value, for objects, <code class=\"language-text\">===</code> compares by reference.  So the following code works in a way that people might not expect if they don’t understand variables.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">sameReference</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> x<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token function\">sameReference</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">===</span> b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">===</span> c<span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">===</span> d<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre></div>\n<ol start=\"2\">\n<li><strong>Modifying objects in functions modifies them outside of the function scope</strong> - This is a pretty common gotcha for folks who don’t understand variables and memory.  When they have a bad mental model of function arguments, you get code like the following made up example.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// function to create a contact that is ready to send</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">formatContactForSend</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">contact</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  contact<span class=\"token punctuation\">.</span>fullName <span class=\"token operator\">=</span> contact<span class=\"token punctuation\">.</span>firstName <span class=\"token operator\">+</span> contact<span class=\"token punctuation\">.</span>lastName<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">delete</span> contact<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> contact<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// get a contact from somewhere</span>\n<span class=\"token keyword\">let</span> newContact <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">firstName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Ben'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">lastName</span><span class=\"token operator\">:</span> <span class=\"token string\">'McCormick'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// send along the formatted version of the contact</span>\n<span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token function\">formatContactForSend</span><span class=\"token punctuation\">(</span>newContact<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//oops</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>newContact<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">/* {\n  firstName: \"Ben\",\n  lastName: \"McCormick\",\n  fullName: \"Ben McCormick\"\n}\n*/</span></code></pre></div>\n<ol start=\"3\">\n<li><strong><code class=\"language-text\">const</code> isn’t really a constant</strong> - <a href=\"https://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning/\">ES6</a> introduced the new keywords for declaring variables <code class=\"language-text\">let</code> and <code class=\"language-text\">const</code>.  Both help with issues around variable scoping<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>, but the difference between the two can seem rather confusing.  It seems like <code class=\"language-text\">const</code> might indicate a constant value that can’t be changed.  But mutable values declared with const can in fact change:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\narr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span> <span class=\"token comment\">// [1, 2, 3, 4]</span></code></pre></div>\n<p>Instead <code class=\"language-text\">const</code> is once again about memory and reference assignment.  A variable that is assigned through const can’t be reassigned to a new location in memory.  So if it is pointed to a primitive like <code class=\"language-text\">123</code> or <code class=\"language-text\">true</code>, it truly is a constant, because the value can’t change. But when it’s pointed to a mutable value, it’s reference won’t change, and it will always <code class=\"language-text\">===</code> any variables that have been assigned to it, but the actual contents of that memory can change.</p>\n<h3>Feedback is lovely</h3>\n<p>This is a new series, and I’d love to hear whether it is helpful for you, and any other topics you’d like to see covered. Feel free to reach out on <a href=\"https://twitter.com/_benmccormick\">Twitter</a> or <a href=\"mailto:ben@benmccormick.org\">email</a><sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">A topic for a different post<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">My carrier pidgeons have all fled their coop. I do promise that if you send me smoke signals I will sit back and ponder their meaning. Right after calling the fire department.<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2018/03/21/cs-basics-variables/"}}}],"topic":"javascript"}},
    "staticQueryHashes": []}