webpackJsonp([69690984481617],{899:function(n,a){n.exports={pathContext:{posts:[{node:{frontmatter:{readNext:null,topics:["Math","Jest","Gatsby"],category:"opinion",key:"weekly-links-12-23-17",title:"Weekly Links: December 23rd 2017",description:"Math in JS, Google vs Apple Maps, and cheating at Settlers",layout:"weekly-links",path:"/2017/12/23/weekly-links-12-23-17/",date:"2017/12/23",dontfeature:null,isDraft:null},html:'<h3>JavaScript And The Web</h3>\n<p><a href="http://raganwald.com/2017/12/14/73939133.html">73,939,133 / Truncatable Primes | Reg Braithwaite</a> - A nice writeup about how brute force can be useful in solving a <a href="https://projecteuler.net/">Project Euler</a> style math problem.</p>\n<h3>Programming Tools and Practices</h3>\n<p><a href="http://facebook.github.io/jest/blog/2017/12/18/jest-22.html">Jest 22: Refinements &#x26; Custom Runners | Jest Blog</a> - This looks like a solid refinement release for Jest.  One warning: If you’re running <code>jest -o</code> on precommit hooks as I described <a href="https://benmccormick.org/2017/02/26/running-jest-tests-before-each-git-commit/">here</a>, Jest 22 fails when run with 0 tests, so you need to specify the <code>--passWithNoTests</code> flag in order to let things go when you make a change that doesn’t affect any tests.</p>\n<p><a href="https://www.gatsbyjs.org/blog/2017-12-20-introducing-the-gatsby-ux-research-program/">Introducing The Gatsby UX Research Program | Gatsby Blog</a> - An unusual case of doing real UX research for an open source developer tool.  Very cool stuff.</p>\n<h3>Non-Tech</h3>\n<p><a href="https://www.justinobeirne.com/google-maps-moat">Google Maps’s Moat</a> - If you have any interest in product design, maps, or computer intelligence, this is the one article you need to read this week.  Beautifully put together.  It’s an in depth examination of the difference between Google and Apple maps, but it reads as a deeper exploration of how big data combined with computer learning and automation can have a huge impact on product design.</p>\n<p><a href="https://izbicki.me/blog/how-to-cheat-at-settlers-of-catan-by-loading-the-dice-and-prove-it-with-p-values.html">How to cheat at settlers by loading the dice | Mike Izbicki</a> - This is just a fun application of statistics to my favorite board game.</p>',fields:{slug:"/2017/12/23/weekly-links-12-23-17/"}}},{node:{frontmatter:{readNext:"jest-first,react-component-styles,mobx-first",topics:["JavaScript","Highcharts","Math"],category:"frameworks",key:"highcharts-normal",title:"Building Normal Distribution Charts Using Highcharts",description:"Creating a statistical visualization in JavaScript",layout:"post",path:"/2017/05/11/building-normal-curves-highcharts/",date:"2017-05-12T02:30:00+00:00",dontfeature:null,isDraft:null},html:'<p>This week I got to have a little fun remembering some High School math, and using one of my favorite libraries: <a href="https://www.highcharts.com/">Highcharts</a>.  Highcharts is a commercial JavaScript data-viz library, and it makes most standard charts and graphs a breeze to implement.  I was using it to plot a normal distribution in order to display a 95% confidence interval.  It’s a pretty straightforward problem, but its a nice example of a practical use of Highcharts, and comes with a little stats math that many of us may have learned and forgotten.</p>\n<h3>The Problem</h3>\n<p>The goal was to display a <a href="https://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a> to represent a 95% confidence interval, given the upper and lower bounds of the confidence interval.  A normal distribution is the classic bell curve, where the area under any section of the graph represents the probability that the true value of the measure being tracked is within that range.  These curves are usually represented something like this:</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/confidence-interval-3c13198254a7cdabc416bd2aa060cb7b-4c4f6.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 499px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 66.73346693386773%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABx0lEQVQoz42Sy07CQBSGeRA3xhhBNF4I6CO4cmFc+BS6cesLuDHGK4zaYIqJJt4XKqAoFQKO9cKl1Bhtg6lg1VbAS6C0OG0jUayJJ5PJ3zP/N2fOSU0Vo1AUdd+9oHfPKPWzYhym3ylZQyn2rmViB62La6aa/A+s7sOrR81YxOo+GVwOVGRJ+U9lvcLNHWef8Xbi0IbDjlkfzaQNi9fCZc0x5Y82ugiHBzpwiMTYXqR69CesaMeF3Esv5mt1R21YyIaF23CyZ96LklWDMVzW2t2IXFrAcfv4dsPQaNMI6HQdml3BldB51WAA67cW398GFv0tbmhbINqmfR0ggETrIuzDvB+FfE3nppohO/3RZkB0eU7tOHQskXZNdHugZY6Y9IZV2/fKsixLklQqlbhMJsPe9Ds366YPrXOEBRBmF2EGQTMgrCBYD8J9zq1bmsryfLFYRAgCTaIoMgxD0zRFpYSnp30ytgYTm2idJpePydVIDIkNmFiHyQMy/sg/pFIpZGZZVhCEb8+WZe4+e0XFT8IhPcM/ZO85Tte5XD4RjwUCBz8GpnwFgp9FMZ1m0ROkstrasyDw/KP2byv5wivLMslkQtFGq8cnZS6ksmo1Lv8AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Normal Distribution image"\n        title=""\n        src="/static/confidence-interval-3c13198254a7cdabc416bd2aa060cb7b-4c4f6.png"\n        srcset="/static/confidence-interval-3c13198254a7cdabc416bd2aa060cb7b-73dd7.png 143w,\n/static/confidence-interval-3c13198254a7cdabc416bd2aa060cb7b-17358.png 285w,\n/static/confidence-interval-3c13198254a7cdabc416bd2aa060cb7b-4c4f6.png 499w"\n        sizes="(max-width: 499px) 100vw, 499px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The x axis of the curve represents the range of values, while the y axis is a function of x that shows the relative probability for different areas.  Data sets that are normally distributed conform to the above bell curve and the <a href="https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule">68-95-99.7 rule</a>. There’s a 68% chance that the true value is within 1 standard deviation of the middle of the curve (the mean), a 95% chance that the true value is within 2 standard deviations, and a 99.7% chance that the true value is within 3 standard deviations.</p>\n<h3>Step 1: Generating a Dataset</h3>\n<p>Highcharts operates by plotting a set of data points, not by handling equations directly.  So our first step is computing a set of data points to plot.  We can find the equation for calculating a normal distribution’s probability density on <a href="https://en.wikipedia.org/wiki/Normal_distribution">Wikipedia</a>.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/equation-6a389461177782c04eacef4eb7226e50-6eea4.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 510px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABDUlEQVQoz51Ra4+DIBD0//+6+3JtmrTqgaL06gM0ggjOwTb90Euae0wyYQns7O5sxoTCqVS4cI2ynlFUI0RdQQiBqqpQRxZFgaIs0XUd9n1HwuP8jmxZDJzzWIwlui3GywLvPYZhIFHnHN1DCD8LStlSopQS0zRBjSMOhyN1k4S11k8JSegV4yuyeZ4peMBEke52o67+iqSZNU0Txww0kts2+ACicxusNTDmznVdn2jX+L56KmzsPaYORRQ8M4Wc98hZh7dTh/dzD/nZo20EGONgHwypcFpQ8rRtW/BGo6g1WVU1Cixy3wMyzuMW+YBjPsYPE0ox4dob/AfJx0ypEddbqjCjV/ZX5r9eCvAFxfBsjxWhI3oAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Normal Distribution equation"\n        title=""\n        src="/static/equation-6a389461177782c04eacef4eb7226e50-6eea4.png"\n        srcset="/static/equation-6a389461177782c04eacef4eb7226e50-dab4a.png 143w,\n/static/equation-6a389461177782c04eacef4eb7226e50-e69c1.png 285w,\n/static/equation-6a389461177782c04eacef4eb7226e50-6eea4.png 510w"\n        sizes="(max-width: 510px) 100vw, 510px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Yep, we get to play with an equation that has both π and e in it.  I hope this feels sufficiently like a high school math class now.  But we can actually choose to drop the left side of the equation.  It is the <a href="https://en.wikipedia.org/wiki/Normalizing_constant">normalization constant</a> for the equation: it ensures that the total area under the curve equals 1, but doesn’t change the shape of the curve.  Since we’re simply displaying the shape of the graph and care primarily about showing the range along the x axis, we can ignore it and instead use this function:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">normalY</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> stdDev<span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> stdDev<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>That’s a good start, but right now we only have an upper and lower bound value for a 95% confidence interval.  So before we can apply the equation, we need to find a mean, a standard deviation, and a set of x values to run the formula against.  The mean and standard deviation are fairly straightforward, and we can use lodash to generate a set of points.  For the sake of this example, we’ll plan on generating 100 points ranging from +/- 5 standard deviations from the mean, which should allow us to see all meaningful parts of the distribution, and still have a bit of padding.  </p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getMean</span> <span class="token operator">=</span> <span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>upperBound <span class="token operator">+</span> lowerBound<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n<span class="token comment">// distance between mean and each bound of a 95% confidence interval</span>\n<span class="token comment">// is 2 stdDeviation, so distance between the bounds is 4</span>\n<span class="token keyword">const</span> <span class="token function-variable function">getStdDeviation</span> <span class="token operator">=</span> <span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>upperBound <span class="token operator">-</span> lowerBound<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>\n\n\n<span class="token keyword">const</span> <span class="token function-variable function">generatePoints</span> <span class="token operator">=</span> <span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> stdDev <span class="token operator">=</span> <span class="token function">getStdDeviation</span><span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> min <span class="token operator">=</span> lowerBound <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> stdDev<span class="token punctuation">;</span>\n  <span class="token keyword">let</span> max <span class="token operator">=</span> upperBound <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> stdDev<span class="token punctuation">;</span>\n  <span class="token keyword">let</span> unit <span class="token operator">=</span> max <span class="token operator">-</span> min <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> max<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>Now that we have the x axis locations for the points, we can generate a whole data series.  </p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">let</span> mean <span class="token operator">=</span> <span class="token function">getMean</span><span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> stdDev <span class="token operator">=</span> <span class="token function">getStdDeviation</span><span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token function">generatePoints</span><span class="token punctuation">(</span>lowerBound<span class="token punctuation">,</span> upperBound<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n<span class="token keyword">let</span> seriesData <span class="token operator">=</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token function">normalY</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> stdDev<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<h3>Step 2: Creating the Chart</h3>\n<p>Now we have what we need to generate a chart!  Given the data, It’s easy to make a simple normal distribution curve with highcharts.  All we need to do is create a <code>&#x3C;div id="container"></code> element and then run this JavaScript:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code>Highcharts<span class="token punctuation">.</span><span class="token function">chart</span><span class="token punctuation">(</span><span class="token string">\'container\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    chart<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        type<span class="token punctuation">:</span> <span class="token string">\'area\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    series<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n        data<span class="token punctuation">:</span> seriesData<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>Which produces the following graph:</p>\n<iframe width="100%" height="400" src="//jsfiddle.net/ben336/8bgm1m18/embedded/result,js/"\nallowfullscreen="allowfullscreen" frameborder="0"></iframe>\n<p>Thats a good start, but contains a lot of “stuff” that Highcharts provides by default that we don’t necessarily want for our normal distribution illustration.  Let’s cut the title, legend, y-axis, and tooltips/mouse action.  To do that we need a bit more configuration:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code>Highcharts<span class="token punctuation">.</span><span class="token function">chart</span><span class="token punctuation">(</span><span class="token string">\'container\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    chart<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        type<span class="token punctuation">:</span> <span class="token string">\'area\'</span><span class="token punctuation">,</span>\n        height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        text<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    yAxis<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      labels<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   \n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      gridLineWidth<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    tooltip<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n       enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    legend<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    series<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n        data<span class="token punctuation">:</span> seriesData<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    plotOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      area<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        enableMouseTracking<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<iframe width="100%" height="400" src="//jsfiddle.net/ben336/w7165m2u/embedded/result,js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>\n<p>This is pretty great, but we still want to show our confidence interval like the wikipedia image at the top.  Ideally we’d only be filling in the areas within the 95% curve.  Thats pretty easy to do with Highcharts.  We can use <em>zones</em>, Highcharts way of applying different styles to different sections of the chart.  We want our zones to apply to the x axis, and we’ll define 3 zones: 0 to the lower bound, lower bound to the upper bound, and everything else.  In Highcharts that looks like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token punctuation">{</span>\n  plotOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    area<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      zones<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n        <span class="token comment">//fillColor gets the inside of the graph, color would change the lines</span>\n        fillColor<span class="token punctuation">:</span> <span class="token string">\'white\'</span><span class="token punctuation">,</span>\n        <span class="token comment">// everything below this value has this style applied to it</span>\n        value<span class="token punctuation">:</span> lowerBound<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>\n        value<span class="token punctuation">:</span> upperBound<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>\n        fillColor<span class="token punctuation">:</span> <span class="token string">\'white\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>We also want to show a 95% label on the graph like the image at the start.  There are multiple ways to do that in Highcharts, but for this simple case we’ll just abuse the title attribute and move it down into the middle of the chart:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token punctuation">{</span>\n    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        text<span class="token punctuation">:</span> <span class="token string">\'95%\'</span><span class="token punctuation">,</span>\n        y<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<iframe width="100%" height="400" src="//jsfiddle.net/ben336/81kb997x/embedded/result,js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>\n<p>And with that we’ve taken our original inputs and produced a dynamic illustration of a confidence interval that matches the image we started with.  </p>\n<h3>More Resources</h3>\n<ul>\n<li>\n<p>Highcharts has great <a href="http://api.highcharts.com/highcharts/">documentation</a> and you can see more <a href="https://www.highcharts.com/demo">demos</a> on their site, both for Highcharts and their stock and map chart variants.  Note that Highcharts is not free for commercial use.  I’ve found that it is well worth the money though for any team that is going to be doing many data visualizations, especially if its using relatively standard forms of data visualizations on variable data.  </p>\n</li>\n<li>\n<p>If you need more freeform visualizations, <a href="https://d3js.org/">d3</a> is a great place to look.  Here’s an example of D3 being used to draw a similar chart: <a href="http://bl.ocks.org/phil-pedruco/88cb8a51cdce45f13c7e">http://bl.ocks.org/phil-pedruco/88cb8a51cdce45f13c7e</a>  It’s more involved than the Highcharts example, but allows for more flexibility as a result.  And unlike Highcharts, its free to use for anything.  </p>\n</li>\n</ul>',fields:{slug:"/2017/05/11/building-normal-curves-highcharts/"}}},{node:{frontmatter:{readNext:"ten-things-js,favorite-interview,following-js-roadmap",topics:["JavaScript","Math"],category:"javascript",key:"sieveoferatosthenes",title:"Implementing The Sieve Of Eratosthenes in JavaScript",description:"Generating a series of prime numbers",layout:"post",path:"/2017/11/28/sieveoferatosthenes/",date:"2017/11/28",dontfeature:null,isDraft:null},html:'<p>As a way of keeping my math skills sharp, I’ve recently started to work through the <a href="https://projecteuler.net/">Project Euler</a> set of computational math problems.  They ask you not to post your work publicly, so I won’t be posting about any of my specific solutions, but I did think it would be fun to share about a helper method I’ve been using.</p>\n<p>For several of the Project Euler problems I’ve worked on, I needed to be able to generate a list of prime numbers.  To do that, I borrowed a Python implementation of the Sieve Of Erathosthenes from <a href="https://stackoverflow.com/a/568618/1424361">this StackOverflow answer</a>.  Since I haven’t had much reason to use generators in JavaScript yet, I thought it would be fun to translate that algorithm to JavaScript and share that here.</p>\n<h3>Sieve of Eratosthenes</h3>\n<p>The Sieve of Erathosthenes is a very old<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> simple algorithm for identifying prime numbers.  In its normal implementation it is a useful way of finding small primes up to a certain number.  Beginning at 2, the algorithm iterates upward.  For the current number, if the number has not been marked, we identify it as a prime, and then mark all multiples of that number up to our target number.  So to find all primes up to 12, we would</p>\n<ul>\n<li>start at 2, note <strong>2</strong> as prime, and mark 4, 6, 8, 10 and 12 as non-prime</li>\n<li>move to 3, note <strong>3</strong> as prime, and mark 6, 9, 12 as non-prime</li>\n<li>move to 4, see that it is marked, and skip it</li>\n<li>move to 5, note <strong>5</strong> as prime and mark 10 as non-prime</li>\n<li>move to 6, see that it is marked and skip it</li>\n<li>move to 7 , note <strong>7</strong> as prime</li>\n<li>see that 8-10 are marked and skip them</li>\n<li>move to 11, note <strong>11</strong> as prime</li>\n<li>move to 12, see that it is marked and skip it</li>\n</ul>\n<p>You can see it graphically with this visualization from <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Wikipedia</a>:</p>\n<p><img src="/sieve-animation-6420e3488e509dce176a1e957ea07ff5.gif" alt="sieve animation, shows the numbers being marked visually"></p>\n<h3>Python Implementation</h3>\n<p>The Python implementation that I used makes some modifications to the classic version of the algorithm that lets it generate an indefinite number of primes while being memory efficient</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">gen_primes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">""" Generate an infinite sequence of prime numbers."""</span>\n    marked_not_prime <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    value_to_check <span class="token operator">=</span> <span class="token number">2</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> value_to_check <span class="token operator">not</span> <span class="token keyword">in</span> marked_not_prime<span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> value_to_check\n            marked_not_prime<span class="token punctuation">[</span>value_to_check <span class="token operator">*</span> value_to_check<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>value_to_check<span class="token punctuation">]</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">for</span> prime <span class="token keyword">in</span> marked_not_prime<span class="token punctuation">[</span>value_to_check<span class="token punctuation">]</span><span class="token punctuation">:</span>\n                marked_not_prime<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>prime <span class="token operator">+</span> value_to_check<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>prime<span class="token punctuation">)</span>\n            <span class="token keyword">del</span> marked_not_prime<span class="token punctuation">[</span>value_to_check<span class="token punctuation">]</span>\n        value_to_check <span class="token operator">+=</span> <span class="token number">1</span>\n</code></pre>\n      </div>\n<p>This version of the algorithm keeps a running set of the relevant matches, and keeps only the ones it needs.  We can translate it more or less directly to JavaScript like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatePrimes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> markedNotPrime <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> valueToCheck <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>valueToCheck <span class="token keyword">in</span> markedNotPrime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">yield</span> valueToCheck\n            markedNotPrime<span class="token punctuation">[</span>valueToCheck<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> primes <span class="token operator">=</span>markedNotPrime<span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span><span class="token punctuation">;</span>\n            primes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prime<span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">let</span> nextMultipleOfPrime <span class="token operator">=</span> prime <span class="token operator">+</span> valueToCheck<span class="token punctuation">;</span>\n                <span class="token keyword">if</span> <span class="token punctuation">(</span>nextMultipleOfPrime <span class="token keyword">in</span> markedNotPrime<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    markedNotPrime<span class="token punctuation">[</span>nextMultipleOfPrime<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>prime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                    markedNotPrime<span class="token punctuation">[</span>nextMultipleOfPrime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>prime<span class="token punctuation">]</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token keyword">delete</span> markedNotPrime<span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        valueToCheck <span class="token operator">+=</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>Let’s break down what this is doing.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatePrimes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">//...</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p><code>generatePrimes</code> is a JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator">generator</a>.  Generators “generate” a series of values in a “just in time” fashion; they only calculate the next value when it is needed, making them an efficient solution for working with large or infinite series.  You specify a generator function by adding the <code>*</code> to the function declaration.  Generators then use the <code>yield</code> keyword rather than <code>return</code> to return their values, and can <code>yield</code> multiple times. After a generator yields, it pauses execution until it is asked for another value.  For our <code>generatePrimes</code> function, we are operating inside an infinite loop and will yield continuously without stopping<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">const</span> markedNotPrime <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> valueToCheck <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//...</span>\n    valueToCheck <span class="token operator">+=</span> <span class="token number">1</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>We’re using a plain object to keep track of our marked numbers, and using <code>valueToCheck</code> to keep track of where we are in iterating through numbers. As noted, we will iterate it forever if the generator continues to be called.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>valueToCheck <span class="token keyword">in</span> markedNotPrime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">yield</span> valueToCheck\n    markedNotPrime<span class="token punctuation">[</span>valueToCheck<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  <span class="token comment">//...</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>As in the original algorithm, if we get to a number that isn’t marked, we know that it is a prime.  So we <code>yield</code> it, which pauses execution.  If the generator is queried again, when we resume execution we mark the prime squared as not-prime, and we do that by assigning it an array with the current prime value in it.  Using arrays for markers will make more sense in a moment. For now its worth noting that we only need to mark prime-squared as non-prime since every multiple below that is the current prime multiplied by a number less than it, which means it will already be covered, as we will see below.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>valueToCheck <span class="token keyword">in</span> markedNotPrime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">//...</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> primes <span class="token operator">=</span> markedNotPrime<span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    primes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prime <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> nextMultipleOfPrime <span class="token operator">=</span> prime <span class="token operator">+</span> valueToCheck<span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextMultipleOfPrime <span class="token keyword">in</span> markedNotPrime<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            markedNotPrime<span class="token punctuation">[</span>nextMultipleOfPrime<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>prime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            markedNotPrime<span class="token punctuation">[</span>nextMultipleOfPrime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>prime<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">delete</span> markedNotPrime<span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>Here’s the clever part of this implementation.  When we hit a number that is marked as not-prime, instead of just skipping it and moving on, we use some logic to keep our list of marked values small and memory efficient. This is also what allows us to get an infinite list of primes instead of settling for those under a particular value.  What we want to do is keep a list of all the primes that are factors of each marked number.  Then when we hit a number that is marked, we mark the next multiple for each prime (<code>valueToCheck + prime</code>), and remove the current value from the object.  That keeps checks fairly cheap by eliminating the number of marked numbers, and allows us to only add values to the marked list as we need them.</p>\n<p>We can then use this code to get the 1,000,001st prime like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">let</span> gen <span class="token operator">=</span> <span class="token function">generatePrimes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">1000000</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p>That executed on my laptop in ~20seconds, approximately the same as the python implementation in python2, a little slower than running it under python3.  I was curious whether using a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a> for our marked prime list would speed things up:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generatePrimes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> markedNotPrimeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> valueToCheck <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>markedNotPrimeMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">yield</span> valueToCheck\n            markedNotPrimeMap<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>valueToCheck<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>valueToCheck<span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> primes <span class="token operator">=</span>markedNotPrimeMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">)</span>\n            primes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prime<span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">let</span> nextMultipleOfPrime <span class="token operator">=</span> prime <span class="token operator">+</span> valueToCheck<span class="token punctuation">;</span>\n                <span class="token keyword">if</span> <span class="token punctuation">(</span>markedNotPrimeMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>nextMultipleOfPrime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    markedNotPrimeMap<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>nextMultipleOfPrime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>prime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                    markedNotPrimeMap<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>nextMultipleOfPrime<span class="token punctuation">,</span> <span class="token punctuation">[</span>prime<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            markedNotPrimeMap<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>valueToCheck<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        valueToCheck <span class="token operator">+=</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>This version of the code runs about 25% faster, in 15 seconds on my machine. Not bad.</p>\n<h3>More Resources</h3>\n<ul>\n<li>You can dig in more on the Sieve of Erosthenes on <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Wikipedia</a></li>\n<li>Check out <a href="https://projecteuler.net/">Project Euler</a> for some fun computational math problems.</li>\n</ul>\n<div class="footnotes">\n<hr>\n<ol>\n<li id="fn-1">\n<p>There are references as old as ~100 AD</p>\n<a href="#fnref-1" class="footnote-backref">↩</a>\n</li>\n<li id="fn-2">\n<p>At least until we hit system boundaries for memory/number size/etc.</p>\n<a href="#fnref-2" class="footnote-backref">↩</a>\n</li>\n</ol>\n</div>',
fields:{slug:"/2017/11/28/sieveoferatosthenes/"}}}],topic:"Math"}}}});
//# sourceMappingURL=path---topics-math-68a565b6fd92b2abb64a.js.map