<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#57a3e8"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><script type="text/javascript" src="//use.typekit.net/msd6bqv.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><title data-react-helmet="true">Adding RSS, Atom, and JSON Feed to Gatsby | benmccormick.org</title><meta data-react-helmet="true" name="description" content="How to support subscription feeds with Gastby"/><meta data-react-helmet="true" name="keywords" content="rss atom json feed gatsby"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:site" content="@benmccormickorg"/><meta data-react-helmet="true" name="twitter:creator" content="@ben336"/><meta data-react-helmet="true" name="twitter:title" content="Adding RSS, Atom, and JSON Feed to Gatsby"/><meta data-react-helmet="true" name="twitter:description" content="How to support subscription feeds with Gastby"/><meta data-react-helmet="true" name="twitter:image" content="http://benmccormick.org/logo.png"/><script data-react-helmet="true" type="application/ld+json">{
                "@context": "http://schema.org"
                "@type": "BlogPosting",
                "headline": "Adding RSS, Atom, and JSON Feed to Gatsby",
                "genre": "Software Development",
                "keywords": "rss atom json feed gatsby",
                "url": "http://benmccormick.org/2017/06/03/rss-atom-json-gatsby/",
                "image": "http://benmccormick.org/logo.png",
                "datePublished": "2017-06-3",
                "description": "How to support subscription feeds with Gastby",
                "articleBody": "<p>For the last few months, this blog has been written in <a href=\"https://github.com/gatsbyjs/gatsby\">Gatsby</a>, a static site generator for JavaScript.  One of the first problems I had to solve when migrating the blog was how to maintain my RSS feed, since Gatsby doesn’t have any built in concept of an RSS feed.  This issue came up again this week as I decided to implement the new <a href=\"https://jsonfeed.org/\">JSON Feed</a> spec and give folks an additional option for subscribing to this blog.  Fortunately this turns out to be a pretty easy problem to solve because of the excellent npm module <a href=\"https://github.com/jpmonette/feed\">feed</a>.</p>
<p><em>feed</em> is an npm module that takes a bunch of information about a blog and its posts, and normalizes them into various syndication feed format.  Here’s what setting up a feed option looks like for this blog:</p>
<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'fs'</span>);
<span class=\"hljs-keyword\">const</span> Feed = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'feed'</span>);
<span class=\"hljs-keyword\">const</span> filter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/filter'</span>);
<span class=\"hljs-keyword\">const</span> sortBy = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/sortBy'</span>);
<span class=\"hljs-keyword\">const</span> forEach = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/forEach'</span>);
<span class=\"hljs-keyword\">const</span> get = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/get'</span>);
<span class=\"hljs-keyword\">const</span> moment = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'moment'</span>);
<span class=\"hljs-keyword\">const</span> markdownIt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'markdown-it'</span>);
<span class=\"hljs-keyword\">const</span> frontmatter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'front-matter'</span>);


<span class=\"hljs-comment\">//markdownIt is a markdown parser that takes my raw md files and</span>
<span class=\"hljs-comment\">//translates them into HTML that we can use in the feed</span>
<span class=\"hljs-keyword\">const</span> md = markdownIt({
  <span class=\"hljs-attr\">html</span>: <span class=\"hljs-literal\">true</span>,
  <span class=\"hljs-attr\">linkify</span>: <span class=\"hljs-literal\">true</span>,
  <span class=\"hljs-attr\">typographer</span>: <span class=\"hljs-literal\">true</span>,
});


<span class=\"hljs-comment\">// getPageContent is a function to help us grab the html content from a post path</span>
<span class=\"hljs-keyword\">const</span> getPageContent = <span class=\"hljs-function\"><span class=\"hljs-params\">page</span> =&gt;</span> {
  <span class=\"hljs-keyword\">let</span> file = fs.readFileSync(__dirname + <span class=\"hljs-string\">'/pages/'</span> + page.requirePath, <span class=\"hljs-string\">'utf-8'</span>);
  <span class=\"hljs-keyword\">let</span> body = md.render(frontmatter(file).body);
  <span class=\"hljs-comment\">// handle local links</span>
  <span class=\"hljs-keyword\">return</span> body.replace(<span class=\"hljs-regexp\">/src=\"\//g</span>, <span class=\"hljs-string\">'src=\"http://benmccormick.org/'</span>);
};

<span class=\"hljs-comment\">// build feed is our main function to build a `Feed` object which we</span>
<span class=\"hljs-comment\">// can then serialize into various formats</span>
<span class=\"hljs-keyword\">const</span> buildFeed = <span class=\"hljs-function\"><span class=\"hljs-params\">pages</span> =&gt;</span> {
  <span class=\"hljs-keyword\">let</span> feed = <span class=\"hljs-keyword\">new</span> Feed({
    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">'benmccormick.org'</span>,
    <span class=\"hljs-attr\">description</span>: <span class=\"hljs-string\">'A blog by Ben McCormick'</span>,
    <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'http://benmccormick.org'</span>,
    <span class=\"hljs-attr\">id</span>: <span class=\"hljs-string\">'http://benmccormick.org'</span>,
    <span class=\"hljs-attr\">copyright</span>: <span class=\"hljs-string\">'All rights reserved 2016, Ben McCormick'</span>,
    <span class=\"hljs-attr\">feedLinks</span>: {
      <span class=\"hljs-attr\">atom</span>: <span class=\"hljs-string\">'http://benmccormick.org/atom.xml'</span>,
      <span class=\"hljs-attr\">json</span>: <span class=\"hljs-string\">'http://benmccormick.org/feed.json'</span>,
    },
    <span class=\"hljs-attr\">author</span>: {
      <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'Ben McCormick'</span>,
      <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">'ben@benmccormick.org'</span>
    }
  });
  <span class=\"hljs-comment\">// ignore pages (non posts) </span>
  pages = filter(pages, p =&gt; ( !(get(p, <span class=\"hljs-string\">'data.layout'</span>, <span class=\"hljs-string\">'page'</span>) === <span class=\"hljs-string\">'page'</span>)));
  <span class=\"hljs-comment\">// we only want the last 10 articles to show up in the feed</span>
  pages = sortBy(pages, page =&gt; get(page, <span class=\"hljs-string\">'data.date'</span>));
  pages = pages.reverse();
  pages = pages.slice(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">10</span>);

  forEach(pages, page =&gt; feed.addItem({
    <span class=\"hljs-attr\">title</span>: page.data.title,
    <span class=\"hljs-attr\">id</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span> + page.path,
    <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span> + page.path,
    <span class=\"hljs-attr\">date</span>: moment(page.data.date).toDate(),
    <span class=\"hljs-attr\">content</span>: getPageContent(page),
    <span class=\"hljs-attr\">author</span>: [
      {
        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'Ben McCormick'</span>,
        <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">'ben@benmccormick.org'</span>,
        <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span>
      }
    ]
  }));
  feed.addContributor({
    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'Ben McCormick'</span>,
    <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">'ben@benmccormick.org'</span>,
    <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span>
  });
  <span class=\"hljs-keyword\">return</span> feed;
};
</code></pre>
<p>Now we have a <code>buildFeed</code> method that takes a list of pages and generates a feed object.  Then we can use the feed object we’ve created to actually build write some files.  We’ll trigger that in the <code>postBuild</code> callback of <code>gatsby-node</code>.  Here was my first version to support RSS and Atom:</p>
<pre><code class=\"language-javascript\">
<span class=\"hljs-comment\">//mkDir and mkFile are just light wrappers around node's file system APIs</span>
<span class=\"hljs-keyword\">let</span> createRSSFolder = <span class=\"hljs-function\"><span class=\"hljs-params\">()</span> =&gt;</span> mkDir(<span class=\"hljs-string\">'/public/rss/'</span>);
<span class=\"hljs-keyword\">let</span> generateAtomFeed = <span class=\"hljs-function\">(<span class=\"hljs-params\">feed</span>) =&gt;</span> mkFile(<span class=\"hljs-string\">'/public/atom.xml'</span>, feed.atom1());
<span class=\"hljs-keyword\">let</span> generateRSS = <span class=\"hljs-function\">(<span class=\"hljs-params\">feed</span>) =&gt;</span> mkFile(<span class=\"hljs-string\">'/public/rss/index.xml'</span>, feed.rss2());

exports.postBuild = <span class=\"hljs-function\"><span class=\"hljs-params\">pages</span> =&gt;</span> {
  <span class=\"hljs-keyword\">let</span> feed = buildFeed(pages);
  createRSSFolder();
  generateAtomFeed(feed);
  generateRSS(feed);
};
</code></pre>
<p>Prior to this week, <code>feed</code> didn’t support JSON Feed, so I had stopped here.  But because JSON Feed is super simple to implement (its just JSON!), I decided to try to add it to <code>feed</code> this week.  It turned out it was as simple as adding a single function that looks like this:</p>
<pre><code class=\"language-javascript\">json1() {
   <span class=\"hljs-keyword\">const</span> { options, items } = <span class=\"hljs-keyword\">this</span>
   <span class=\"hljs-keyword\">let</span> feed = {
     <span class=\"hljs-attr\">version</span>: <span class=\"hljs-string\">'https://jsonfeed.org/version/1'</span>,
     <span class=\"hljs-attr\">title</span>: options.title,
   };

   <span class=\"hljs-keyword\">if</span> (options.link) {
     feed.home_page_url = options.link;
   }

   <span class=\"hljs-keyword\">if</span> (options.feedLinks &amp;&amp; options.feedLinks.json) {
     feed.feed_url = options.feedLinks.json;
   }

   <span class=\"hljs-keyword\">if</span> (options.description) {
     feed.description = options.description;
   }


   <span class=\"hljs-keyword\">if</span> (options.image) {
     feed.icon = options.image;
   }

   <span class=\"hljs-keyword\">if</span> (options.author) {
     feed.author = {};
     <span class=\"hljs-keyword\">if</span> (options.author.name) {
         feed.author.name = options.author.name;
     }
     <span class=\"hljs-keyword\">if</span> (options.author.link) {
         feed.author.url = options.author.link;
     }
   }
   feed.items = items.map(<span class=\"hljs-function\"><span class=\"hljs-params\">item</span> =&gt;</span> {
     <span class=\"hljs-keyword\">let</span> feedItem = {
       <span class=\"hljs-attr\">id</span>: item.id,
       <span class=\"hljs-comment\">// json_feed distinguishes between html and text content</span>
       <span class=\"hljs-comment\">// but since we only take a single type, we'll assume HTML</span>
       html_content: item.content,
     }
     <span class=\"hljs-keyword\">if</span> (item.link) {
       feedItem.url = item.link;
     }
     <span class=\"hljs-keyword\">if</span>(item.title) {
       feedItem.title = item.title;
     }
     <span class=\"hljs-keyword\">if</span> (item.description) {
       feedItem.summary = item.description;
     }

     <span class=\"hljs-keyword\">if</span> (item.image) {
       feedItem.image = item.image
     }

     <span class=\"hljs-keyword\">if</span> (item.date) {
       feedItem.date_modified = <span class=\"hljs-keyword\">this</span>.ISODateString(item.date);
     }
     <span class=\"hljs-keyword\">if</span> (item.published) {
       feedItem.date_published = <span class=\"hljs-keyword\">this</span>.ISODateString(item.published);
     }

     <span class=\"hljs-keyword\">if</span> (item.author) {
       <span class=\"hljs-keyword\">let</span> author = item.author;
       <span class=\"hljs-keyword\">if</span> (author <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-built_in\">Array</span>) {
         <span class=\"hljs-comment\">// json feed only supports 1 author per post</span>
         author = author[<span class=\"hljs-number\">0</span>];
       }
       feedItem.author = {};
       <span class=\"hljs-keyword\">if</span> (author.name) {
           feedItem.author.name = author.name;
       }
       <span class=\"hljs-keyword\">if</span> (author.link) {
           feedItem.author.url = author.link;
       }
     }
     <span class=\"hljs-keyword\">return</span> feedItem;
   });

   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">JSON</span>.stringify(feed, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">4</span>);
 }
</code></pre>
<p>My <a href=\"https://github.com/jpmonette/feed/pull/56/files\">pull request</a> was accepted, so feed v1.1.0 now supports JSON feed and my final code to add <a href=\"http://benmccormick.org/rss/\">rss</a>, <a href=\"http://benmccormick.org/atom.xml\">atom</a>, and <a href=\"http://benmccormick.org/feed.json\">json</a> feed to this site looks like this:</p>
<pre><code class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'fs'</span>);
<span class=\"hljs-keyword\">const</span> Feed = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'feed'</span>);
<span class=\"hljs-keyword\">const</span> filter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/filter'</span>);
<span class=\"hljs-keyword\">const</span> sortBy = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/sortBy'</span>);
<span class=\"hljs-keyword\">const</span> forEach = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/forEach'</span>);
<span class=\"hljs-keyword\">const</span> get = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'lodash/get'</span>);
<span class=\"hljs-keyword\">const</span> moment = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'moment'</span>);
<span class=\"hljs-keyword\">const</span> markdownIt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'markdown-it'</span>);
<span class=\"hljs-keyword\">const</span> frontmatter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'front-matter'</span>);
<span class=\"hljs-keyword\">const</span> {mkDir, mkFile} = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'./utils/file_system'</span>);


<span class=\"hljs-keyword\">const</span> md = markdownIt({
 <span class=\"hljs-attr\">html</span>: <span class=\"hljs-literal\">true</span>,
 <span class=\"hljs-attr\">linkify</span>: <span class=\"hljs-literal\">true</span>,
 <span class=\"hljs-attr\">typographer</span>: <span class=\"hljs-literal\">true</span>,
});

<span class=\"hljs-keyword\">const</span> extractMarkdownContent = <span class=\"hljs-function\"><span class=\"hljs-params\">file</span> =&gt;</span> {
 <span class=\"hljs-keyword\">let</span> body = md.render(frontmatter(file).body);
 <span class=\"hljs-comment\">// handle local links</span>
 <span class=\"hljs-keyword\">return</span> body.replace(<span class=\"hljs-regexp\">/src=\"\//g</span>, <span class=\"hljs-string\">'src=\"http://benmccormick.org/'</span>);

};

<span class=\"hljs-keyword\">const</span> getPageContent = <span class=\"hljs-function\"><span class=\"hljs-params\">page</span> =&gt;</span> {
 <span class=\"hljs-keyword\">let</span> file = fs.readFileSync(__dirname + <span class=\"hljs-string\">'/pages/'</span> + page.requirePath, <span class=\"hljs-string\">'utf-8'</span>);
 <span class=\"hljs-keyword\">return</span> extractMarkdownContent(file);
};

<span class=\"hljs-keyword\">const</span> buildFeed = <span class=\"hljs-function\"><span class=\"hljs-params\">pages</span> =&gt;</span> {
 <span class=\"hljs-keyword\">let</span> feed = <span class=\"hljs-keyword\">new</span> Feed({
   <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">'benmccormick.org'</span>,
   <span class=\"hljs-attr\">description</span>: <span class=\"hljs-string\">'A blog by Ben McCormick'</span>,
   <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'http://benmccormick.org'</span>,
   <span class=\"hljs-attr\">id</span>: <span class=\"hljs-string\">'http://benmccormick.org'</span>,
   <span class=\"hljs-attr\">copyright</span>: <span class=\"hljs-string\">'All rights reserved 2016, Ben McCormick'</span>,
   <span class=\"hljs-attr\">feedLinks</span>: {
     <span class=\"hljs-attr\">atom</span>: <span class=\"hljs-string\">'http://benmccormick.org/atom.xml'</span>,
     <span class=\"hljs-attr\">json</span>: <span class=\"hljs-string\">'http://benmccormick.org/feed.json'</span>,
   },
   <span class=\"hljs-attr\">author</span>: {
     <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'Ben McCormick'</span>,
     <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">'ben@benmccormick.org'</span>
   }
 });
 <span class=\"hljs-comment\">// ignore pages (non posts)</span>
 pages = filter(pages, p =&gt; ( !(get(p, <span class=\"hljs-string\">'data.layout'</span>, <span class=\"hljs-string\">'page'</span>) === <span class=\"hljs-string\">'page'</span>)));
 <span class=\"hljs-comment\">// we only want the last 10 articles to show up in the feed</span>
 pages = sortBy(pages, page =&gt; get(page, <span class=\"hljs-string\">'data.date'</span>));
 pages = pages.reverse();
 pages = pages.slice(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">10</span>);

 forEach(pages, page =&gt; feed.addItem({
   <span class=\"hljs-attr\">title</span>: page.data.title,
   <span class=\"hljs-attr\">id</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span> + page.path,
   <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span> + page.path,
   <span class=\"hljs-attr\">date</span>: moment(page.data.date).toDate(),
   <span class=\"hljs-attr\">content</span>: getPageContent(page),
   <span class=\"hljs-attr\">author</span>: [
     {
       <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'Ben McCormick'</span>,
       <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">'ben@benmccormick.org'</span>,
       <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span>
     }
   ]
 }));
 feed.addContributor({
   <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'Ben McCormick'</span>,
   <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">'ben@benmccormick.org'</span>,
   <span class=\"hljs-attr\">link</span>: <span class=\"hljs-string\">'https://benmccormick.org'</span>
 });
 <span class=\"hljs-keyword\">return</span> feed;
};

<span class=\"hljs-keyword\">let</span> createRSSFolder = <span class=\"hljs-function\"><span class=\"hljs-params\">()</span> =&gt;</span> mkDir(<span class=\"hljs-string\">'/public/rss/'</span>);
<span class=\"hljs-keyword\">let</span> generateAtomFeed = <span class=\"hljs-function\">(<span class=\"hljs-params\">feed</span>) =&gt;</span> mkFile(<span class=\"hljs-string\">'/public/atom.xml'</span>, feed.atom1());
<span class=\"hljs-keyword\">let</span> generateRSS = <span class=\"hljs-function\">(<span class=\"hljs-params\">feed</span>) =&gt;</span> mkFile(<span class=\"hljs-string\">'/public/rss/index.xml'</span>, feed.rss2());
<span class=\"hljs-keyword\">let</span> generateJSONFeed = <span class=\"hljs-function\">(<span class=\"hljs-params\">feed</span>) =&gt;</span> mkFile(<span class=\"hljs-string\">'/public/feed.json'</span>, feed.json1());

exports.postBuild = <span class=\"hljs-function\"><span class=\"hljs-params\">pages</span> =&gt;</span> {
  <span class=\"hljs-keyword\">let</span> feed = buildFeed(pages);
  createRSSFolder();
  generateAtomFeed(feed);
  generateRSS(feed);
  generateJSONFeed(feed);
};
</code></pre>
<h3>More Resources</h3>
<ul>
<li>You can see the whole spec for <a href=\"https://jsonfeed.org/\">JSON Feed</a> on their <a href=\"https://jsonfeed.org/\">site</a>.  It really is remarkably simple.  They also have a list of implementations and example sites.</li>
</ul>
",
                  "author": {
                    "@type": "Person",
                    "name": "Ben McCormick"
                    "email": "mailto:ben@benmccormick.org",
                    "image": "/profile_pic.jpg",
                    "jobTitle": "Software Engineer",
                    "alumniOf": "Duke",
                    "birthPlace": "Pittsburgh, PA",
                    "gender": "male",
                    "url": "http://benmccormick.org",
              	    "sameAs" : [
                      "https://www.linkedin.com/in/benmccormick",
                      "http://twitter.com/ben336",
                    ]
                 }
              }</script><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.55em brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.5rem;line-height:2.325rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.27542rem;line-height:1.55rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.17608rem;line-height:1.55rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.55rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.92211rem;line-height:1.55rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.88547rem;line-height:1.55rem;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}ul{margin-left:1.55rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.55rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.1625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;font-size:1rem;line-height:1.55rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}blockquote{margin-left:1.55rem;margin-right:1.55rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.1625rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.1625rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.55rem;margin-bottom:calc(1.1625rem / 2);margin-top:calc(1.1625rem / 2);}li > ul{margin-left:1.55rem;margin-bottom:calc(1.1625rem / 2);margin-top:calc(1.1625rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.1625rem / 2);}code{font-size:0.85rem;line-height:1.55rem;}kbd{font-size:0.85rem;line-height:1.55rem;}samp{font-size:0.85rem;line-height:1.55rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;-moz-font-feature-settings:tnum;-ms-font-feature-settings:tnum;-webkit-font-feature-settings:tnum;padding-left:1.03333rem;padding-right:1.03333rem;padding-top:0.775rem;padding-bottom:calc(0.775rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:75%;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style>.header-link{color:hsla(0,0%,39%,.7)}.header-link:hover{color:#e2777a}#carbonads{height:100px;font-size:14px;width:300px;position:relative;background:#f0f0f0}.carbon-wrap{height:100px;display:-ms-flexbox;display:flex}.carbon-text{padding:5px 10px;max-height:80px;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:hsla(0,0%,39%,.7);position:absolute;right:5px;bottom:0}@media (max-width:600px){#carbonads,.no-mobile{display:none}.subscribe-block{padding-right:0;padding:0 10px}.subscribe-block,.subscribe-block .mc-field-group{width:100%!important}.subscribe-block .mc-field-group input{width:100%!important;font-size:.8em;height:2.4em}.up-next-block{width:100%!important;padding:0 10px}}@media (max-width:321px){html{font-size:100%!important}}.subscribe-container{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-wrap:wrap;flex-wrap:wrap}.subscribe-block{width:400px;padding-right:30px;overflow:hidden}.subscribe-block #mc_embed_signup form{margin-bottom:20px}.up-next-block{width:300px}.subscribe-button{color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:5px 10px;margin:20px 0;cursor:pointer}.rss{padding-bottom:10px}.rss a{display:-ms-flexbox;display:flex}.rss-icon{display:block;width:17px;margin-right:.5em;height:50px}.rss-icon *{fill:#e2777a}.twitter-item{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;margin-bottom:15px}.twitter-item iframe{margin:0 0 0 10px}.hljs,.markdown pre{display:block;background:#fdf6e3;color:#657b83}.hljs{overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#93a1a1}.hljs-addition,.hljs-keyword,.hljs-selector-tag{color:#859900}.hljs-doctag,.hljs-literal,.hljs-meta .hljs-meta-string,.hljs-number,.hljs-regexp,.hljs-string{color:#2aa198}.hljs-name,.hljs-section,.hljs-selector-class,.hljs-selector-id,.hljs-title{color:#268bd2}.hljs-attr,.hljs-attribute,.hljs-class .hljs-title,.hljs-template-variable,.hljs-type,.hljs-variable{color:#b58900}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-meta .hljs-keyword,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol{color:#cb4b16}.hljs-built_in,.hljs-deletion{color:#dc322f}.hljs-formula{background:#eee8d5}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}a{color:#e2777a;text-decoration:none}blockquote{border-left:5px solid #57a3e8;font-style:italic;background:#eee;font-weight:400;font-size:.9rem;padding:10px 20px;margin:0 0 30px -25px}blockquote p{margin-bottom:.667em}h2,h3{color:#57a3e8}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnote p{display:inline-block;margin-bottom:0}.article-body .reading-img img{width:150px;float:right;margin:0 10px 20px}.article-body img{max-height:200px;display:block;margin:40px auto 20px}.article-body img.full-width{max-height:none}.article-body img.half-width{max-height:none;width:50%}.bordered-img{border:3px solid #57a3e8}.img-group{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.img-group img{padding:0;height:auto}twitterwidget{margin-left:auto;margin-right:auto}.mc-field-group{width:400px;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.mc-field-group input{border-radius:3px;max-width:350px;width:80vw;border:1px solid #ccc;margin-right:10px;height:30px}.mc-field-group label{font-size:.9em;font-weight:600}#mc-embedded-subscribe{color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:0 10px;margin:10px 0;cursor:pointer;width:40vw}#mc-embedded-subscribe:hover{background:#3e8acf}.twitter-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.twitter-row>div{padding-right:20px;min-width:300px}.category-icon-wrapper{color:rgba(87,163,232,.5)}.category-icon{display:inline-block;width:.75em;margin-right:.5em}.category-icon *{fill:#57a3e8;fill:rgba(87,163,232,.5)}.category-icon>i{height:30px}</style></head><body class="landing-page" style="background:#FCFCFC;padding:0 10px;"><div id="react-mount"><div style="max-width:40.3rem;margin-left:auto;margin-right:auto;padding:2.325rem 1.1625rem;" data-reactroot="" data-reactid="1" data-react-checksum="140746335"><div style="display:flex;padding-bottom:0.5rem;margin-bottom:0.5rem;" data-reactid="2"><div style="flex-grow:3;display:flex;flex-direction:column;justify-content:space-around;" data-reactid="3"><h3 style="margin:0;padding-bottom:0;" data-reactid="4"><a style="box-shadow:none;text-decoration:none;color:inherit;" name="title" href="/" data-reactid="5">benmccormick.org</a></h3><div style="color:rgba(100,100,100, 0.7);" data-reactid="6"><a class="header-link" href="/subscribe/" data-reactid="7">Subscribe</a><span style="padding:0 0.33rem;" data-reactid="8">•</span><a class="header-link" href="/archive/" data-reactid="9">Archive</a><span style="padding:0 0.33rem;" data-reactid="10">•</span><a class="header-link" href="http://twitter.com/ben336" data-reactid="11">Twitter</a><span style="padding:0 0.33rem;" data-reactid="12">•</span><a class="header-link" href="/about/" data-reactid="13">About</a></div></div><div style="flex-shrink:2;" data-reactid="14"><span data-reactid="15"></span></div></div><div class="markdown" data-reactid="16"><!-- react-empty: 17 --><h5 style="display:block;color:rgba(100,100,100, 0.7);margin-bottom:0.3875rem;" data-reactid="18">June 3, 2017</h5><h1 style="margin-top:0;margin-bottom:1rem;" data-reactid="19">Adding RSS, Atom, and JSON Feed to Gatsby</h1><div class="article-body" data-reactid="20"><p>For the last few months, this blog has been written in <a href="https://github.com/gatsbyjs/gatsby">Gatsby</a>, a static site generator for JavaScript.  One of the first problems I had to solve when migrating the blog was how to maintain my RSS feed, since Gatsby doesn’t have any built in concept of an RSS feed.  This issue came up again this week as I decided to implement the new <a href="https://jsonfeed.org/">JSON Feed</a> spec and give folks an additional option for subscribing to this blog.  Fortunately this turns out to be a pretty easy problem to solve because of the excellent npm module <a href="https://github.com/jpmonette/feed">feed</a>.</p>
<p><em>feed</em> is an npm module that takes a bunch of information about a blog and its posts, and normalizes them into various syndication feed format.  Here’s what setting up a feed option looks like for this blog:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> Feed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'feed'</span>);
<span class="hljs-keyword">const</span> filter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/filter'</span>);
<span class="hljs-keyword">const</span> sortBy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/sortBy'</span>);
<span class="hljs-keyword">const</span> forEach = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/forEach'</span>);
<span class="hljs-keyword">const</span> get = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/get'</span>);
<span class="hljs-keyword">const</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>);
<span class="hljs-keyword">const</span> markdownIt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'markdown-it'</span>);
<span class="hljs-keyword">const</span> frontmatter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'front-matter'</span>);


<span class="hljs-comment">//markdownIt is a markdown parser that takes my raw md files and</span>
<span class="hljs-comment">//translates them into HTML that we can use in the feed</span>
<span class="hljs-keyword">const</span> md = markdownIt({
  <span class="hljs-attr">html</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">linkify</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">typographer</span>: <span class="hljs-literal">true</span>,
});


<span class="hljs-comment">// getPageContent is a function to help us grab the html content from a post path</span>
<span class="hljs-keyword">const</span> getPageContent = <span class="hljs-function"><span class="hljs-params">page</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> file = fs.readFileSync(__dirname + <span class="hljs-string">'/pages/'</span> + page.requirePath, <span class="hljs-string">'utf-8'</span>);
  <span class="hljs-keyword">let</span> body = md.render(frontmatter(file).body);
  <span class="hljs-comment">// handle local links</span>
  <span class="hljs-keyword">return</span> body.replace(<span class="hljs-regexp">/src="\//g</span>, <span class="hljs-string">'src="http://benmccormick.org/'</span>);
};

<span class="hljs-comment">// build feed is our main function to build a `Feed` object which we</span>
<span class="hljs-comment">// can then serialize into various formats</span>
<span class="hljs-keyword">const</span> buildFeed = <span class="hljs-function"><span class="hljs-params">pages</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> feed = <span class="hljs-keyword">new</span> Feed({
    <span class="hljs-attr">title</span>: <span class="hljs-string">'benmccormick.org'</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">'A blog by Ben McCormick'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-string">'http://benmccormick.org'</span>,
    <span class="hljs-attr">id</span>: <span class="hljs-string">'http://benmccormick.org'</span>,
    <span class="hljs-attr">copyright</span>: <span class="hljs-string">'All rights reserved 2016, Ben McCormick'</span>,
    <span class="hljs-attr">feedLinks</span>: {
      <span class="hljs-attr">atom</span>: <span class="hljs-string">'http://benmccormick.org/atom.xml'</span>,
      <span class="hljs-attr">json</span>: <span class="hljs-string">'http://benmccormick.org/feed.json'</span>,
    },
    <span class="hljs-attr">author</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Ben McCormick'</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">'ben@benmccormick.org'</span>
    }
  });
  <span class="hljs-comment">// ignore pages (non posts) </span>
  pages = filter(pages, p =&gt; ( !(get(p, <span class="hljs-string">'data.layout'</span>, <span class="hljs-string">'page'</span>) === <span class="hljs-string">'page'</span>)));
  <span class="hljs-comment">// we only want the last 10 articles to show up in the feed</span>
  pages = sortBy(pages, page =&gt; get(page, <span class="hljs-string">'data.date'</span>));
  pages = pages.reverse();
  pages = pages.slice(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);

  forEach(pages, page =&gt; feed.addItem({
    <span class="hljs-attr">title</span>: page.data.title,
    <span class="hljs-attr">id</span>: <span class="hljs-string">'https://benmccormick.org'</span> + page.path,
    <span class="hljs-attr">link</span>: <span class="hljs-string">'https://benmccormick.org'</span> + page.path,
    <span class="hljs-attr">date</span>: moment(page.data.date).toDate(),
    <span class="hljs-attr">content</span>: getPageContent(page),
    <span class="hljs-attr">author</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Ben McCormick'</span>,
        <span class="hljs-attr">email</span>: <span class="hljs-string">'ben@benmccormick.org'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-string">'https://benmccormick.org'</span>
      }
    ]
  }));
  feed.addContributor({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Ben McCormick'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'ben@benmccormick.org'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-string">'https://benmccormick.org'</span>
  });
  <span class="hljs-keyword">return</span> feed;
};
</code></pre>
<p>Now we have a <code>buildFeed</code> method that takes a list of pages and generates a feed object.  Then we can use the feed object we’ve created to actually build write some files.  We’ll trigger that in the <code>postBuild</code> callback of <code>gatsby-node</code>.  Here was my first version to support RSS and Atom:</p>
<pre><code class="language-javascript">
<span class="hljs-comment">//mkDir and mkFile are just light wrappers around node's file system APIs</span>
<span class="hljs-keyword">let</span> createRSSFolder = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> mkDir(<span class="hljs-string">'/public/rss/'</span>);
<span class="hljs-keyword">let</span> generateAtomFeed = <span class="hljs-function">(<span class="hljs-params">feed</span>) =&gt;</span> mkFile(<span class="hljs-string">'/public/atom.xml'</span>, feed.atom1());
<span class="hljs-keyword">let</span> generateRSS = <span class="hljs-function">(<span class="hljs-params">feed</span>) =&gt;</span> mkFile(<span class="hljs-string">'/public/rss/index.xml'</span>, feed.rss2());

exports.postBuild = <span class="hljs-function"><span class="hljs-params">pages</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> feed = buildFeed(pages);
  createRSSFolder();
  generateAtomFeed(feed);
  generateRSS(feed);
};
</code></pre>
<p>Prior to this week, <code>feed</code> didn’t support JSON Feed, so I had stopped here.  But because JSON Feed is super simple to implement (its just JSON!), I decided to try to add it to <code>feed</code> this week.  It turned out it was as simple as adding a single function that looks like this:</p>
<pre><code class="language-javascript">json1() {
   <span class="hljs-keyword">const</span> { options, items } = <span class="hljs-keyword">this</span>
   <span class="hljs-keyword">let</span> feed = {
     <span class="hljs-attr">version</span>: <span class="hljs-string">'https://jsonfeed.org/version/1'</span>,
     <span class="hljs-attr">title</span>: options.title,
   };

   <span class="hljs-keyword">if</span> (options.link) {
     feed.home_page_url = options.link;
   }

   <span class="hljs-keyword">if</span> (options.feedLinks &amp;&amp; options.feedLinks.json) {
     feed.feed_url = options.feedLinks.json;
   }

   <span class="hljs-keyword">if</span> (options.description) {
     feed.description = options.description;
   }


   <span class="hljs-keyword">if</span> (options.image) {
     feed.icon = options.image;
   }

   <span class="hljs-keyword">if</span> (options.author) {
     feed.author = {};
     <span class="hljs-keyword">if</span> (options.author.name) {
         feed.author.name = options.author.name;
     }
     <span class="hljs-keyword">if</span> (options.author.link) {
         feed.author.url = options.author.link;
     }
   }
   feed.items = items.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
     <span class="hljs-keyword">let</span> feedItem = {
       <span class="hljs-attr">id</span>: item.id,
       <span class="hljs-comment">// json_feed distinguishes between html and text content</span>
       <span class="hljs-comment">// but since we only take a single type, we'll assume HTML</span>
       html_content: item.content,
     }
     <span class="hljs-keyword">if</span> (item.link) {
       feedItem.url = item.link;
     }
     <span class="hljs-keyword">if</span>(item.title) {
       feedItem.title = item.title;
     }
     <span class="hljs-keyword">if</span> (item.description) {
       feedItem.summary = item.description;
     }

     <span class="hljs-keyword">if</span> (item.image) {
       feedItem.image = item.image
     }

     <span class="hljs-keyword">if</span> (item.date) {
       feedItem.date_modified = <span class="hljs-keyword">this</span>.ISODateString(item.date);
     }
     <span class="hljs-keyword">if</span> (item.published) {
       feedItem.date_published = <span class="hljs-keyword">this</span>.ISODateString(item.published);
     }

     <span class="hljs-keyword">if</span> (item.author) {
       <span class="hljs-keyword">let</span> author = item.author;
       <span class="hljs-keyword">if</span> (author <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
         <span class="hljs-comment">// json feed only supports 1 author per post</span>
         author = author[<span class="hljs-number">0</span>];
       }
       feedItem.author = {};
       <span class="hljs-keyword">if</span> (author.name) {
           feedItem.author.name = author.name;
       }
       <span class="hljs-keyword">if</span> (author.link) {
           feedItem.author.url = author.link;
       }
     }
     <span class="hljs-keyword">return</span> feedItem;
   });

   <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(feed, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>);
 }
</code></pre>
<p>My <a href="https://github.com/jpmonette/feed/pull/56/files">pull request</a> was accepted, so feed v1.1.0 now supports JSON feed and my final code to add <a href="http://benmccormick.org/rss/">rss</a>, <a href="http://benmccormick.org/atom.xml">atom</a>, and <a href="http://benmccormick.org/feed.json">json</a> feed to this site looks like this:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> Feed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'feed'</span>);
<span class="hljs-keyword">const</span> filter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/filter'</span>);
<span class="hljs-keyword">const</span> sortBy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/sortBy'</span>);
<span class="hljs-keyword">const</span> forEach = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/forEach'</span>);
<span class="hljs-keyword">const</span> get = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/get'</span>);
<span class="hljs-keyword">const</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>);
<span class="hljs-keyword">const</span> markdownIt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'markdown-it'</span>);
<span class="hljs-keyword">const</span> frontmatter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'front-matter'</span>);
<span class="hljs-keyword">const</span> {mkDir, mkFile} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils/file_system'</span>);


<span class="hljs-keyword">const</span> md = markdownIt({
 <span class="hljs-attr">html</span>: <span class="hljs-literal">true</span>,
 <span class="hljs-attr">linkify</span>: <span class="hljs-literal">true</span>,
 <span class="hljs-attr">typographer</span>: <span class="hljs-literal">true</span>,
});

<span class="hljs-keyword">const</span> extractMarkdownContent = <span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
 <span class="hljs-keyword">let</span> body = md.render(frontmatter(file).body);
 <span class="hljs-comment">// handle local links</span>
 <span class="hljs-keyword">return</span> body.replace(<span class="hljs-regexp">/src="\//g</span>, <span class="hljs-string">'src="http://benmccormick.org/'</span>);

};

<span class="hljs-keyword">const</span> getPageContent = <span class="hljs-function"><span class="hljs-params">page</span> =&gt;</span> {
 <span class="hljs-keyword">let</span> file = fs.readFileSync(__dirname + <span class="hljs-string">'/pages/'</span> + page.requirePath, <span class="hljs-string">'utf-8'</span>);
 <span class="hljs-keyword">return</span> extractMarkdownContent(file);
};

<span class="hljs-keyword">const</span> buildFeed = <span class="hljs-function"><span class="hljs-params">pages</span> =&gt;</span> {
 <span class="hljs-keyword">let</span> feed = <span class="hljs-keyword">new</span> Feed({
   <span class="hljs-attr">title</span>: <span class="hljs-string">'benmccormick.org'</span>,
   <span class="hljs-attr">description</span>: <span class="hljs-string">'A blog by Ben McCormick'</span>,
   <span class="hljs-attr">link</span>: <span class="hljs-string">'http://benmccormick.org'</span>,
   <span class="hljs-attr">id</span>: <span class="hljs-string">'http://benmccormick.org'</span>,
   <span class="hljs-attr">copyright</span>: <span class="hljs-string">'All rights reserved 2016, Ben McCormick'</span>,
   <span class="hljs-attr">feedLinks</span>: {
     <span class="hljs-attr">atom</span>: <span class="hljs-string">'http://benmccormick.org/atom.xml'</span>,
     <span class="hljs-attr">json</span>: <span class="hljs-string">'http://benmccormick.org/feed.json'</span>,
   },
   <span class="hljs-attr">author</span>: {
     <span class="hljs-attr">name</span>: <span class="hljs-string">'Ben McCormick'</span>,
     <span class="hljs-attr">email</span>: <span class="hljs-string">'ben@benmccormick.org'</span>
   }
 });
 <span class="hljs-comment">// ignore pages (non posts)</span>
 pages = filter(pages, p =&gt; ( !(get(p, <span class="hljs-string">'data.layout'</span>, <span class="hljs-string">'page'</span>) === <span class="hljs-string">'page'</span>)));
 <span class="hljs-comment">// we only want the last 10 articles to show up in the feed</span>
 pages = sortBy(pages, page =&gt; get(page, <span class="hljs-string">'data.date'</span>));
 pages = pages.reverse();
 pages = pages.slice(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);

 forEach(pages, page =&gt; feed.addItem({
   <span class="hljs-attr">title</span>: page.data.title,
   <span class="hljs-attr">id</span>: <span class="hljs-string">'https://benmccormick.org'</span> + page.path,
   <span class="hljs-attr">link</span>: <span class="hljs-string">'https://benmccormick.org'</span> + page.path,
   <span class="hljs-attr">date</span>: moment(page.data.date).toDate(),
   <span class="hljs-attr">content</span>: getPageContent(page),
   <span class="hljs-attr">author</span>: [
     {
       <span class="hljs-attr">name</span>: <span class="hljs-string">'Ben McCormick'</span>,
       <span class="hljs-attr">email</span>: <span class="hljs-string">'ben@benmccormick.org'</span>,
       <span class="hljs-attr">link</span>: <span class="hljs-string">'https://benmccormick.org'</span>
     }
   ]
 }));
 feed.addContributor({
   <span class="hljs-attr">name</span>: <span class="hljs-string">'Ben McCormick'</span>,
   <span class="hljs-attr">email</span>: <span class="hljs-string">'ben@benmccormick.org'</span>,
   <span class="hljs-attr">link</span>: <span class="hljs-string">'https://benmccormick.org'</span>
 });
 <span class="hljs-keyword">return</span> feed;
};

<span class="hljs-keyword">let</span> createRSSFolder = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> mkDir(<span class="hljs-string">'/public/rss/'</span>);
<span class="hljs-keyword">let</span> generateAtomFeed = <span class="hljs-function">(<span class="hljs-params">feed</span>) =&gt;</span> mkFile(<span class="hljs-string">'/public/atom.xml'</span>, feed.atom1());
<span class="hljs-keyword">let</span> generateRSS = <span class="hljs-function">(<span class="hljs-params">feed</span>) =&gt;</span> mkFile(<span class="hljs-string">'/public/rss/index.xml'</span>, feed.rss2());
<span class="hljs-keyword">let</span> generateJSONFeed = <span class="hljs-function">(<span class="hljs-params">feed</span>) =&gt;</span> mkFile(<span class="hljs-string">'/public/feed.json'</span>, feed.json1());

exports.postBuild = <span class="hljs-function"><span class="hljs-params">pages</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> feed = buildFeed(pages);
  createRSSFolder();
  generateAtomFeed(feed);
  generateRSS(feed);
  generateJSONFeed(feed);
};
</code></pre>
<h3>More Resources</h3>
<ul>
<li>You can see the whole spec for <a href="https://jsonfeed.org/">JSON Feed</a> on their <a href="https://jsonfeed.org/">site</a>.  It really is remarkably simple.  They also have a list of implementations and example sites.</li>
</ul>
</div><div data-reactid="21"><hr data-reactid="22"/><div class="subscribe-container" data-reactid="23"><div class="subscribe-block" data-reactid="24"><p data-reactid="25"><!-- react-text: 26 -->Thanks for taking the time to read this post!<!-- /react-text --><!-- react-text: 27 --> Web development<!-- /react-text --><!-- react-text: 28 --> is one of the main topics of this blog, so if you enjoyed the post, please consider subscribing by using the feed, Twitter or my mailing list.<!-- /react-text --></p><div style="margin-bottom:3.875rem;" data-reactid="29"><div id="mc_embed_signup" data-reactid="30"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="31">EMAIL</h6><form action="//benmccormick.us8.list-manage.com/subscribe/post?u=115446b80fd9d930ba091cc27&amp;id=f5b9f5acf2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="" data-reactid="32"><div id="mc_embed_signup_scroll" data-reactid="33"><div class="mc-field-group" style="padding-right:30px;" data-reactid="34"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address" data-reactid="35"/><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" data-reactid="36"/></div><div id="mce-responses" class="clear" data-reactid="37"><div class="response" id="mce-error-response" style="display:none;" data-reactid="38"></div><div class="response" id="mce-success-response" style="display:none;" data-reactid="39"></div></div><div style="position:absolute;left:-5000px;" aria-hidden="true" data-reactid="40"><input type="text" name="b_115446b80fd9d930ba091cc27_f5b9f5acf2" tabindex="-1" value="" data-reactid="41"/></div><div class="clear" data-reactid="42"></div></div></form></div><div class="rss" data-reactid="43"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="44">RSS</h6><a href="/rss/" data-reactid="45"><i class="rss-icon" data-reactid="46"><svg viewBox="0 0 10 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>rss</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="rss" fill="#000000"><path d="M2,13 L0,13 L0,11 C1.11,11 2,11.89 2,13 L2,13 Z M0,3 L0,4 C4.97,4 9,8.03 9,13 L10,13 C10,7.48 5.52,3 0,3 L0,3 Z M0,7 L0,8 C2.75,8 5,10.25 5,13 L6,13 C6,9.69 3.31,7 0,7 L0,7 Z" id="Shape"></path></g></g></svg></i><!-- react-text: 47 --> <!-- /react-text --><span data-reactid="48">RSS</span></a></div><div data-reactid="49"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="50">TWITTER</h6><div class="twitter-item" data-reactid="51"><span data-reactid="52">Site Feed: </span><a href="https://twitter.com/benmccormickorg" class="twitter-follow-button" data-show-count="false" data-reactid="53">Follow @benmccormickorg</a></div></div><div data-reactid="54"><div class="twitter-item" data-reactid="55"><span data-reactid="56">Personal Feed: </span><a href="https://twitter.com/ben336" class="twitter-follow-button" data-show-count="false" data-reactid="57">Follow @ben336</a></div></div></div></div><div class="up-next-block" data-reactid="58"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="59">You Might Also Like:</h6><div data-reactid="60"><h3 style="margin-top:0;margin-bottom:0.3875rem;" data-reactid="61"><a href="/2017/05/29/atom-tips/?readNext=true#title" data-reactid="62">Atom Productivity Tips</a></h3><p data-reactid="63">Getting the most out of Atom</p></div><div data-reactid="64"><hr data-reactid="65"/><h3 style="margin-top:0;margin-bottom:0.3875rem;" data-reactid="66"><a href="/2017/05/28/mariana-syntax-atom/?readNext=true#title" data-reactid="67">Mariana Syntax Theme For Atom</a></h3><p data-reactid="68">Announcing a port of the Mariana color scheme to Atom</p></div><div data-reactid="69"><hr data-reactid="70"/><h3 style="margin-top:0;margin-bottom:0.3875rem;" data-reactid="71"><a href="/2016/12/02/whole-new-site/?readNext=true#title" data-reactid="72">A whole new site</a></h3><p data-reactid="73">Introducing a new look for benmccormick.org</p></div></div></div></div><hr style="margin-bottom:3.1rem;" data-reactid="74"/><div title="Adding RSS, Atom, and JSON Feed to Gatsby" data-reactid="75"><div id="disqus_thread" data-reactid="76"></div><noscript data-reactid="77"><span data-reactid="78"><!-- react-text: 79 -->Please enable JavaScript to view the<!-- /react-text --><a href="http://disqus.com/?ref_noscript" data-reactid="80">comments powered by Disqus.</a></span></noscript><a href="http://disqus.com" class="dsq-brlink" data-reactid="81"><!-- react-text: 82 -->Blog comments powered by <!-- /react-text --><span class="logo-disqus" data-reactid="83">Disqus</span><!-- react-text: 84 -->.<!-- /react-text --></a></div></div><span style="display:block;clear:both;" data-reactid="85"> </span></div></div><script src="/bundle.js?t=1496547995590"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script type="text/javascript">
              // adapted from: https://css-tricks.com/serviceworker-for-offline/
              // ServiceWorker is a progressive technology. Ignore unsupported browsers
              if ('serviceWorker' in navigator) {
              console.log('CLIENT: service worker registration in progress.');
              navigator.serviceWorker.register('/sw.js').then(function() {
                console.log('CLIENT: service worker registration complete.');
              }, function() {
                console.log('CLIENT: service worker registration failure.');
              });
              } else {
              console.log('CLIENT: service worker is not supported.');
              }
            </script></body></html>