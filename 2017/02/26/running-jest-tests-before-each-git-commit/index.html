<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#57a3e8"/><link rel="alternate" title="JSON Feed" type="application/json" href="/feed.json"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'Garamond','Baskerville','Baskerville Old Face','Hoefler Text','Times New Roman',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Garamond','Baskerville','Baskerville Old Face','Hoefler Text','Times New Roman',serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:inherit;font-family:-apple-system,'system-ui','BlinkMacSystemFont','Segoe UI','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.2rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.2rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:14px;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style type="text/css" data-href="/0.3145d1f9f21dcd679291.css">a{color:#e2777a;text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}.footnote-backref,.footnote-ref{text-decoration:none;padding-left:3px}blockquote{border-left:5px solid #57a3e8;background:#eee;font-weight:400;font-size:.9rem;padding:1.5rem 2rem;margin:0 0 1rem}blockquote p{margin-bottom:.667em}h3{color:#57a3e8}h4{font-size:110%}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnotes{font-size:80%}.footnotes li>*{display:inline;margin-bottom:0}
#carbonads{height:300px;font-size:14px;width:150px;position:relative;border:3px solid #f0f0f0;padding:7px}.carbon-wrap{width:130px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}.carbon-text{padding:5px 10px;max-height:120px;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:hsla(0,0%,39%,.7);position:absolute;right:5px;bottom:0}.post-title-area{padding:1em 0}
.columns{display:grid;grid-template-columns:600px 1fr;grid-template-rows:1fr;grid-column-gap:50px}@media (max-width:700px){.columns{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center}.no-mobile{display:none}}@media (max-width:321px){html{font-size:100%!important}}

/*# sourceMappingURL=0.3145d1f9f21dcd679291.css.map*/</style><style type="text/css" data-href="/component---src-templates-blog-post-js.3ad4ad0634b12ff47adb.css">.markdown pre{display:block;background:#343d46;color:#d8dee9;padding:.8rem}.markdown pre code:after{content:unset}.token.comment,.token.quote{color:#a7adba}.token.addition,.token.attr,.token.selector-tag,.token.string{color:#99c794}.token.doctag,.token.meta .token.meta-string,.token.regexp{color:#89ddf3}.token.built_in,.token.function{color:#5fb3b3}.token.name,.token.section,.token.selector-class,.token.selector-id,.token.title{color:#69c}.token.attribute,.token.class .token.title,.token.template-variable,.token.type,.token.variable{color:#fac863}.token.bullet,.token.link,.token.meta,.token.meta .token.keyword,.token.selector-attr,.token.selector-pseudo,.token.subst,.token.symbol{color:#f9ae58}.token.boolean,.token.deletion,.token.literal,.token.number{color:#f07178}.token.keyword{color:#c594c5}.token.formula{background:#a7adba}.token.emphasis{font-style:italic}.token.strong{font-weight:700}
.gatsby-resp-image-wrapper{max-width:75%;display:block;margin:40px auto 20px}.bordered-img{border:3px solid #57a3e8}.img-group{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.img-group img{padding:0;height:auto}.inline-img{display:inline-block;float:right;padding:2rem}
.subscribe-page-group{width:400px;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.subscribe-page-group input{border-radius:3px;max-width:350px;width:80vw;border:1px solid #ccc;margin-right:10px;height:30px}.mc-field-group label{font-size:.9em;font-weight:600}.subscribe-button-large{font-family:-apple-system,system-ui,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:0 10px;margin:10px 0;cursor:pointer;width:40vw}.subscribe-button-large:hover{background:#3e8acf}.twitter-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.twitter-row>div{padding-right:20px;min-width:300px}
.twitter-tweet,twitterwidget{margin-left:auto;margin-right:auto}
.sidebar-group{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.sidebar{padding-left:2rem}.subscribe-container{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;-ms-flex-wrap:wrap;flex-wrap:wrap}.subscribe-email{padding:0 .1rem;margin:0 .2rem 0 0;font-size:.7rem;height:1.5rem;width:6rem}.subscribe-button{color:#fff;background:#57a3e8;border-radius:4px;font-size:1rem;line-height:1rem;height:1.5rem;width:1.5rem;max-width:2rem;-ms-flex-positive:0;flex-grow:0;border:0;margin:0;cursor:pointer}.rss{padding-bottom:10px}.rss a{display:-ms-flexbox;display:flex}.rss-icon{display:block;width:17px;margin-right:.5em;height:50px}.rss-icon *{fill:#e2777a}.twitter-item{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;margin-bottom:15px}.twitter-item iframe{margin:0 0 0 10px}

/*# sourceMappingURL=component---src-templates-blog-post-js.3ad4ad0634b12ff47adb.css.map*/</style><style id="glamor-styles">.css-1a7irg3,[data-css-1a7irg3]{color:rgba(100,100,100, 0.7);font-size:16px;font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}.css-1a7irg3:hover,[data-css-1a7irg3]:hover{color:#E2777A;}.css-bhw7gr,[data-css-bhw7gr]{font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:120%;margin:0 1px 0.8rem 1px;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;justify-content:space-between;align-items:center;border:3px dashed #E2777A;padding:15px;color:initial;transition:background 0.5s ease, color 0.5s ease;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-webkit-transition:background 0.5s ease, color 0.5s ease;-moz-transition:background 0.5s ease, color 0.5s ease;}.css-bhw7gr:hover,[data-css-bhw7gr]:hover{background:#E2777A;color:white;text-decoration:none;}.css-4u7z7f,[data-css-4u7z7f]{max-width:960px;margin:0 auto;padding:2.4rem 1.2rem;}.css-1rrcu7t,[data-css-1rrcu7t]{display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;padding-bottom:2rem;flex-direction:row;justify-content:space-between;flex-wrap:wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-lines:multiple;-webkit-flex-wrap:wrap;}.css-nj9d06,[data-css-nj9d06]{margin:0 20px 0 0;padding-bottom:0;}.css-nj9d06 a,[data-css-nj9d06] a{box-shadow:none;text-decoration:none;color:inherit;}.css-nj9d06 a:hover,[data-css-nj9d06] a:hover{text-decoration:none;}.css-1iige26,[data-css-1iige26]{color:rgba(100,100,100, 0.7);}.css-1821md7,[data-css-1821md7]{padding:0 0.5rem;}@media all and (max-width: 400px){.css-1821md7,[data-css-1821md7]{padding:0 0.25rem;}}.css-d0z96,[data-css-d0z96]{display:block;max-width:100%;}.css-1kurdub,[data-css-1kurdub]{display:block;font-family:Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:16px;color:rgba(100,100,100, 0.8);margin-top:0.8rem;margin-bottom:0.8rem;}.css-n40tvx,[data-css-n40tvx]{max-width:100%;}.css-n40tvx li,[data-css-n40tvx] li{padding-left:10px;}.css-n40tvx .reading-img img,[data-css-n40tvx] .reading-img img{width:150px;float:right;margin:0px 10px 20px 10px;}.css-n40tvx img.full-width,[data-css-n40tvx] img.full-width{max-height:none;}.css-n40tvx img.half-width,[data-css-n40tvx] img.half-width{max-height:none;width:50%;}.css-y3ugfx,[data-css-y3ugfx]{padding-left:2rem;}.css-1aluta2,[data-css-1aluta2]{height:300px;width:150px;overflow:hidden;margin:0 0 1rem 0;}@media all and (max-width: 700px){.css-1aluta2,[data-css-1aluta2]{display:none;}}.css-m9l7q0,[data-css-m9l7q0]{overflow:hidden;margin:0;}.css-m9l7q0 #mc_embed_signup form,[data-css-m9l7q0] #mc_embed_signup form{margin-bottom:20px;}@media all and (max-width: 700px){.css-m9l7q0,[data-css-m9l7q0]{padding-right:0;width:100% !important;padding:0 10px;}.css-m9l7q0 .mc-field-group,[data-css-m9l7q0] .mc-field-group{width:100% !important;}.css-m9l7q0 .mc-field-group input,[data-css-m9l7q0] .mc-field-group input{width:100% !important;font-size:0.8em;height:2.4em;}}.css-h2hkv8,[data-css-h2hkv8]{margin:0;font-size:0.79057rem;line-height:1.6rem;letter-spacing:-0.25px;}.css-4w3jde,[data-css-4w3jde]{color:inherit;}.css-33c833,[data-css-33c833]{margin-left:0;padding-left:0;}.css-vjg5fh,[data-css-vjg5fh]{max-width:60vw;display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;align-items:centglamor.er;-webkit-box-align:centglamor.er;-webkit-align-items:centglamor.er;}@media all and (max-width: 700px){.css-vjg5fh,[data-css-vjg5fh]{max-width:100vw;}}.css-1m362nd,[data-css-1m362nd]{display:-webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex;align-items:center;-webkit-box-align:center;-webkit-align-items:center;}.css-1m362nd> *,[data-css-1m362nd]> *{margin-right:10px;}.css-1182rq7,[data-css-1182rq7]{font-family:Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size:18px;margin:0;}.css-17c7pi4,[data-css-17c7pi4]{white-space:nowrap;font-size:18px;}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["1a7irg3","bhw7gr","4u7z7f","1rrcu7t","nj9d06","1iige26","1821md7","d0z96","1kurdub","n40tvx","y3ugfx","1aluta2","m9l7q0","h2hkv8","4w3jde","33c833","vjg5fh","1m362nd","1182rq7","17c7pi4"]
        // ]]>
        </script><title data-react-helmet="true">Running Jest Tests Before Each Git Commit | benmccormick.org</title><meta data-react-helmet="true" name="description" content="Ben McCormick&#x27;s blog on JavaScript and Web Development"/><meta data-react-helmet="true" name="keywords" content="Jest testing git pre-commit JavaScript"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:site" content="@benmccormickorg"/><meta data-react-helmet="true" name="twitter:creator" content="@ben336"/><meta data-react-helmet="true" name="twitter:title" content="Running Jest Tests Before Each Git Commit"/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="twitter:image" content="http://benmccormick.org/logo.png"/><script data-react-helmet="true" type="application/ld+json">{
                  "@context": "http://schema.org"
                  "@type": "BlogPosting",
                  "headline": "Running Jest Tests Before Each Git Commit",
                  "genre": "Software Development",
                  "keywords": "Jest testing git pre-commit JavaScript",
                  "url": "http://benmccormick.org//2017/02/26/running-jest-tests-before-each-git-commit/",
                  "image": "http://benmccormick.org/logo.png",
                  "datePublished": "2017-02-26",
                  
                  "articleBody": "<p>My main work project makes heavy use of <a href=\"https://facebook.github.io/jest/\">Jest</a> to test our JavaScript code.  For a while now I’ve wanted to set up a way to run tests every time I run a commit.  I knew that git provides <a href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks\">hooks</a> that allow scripting actions to occur before or after any commit or push, and in fact we were already using a <code class=\"language-text\">pre-commit</code> hook script to lint our code with <a href=\"http://eslint.org/\">ESLint</a>.  But it was non-obvious how to make that work well with Jest testing.  I eventually figured out a setup that worked, and the found a better way to do both the Jest and ESLint testing.  Since it took me a while to work through, I thought I’d share it here and save the rest of you some time.</p>
<h3>What didn’t work</h3>
<p>A naive approach to this problem would be to set up a pre-commit hook that simply ran <code class=\"language-text\">jest</code> to run all tests. The problem is that running our full test suite currently takes between 10 and 20 seconds to run all tests and that time is increasing as we grow our test suite.  Adding that overhead to every commit would cost my team a lot of time, and would be especially inefficient since the repo contains plenty non-JavaScript code that doesn’t require tests to be run when updated.</p>
<p>For our ESLint hook, we queried git to get a list of staged files, and then ran eslint against each one of them individually, displaying a pass/fail message.  That looked something like this:</p>
<div class=\"gatsby-highlight\" data-language=\"bash\">
      <pre class=\"language-bash\"><code class=\"language-bash\">STAGED_FILES<span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> <span class=\"token function\">diff</span> --cached --name-only --diff-filter<span class=\"token operator\">=</span>ACM <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"js$\"</span><span class=\"token variable\">)</span></span>
<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$STAGED_FILES</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>
    <span class=\"token keyword\">exit</span> 0
<span class=\"token keyword\">fi</span>

PASS<span class=\"token operator\">=</span>true

<span class=\"token keyword\">for</span> FILE <span class=\"token keyword\">in</span> <span class=\"token variable\">$STAGED_FILES</span>
<span class=\"token keyword\">do</span>
    eslint --quiet <span class=\"token string\">\"<span class=\"token variable\">$FILE</span>\"</span>

    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$?</span>\"</span> <span class=\"token operator\">==</span> 0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>
        <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\t\033[32mESLint Passed: <span class=\"token variable\">$FILE</span>\033[0m\"</span>
    <span class=\"token keyword\">else</span>
        <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\t\033[41mESLint Failed: <span class=\"token variable\">$FILE</span>\033[0m\"</span>
        PASS<span class=\"token operator\">=</span>false
    <span class=\"token keyword\">fi</span>
<span class=\"token keyword\">done</span></code></pre>
      </div>
<p>This works great for ESLint, but doesn’t work out of the box for Jest, because I don’t want Jest to run the files that changed, I want them to run any tests that changed AND any tests that might have been broken because of that.</p>
<p>Jest has a wonderful command line flag <code class=\"language-text\">jest --onlyChanged</code>/<code class=\"language-text\">jest -o</code> that runs only the tests related to files that have been changed according to git.  It is extremely helpful since it is smart enough to read the dependency structure for the project and run all tests that might be changed from updating a source file. It also has a <code class=\"language-text\">--lastCommit</code> option that does the same thing for files that were in the previous commit.  Unfortunately, these options aren’t helpful at the point of committing, since <code class=\"language-text\">onlyChanged</code> does not look at files that have been staged for commit, and we haven’t actually made a commit yet for <code class=\"language-text\">lastCommit</code> to read.</p>
<h3>What Did Work</h3>
<p>Fortunately Jest has a lower level command that uses the same logic as <code class=\"language-text\">onlyChanged</code> and <code class=\"language-text\">lastCommit</code>.  <code class=\"language-text\">--findRelatedTests</code> is a flag that tells Jest to run any tests related to the files passed to it instead of trying to run those files as tests as it would normally do.</p>

  <a class=\"gatsby-resp-image-link\" href=\"/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-1b819.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">
  
  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 570px; margin-left: auto; margin-right: auto;\">
    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 81.97573656845753%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y41UyW7TUBT1t7GoxA4EWzZsQCz4KYSEQKBSAWppJVQQlDYNbVzHyYsd2+95SNI4djwl6Xi4fulAUJtmcXSvh3feHc69yiA0YbochrAJDizPAfcdmOQP6dto2MbZyCUInI+n9ozs+S1Q1jafY3XzJeK+gcOgBbtdg8s1eEJHL2hIQhx5V2Tnc8gk4auP9/Dm0xLymBGhjrr2C6y5jRbbgWXu0gV/MOg1MUnt6wjnECvvvjzAh7VHSMIGhF3DduUbNG0LqvqTCKtwiNB1asgiczHC96sPsfz1MYphi0gNdLwD+EKFY+1RxHWkAwPHuQNMvMVSDtzv6He35MGjzKGaWeS3kFNESUg2NnFa8KvIpphDaJs1cEuVdSrocFmzFqtg2G9JwuiQzXb4gvA2KAbbhsf3ZTePqPAdT5PRYXJ9610kM4SjhONk5GOScYzLlFNH+ieFkKmeFlS/sVgYymFPhcGbsKWgOdyOQNAV4AFHMrAQRhyDJECUeGR9pJmHLJv6ESFOPcRkh+n0vbKy8QTL608R9hh8t4G6XiEdVsHYHoSjwnXriGMHRe5JjHMXk8JFnnlX7wryRxfflNcrS3j7+T51VkdAcqmQDpuN31LgnKTTJ+lEXR2TpC3remfKa5vPsP7jBcZ0IKIohbOPwD2gRtWkDnu+hrBLI5hYCzVICbsayaNJMmEkm5K0KQnKySiRX0zIrGzEzMT86yussQOD7dJyYFI6baMqcUlYTg/ox3JS/sdNC0MRNtWpo1PKFk2KTRtGl0TluB3nXC6F8rkU+uUF5VSVE3TTwvgL5+Ghb81Fxi8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\">
      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"an example of findRelatedTests running against the redux repo\" title=\"\" src=\"/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-d766e.png\" srcset=\"/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-a6b6e.png 143w,
/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-8e488.png 285w,
/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-d766e.png 570w,
/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-1b819.png 577w\" sizes=\"(max-width: 570px) 100vw, 570px\">
    </span>
  </span>
  
  </a>
    
<p>This is a perfect fit for a pre-commit hook.  I was able to integrate it into my existing script like this:</p>
<div class=\"gatsby-highlight\" data-language=\"bash\">
      <pre class=\"language-bash\"><code class=\"language-bash\">jest --bail --findRelatedTests <span class=\"token variable\">$STAGED_FILES</span>
<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$?</span>\"</span> <span class=\"token operator\">==</span> 0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>
    <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\t\033[32mJest Tests Passed\033[0m\"</span>
<span class=\"token keyword\">else</span>
    <span class=\"token keyword\">echo</span> <span class=\"token string\">\"\t\033[41mJest Tests Failed\033[0m\"</span>
    PASS<span class=\"token operator\">=</span>false
<span class=\"token keyword\">fi</span></code></pre>
      </div>
<p><code class=\"language-text\">$STAGED_FILES</code> is re-used from the eslint portion of the script, and is just a space delimited list of files that are being committed.  The <code class=\"language-text\">--bail</code> option simply stops running tests as soon as one has failed.  Including that is optional, you won’t see all the tests that have failed, but the failure will happen faster and you’ll be able to decide how to proceed, including possibly running the full test script on your own.   </p>
<p>Those lines (along with some sanity checks for the existence of Jest and error handling when PASS is set to false) are enough to get a workable commit hook going, but they’re not ideal.  pre-commit hooks aren’t persisted by git, so each user has to install the hook script individually, and any updates aren’t shared automatically.  Plus I’m inefficiently passing all staged files to eslint and Jest regardless of whether they’re JavaScript that those tools are actually meant to work on.  My ESLint code was also written before ESLint developed robust <code class=\"language-text\">--fix</code> capabilities, and doesn’t try to fix the errors it is capable of fixing.  Finally, while this is just poor coding and not an inherent limitation of my other method, I’m using globally installed versions of Jest and ESLint instead of scoping them to my project.</p>
<h3>Making it better</h3>
<p>Fortunately I’d discovered a better solution the other day while working on something else.  There is an npm package for making this process easier, <a href=\"https://github.com/okonet/lint-staged\">lint-staged</a>.  Lint staged abstracts away the boilerplate of getting the staged files, and makes it easy to run local node executables against specific sets of files.  I was able to replace my whole pre-commit script and address all of the problems mentioned above with only a few lines in my package.json:</p>
<div class=\"gatsby-highlight\" data-language=\"json\">
      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>
  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
    <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lint-staged\"</span><span class=\"token punctuation\">,</span>
  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
  <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
    <span class=\"token property\">\"*.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>
      <span class=\"token string\">\"eslint --fix\"</span><span class=\"token punctuation\">,</span>
      <span class=\"token string\">\"git add\"</span><span class=\"token punctuation\">,</span>
      <span class=\"token string\">\"jest --bail --findRelatedTests\"</span>
    <span class=\"token punctuation\">]</span>
  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>
    <span class=\"token property\">\"eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.16.1\"</span><span class=\"token punctuation\">,</span>
    <span class=\"token property\">\"jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"19.0.1\"</span><span class=\"token punctuation\">,</span>
    <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.3.1\"</span><span class=\"token punctuation\">,</span>
  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>
<span class=\"token punctuation\">}</span></code></pre>
      </div>
<p><code class=\"language-text\">lint-staged</code> now handles making sure that I’m only running checks against JavaScript files, lets eslint autofix and stage any files that it can fix, and uses the local versions of jest and eslint.  It also adds a nice pretty interface for the results:</p>

  <a class=\"gatsby-resp-image-link\" href=\"/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-41b68.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">
  
  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 570px; margin-left: auto; margin-right: auto;\">
    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.321100917431195%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABCElEQVQoz3WR63KCMBCF8/6P15ZWEUXBCnJLMFwD9nQ3gU7r2B/fbNhkz5zDClkEuFxD6DrEqEO0co+mCtCpPerCt+eGetzv6wOm5oSvPsa9i2x9RHRyB5Vt7OBwc6KmOdrBgQRG2zvCMNSf2+iP4KOwGFWAJH6DzLfk6mBFWYwfYjj/InYsg3z/DGHKLRoSslEJFla5b88szvSLU6597XrP4jqHMsBMyoZccdy5de44GvemBY7LsccFvue3juhnTlTkRl83qOMX8Dn99JAlH8hTgmpy9nArd9AEL0lRAv5uFScKoJel6dLtQBjpY8w8TPk7TOWjK2hB6Sv60rdO1tiry/X//hf5G+jMEWFL2TQIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\">
      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"pretty lint-staged output\" title=\"\" src=\"/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-d766e.png\" srcset=\"/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-a6b6e.png 143w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-8e488.png 285w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-d766e.png 570w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-13239.png 855w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-41b68.png 872w\" sizes=\"(max-width: 570px) 100vw, 570px\">
    </span>
  </span>
  
  </a>
    
<p><code class=\"language-text\">lint-staged</code> docs recommend using an npm based hooks manager like <a href=\"https://github.com/observing/pre-commit\">pre-commit</a> for running the scripts, but due to some quirks in my setup (node_modules is symlinked, and I sometimes want to run these commands inside a docker container), I found it easier to maintain a custom pre-commit script and just replace the previous logic with <code class=\"language-text\">npm run lint-staged</code>.  Either way, all of the actual logic is now checked into the repository and shared between all users.  The only manual step is adding the call to a pre-commit hook or (if you’re using a helper lib) running npm install.</p>
<h3>More Resources</h3>
<ul>
<li>This maybe merits a future post on its own, but if you’re interested in automating away your code style maintenance look at combining <a href=\"https://github.com/prettier/prettier\">prettier</a> (and possibly  <a href=\"https://github.com/not-an-aardvark/eslint-plugin-prettier\">eslint-plugin-prettier</a>) with the pre-commit hooks from above.  Prettier will guarantee that your code follows a consistent style, and because it handles maximum line lengths, is much more robust than ESLint on its own.  Using its ESLint plugin within my editor and on pre-commit hooks has pretty much eliminated me manually fixing code style problems.</li>
</ul>",
                    "author": {
                      "@type": "Person",
                      "name": "Ben McCormick"
                      "email": "mailto:ben@benmccormick.org",
                      "image": "/profile_pic.jpg",
                      "jobTitle": "Software Engineer",
                      "alumniOf": "Duke",
                      "birthPlace": "Pittsburgh, PA",
                      "gender": "male",
                      "url": "http://benmccormick.org",
                	    "sameAs" : [
                        "https://www.linkedin.com/in/benmccormick",
                        "http://twitter.com/ben336",
                      ]
                   }
                }</script><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f1ff7d131df0a80437e4.js"/><link as="script" rel="preload" href="/0-0a2a2413d5b3e62686ce.js"/><link as="script" rel="preload" href="/1-4a4df9f682b1321a5732.js"/><link as="script" rel="preload" href="/app-a122d914cf5d49401320.js"/><link as="script" rel="preload" href="/webpack-runtime-9d9baba22f521c67ee80.js"/><link rel="preload" href="/static/d/path---2017-02-26-running-jest-tests-before-each-git-commit-00-e-192-XWo6TGifZZIFZW4K6iWCaBtYyvg.json" as="fetch" crossOrigin="use-credentials"/><link as="style" rel="preload" href="/component---src-templates-blog-post-js.3ad4ad0634b12ff47adb.css"/><link as="style" rel="preload" href="/0.3145d1f9f21dcd679291.css"/></head><body class="landing-page" style="background:#FCFCFC;padding:0 10px"><div id="___gatsby"><div class="css-4u7z7f" data-reactroot=""><div class="css-1rrcu7t"><h3 class="css-nj9d06"><a name="title" href="/">benmccormick.org</a></h3><div class="css-1iige26"><a class="css-1a7irg3" href="/archive/">Blog</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/subscribe/">Subscribe</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/speaking/">Speaking</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="http://twitter.com/ben336">Twitter</a><span class="css-1821md7"></span><a class="css-1a7irg3" href="/about/">About</a></div></div><div class="markdown"><div class="post-title-area"><h1 class="css-d0z96">Running Jest Tests Before Each Git Commit</h1><h5 class="css-1kurdub">Originally Posted <!-- -->February 26th 2017</h5></div><div class="columns"><div class="css-n40tvx"><p>My main work project makes heavy use of <a href="https://facebook.github.io/jest/">Jest</a> to test our JavaScript code.  For a while now I’ve wanted to set up a way to run tests every time I run a commit.  I knew that git provides <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">hooks</a> that allow scripting actions to occur before or after any commit or push, and in fact we were already using a <code class="language-text">pre-commit</code> hook script to lint our code with <a href="http://eslint.org/">ESLint</a>.  But it was non-obvious how to make that work well with Jest testing.  I eventually figured out a setup that worked, and the found a better way to do both the Jest and ESLint testing.  Since it took me a while to work through, I thought I’d share it here and save the rest of you some time.</p>
<h3>What didn’t work</h3>
<p>A naive approach to this problem would be to set up a pre-commit hook that simply ran <code class="language-text">jest</code> to run all tests. The problem is that running our full test suite currently takes between 10 and 20 seconds to run all tests and that time is increasing as we grow our test suite.  Adding that overhead to every commit would cost my team a lot of time, and would be especially inefficient since the repo contains plenty non-JavaScript code that doesn’t require tests to be run when updated.</p>
<p>For our ESLint hook, we queried git to get a list of staged files, and then ran eslint against each one of them individually, displaying a pass/fail message.  That looked something like this:</p>
<div class="gatsby-highlight" data-language="bash">
      <pre class="language-bash"><code class="language-bash">STAGED_FILES<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> <span class="token function">diff</span> --cached --name-only --diff-filter<span class="token operator">=</span>ACM <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"js$"</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$STAGED_FILES</span>"</span> <span class="token operator">=</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token keyword">exit</span> 0
<span class="token keyword">fi</span>

PASS<span class="token operator">=</span>true

<span class="token keyword">for</span> FILE <span class="token keyword">in</span> <span class="token variable">$STAGED_FILES</span>
<span class="token keyword">do</span>
    eslint --quiet <span class="token string">"<span class="token variable">$FILE</span>"</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$?</span>"</span> <span class="token operator">==</span> 0 <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token keyword">echo</span> <span class="token string">"\t\033[32mESLint Passed: <span class="token variable">$FILE</span>\033[0m"</span>
    <span class="token keyword">else</span>
        <span class="token keyword">echo</span> <span class="token string">"\t\033[41mESLint Failed: <span class="token variable">$FILE</span>\033[0m"</span>
        PASS<span class="token operator">=</span>false
    <span class="token keyword">fi</span>
<span class="token keyword">done</span></code></pre>
      </div>
<p>This works great for ESLint, but doesn’t work out of the box for Jest, because I don’t want Jest to run the files that changed, I want them to run any tests that changed AND any tests that might have been broken because of that.</p>
<p>Jest has a wonderful command line flag <code class="language-text">jest --onlyChanged</code>/<code class="language-text">jest -o</code> that runs only the tests related to files that have been changed according to git.  It is extremely helpful since it is smart enough to read the dependency structure for the project and run all tests that might be changed from updating a source file. It also has a <code class="language-text">--lastCommit</code> option that does the same thing for files that were in the previous commit.  Unfortunately, these options aren’t helpful at the point of committing, since <code class="language-text">onlyChanged</code> does not look at files that have been staged for commit, and we haven’t actually made a commit yet for <code class="language-text">lastCommit</code> to read.</p>
<h3>What Did Work</h3>
<p>Fortunately Jest has a lower level command that uses the same logic as <code class="language-text">onlyChanged</code> and <code class="language-text">lastCommit</code>.  <code class="language-text">--findRelatedTests</code> is a flag that tells Jest to run any tests related to the files passed to it instead of trying to run those files as tests as it would normally do.</p>

  <a class="gatsby-resp-image-link" href="/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-1b819.png" style="display: block" target="_blank" rel="noopener">
  
  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 570px; margin-left: auto; margin-right: auto;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.97573656845753%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y41UyW7TUBT1t7GoxA4EWzZsQCz4KYSEQKBSAWppJVQQlDYNbVzHyYsd2+95SNI4djwl6Xi4fulAUJtmcXSvh3feHc69yiA0YbochrAJDizPAfcdmOQP6dto2MbZyCUInI+n9ozs+S1Q1jafY3XzJeK+gcOgBbtdg8s1eEJHL2hIQhx5V2Tnc8gk4auP9/Dm0xLymBGhjrr2C6y5jRbbgWXu0gV/MOg1MUnt6wjnECvvvjzAh7VHSMIGhF3DduUbNG0LqvqTCKtwiNB1asgiczHC96sPsfz1MYphi0gNdLwD+EKFY+1RxHWkAwPHuQNMvMVSDtzv6He35MGjzKGaWeS3kFNESUg2NnFa8KvIpphDaJs1cEuVdSrocFmzFqtg2G9JwuiQzXb4gvA2KAbbhsf3ZTePqPAdT5PRYXJ9610kM4SjhONk5GOScYzLlFNH+ieFkKmeFlS/sVgYymFPhcGbsKWgOdyOQNAV4AFHMrAQRhyDJECUeGR9pJmHLJv6ESFOPcRkh+n0vbKy8QTL608R9hh8t4G6XiEdVsHYHoSjwnXriGMHRe5JjHMXk8JFnnlX7wryRxfflNcrS3j7+T51VkdAcqmQDpuN31LgnKTTJ+lEXR2TpC3remfKa5vPsP7jBcZ0IKIohbOPwD2gRtWkDnu+hrBLI5hYCzVICbsayaNJMmEkm5K0KQnKySiRX0zIrGzEzMT86yussQOD7dJyYFI6baMqcUlYTg/ox3JS/sdNC0MRNtWpo1PKFk2KTRtGl0TluB3nXC6F8rkU+uUF5VSVE3TTwvgL5+Ghb81Fxi8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">
      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="an example of findRelatedTests running against the redux repo" title="" src="/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-d766e.png" srcset="/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-a6b6e.png 143w,
/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-8e488.png 285w,
/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-d766e.png 570w,
/static/jest-related-tests-9350cbcea06e8f1f423335d94d84ac98-1b819.png 577w" sizes="(max-width: 570px) 100vw, 570px">
    </span>
  </span>
  
  </a>
    
<p>This is a perfect fit for a pre-commit hook.  I was able to integrate it into my existing script like this:</p>
<div class="gatsby-highlight" data-language="bash">
      <pre class="language-bash"><code class="language-bash">jest --bail --findRelatedTests <span class="token variable">$STAGED_FILES</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$?</span>"</span> <span class="token operator">==</span> 0 <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token keyword">echo</span> <span class="token string">"\t\033[32mJest Tests Passed\033[0m"</span>
<span class="token keyword">else</span>
    <span class="token keyword">echo</span> <span class="token string">"\t\033[41mJest Tests Failed\033[0m"</span>
    PASS<span class="token operator">=</span>false
<span class="token keyword">fi</span></code></pre>
      </div>
<p><code class="language-text">$STAGED_FILES</code> is re-used from the eslint portion of the script, and is just a space delimited list of files that are being committed.  The <code class="language-text">--bail</code> option simply stops running tests as soon as one has failed.  Including that is optional, you won’t see all the tests that have failed, but the failure will happen faster and you’ll be able to decide how to proceed, including possibly running the full test script on your own.   </p>
<p>Those lines (along with some sanity checks for the existence of Jest and error handling when PASS is set to false) are enough to get a workable commit hook going, but they’re not ideal.  pre-commit hooks aren’t persisted by git, so each user has to install the hook script individually, and any updates aren’t shared automatically.  Plus I’m inefficiently passing all staged files to eslint and Jest regardless of whether they’re JavaScript that those tools are actually meant to work on.  My ESLint code was also written before ESLint developed robust <code class="language-text">--fix</code> capabilities, and doesn’t try to fix the errors it is capable of fixing.  Finally, while this is just poor coding and not an inherent limitation of my other method, I’m using globally installed versions of Jest and ESLint instead of scoping them to my project.</p>
<h3>Making it better</h3>
<p>Fortunately I’d discovered a better solution the other day while working on something else.  There is an npm package for making this process easier, <a href="https://github.com/okonet/lint-staged">lint-staged</a>.  Lint staged abstracts away the boilerplate of getting the staged files, and makes it easy to run local node executables against specific sets of files.  I was able to replace my whole pre-commit script and address all of the problems mentioned above with only a few lines in my package.json:</p>
<div class="gatsby-highlight" data-language="json">
      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"lint-staged"</span><span class="token operator">:</span> <span class="token string">"lint-staged"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"lint-staged"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"*.js"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"eslint --fix"</span><span class="token punctuation">,</span>
      <span class="token string">"git add"</span><span class="token punctuation">,</span>
      <span class="token string">"jest --bail --findRelatedTests"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"eslint"</span><span class="token operator">:</span> <span class="token string">"3.16.1"</span><span class="token punctuation">,</span>
    <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token string">"19.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"lint-staged"</span><span class="token operator">:</span> <span class="token string">"3.3.1"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p><code class="language-text">lint-staged</code> now handles making sure that I’m only running checks against JavaScript files, lets eslint autofix and stage any files that it can fix, and uses the local versions of jest and eslint.  It also adds a nice pretty interface for the results:</p>

  <a class="gatsby-resp-image-link" href="/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-41b68.png" style="display: block" target="_blank" rel="noopener">
  
  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 570px; margin-left: auto; margin-right: auto;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.321100917431195%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABCElEQVQoz3WR63KCMBCF8/6P15ZWEUXBCnJLMFwD9nQ3gU7r2B/fbNhkz5zDClkEuFxD6DrEqEO0co+mCtCpPerCt+eGetzv6wOm5oSvPsa9i2x9RHRyB5Vt7OBwc6KmOdrBgQRG2zvCMNSf2+iP4KOwGFWAJH6DzLfk6mBFWYwfYjj/InYsg3z/DGHKLRoSslEJFla5b88szvSLU6597XrP4jqHMsBMyoZccdy5de44GvemBY7LsccFvue3juhnTlTkRl83qOMX8Dn99JAlH8hTgmpy9nArd9AEL0lRAv5uFScKoJel6dLtQBjpY8w8TPk7TOWjK2hB6Sv60rdO1tiry/X//hf5G+jMEWFL2TQIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;">
      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="pretty lint-staged output" title="" src="/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-d766e.png" srcset="/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-a6b6e.png 143w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-8e488.png 285w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-d766e.png 570w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-13239.png 855w,
/static/lint-staged-errors-07049d14abcd3c0065c9779b76d22045-41b68.png 872w" sizes="(max-width: 570px) 100vw, 570px">
    </span>
  </span>
  
  </a>
    
<p><code class="language-text">lint-staged</code> docs recommend using an npm based hooks manager like <a href="https://github.com/observing/pre-commit">pre-commit</a> for running the scripts, but due to some quirks in my setup (node_modules is symlinked, and I sometimes want to run these commands inside a docker container), I found it easier to maintain a custom pre-commit script and just replace the previous logic with <code class="language-text">npm run lint-staged</code>.  Either way, all of the actual logic is now checked into the repository and shared between all users.  The only manual step is adding the call to a pre-commit hook or (if you’re using a helper lib) running npm install.</p>
<h3>More Resources</h3>
<ul>
<li>This maybe merits a future post on its own, but if you’re interested in automating away your code style maintenance look at combining <a href="https://github.com/prettier/prettier">prettier</a> (and possibly  <a href="https://github.com/not-an-aardvark/eslint-plugin-prettier">eslint-plugin-prettier</a>) with the pre-commit hooks from above.  Prettier will guarantee that your code follows a consistent style, and because it handles maximum line lengths, is much more robust than ESLint on its own.  Using its ESLint plugin within my editor and on pre-commit hooks has pretty much eliminated me manually fixing code style problems.</li>
</ul></div><div class="css-y3ugfx no-mobile"><div class="css-1aluta2"></div><div class="css-m9l7q0"><div id="mc_embed_signup"><h6 class="css-h2hkv8">Subscribe via email</h6><form action="//benmccormick.us8.list-manage.com/subscribe/post?u=115446b80fd9d930ba091cc27&amp;id=f5b9f5acf2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group sidebar-group"><input type="email" name="EMAIL" class="subscribe-email required email" id="mce-EMAIL" placeholder="Email Address" value=""/><input type="submit" value="&gt;" name="subscribe" id="mc-embedded-subscribe" class="subscribe-button button"/></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position:absolute;left:-5000px" aria-hidden="true"><input type="text" name="b_115446b80fd9d930ba091cc27_f5b9f5acf2" tabindex="-1" value=""/></div><div class="clear"></div></div></form></div></div></div></div><div><hr/><div class=""><h3 class="css-4w3jde">You Might Also Like These Articles</h3><ul class="css-33c833"><a class="css-bhw7gr" href="/2016/09/19/testing-with-jest-snapshots-first-impressions/"><div class="css-vjg5fh"><div><div class="css-1m362nd">Testing with Jest Snapshots: First Impressions</div><p class="css-1182rq7">First impression of testing UI components using Jest snapshots</p></div></div><span class="css-17c7pi4 no-mobile">Sep 19th 2016</span></a><a class="css-bhw7gr" href="/2016/12/10/saving-time-with-jest"><div class="css-vjg5fh"><div><div class="css-1m362nd">Saving Time With Jest: Meetup Summary</div><p class="css-1182rq7">A summary of my meetup talk on saving time with Jest</p></div></div><span class="css-17c7pi4 no-mobile">Dec 10th 2016</span></a><a class="css-bhw7gr" href="/2017/01/09/mobx-first-impressions/"><div class="css-vjg5fh"><div><div class="css-1m362nd">MobX: First Impressions</div><p class="css-1182rq7">First impression of managing data with MobX</p></div></div><span class="css-17c7pi4 no-mobile">Jan 9th 2017</span></a></ul></div></div></div></div></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script>
          window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"2017-02-26-running-jest-tests-before-each-git-commit-00e","path":"/2017/02/26/running-jest-tests-before-each-git-commit/"};window.dataPath="path---2017-02-26-running-jest-tests-before-each-git-commit-00-e-192-XWo6TGifZZIFZW4K6iWCaBtYyvg";/*]]>*/</script><script src="/webpack-runtime-9d9baba22f521c67ee80.js" async=""></script><script src="/app-a122d914cf5d49401320.js" async=""></script><script src="/1-4a4df9f682b1321a5732.js" async=""></script><script src="/0-0a2a2413d5b3e62686ce.js" async=""></script><script src="/component---src-templates-blog-post-js-f1ff7d131df0a80437e4.js" async=""></script></body></html>