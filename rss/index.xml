<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>benmccormick.org</title>
        <link>http://benmccormick.org</link>
        <description>A blog by Ben McCormick</description>
        <lastBuildDate>Tue, 19 Jun 2018 21:30:43 GMT</lastBuildDate>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
        <generator>Feed for Node.js</generator>
        <image>
            <title>benmccormick.org</title>
            <url>https://benmccormick.org/logo.png</url>
            <link>http://benmccormick.org</link>
        </image>
        <copyright>All rights reserved 2016, Ben McCormick</copyright>
        <atom:link href="http://benmccormick.org/atom.xml" rel="self" type="application/rss+xml"/>
        <item>
            <title><![CDATA[Code Golf: Sparse Arrays]]></title>
            <link>https://benmccormick.org/2018/06/19/code-golf-sparse-arrays/</link>
            <guid>https://benmccormick.org/2018/06/19/code-golf-sparse-arrays/</guid>
            <pubDate>Tue, 19 Jun 2018 06:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>Today on Twitter, <a href="http://2ality.com/index.html">Axel Rauschmayer</a> posted a fun little coding challenge:</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Code golf: check if an Array has holes. I’ll reply with two ideas of mine in a few minutes.</p>&mdash; Axel Rauschmayer (@rauschma) <a href="https://twitter.com/rauschma/status/1009053456123027463?ref_src=twsrc%5Etfw">June 19, 2018</a></blockquote>
<p>For context, <em>code golf</em> is a type of challenge where participants attempt to find the shortest possible way to express a program.  Arrays that have holes, or sparse arrays, refer to arrays that don’t have values at every index between their maximum and minimum values.  You can define a sparse array like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">// arr.length is 100</span></code></pre>
      </div>
<p>or like this</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// arr.length is 3</span></code></pre>
      </div>
<p>This is different from <code class="language-text">let arr = [1, undefined, 2]</code>, because the index keys are not defined.  If this is difficult to understand, you can picture arrays as simple objects, with access to the <code class="language-text">Array.Prototype</code> methods and a special <code class="language-text">length</code> property that is aware of numeric keys.  The important thing is not whether a value is defined for a specific index, but whether a key was ever explicitly set.  Axel’s suggested solutions take advantage of that distinction:</p>
<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr">// Does someArray have holes?<br><br>someArray.findIndex((x,i,arr) =&gt; x === undefined &amp;&amp; !(i in arr)) &gt;= 0<br>Object.keys(someArray).length &lt; someArray.length<br>someArray.filter(_ =&gt; true).length &lt; someArray.length</p>&mdash; Axel Rauschmayer (@rauschma) <a href="https://twitter.com/rauschma/status/1009056501095428096?ref_src=twsrc%5Etfw">June 19, 2018</a></blockquote>
<p>I’m going to standardize these into a function syntax for the purpose of comparison.  I’m only going to consider one liners, so we’ll define a simple arrow function <code class="language-text">isSparse</code>, and compare the length of the function bodies.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Solution 1</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> someArray <span class="token operator">=></span> someArray<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>i<span class="token punctuation">,</span>arr<span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">===</span> undefined <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span>
<span class="token comment">// Solution 1 condensed (49 characters)</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> a<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>i<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token operator">=></span>x<span class="token operator">===</span>undefined<span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0</span>
<span class="token comment">// Solution 2</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> someArray <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>someArray<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> someArray<span class="token punctuation">.</span>length
<span class="token comment">// Solution 2 condensed (30 characters)</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length
<span class="token comment">// Solution 3</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> someArray <span class="token operator">=></span> someArray<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>_ <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> someArray<span class="token punctuation">.</span>length
<span class="token comment">// Solution 3 condensed (33 characters)</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> a<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>_<span class="token operator">=></span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length</code></pre>
      </div>
<p>Axel’s solutions all rely on the fact that sparse items don’t have keys, and that Object.keys and Array.prototype methods therefore don’t iterate over them.  That’s a good insight and a good foundation for getting even more concise.  We can use a few tricks to do that.</p>
<p>Let’s start with his second solution, which was the shortest and clearest in practice and modify it a bit</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// We're comparing the length of the list of keys to the array length</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length
<span class="token comment">//But we can use reduce to do this instead (28 characters)</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> a<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>x<span class="token operator">=></span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span></code></pre>
      </div>
<p>So our first step is to use <code class="language-text">reduce</code> to save 2 characters.  If you haven’t seen <code class="language-text">reduce</code> before, I recommend checking out <a href="https://css-tricks.com/understanding-the-almighty-reducer/">this great explainer</a> by Sarah Drasner that I linked to in my <a href="https://benmccormick.org/2018/06/15/weekly-links-06-15-18/">Weekly Links post</a> last week.  Essentially though, reduce is a generic method for iterating through an array to produce a new value.  It takes a function and an initial value, and uses the items of the array to iteratively transform the initial value.  In this case, I’m just decrementing the value for each defined item in the array, starting at length and seeing if it equals 0.  Which ends up being shorter than taking the length of the keys array.  But we can still do better!</p>
<p>Our next step will take advantage of a property of numbers in JavaScript.  When converting numbers to booleans, <code class="language-text">0</code> is considered <em>falsy</em>, while every other number is considered <em>truthy</em>.  Since we want our function to produce a boolean, we can take advantage of this property, and write our function like this.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Boolean version (27 characters)</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>a<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>x<span class="token operator">=></span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>length<span class="token punctuation">)</span></code></pre>
      </div>
<p>That seems like a bit of a local maximum.  But getting to this point made me realize that we weren’t actually saving anything by using the boolean version over a comparison, since we can increment instead and end up at the same length.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Counting up to length (27 characters)</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> a<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>x<span class="token operator">=></span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length</code></pre>
      </div>
<p><del>Doing it this way though, we can actually save 2 more characters, because if reduce doesn’t have an initial value, it just uses the unmodified first element in an array as its initial value, and goes from there:</del></p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Final (broken) Version (25 characters)</span>
<span class="token comment">// UPDATE: This doesn't work</span>
<span class="token keyword">let</span> <span class="token function-variable function">isSparse</span> <span class="token operator">=</span> a <span class="token operator">=></span> a<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>x<span class="token operator">=></span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>a<span class="token punctuation">.</span>length</code></pre>
      </div>
<p><strong>Update: This last solution only works in situations where the array starts with <code class="language-text">1</code>.  So 27 is the best generic solution I can find at this point.  Thanks to <a href="https://twitter.com/rauschma/status/1009149034622275585">Axel</a> for correcting me. Code golf is hard 😔.</strong></p>
<p>So there you have it.  27 characters to identify sparse arrays.  I’d love to hear from you if you can do better.  Hit me up on <a href="https://twitter.com/ben336">Twitter</a> or by <a href="ben@benmccormick.org">email</a>.</p>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[A Codemod Survival Guide]]></title>
            <link>https://benmccormick.org/2018/06/18/codemod-survival/</link>
            <guid>https://benmccormick.org/2018/06/18/codemod-survival/</guid>
            <pubDate>Mon, 18 Jun 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>Do you like making repetitive syntax updates across many files?  Enjoy the thrill of painstakingly combing through 1000 line diffs that all look the same to see if you made any typos?  Relish that feeling of doubt in the back of your head as you wonder whether you actually caught all instances of the syntax you needed to update when you switched to the next major version of a library?  If so, you should probably stop reading now, because you won’t like codemods at all.  For the rest of us, codemods are a tool for assisting in large refactoring; they save you time and reduce typos.</p>
<p>Codemods originated at Facebook, first with a tool named <a href="https://github.com/facebook/codemod">codemod</a> that served as a helper for regex or python based refactoring, allowing you to make iterative changes with pretty diffs, then with <a href="https://github.com/facebook/jscodeshift">jscodeshift</a> a tool for doing more advanced JavaScript refactors that work directly against a data model representation of the code, rather than relying on regex or direct programmatic changes to text.  jscodeshift is extremely powerful, but I found it intimidating to approach.  Once I took the plunge though, it wasn’t that hard to start writing codemods.  So here are a few quick tips for anyone else who might be interested.</p>
<h4>1. Start with a goal in mind</h4>
<p>It’s always helpful to dive into a new technology by trying to solve a concrete problem.  That’s especially useful for codemods, because the ideas behind them can seem abstract and poorly documented until you begin focusing on a specific issue.  In my case I was originally motivated to look at codemods when updating an application from using MobX version 3 to MobX version 5.  In MobX3, when you write code without using decorators, a typical model class will look something like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> extendObservable<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> action<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            currentData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            otherData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">)</span><span class="token punctuation">,</span>
            setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">unrelatedMethod</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>I was updating an app with dozens of these model classes.  Unfortunately, in Mobx5, the syntax for these classes has changed, and it now needs to be rewritten like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> extendObservable<span class="token punctuation">,</span> action<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token keyword">get</span> <span class="token function">currentData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">get</span> <span class="token function">otherData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            setFoo<span class="token punctuation">:</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            setBar<span class="token punctuation">:</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">unrelatedMethod</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Computeds must be shifted to gets, action functions have to be pulled out of their wrapper function calls, but the wrapper and action names have to be moved down to a new second object.  This is really finicky to do by hand or with a text editor macro, because it’s a lot more complicated than just find and replace.  I’d usually be converting from arrow functions that might or might not have blocks and return statements currently, and I’d have to move the actions down to the new object correctly even though some of the models had 10+ action functions.   Facing several hours worth of finicky manual or script assisted refactoring work was enough to convince me it was time to learn about codemods.</p>
<h4>2. Create a small example and learn about its AST</h4>
<p>My first productive step towards creating a Mobx3to5 codemod for my codebase was creating the example code above.  I iterated on it a bit as I found new things I cared about; I didn’t realize at first that computeds needed to be changed as well as actions, and I eventually realized I needed to handle 2 types of arrow function syntax. But the initial version I wrote got me going.  Having a stripped down example of the code I cared about without the baggage of my real codebase was valuable, and being able to update it to include all the cases I cared about during testing was even better.</p>
<p>Once I created the example, I was able to understand better what I was trying to do by examining its AST.  An AST (Abstract Syntax Tree) is a representation of a JavaScript file’s source code as a tree data structure.  For instance here’s a portion of the AST for a basic Hello World program:</p>
<div class="gatsby-highlight" data-language="json">
      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Program"</span><span class="token punctuation">,</span>
  <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ExpressionStatement"</span><span class="token punctuation">,</span>
      <span class="token property">"expression"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"CallExpression"</span><span class="token punctuation">,</span>
        <span class="token property">"callee"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"MemberExpression"</span><span class="token punctuation">,</span>
          <span class="token property">"object"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"console"</span><span class="token punctuation">,</span>
            <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"property"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"log"</span><span class="token punctuation">,</span>
            <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"computed"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"MemberExpression"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Literal"</span><span class="token punctuation">,</span>
            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span>
            <span class="token property">"rawValue"</span><span class="token operator">:</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span>
            <span class="token property">"raw"</span><span class="token operator">:</span> <span class="token string">"'Hello World'"</span><span class="token punctuation">,</span>
            <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"Literal"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"CallExpression"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"_babelType"</span><span class="token operator">:</span> <span class="token string">"ExpressionStatement"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>This is a simplified example that looks only at the semantic structure of the syntax.  The full version also contains information about the indenting and exact text of the code, and comes out to about 600 lines when represented as formatted JSON.   All of this from <code class="language-text">console.log(&#39;Hello World&#39;);</code>.  Fortunately there’s a nice tool for exploring ASTs.</p>
<p><a href="http://astexplorer.net/">AST Explorer</a> is a site that lets you enter some JavaScript code, and then visualize the AST that represents the code.  When I put my example code above, in, I was able to see that the computed expressions in my original code showed as a <code class="language-text">CallExpression</code> with an <code class="language-text">ArrowFunctionExpression</code> as an argument.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-d5dfd.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 570px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 52.06143896523848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABj0lEQVQoz32Sy47TMBRA8/8LVkjzFbBgx0gsGXXJBhhVQ1HiOG/bafNumh5uMpkhI0EtXdm6j+P78ipb47KaIBwwbqKqoWpg6CdUoPn6sONx/4Tv+0RRhFKKOI4JgoBIh6hQobXGWkue53h931KdDL+e9kRhyNClXKeK+XT9gHUOI85FUSwyBxljyBKBaZ+fSqOShNJZnPh6bRNJ6A/S6Bvq93dC/4HSHmiamrqqlp9nx7dSYouEQCsOiSUpZt1x8fXaVupjosgNaWIo8yN9PdK0Z2bbC3C+X8WdcMWBTH9AxV8wxT0ntxPbnGHbLuWdh4G+6xiGnulyWXSzbZvh8l6BR7enjN+h4ztO5j2N+yj2Eq+ua+lhJX1xtN3I9vwfeMQZnyL5RJzek+WfpU27tYcSNF0mye7MZZq4Xq+L/Av4Cl1vX4UEUSZly9CMfCKD8cbxbVa3gH8zlMmbXCBm0T1P+Lm/3nkFbkE3gesdRDFa1mVeo5dVWkoeN8BtlreAxhr2QYwSaJKmi+Syo7PtD7qx9vy8Vq9QAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="AST explorer screenshot showing the CallExpression syntax"
        title=""
        src="/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-d766e.png"
        srcset="/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-a6b6e.png 143w,
/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-8e488.png 285w,
/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-d766e.png 570w,
/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-13239.png 855w,
/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-cab6d.png 1140w,
/static/computed-ast-566c7da27d68ddf6d09c7859481c3a91-d5dfd.png 1237w"
        sizes="(max-width: 570px) 100vw, 570px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>When I put the result code I wanted in, I could see that I would need to switch the property that contained the callexpression to have a type <code class="language-text">get</code> and would need to replace the call expression with a function expression.</p>
<h4>3. Start with a small edit</h4>
<p>As a starting point, I decided I wanted to write a script that could find MobX classes and just add the second object argument to extendObservable, with a dummy property.  So this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    currentData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    otherData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">)</span><span class="token punctuation">,</span>
    setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>would become this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    bar<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    currentData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> foo <span class="token operator">||</span> bar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    otherData<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> foo <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">)</span><span class="token punctuation">,</span>
    setFoo<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Foo'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    setBar<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'Set Bar'</span><span class="token punctuation">,</span> val <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>To do this, I took an existing script that I found in <a href="https://github.com/jhgg/js-transforms">this repo of small codemod examples</a> and modified it to lookup <code class="language-text">extendObservable</code> calls and add a second argument.  I filtered it to only include calls with 2 arguments, in case I ran the code a second time<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>file<span class="token punctuation">,</span> api<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">j</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span>
        <span class="token comment">// We're looking for a CallExpression for extend observable</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>CallExpression<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            callee<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'extendObservable'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=></span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"ObjectExpression"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Now we want to</span>
            <span class="token comment">// 1. Add a 3rd argument object</span>
            <span class="token keyword">let</span> args <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
            args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span>j<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span>j<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// TODO: 2. Move action declarations to that argument</span>
            <span class="token comment">// TODO: 3. Convert action statements to plain functions</span>
            <span class="token comment">// TODO: 4. Convert computeds to get statements</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>This is a working script to achieve my simple goal.  To break it down:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token function">j</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>CallExpression<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            callee<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'extendObservable'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>jscodeshift provides a jQuery style api for traversing a tree.  Here we’re looking for <code class="language-text">CallExpression</code>s that have the name <code class="language-text">extendObservable</code>.  We now have a collection of these expressions, and we can filter it down to only the expressions that have 2 arguments.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=></span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"ObjectExpression"</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>Next we want to go through each callExpression and transform it.  In this case by finding it’s arguments list and pushing a new one, using the jsCodeshift API to simply generate the AST objects neededed to represent <code class="language-text">{foo: bar}</code>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Now we want to</span>
            <span class="token comment">// 1. Add a 3rd argument object</span>
            <span class="token keyword">let</span> args <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
            args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span>j<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span>j<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// TODO: 2. Move action declarations to that argument</span>
            <span class="token comment">// TODO: 3. Convert action statements to plain functions</span>
            <span class="token comment">// TODO: 4. Convert computeds to get statements</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>Finally, we call <code class="language-text">.toSource()</code> to write the tranformed AST back to the file.</p>
<h4>4. Test your edit</h4>
<p>Because this type of coding lends itself to experimentation, it’s important to develop a good feedback loop while working on your codemod.  If you have a simple example you’re off to a good start.  The next step is to find a good way to run your script and see the output.  Simply running your test is a bit frustrating, because jscodeshift is destructive.  It overwrites your file in place, and doesn’t save a copy.  You can get around this though by adding <code class="language-text">--dry --print</code> flags to your command line call</p>
<p><code class="language-text">jscodeshift -t my-codemod.js example.js</code></p>
<p>will run the transform defined in <code class="language-text">my-codemod.js</code> against <code class="language-text">example.js</code> and modify it in place.</p>
<p><code class="language-text">jscodeshift --dry --print -t my-codemod.js example.js</code></p>
<p>will print the transformed file to the console and not update example.js.</p>
<p>For simple codemods and small example files, this is a nice way to iterate quickly.  For more extensive codemods with multiple test cases, I’m excited to try out jscodeshift’s Jest support<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>.  It has helper methods for working with transforms, and a workflow of Jest watch checking the output of several inputs against several expected outputs would be lovely.</p>
<h4>5. Iterate</h4>
<p>After I got that first edit working, it was simply a matter of working through my list.  I needed to remove the experimental <code class="language-text">foo:bar</code> and then</p>
<ol>
<li>Move action declarations to the new argument object</li>
<li>Convert action declarations to plain functions in the existing object</li>
<li>Convert computeds to get statements</li>
</ol>
<p>I was able to take those one at a time, and my final script looked something like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>file<span class="token punctuation">,</span> api<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">buildDecoratorPropertiesFromCurrentObject</span> <span class="token operator">=</span> currentObj <span class="token operator">=></span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> decoratorProps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        currentObj<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prop <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'CallExpression'</span> <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'computed'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                prop<span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'get'</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> fnBody <span class="token operator">=</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>fnBody<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'ArrowFunctionExpression'</span> <span class="token operator">&amp;&amp;</span> fnBody<span class="token punctuation">.</span>body<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'BlockStatement'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    prop<span class="token punctuation">.</span>value <span class="token operator">=</span> j<span class="token punctuation">.</span><span class="token function">functionExpression</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fnBody<span class="token punctuation">.</span>params<span class="token punctuation">,</span>
                        j<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span>j<span class="token punctuation">.</span><span class="token function">returnStatement</span><span class="token punctuation">(</span>fnBody<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    prop<span class="token punctuation">.</span>value <span class="token operator">=</span> j<span class="token punctuation">.</span><span class="token function">functionExpression</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fnBody<span class="token punctuation">.</span>params<span class="token punctuation">,</span> fnBody<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> dataProps <span class="token operator">=</span> currentObj<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>prop <span class="token operator">=></span> <span class="token operator">!</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'CallExpression'</span> <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'computed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataProps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>prop <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'CallExpression'</span> <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'action'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// copy action to the decorator area first...</span>
                <span class="token keyword">let</span> args <span class="token operator">=</span> prop<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
                <span class="token keyword">let</span> dupProp <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
                dupProp<span class="token punctuation">.</span>value <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> dupProp<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                dupProp<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                decoratorProps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dupProp<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// then flatten things out</span>
                prop<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>dataProps<span class="token punctuation">,</span> decoratorProps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">j</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span>
        <span class="token comment">// We're looking for a CallExpression for extend observable</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>CallExpression<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            callee<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'extendObservable'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// Verify that it's only using 2 arguments so far, and that the second one is an Object Expression</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">=></span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"ObjectExpression"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Now we want to</span>
            <span class="token comment">// 1. Add a 3rd argument</span>
            <span class="token comment">// 2. Move action declarations to that argument</span>
            <span class="token comment">// 3. Convert action statements to plain functions</span>
            <span class="token comment">// 4. Convert computeds to get statements, or just move them down to the second object?</span>
            <span class="token keyword">let</span> args <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>
            <span class="token keyword">let</span> <span class="token punctuation">[</span>dataProps<span class="token punctuation">,</span> decoratorProps<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">buildDecoratorPropertiesFromCurrentObject</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> dataProps<span class="token punctuation">;</span>
            args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span>decoratorProps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>That looks rather crazy, but the <code class="language-text">buildDecoratorPropertiesFromCurrentObject</code> is mostly straightforward data manipulation, looking for some patterns in the data, and replacing them with a different pattern.  Everything else is just the same base code from our initial example.</p>
<h4>6. Use version control and code reviews!</h4>
<p>Actually running a finished transform against a codebase is crazy easy.  Just give it a base folder, and <code class="language-text">jscodeshift</code> will run your script against all JavaScript files in the directory.  This is definitely a “With great power comes great responsibility” tool though.  Before running jscodeshift across a large code base, make sure you are using version control and that you’ve checked in any other changes.  Because the script will update many files at once, you want to be able to isolate the change and review it carefully afterwards, to make sure that you see what is different, and that those changes look right.  In my case, I got to be <em>done</em> with my script twice, because the first time I thought it was ready to execute across all of the app files, things still went wrong.  It was easy to fix though, since I was able to just checkout my changes and try again.</p>
<h3>Resources</h3>
<p>If you have a change that you want to make to your codebase, but have been holding off because you think it would take forever, I definitely encourage you to check codemods out.  They’re not as scary as you think!  Here are some more resources to get started:</p>
<ul>
<li><a href="https://github.com/facebook/jscodeshift">facebook/jscodeshift</a></li>
<li><a href="http://astexplorer.net/">AST Explorer</a></li>
<li><a href="https://medium.com/@andrew_levine/writing-your-very-first-codemod-with-jscodeshift-7a24c4ede31b">Writing Your First codemod with jscodeshift</a></li>
<li><a href="https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb">Effective JavaScript Codemods</a></li>
</ul>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>This is one of many assumptions I made that won’t be true for MobX classes generally.  I was writing a script to convert my app to MobX5 compatible syntax, not write a general case update tool.  In the end there were a few examples that violated my assumptions in the codebase, and I had to update 2 files by hand.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>jscodeshift was created by Christoph Pojer who is also one of the primary maintainers of Jest.</p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
</ol>
</div>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[Weekly Links: June 15th]]></title>
            <link>https://benmccormick.org/2018/06/15/weekly-links-06-15-18/</link>
            <guid>https://benmccormick.org/2018/06/15/weekly-links-06-15-18/</guid>
            <pubDate>Fri, 15 Jun 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3>JavaScript &#x26; The Web</h3>
<p><a href="https://www.graphqlstack.com">GraphQL Stack</a></p>
<p>This is a nice overview of the technologies involved with GraphQL, for anyone who has heard of the technology but isn’t quite sure how it all fits together.</p>
<p><a href="https://css-tricks.com/understanding-the-almighty-reducer/">Understanding The Almighty Reducer | Sarah Drasner</a></p>
<p>Moving from a loop mindset to making proper use of forEach/map/filter/reduce was one of the biggest shifts I made when moving from Java development to JavaScript.  Reduce especially can be hard to learn initially, and it never becomes simple.  This is a great introduction for those who are unfamiliar or haven’t gotten comfortable with writing reducers yet.</p>
<h3>Software + Business</h3>
<p><a href="https://seths.blog/2018/06/on-paying-for-software/">On paying for software | Seth Godin</a></p>
<p>This mirrors my opinions on paying for software pretty well.  There’s a place in the world for free apps, and I definitely have passed on apps because of price before.  But the apps I’ve used that have had real value to me have almost always been paid, usually these days as an ongoing subscription.  The exceptions, like Twitter, tend to come with frustrating downsides that are difficult to disentangle from the free-to-play model.</p>
<h3>Tech World</h3>
<p><a href="https://www.theatlantic.com/science/archive/2018/06/its-possible-to-reverse-climate-change-suggests-major-new-study/562289/">Climate Change Can Be Reversed by Turning Air Into Gasoline | The Atlantic</a></p>
<p>This seems really promising.</p>
<p><a href="https://weblog.rogueamoeba.com/2018/06/14/on-the-sad-state-of-macintosh-hardware/">On The Sad State of Macintosh Hardware | Rogue Amoeba</a></p>
<p>I’m lucky enough to have access to 2 2015 era Macbook Pros (1 for home, 1 for work) and they’re amazing machines.  I’m hoping that they both have long lifespans. But I’m increasingly not sure what my next laptop will be whenever I next have a choice.  It seems like the laptops since then have lost some things I appreciate about my current laptops (Magsafe charger, HDMI port) and made the keyboard significantly worse, with minimum benefits.  I hope that Apple can right this ship.</p>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[Weekly Links: June 10th]]></title>
            <link>https://benmccormick.org/2018/06/10/weekly-links-06-10-18/</link>
            <guid>https://benmccormick.org/2018/06/10/weekly-links-06-10-18/</guid>
            <pubDate>Sun, 10 Jun 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3>JavaScript &#x26; The Web</h3>
<p><a href="https://daverupert.com/2018/06/the-react-is-just-javascript-myth/">The React is “just” JavaScript Myth | Dave Rupert</a></p>
<p>I’ve been thinking a lot about the reasons that JavaScript development is perceived as intimidating and over-complicated the past few weeks.  Might have a full post on that soon, but for now, there’s a good point here.</p>
<p>React is relatively simple at it’s core, but it’s difficult to find examples of using it in the wild, that don’t require you to learn Webpack/Babel/npm at minimum, and many “starting points” will also toss in Redux/React Router/Jest/etc as well.</p>
<p><a href="https://medium.com/@mweststrate/mobx-5-the-saga-continues-4852bce05572">MobX 5: the saga continues… | Michael Weststrate</a></p>
<p>MobX is the first major library I’ve seen to take advantage of proxies to give normal looking JavaScript objects/arrays magic powers<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.  This sort of “just make it work in the prettiest way possible” API is the type of thing that tends to produce really cool results as long as it works correctly 100% of the time, but becomes a huge pain as soon as it’s flaky.  I’ve never had any problems with MobX after using it for 2 years, so I’m hopeful seeing them as an early adapter here.  Will be interested to see if they start getting used more widely going forward.  If so, I hope that browser start thinking about how they can expose these types of patterns well in developer tools.  How do you drop into a side effect caused by a proxy in a debugger?  It’s an interesting problem</p>
<p><a href="http://2ality.com/2014/12/es6-proxies.html">Meta programming with ECMAScript 6 proxies | 2ality</a></p>
<p>In case I lost anybody with my discussion of the last link, here’s an old but good walkthrough of what Proxies are and how you can use them to create some pretty magical APIs.</p>
<h3>Microsoft Buying Github</h3>
<p><a href="https://changelog.com/spotlight/14">🔥 Our reactions to Microsoft buying GitHub |Adam Stacoviak &#x26; Jerod Santo</a></p>
<p>A <a href="https://changelog.com/">Changelog</a> podcast that summarizes the reaction of the 2 primary Changelog hosts to the annoucement as well as collecting reactions from around the internet.</p>
<p><a href="https://github.com/martenbjork/github-xp">github-xp | Mårten Björk</a></p>
<p>This is just fun.  A Chrome extension to render Github in the style of Windows XP.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>Even if they chose to announce that in the silliest way possible</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
</ol>
</div>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[ES6: The Bad Parts]]></title>
            <link>https://benmccormick.org/2018/06/05/es6-the-bad-parts/</link>
            <guid>https://benmccormick.org/2018/06/05/es6-the-bad-parts/</guid>
            <pubDate>Tue, 05 Jun 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>This month is the 3 year anniversary of the ECMAScript2015 spec, <a href="https://benmccormick.org/2015/09/14/es5-es6-es2016-es-next-whats-going-on-with-javascript-versioning">better known as ES6</a>.  It was a spec update that brought a ton of features to the JavaScript language, and the start of a new era of improving the language.  It was also the last “big bang” release of JavaScript, as TC39 has now moved to a pattern of annual small releases rather than making large multi-year language releases.</p>
<p>There has been a boatload of justified hype around ES6 over the last 4 years.  I’ve been writing all of my code using the modern spec during that time<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>. So this is a good time to step back and evaluate the features that were added.  Specifically there are some features that I used for a while that I’ve stopped using, because they made my code worse.</p>
<p>In his book <a href="https://amzn.to/2LJBY9z">JavaScript: The Good Parts</a> Douglas Crockford dedicated a chapter to the <em>Bad Parts</em> of JavaScript.  <em>The Bad Parts</em> are the features of JavaScript that he felt shouldn’t be used.  Fortunately there is nothing as bad in ES6 as some of the old JavaScript stinkers like coercive equality, eval or the <code class="language-text">with</code> statement.  ES6 was a well-designed release. But there are some features and patterns that I avoid. A JavaScript feature makes my <em>Bad Parts</em> list because:</p>
<ol>
<li><strong>It’s a trap.</strong>  The feature looks like it does one thing, but has unexpected behavior in some cases that can easily lead to bugs</li>
<li><strong>It increases the scope of the language for little benefit.</strong> The feature provides some small advantage, but requires the readers of my code to know about obscure features.  This is doubly true for <em>API features</em> where using the feature means that other code that interacts with my code must know about the feature.</li>
</ol>
<p>In that spirit, here are my <em>Bad Parts</em> of ES6.</p>
<h4>const</h4>
<p>In older versions of JavaScript, we declared variables with the var keyword<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>.  This was mostly fine, but <code class="language-text">var</code> has peculiarities.  It creates variables that are added to the global object, or scoped to a function, but don’t respect other block boundaries.  It is also possible to reference a <code class="language-text">var</code> declared variable before it is declared. These oddities occasionally come back to bite developers.  In response ES6 introduced 2 new keywords for declaring variables: <code class="language-text">let</code> and <code class="language-text">const</code>.  These solve the primary quirks of <code class="language-text">var</code>; they are block-scoped, so a variable declared inside of a loop is not referencable outside of that loop, and trying to access the variable before it is declared in code results in a reference error. This was a big step forward.  It was also confusing, because we were given 2 solutions.</p>
<p>A <code class="language-text">const</code> variable cannot be re-assigned after it has been declared. This is the only difference between <code class="language-text">const</code> and <code class="language-text">let</code>. This seems useful, and it can be.  The problem is the name. What it guarantees doesn’t match what most people expect from a <em>constant</em>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">CONSTANT</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment">// this will cause "TypeError: invalid assignment to const `CONSTANT`"</span>
<span class="token constant">CONSTANT</span> <span class="token operator">=</span> <span class="token number">345</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CONSTANT_ARR</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token constant">CONSTANT_ARR</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// this will print [1] without an error</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">CONSTANT_ARR</span><span class="token punctuation">)</span></code></pre>
      </div>
<p><code class="language-text">const</code> prevents reassignment, but it doesn’t make objects immutable.  This is a fairly weak guarantee for most value types.  Because this feature invites confusion, and <code class="language-text">const</code> is otherwise redundant with <code class="language-text">let</code>, I choose to always use <code class="language-text">let</code>.</p>
<h4>Template Literal Tags</h4>
<p><code class="language-text">const</code> is an example of the spec creating too many solutions to too few problems. Template literals are the inverse.  The template literal syntax was TC39’s way of tackling string interpolation and multi-line strings.  Then they decided to give it a string macro feature as well.</p>
<p>If you’ve never seen a template literal tag, they’re a little like <a href="https://github.com/tc39/proposal-decorators">decorators</a> for strings.  Here’s an example from <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">MDN</a>:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token string">'Mike'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myTag</span><span class="token punctuation">(</span>strings<span class="token punctuation">,</span> personExp<span class="token punctuation">,</span> ageExp<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> str0 <span class="token operator">=</span> strings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "that "</span>
  <span class="token keyword">var</span> str1 <span class="token operator">=</span> strings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// " is a "</span>

  <span class="token comment">// There is technically a string after</span>
  <span class="token comment">// the final expression (in our example),</span>
  <span class="token comment">// but it is empty (""), so disregard.</span>
  <span class="token comment">// var str2 = strings[2];</span>

  <span class="token keyword">var</span> ageStr<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ageExp <span class="token operator">></span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ageStr <span class="token operator">=</span> <span class="token string">'centenarian'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ageStr <span class="token operator">=</span> <span class="token string">'youngster'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> str0 <span class="token operator">+</span> personExp <span class="token operator">+</span> str1 <span class="token operator">+</span> ageStr<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> output <span class="token operator">=</span> myTag<span class="token template-string"><span class="token string">`that </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> person <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> age <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// that Mike is a youngster</span></code></pre>
      </div>
<p>This isn’t totally useless. <a href="https://codeburst.io/javascript-es6-tagged-template-literals-a45c26e54761">Here’s a roundup of some use cases</a>.  HTML sanitization is a useful trait.  And this is the currently the cleanest way to do things when you’re having to perform the same operation on all inputs to an arbitrary string template.  But that’s a relatively rare scenario, and you can also accomplish the same use cases with a (more verbose) function API rather than using tagged literals.  And for most things, the function API won’t even be worse.  This feature is not adding new capabilities, but is adding new concepts that future readers of my code have to be familiar with.  So I plan on staying clear as much as possible.</p>
<h4>Overly crazy destructuring expressions</h4>
<p>Some features are fine when used simply, but can spiral out of controls.  For instance, I am happy to write ternary statements like</p>
<p><code class="language-text">let conferenceCost = isStudent ? 50 : 200</code></p>
<p>but they become tough to follow if you start nesting them:</p>
<p><code class="language-text">let conferenceCost = isStudent ? hasDiscountCode ? 25 : 50 : hasDiscountCode ? 100 : 200</code>;</p>
<p>This is how I feel about destructuring.  Destructuring lets you pull variables out of objects or arrays</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">{</span>a<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// 2, 4</span></code></pre>
      </div>
<p>and also lets you rename variables, get nested values, and set defaults.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> val1<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>b<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> <span class="token punctuation">{</span>c<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> d<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>c<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>d<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token comment">// 2, 4, 5, 6</span></code></pre>
      </div>
<p>All of which is great, until you start combining those features.  For instance, this expression declares 4 variables, userName, eventType, eventDate, and eventId pulled out of different spots in the object structure of <code class="language-text">eventRecord</code>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> eventRecord <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"Ben M"</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token string">"ben@m.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  event<span class="token punctuation">:</span> <span class="token string">"logged in"</span><span class="token punctuation">,</span>
  metadata<span class="token punctuation">:</span> <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token string">"10-10-2017"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> <span class="token string">"123"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> userName <span class="token operator">=</span> <span class="token string">"Unknown"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  event<span class="token punctuation">:</span> eventType <span class="token operator">=</span> <span class="token string">"Unknown Event"</span><span class="token punctuation">,</span>
  metadata<span class="token punctuation">:</span> <span class="token punctuation">[</span>date<span class="token punctuation">:</span> eventDate<span class="token punctuation">]</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> eventId
<span class="token punctuation">}</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span></code></pre>
      </div>
<p>It’s pretty much impossible to follow.  Code like this is much easier to read with the destructuring split into parts or eliminated.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> eventRecord <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"Ben M"</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token string">"ben@m.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  event<span class="token punctuation">:</span> <span class="token string">"logged in"</span><span class="token punctuation">,</span>
  metadata<span class="token punctuation">:</span> <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token string">"10-10-2017"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> <span class="token string">"123"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> userName <span class="token operator">=</span> eventRecord<span class="token punctuation">.</span>user<span class="token punctuation">.</span>userName <span class="token operator">||</span> <span class="token string">'Unknown'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> eventDate <span class="token operator">=</span> eventRecord<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>date<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>event<span class="token punctuation">:</span>eventType<span class="token operator">=</span><span class="token string">'UnknownEvent'</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span>eventId<span class="token punctuation">}</span> <span class="token operator">=</span> eventRecord<span class="token punctuation">;</span></code></pre>
      </div>
<p>I don’t have a clear line for when destructuring has gone too far, but anytime I can’t look at it and instantly know what variables are being declared, I know it’s time to break things down for readability.</p>
<h4>Default Exports</h4>
<p>One nice thing about ES6 was the way it standardized things that had been accomplished using competing libraries.  Classes, Promises and modules all benefited from being folded into the spec after the community had time to absorb lessons learned from competitive user-land implementations.  ES6 modules are a great replacement for the AMD/CommonJS format wars, and provide a nice clean syntax for imports.</p>
<p>ES6 modules provide 2 main ways of exporting values: <em>named exports</em>, and <em>default exports</em>.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> mainValue <span class="token operator">=</span> 'This is the <span class="token keyword">default</span> <span class="token keyword">export</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> mainValue

<span class="token keyword">export</span> <span class="token keyword">const</span> secondaryValue <span class="token operator">=</span> 'This is a secondary value<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> secondaryValue2 <span class="token operator">=</span> 'This is another secondary value<span class="token punctuation">;</span></code></pre>
      </div>
<p>A module can define multiple named exports, but only a single default export.  When importing default exports, the importing file can give the default export any name as there isn’t any lookup on name.  Named exports are imported by using the name of the variable in the exporting file, though renaming is possible.</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// default import</span>
<span class="token keyword">import</span> renamedMainValue <span class="token keyword">from</span> <span class="token string">'./the-above-example'</span><span class="token punctuation">;</span>
<span class="token comment">// named import</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>secondaryValue<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./the-above-example'</span><span class="token punctuation">;</span>
<span class="token comment">// named import with a rename</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>secondaryValue <span class="token keyword">as</span> otherValue<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./the-above-example'</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Default exports <a href="https://esdiscuss.org/topic/moduleimport#content-0">were the preferred syntax of the folks designing ES6</a> and they intentionally gave it the cleanest syntax.  But in practice I’ve found named exports to be better.</p>
<ol>
<li>Named exports match the names of the imported variable by default, making searching easier for those not using intelligent tooling.</li>
<li>Named exports can be matched to variables in other values prior to an import statement being written, allowing niceties like <a href="https://code.visualstudio.com/updates/v1_18#_auto-import-for-javascript-and-typescript">auto-import</a> for those using intelligent tooling.</li>
<li>It’s possible to use named imports consistently for everything, but that’s only possible with default imports if you never want to export multiple values from a file.<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup> Using only named modules keep things simpler.</li>
</ol>
<p>Naming things is good.  It promotes consistency in discussion and code.  I use named exports because I like clarity.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>Thanks <a href="https://babeljs.io/learn-es2015/">Babel</a>!</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>Or global scope, or a property on an object, or a function declaration</p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
<li id="fn-3">
<p>Exporting objects with multiple values as properties seems like a workaround here, but that loses the tree-shaking value that ES6 Modules provide for bundlers like webpack.</p>
<a href="#fnref-3" class="footnote-backref">↩</a>
</li>
</ol>
</div>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[Weekly Links: June 3rd]]></title>
            <link>https://benmccormick.org/2018/06/03/weekly-links-06-03-18/</link>
            <guid>https://benmccormick.org/2018/06/03/weekly-links-06-03-18/</guid>
            <pubDate>Sun, 03 Jun 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3>JavaScript &#x26; The Web</h3>
<p><a href="https://developers.google.com/web/updates/2018/05/nic67#desktop-pwas">New in Chrome 67  - Desktop PWAs | Google Developers</a></p>
<p>Google has a new process for bundling web apps as installable applications, this time based on the emerging Progressive Web App semi-standard<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.  An interesting alternative approach for smaller applications that don’t need the full electron runtime, or education apps targeting Chromebooks</p>
<h3>Programming Tools</h3>
<p><a href="https://github.com/ambv/black">black: The uncompromising Python code formatter | Github</a></p>
<p>This looks like a Python version of <a href="https://prettier.io/">Prettier</a>, and something I’d be interested in playing with.</p>
<p><a href="https://facebook.github.io/jest/blog/2018/05/29/jest-23-blazing-fast-delightful-testing.html">Jest 23 | Jest Blog</a></p>
<p>Jest just keeps getting better.  This release brings interactive snapshot updating, so that you can approve some changes and not others.  That’s a big UX improvement and reason enough to upgrade, but looks like there are some improved matchers and new customizability options for power users as well.  A solid release.</p>
<h3>Tech &#x26; Business</h3>
<p><a href="https://www.theverge.com/2018/6/3/17422752/microsoft-github-acquisition-rumors">Microsoft has reportedly acquired Github | The Verge</a></p>
<p>Microsoft seems to be doing everything it can to earn back love and trust from developers.  Some of that has been by investing in new stuff like Visual Studio Code, some of it has been attitude, and then things like this are just buying somebody elses love.  But I think they’ve earned back enough good will at this point that most developers will be willing to give them a chance and not assume that this will automatically be a bad thing.  Which is a big change from 5 years ago.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>It’s a little vague still to really be considered a standard, but Microsoft and Google at least are providing broad support for similar sounding things that they both call PWAs, and Mozilla and Apple have been supporting the underlying technology if not the branding as much.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
</ol>
</div>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[Weekly Links: May 27th]]></title>
            <link>https://benmccormick.org/2018/05/27/weekly-links-05-27-18/</link>
            <guid>https://benmccormick.org/2018/05/27/weekly-links-05-27-18/</guid>
            <pubDate>Sun, 27 May 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3>Business &#x26; Technology</h3>
<p><a href="https://www.gatsbyjs.org/blog/2018-05-24-launching-new-gatsby-company/">Gatsby contributors form Gatsby Inc. | Gatsby Blog</a></p>
<p>This blog is built on <a href="https://www.gatsbyjs.org/">Gatsby</a>, and I’ve <a href="https://benmccormick.org/topics/gatsby">written</a> and <a href="https://www.slideshare.net/BenMcCormick/gatsby-intro">spoken</a> on it a few times in the past.  So I’m really excited to see what happens with the tech as it becomes a company, while continuing to be open source.  It will be really exciting to see where they take it from here, and I think they have a real chance to be successful, especially if they can get a foothold into the ecommerce world.</p>
<h3>Problem Solving</h3>
<p><a href="http://reinertsenassociates.com/the-cult-of-the-root-cause/">The Cult of the Root Cause | Donald Reinertsen</a></p>
<p>A really nice short post on problem solving, and how the quest to find the root cause for an issue can sometimes be a distraction.</p>
<h3>Books</h3>
<p><a href="https://amzn.to/2sgXJoo">Unbroken | Laura Hillenbrand</a></p>
<p>I’ve fallen behind on my quest to read 30 books in a year, but this month I was able to read a fantastic book that multiple friends had recommended: Unbroken.  With the <a href="https://www.imdb.com/title/tt7339792/">second movie</a> based on the book coming out this fall, you’ll probably start to hear about this book again.  It’s been around since 2010, but I didn’t read it when it was first popular, and now I wish I had.  It is an amazing story of human perseverence, surviving trauma, and ultimately grace.  It doesn’t oversimplify the human beings whose lives it chronicles, but still manages to shine on a light on the best and worst of the human condition.  Highly recommended.</p>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[Weekly Links: May 19th]]></title>
            <link>https://benmccormick.org/2018/05/19/weekly-links-05-19-18/</link>
            <guid>https://benmccormick.org/2018/05/19/weekly-links-05-19-18/</guid>
            <pubDate>Sat, 19 May 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3>JavaScript and the Web</h3>
<p><a href="https://changelog.com/reactpodcast">The React Podcast | Michael Jackson</a></p>
<p>I listen to a decent amount of podcasts, but I’ve usually found it tough to get into programming podcasts.  Without visually being able to see code, they’re usually either ultra high level, or get hard to follow when going into the details.  The changelog family of podcasts has generally been my favorite though, and the new<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> React podcast has been consistently excellent over it’s first 9 episodes.  Worth a listen.</p>
<p><a href="https://blog.mgechev.com/2018/05/09/introducing-guess-js-data-driven-user-experiences-web/?utm_source=ponyfoo+weekly&#x26;utm_medium=email&#x26;utm_campaign=115">Guess.js | Minko Gechev</a></p>
<p>This is a crazy look at what I suspect will be the next step in static site performance stuff.  This blog does some of the cool stuff mentioned here (we prefetch links on the page thanks to Gatsby, and I use google analytics at build time to determine popular pages and populate the Most Read Articles list on the main page) but this is next level, using analytics to efficiently prefetch.  Excited to try it on the site.</p>
<h3>Non-Tech</h3>
<p><a href="https://amzn.to/2LdnoXK">The Vision | Tom King</a></p>
<p>Ok so I’m pretty late on this one<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>, but Tom King’s <em>The Vision</em> is the best comic book I’ve read in years.  He’s got a <a href="https://amzn.to/2IwlMq1">pretty</a> <a href="https://amzn.to/2LcYQ0U">good</a> <a href="https://amzn.to/2Lh3ZFd">run</a> going on Batman now as well, but this is a brilliant self-contained story that holds up as well as anything I’ve seen. Great art as well.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>Newly relauched? I’m not totally sure of the history</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>The single edition Vision comics were originally released in 2015, though the hardcover that I purchased was just released this year.</p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
</ol>
</div>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[MobX Patterns: State Machines & Flags]]></title>
            <link>https://benmccormick.org/2018/05/14/mobx-state-machines-and-flags/</link>
            <guid>https://benmccormick.org/2018/05/14/mobx-state-machines-and-flags/</guid>
            <pubDate>Mon, 14 May 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>A few weeks ago, I was listening to the <a href="https://changelog.com/reactpodcast">React Podcast</a>, specifically their <a href="https://changelog.com/reactpodcast/5">episode on State Machines</a> with <a href="https://twitter.com/davidkpiano">David Khourshid</a>.  About 20 minutes into the podcast, there was a discussion on the benefits of using enums over flags to model the state of objects that can change across multiple dimensions.  It reminded me of one of the nice patterns that <a href="https://mobx.js.org/">MobX</a> makes possible, and I thought I’d share it here.</p>
<h3>Background</h3>
<p>To set the stage here, the podcast discussion centered around modeling an async process like a promise. One possible way given was to use a mix of flags and if statements like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// loading object</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleLoader</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//fetch data from server and return it here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>using one of these objects might look like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show error state</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show loading state</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// show data State</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>In the podcast David Khourshid criticized this as a haphazard way to manage state, that doesn’t show the whole picture.  Because we can’t easily see how the various flags combine, it’s tough to keep track of all possible states.  For instance, in the above example, did we really want to show the error state if we had an error, but have called <code class="language-text">load()</code> again and both <code class="language-text">hasError</code> and <code class="language-text">isLoading</code> are now true?  Maybe that was the intention, but maybe that was just a state that was missed during the original construction of the program.  It’s hard to tell.  </p>
<p>As an alternative to full blown state machine modeling, David advocated for an easy first step of swapping out flags for enums.  In that case the code above might look like:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">STATES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INITIAL</span><span class="token punctuation">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADING</span><span class="token punctuation">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
  <span class="token constant">ERROR</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADED</span><span class="token punctuation">:</span> <span class="token string">'loaded'</span>
<span class="token punctuation">}</span>
<span class="token comment">// loading object</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleLoader</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">INITIAL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//fetch data from server and return it here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token constant">LOADING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token constant">LOADED</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">LOADING</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">LOADED</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">ERROR</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>with usage like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">switch</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">:</span>
  <span class="token comment">// show error state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADING</span><span class="token punctuation">:</span>
  <span class="token comment">// show loading state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADED</span><span class="token punctuation">:</span>
  <span class="token comment">// show data State</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">INITIAL</span><span class="token punctuation">:</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
  <span class="token comment">// show blank state</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>We can see just from using an enum, we’ve cleared some ambiguity: now it is clear that we should be showing a loading state when we’re loading data, even if a previous load resulted in an error.  And we’ve also been forced to remember another state distinction that was missed originally, the difference between a successful load and the initial state before load is called.  This type of Enum-based approach is really helpful for modeling complex systems and especially async process state. But it’s not perfect.  While ENUMs are great for listing out every possible state, sometimes we just need to know if an object is in a particular state.  For instance, we might have a special help-prompt component that should only show if our data is in an error state, but is otherwise divorced from the details of the data.  In that case <code class="language-text">loader.hasError</code> is simpler and  cleaner than <code class="language-text">loader.state === STATES.ERROR</code>.  It’s a straight forward named expression that doesn’t require importing a constant from another file or matching up to a string value.  Enums add some verbosity and ceremony to code that can otherwise be very simple.  Fortunately MobX allows us to have our cake and eat it too.</p>
<h3>MobX</h3>
<p>MobX is a state management solution created by <a href="https://twitter.com/mweststrate">Michael Weststrate</a>.  It grew out of the React community but can be used with other frameworks or on it’s own.  One of its nicest features are its intelligently updated <a href="https://mobx.js.org/refguide/computed-decorator.html">computed properties</a>.  With MobX we can write our loader object like this:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>extendObservable<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">STATES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INITIAL</span><span class="token punctuation">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADING</span><span class="token punctuation">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
  <span class="token constant">ERROR</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token constant">LOADED</span><span class="token punctuation">:</span> <span class="token string">'loaded'</span>
<span class="token punctuation">}</span>
<span class="token comment">// loading object</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleLoader</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token constant">INITIAL</span><span class="token punctuation">,</span> <span class="token constant">LOADING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">;</span>
      <span class="token function">extendObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          state<span class="token punctuation">:</span> <span class="token constant">INITIAL</span><span class="token punctuation">,</span>
          isLoading<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">LOADING</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          hasError<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">ERROR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          updateState<span class="token punctuation">:</span> <span class="token function">action</span><span class="token punctuation">(</span>state <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//fetch data from server and return it here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token constant">LOADING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token constant">LOADED</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">STATES</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateState</span><span class="token punctuation">(</span><span class="token constant">LOADING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateState</span><span class="token punctuation">(</span><span class="token constant">LOADED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateState</span><span class="token punctuation">(</span><span class="token constant">ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Now we have both our state enum, and we can check specific properties.  So both of the below examples work:</p>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ENUM example</span>
<span class="token keyword">switch</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">:</span>
  <span class="token comment">// show error state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADING</span><span class="token punctuation">:</span>
  <span class="token comment">// show loading state</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">LOADED</span><span class="token punctuation">:</span>
  <span class="token comment">// show data State</span>
  <span class="token keyword">case</span> <span class="token constant">STATES</span><span class="token punctuation">.</span><span class="token constant">INITIAL</span><span class="token punctuation">:</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
  <span class="token comment">// show blank state</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<div class="gatsby-highlight" data-language="javascript">
      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">//Flags example</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show help component</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>And because MobX takes care of the details of efficiently updating our flags based on state, we know everything will stay in sync and remain performant, without a bunch of ugly code to make sure of that.</p>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
        <item>
            <title><![CDATA[Weekly Links: May 5th]]></title>
            <link>https://benmccormick.org/2018/05/05/weekly-links-05-05-18/</link>
            <guid>https://benmccormick.org/2018/05/05/weekly-links-05-05-18/</guid>
            <pubDate>Sat, 05 May 2018 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3>Intriguing Github Projects</h3>
<p><a href="https://github.com/mdx-js/mdx">MDX</a></p>
<p>Ever since I started using Gatsby to power this blog, I’ve wanted the ability to write markdown with React elements intermingled in it.  This looks like the first working version of that I’ve seen.  I’m excited to play with it.</p>
<p><a href="https://github.com/sharkdp/bat">bat: A cat(1) clone with wings | David Peter</a></p>
<p>This looks like a really cool project, a “cat” clone with syntax highlighting and git line indicators.  Lot’s of cool stuff being written in Rust these days.</p>
<h3>Tech and Business</h3>
<p><a href="https://www.sec.gov/Archives/edgar/data/1018724/000119312518121161/d456916dex991.htm">Amazon Letter To Shareholders | Jeff Bezos</a></p>
<p>I originally saw this letter in an article on <a href="https://stratechery.com/2018/divine-discontent-disruptions-antidote/">Stratechery</a>, (and that piece is also great).  It’s one of the best short pieces on business that I’ve ever read.  The Stratechery piece breaks down the idea of “divinely discontent customers”, which is an amazing image.  But the other advice about how to set and maintain high standards is even better.  Just great stuff, from the leader of one of the most important companies in the world.</p>
<h3>Fun</h3>
<p><a href="https://twitter.com/jhoff/status/991408768171855873">“What the customer really wanted 😏… “</a></p>
<p>This is a new variant on one of my favorite programming jokes<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">What the customer really wanted 😏 <a href="https://t.co/sDTbQsZb3U">pic.twitter.com/sDTbQsZb3U</a></p>&mdash; Jayme Hoffman (@jhoff) <a href="https://twitter.com/jhoff/status/991408768171855873?ref_src=twsrc%5Etfw">May 1, 2018</a></blockquote>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>If anyone knows where the original version of this joke is from let me know and I’ll credit it.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
</ol>
</div>]]></content:encoded>
            <author>ben@benmccormick.org (Ben McCormick)</author>
        </item>
    </channel>
</rss>