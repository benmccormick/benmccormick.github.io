<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=yyxgnp97qG"/><link rel="icon" type="image/png" href="/favicon-32x32.png?v=yyxgnp97qG" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png?v=yyxgnp97qG" sizes="16x16"/><link rel="manifest" href="/manifest.json"/><link rel="mask-icon" href="/safari-pinned-tab.svg?v=yyxgnp97qG" color="#57a3e8"/><link rel="shortcut icon" href="/favicon.ico?v=yyxgnp97qG"/><meta name="theme-color" content="#ffffff"/><script type="text/javascript" src="//use.typekit.net/msd6bqv.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><title data-react-helmet="true">Testing with Jest Snapshots: First Impressions | benmccormick.org</title><meta data-react-helmet="true" name="description" content="First impression of testing UI components using Jest snapshots"/><meta data-react-helmet="true" name="keywords" content="Jest JavaScript testing React Snapshot Tests"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:site" content="@benmccormickorg"/><meta data-react-helmet="true" name="twitter:creator" content="@ben336"/><meta data-react-helmet="true" name="twitter:title" content="Testing with Jest Snapshots: First Impressions"/><meta data-react-helmet="true" name="twitter:description" content="First impression of testing UI components using Jest snapshots"/><meta data-react-helmet="true" name="twitter:image" content="http://benmccormick.org/logo.png"/><script data-react-helmet="true" type="application/ld+json">{
                "@context": "http://schema.org"
                "@type": "BlogPosting",
                "headline": "Testing with Jest Snapshots: First Impressions",
                "genre": "Software Development",
                "keywords": "Jest JavaScript testing React Snapshot Tests",
                "url": "http://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/",
                "image": "http://benmccormick.org/logo.png",
                "datePublished": "2016-09-19",
                "description": "First impression of testing UI components using Jest snapshots",
                "articleBody": "<p>Over the past 6 months my team at work has been slowly transitioning a large Backbone application to React.  One of the main goals of the transition has been to build out unit tests as we transition components.  As part of that we switched from using Karma to using Jest for managing our tests.</p>
<p>Our new setup with Jest has several advantages over our previous setup. All Jest tests run through node using a fake DOM implementation.  We don’t need to start up a browser so tests are faster and less flaky <sup class=\"footnote-ref\"><a href=\"#fn1\" id=\"fnref1\">[1]</a></sup>.  Jest makes it possible to mock all modules by default <sup class=\"footnote-ref\"><a href=\"#fn2\" id=\"fnref2\">[2]</a></sup>, which works well for us since our code base currently contains a large amount of code that is difficult to test for one reason or another.  Jest provides great integration with Babel, which is helpful since all of our Backbone and React code uses ES6 that we transpile for the browser.  Finally Jest provides a wonderful watch mode that runs only the tests that are relevant to the changes you’ve made and makes it easy to see the result.</p>
<p>About a month ago, Jest debuted a new feature: Snapshot testing.  It works a bit differently than a normal unit test.  Instead of executing some code and comparing the output against a value provided by a developer, the first time a test is run, the output passed into the test is saved to a “snapshot file”.  Then when the test is run in the future, the output is compared to the snapshot file.  If the output matches the file, the test passes, if the output is different then the file, the test fails and Jest prints a diff.  We’ve been using Jest snapshots for a few weeks now and I wanted to share my initial impressions.</p>
<h3>What is it like to use a snapshot test ?</h3>
<p>The process for snapshot testing is a bit different than normal tests.  Most snapshot tests look fairly simple.  Something like this example from the <a href=\"https://github.com/facebook/jest/tree/master/examples/snapshot\">Jest repository</a>:</p>
<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// Link.react.js</span>
<span class=\"hljs-comment\">// Copyright 2004-present Facebook. All Rights Reserved.</span>

<span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;

<span class=\"hljs-keyword\">const</span> STATUS = {
  <span class=\"hljs-attr\">NORMAL</span>: <span class=\"hljs-string\">'normal'</span>,
  <span class=\"hljs-attr\">HOVERED</span>: <span class=\"hljs-string\">'hovered'</span>,
};

<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Link</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">React</span>.<span class=\"hljs-title\">Component</span> </span>{

  <span class=\"hljs-keyword\">constructor</span>() {
    <span class=\"hljs-keyword\">super</span>();

    <span class=\"hljs-keyword\">this</span>._onMouseEnter = <span class=\"hljs-keyword\">this</span>._onMouseEnter.bind(<span class=\"hljs-keyword\">this</span>);
    <span class=\"hljs-keyword\">this</span>._onMouseLeave = <span class=\"hljs-keyword\">this</span>._onMouseLeave.bind(<span class=\"hljs-keyword\">this</span>);

    <span class=\"hljs-keyword\">this</span>.state = {
      <span class=\"hljs-attr\">class</span>: STATUS.NORMAL,
    };
  }

  _onMouseEnter() {
    <span class=\"hljs-keyword\">this</span>.setState({<span class=\"hljs-attr\">class</span>: STATUS.HOVERED});
  }

  _onMouseLeave() {
    <span class=\"hljs-keyword\">this</span>.setState({<span class=\"hljs-attr\">class</span>: STATUS.NORMAL});
  }

  render() {
    <span class=\"hljs-keyword\">return</span> (
      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span>
        <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">{this.state.class}</span>
        <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">{this.props.page</span> || '#'}
        <span class=\"hljs-attr\">onMouseEnter</span>=<span class=\"hljs-string\">{this._onMouseEnter}</span>
        <span class=\"hljs-attr\">onMouseLeave</span>=<span class=\"hljs-string\">{this._onMouseLeave}</span>&gt;</span>
        {this.props.children}
      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span>
    );
  }

}

<span class=\"hljs-comment\">// Link.react-test.js  (partial)</span>
<span class=\"hljs-comment\">// Copyright 2004-present Facebook. All Rights Reserved.</span>
<span class=\"hljs-comment\">/* eslint-disable no-unused-vars */</span>
<span class=\"hljs-meta\">
'use strict'</span>

<span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;
<span class=\"hljs-keyword\">import</span> Link <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../Link.react'</span>;
<span class=\"hljs-keyword\">import</span> renderer <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react-test-renderer'</span>;

it(<span class=\"hljs-string\">'renders correctly'</span>, () =&gt; {
  <span class=\"hljs-keyword\">const</span> tree = renderer.create(
    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Link</span> <span class=\"hljs-attr\">page</span>=<span class=\"hljs-string\">\"http://www.facebook.com\"</span>&gt;</span>Facebook<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Link</span>&gt;</span></span>
  ).toJSON();
  expect(tree).toMatchSnapshot();
});

</code></pre>
<p>The first time the test is run, a snapshot file is produced.  In this case, running the previous test produces a snapshot file that looks like this:</p>
<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// Link.react-test.js.snap  (partial)</span>
exports[<span class=\"hljs-string\">`test renders correctly 1`</span>] = <span class=\"hljs-string\">`
&lt;a
  className=\"normal\"
  href=\"http://www.facebook.com\"
  onMouseEnter={[Function bound _onMouseEnter]}
  onMouseLeave={[Function bound _onMouseLeave]}&gt;
  Facebook
&lt;/a&gt;
`</span>;
</code></pre>
<p>This gives us a baseline for what we expect the UI to look like.  The snapshot is generated in a folder in your <code>__tests__</code> directory, so that it can be checked into source control.</p>
<p>The next time a test is run, if nothing has changed, the test passes.  However, if we change something (let’s say we add a class), the test fails and shows us a diff.</p>
<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// updated link render method</span>

render() {
  <span class=\"hljs-keyword\">return</span> (
    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span>
      <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">{</span>`<span class=\"hljs-attr\">link-item</span> ${<span class=\"hljs-attr\">this.state.class</span>}`}
      <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">{this.props.page</span> || '#'}
      <span class=\"hljs-attr\">onMouseEnter</span>=<span class=\"hljs-string\">{this._onMouseEnter}</span>
      <span class=\"hljs-attr\">onMouseLeave</span>=<span class=\"hljs-string\">{this._onMouseLeave}</span>&gt;</span>
      {this.props.children}
    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span></span>
  );
}
</code></pre>
<pre><code class=\"language-diff\">
# jest output

FAIL  __tests__/Link.react-test.js
 ✕ renders correctly (16ms)

● renders correctly

    Received value does not match the stored snapshot 1.

    - Snapshot
    + Received

      &lt;a
<span class=\"hljs-deletion\">-       className=\"normal\"</span>
<span class=\"hljs-addition\">+       className=\"link-item normal\"</span>
        href=\"http://www.facebook.com\"
        onMouseEnter={[Function bound _onMouseEnter]}
        onMouseLeave={[Function bound _onMouseLeave]}&gt;
        Facebook
      &lt;/a&gt;

      at Object.&lt;anonymous&gt; (__tests__/Link.react-test.js:14:16)
</code></pre>
<p>We can then choose to accept this change by running <code>jest -u</code> to update the snapshot, or update our code to fix the regression.  If we update the snapshot file, the test will start passing again.</p>
<h3>Snapshot tests are a complement for conventional tests not a replacement</h3>
<p>The first thing that became clear to me while using snapshot testing is that they’re not for everything.  They are optimized for a different case than normal assertion-based tests.</p>
<p>Classic assertion based tests are perfect for testing clearly defined behavior that is expected to remain relatively stable.</p>
<p>Snapshot tests are great for testing less clearly defined behavior that may change often.</p>
<p>Snapshot testing is perfect for things that in the past would have raised concern for “overly brittle” tests that slow development teams down.  The classic example of this (and the main focus of discussion around Jest snapshots so far) is UI testing.</p>
<p>UI components often change in small and trivial ways.  Copy is changed, whitespace is added, a border color is modified. Generally this means that developers have to choose between detailed tests that catch any regression but require constant updates, or less detailed tests that focus on core behaviors but miss smaller regressions.</p>
<p>Snapshot tests provide a new way of approaching these problems in unit tests.  Because they are easy to write and effortless to update, and provide a clear view of what changed after each update, whether it is major or minor.</p>
<p>This isn’t without any disadvantage. Snapshot tests preserve a starting point, but don’t give any indication of developer intent to future developers.  Like any other test, if the initial snapshot passes with bugs, or doesn’t capture the full range of cases, the test won’t adequately cover those behaviors.  But unlike traditional tests, snapshot tests don’t provide specific guidance for what the original developer expected beyond the “actual behavior”.  If there are multiple sub-behaviors that interact to produce output, its not clear which of those are essential, and which are incidental.  That’s not something you want for your critical application logic, especially complicated logic with many subtle cases.  But for UI components and other application elements that are likely to change a lot over time, this is a good set of tradeoffs.</p>
<h3>Snapshot tests are more useful with a healthy code review process</h3>
<p>I’ve pointed out several times now that snapshot tests are easy to update.  One of the downsides of the current design is that they can be almost too easy to update.  When a snapshot test fails, you have the option of modifying the output so that the test passes again, or updating the snapshot to reflect the new output.  Unfortunately, Jest currently provides no granularity for this updating.  Running <code>jest -u</code> to update the snapshots will update all snapshots.  So if  a single change causes many snapshots to break, it can be easy to accidentally update all of them, and possibly difficult to work through the whole diff to find changes.</p>
<p>A robust code review process minimizes these problems.  Because snapshots are checked into source, the diffs in the snapshots are checked into source control.  Viewing diffs in a dedicated code review tool like Github, Bitbucket or Gitlab, it’s easier to see exactly what changed over many files than it might be when updating snapshots from the command line, and if you update a snapshot multiple times in a single branch, you can see the net effect on the snapshot through source control diffs better than you can through Jest.</p>
<h3>Snapshot tests work well with auto-mocking</h3>
<p>Auto-mocking has been one of Jest’s more controversial features.  Prior to version 15, Jest mocked every module used in tests by default.  To run the actual module code, it was necessary to manually unmock each module used or change Jest configurations.  Though it is now disabled by default, auto-mocking actually works very well with snapshot tests.  One problem with tests that rely on generating DOM in React is the fact that most components of any complexity are actually made up of smaller components, that often use external functions with complex logic to determine what to show.  If we fully render everything, changing any of those pieces can break tests for many components, moving us away from the concept of a “unit test”.  If we mock child components and helper functions and then test them individually though, we can focus our tests to only change based on the logic of the individual component being tested.  This is incredibly easy with Jest, and especially helpful in large code bases that don’t have complete test coverage.  Auto-mocking is considered an “advanced feature” of Jest, but it’s not hard to use.  Most mocked modules produce something non-harmful by default, and when its necessary to override, its not difficult to produce something meaningful without getting too involved.  Just add a file with the same name as the file to be mocked into a <code>__mocks__</code> folder in that directory, and give the mocked module the same interface as the mocked component.  You can either write it from scratch or use <a href=\"http://facebook.github.io/jest/docs/api.html#jest-genmockfrommodule-modulename\">jest.genMockFromModule</a> as a starting place.</p>
<h3>Summary</h3>
<p>I’m impressed by Jest snapshots.  When combined with React, they’re providing my first non-frustrating experience unit testing UI components.  I’m excited to use them more going forward, and will be interested to see how they evolve from here.</p>
<hr>
<h3>Extra: A few miscellaneous Jest Thoughts</h3>
<ul>
<li>The UI output from Jest 15 tests is the best I’ve ever seen from a testing framework.  Aside from the nice diffs on snapshots, they do a good job explaining how output differed from expectations in assertion based tests, and communicating context for test failures, warnings and logging messages.  They also give great guidance when making configuration changes:</li>
</ul>
<div style=\"display:flex; justify-content:center\">
<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\"><a href=\"https://twitter.com/cpojer\">@cpojer</a> This is lovely, thank you! <a href=\"https://t.co/CX1v11CAVc\">pic.twitter.com/CX1v11CAVc</a></p>&mdash; Ben McCormick (@ben336) <a href=\"https://twitter.com/ben336/status/772906536154894336\">September 5, 2016</a></blockquote>
</div>
<ul>
<li>
<p>I’ve also been super impressed with Jest’s watch mode in Jest 15.  <code>--watch</code> makes it easy to focus on a few files or run tests on all files, and stays up to date as you change code.  If you haven’t worked with Jest in a while, the developer experience alone makes it worth trying out.</p>
</li>
<li>
<p>One potential future annoyance with snapshot tests:  The snapshot format can’t be iterated on without breaking all current tests.  Make sure not to mix functional changes with Jest updates!</p>
</li>
</ul>
<div style=\"display:flex; justify-content:center\">
<blockquote class=\"twitter-tweet\" data-cards=\"hidden\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">We&#39;ll update the snapshot format sometimes in minor/major releases. When updating Jest, please update snapshots<br><br>See <a href=\"https://t.co/gPE63dMz8P\">https://t.co/gPE63dMz8P</a></p>&mdash; Christoph Pojer (@cpojer) <a href=\"https://twitter.com/cpojer/status/776623521069805568\">September 16, 2016</a></blockquote>
</div>
<h3>More Resources</h3>
<ul>
<li>
<p>Randy Coulman has a <a href=\"http://randycoulman.com/blog/2016/09/06/snapshot-testing-use-with-care/\">nice article</a> on some of the reasons to be careful about embracing snapshot testing.  He makes good points about the requirement of human involvement in verifying a change in time-crunched situations and also the potential value of snapshot tests for legacy code.</p>
</li>
<li>
<p>My team uses a mix of <a href=\"https://github.com/airbnb/enzyme\">enzyme</a> and snapshot tests for unit testing React Components.  <a href=\"https://github.com/trayio/enzyme-to-json?utm_content=buffer6b78b&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer\">This repo</a> combines them, allowing you to use enzyme to generate the snapshot output to diff against rather than the renderer provided by Jest. I personally haven’t felt the need to integrate these two tools, but if your team uses enzyme and wants consistency/fewer (used) dependencies, this could be a cool option.</p>
</li>
<li>
<p>Finally here’s <a href=\"https://blog.grommet.io/post/2016/09/01/how-we-landed-on-jest-snapshot-testing-for-javascript\">another article</a> on how Snapshot testing convinced one team to migrate to Jest from Tape</p>
</li>
</ul>
<hr class=\"footnotes-sep\">
<section class=\"footnotes\">
<ol class=\"footnotes-list\">
<li id=\"fn1\" class=\"footnote-item\"><p>PhantomJS was a tremendous source of pain in our Karma setup. <a href=\"#fnref1\" class=\"footnote-backref\">↩︎</a></p>
</li>
<li id=\"fn2\" class=\"footnote-item\"><p>This used to be the default setting, with Jest 15 it can be configured to work that way. <a href=\"#fnref2\" class=\"footnote-backref\">↩︎</a></p>
</li>
</ol>
</section>
",
                  "author": {
                    "@type": "Person",
                    "name": "Ben McCormick"
                    "email": "mailto:ben@benmccormick.org",
                    "image": "/profile_pic.jpg",
                    "jobTitle": "Software Engineer",
                    "alumniOf": "Duke",
                    "birthPlace": "Pittsburgh, PA",
                    "gender": "male",
                    "url": "http://benmccormick.org",
              	    "sameAs" : [
                      "https://www.linkedin.com/in/benmccormick",
                      "http://twitter.com/ben336",
                    ]
                 }
              }</script><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.55em brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.5rem;line-height:2.325rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.27542rem;line-height:1.55rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.17608rem;line-height:1.55rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.55rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.92211rem;line-height:1.55rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;color:inherit;font-family:brandon-grotesque,Brandon Grotesque,Helvetica Neue,Helvetica,Arial,Lucida Sans,Geneva,Verdana,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.88547rem;line-height:1.55rem;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}ul{margin-left:1.55rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.55rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;font-size:0.85rem;line-height:1.1;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.1625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;font-size:1rem;line-height:1.55rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}blockquote{margin-left:1.55rem;margin-right:1.55rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.1625rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.1625rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.1625rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.55rem;margin-bottom:calc(1.1625rem / 2);margin-top:calc(1.1625rem / 2);}li > ul{margin-left:1.55rem;margin-bottom:calc(1.1625rem / 2);margin-top:calc(1.1625rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.1625rem / 2);}code{font-size:0.85rem;line-height:1.55rem;}kbd{font-size:0.85rem;line-height:1.55rem;}samp{font-size:0.85rem;line-height:1.55rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;-moz-font-feature-settings:tnum;-ms-font-feature-settings:tnum;-webkit-font-feature-settings:tnum;padding-left:1.03333rem;padding-right:1.03333rem;padding-top:0.775rem;padding-bottom:calc(0.775rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;font-size:75%;}pre code{background:none;line-height:1.1;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}h1,h2,h3,h4,h5,h6{line-height:1.1;}@media only screen and (max-width:480px){html{font-size:112.5%;}}</style><style>.header-link{color:hsla(0,0%,39%,.7)}.header-link:hover{color:#e2777a}#carbonads{height:100px;font-size:14px;width:300px;position:relative;background:#f0f0f0}.carbon-wrap{height:100px;display:-ms-flexbox;display:flex}.carbon-text{padding:5px 10px;max-height:80px;display:inline-block;overflow:hidden;line-height:1.3}.carbon-poweredby{color:hsla(0,0%,39%,.7);position:absolute;right:5px;bottom:0}@media (max-width:600px){#carbonads,.no-mobile{display:none}.subscribe-block{padding-right:0;padding:0 10px}.subscribe-block,.subscribe-block .mc-field-group{width:100%!important}.subscribe-block .mc-field-group input{width:100%!important;font-size:.8em;height:2.4em}.up-next-block{width:100%!important;padding:0 10px}}@media (max-width:321px){html{font-size:100%!important}}.subscribe-container{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-wrap:wrap;flex-wrap:wrap}.subscribe-block{width:400px;padding-right:30px;overflow:hidden}.subscribe-block #mc_embed_signup form{margin-bottom:20px}.up-next-block{width:300px}.subscribe-button{color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:5px 10px;margin:20px 0;cursor:pointer}.rss{padding-bottom:10px}.rss a{display:-ms-flexbox;display:flex}.rss-icon{display:block;width:17px;margin-right:.5em;height:50px}.rss-icon *{fill:#e2777a}.twitter-item{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;margin-bottom:15px}.twitter-item iframe{margin:0 0 0 10px}.hljs,.markdown pre{display:block;background:#fdf6e3;color:#657b83}.hljs{overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#93a1a1}.hljs-addition,.hljs-keyword,.hljs-selector-tag{color:#859900}.hljs-doctag,.hljs-literal,.hljs-meta .hljs-meta-string,.hljs-number,.hljs-regexp,.hljs-string{color:#2aa198}.hljs-name,.hljs-section,.hljs-selector-class,.hljs-selector-id,.hljs-title{color:#268bd2}.hljs-attr,.hljs-attribute,.hljs-class .hljs-title,.hljs-template-variable,.hljs-type,.hljs-variable{color:#b58900}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-meta .hljs-keyword,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol{color:#cb4b16}.hljs-built_in,.hljs-deletion{color:#dc322f}.hljs-formula{background:#eee8d5}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}a{color:#e2777a;text-decoration:none}blockquote{border-left:5px solid #57a3e8;font-style:italic;background:#eee;font-weight:400;font-size:.9rem;padding:10px 20px;margin:0 0 30px -25px}blockquote p{margin-bottom:.667em}h2,h3{color:#57a3e8}.explanation{padding:10px;background:#eee;border-radius:10px;margin:20px auto;font-size:.85em}.footnote p{display:inline-block;margin-bottom:0}.article-body .reading-img img{width:150px;float:right;margin:0 10px 20px}.article-body img{max-height:200px;display:block;margin:40px auto 20px}.article-body img.full-width{max-height:none}.article-body img.half-width{max-height:none;width:50%}.bordered-img{border:3px solid #57a3e8}.img-group{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.img-group img{padding:0;height:auto}twitterwidget{margin-left:auto;margin-right:auto}.mc-field-group{width:400px;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;padding:8px 0}.mc-field-group input{border-radius:3px;max-width:350px;width:80vw;border:1px solid #ccc;margin-right:10px;height:30px}.mc-field-group label{font-size:.9em;font-weight:600}#mc-embedded-subscribe{color:#fff;background:#57a3e8;border-radius:4px;border:0;padding:0 10px;margin:10px 0;cursor:pointer;width:40vw}#mc-embedded-subscribe:hover{background:#3e8acf}.twitter-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.twitter-row>div{padding-right:20px;min-width:300px}.category-icon-wrapper{color:rgba(87,163,232,.5)}.category-icon{display:inline-block;width:.75em;margin-right:.5em}.category-icon *{fill:#57a3e8;fill:rgba(87,163,232,.5)}.category-icon>i{height:30px}</style></head><body class="landing-page" style="background:#FCFCFC;padding:0 10px;"><div id="react-mount"><div style="max-width:40.3rem;margin-left:auto;margin-right:auto;padding:2.325rem 1.1625rem;" data-reactroot="" data-reactid="1" data-react-checksum="-361512451"><div style="display:flex;padding-bottom:0.5rem;margin-bottom:0.5rem;" data-reactid="2"><div style="flex-grow:3;display:flex;flex-direction:column;justify-content:space-around;" data-reactid="3"><h3 style="margin:0;padding-bottom:0;" data-reactid="4"><a style="box-shadow:none;text-decoration:none;color:inherit;" name="title" href="/" data-reactid="5">benmccormick.org</a></h3><div style="color:rgba(100,100,100, 0.7);" data-reactid="6"><a class="header-link" href="/subscribe/" data-reactid="7">Subscribe</a><span style="padding:0 0.33rem;" data-reactid="8">•</span><a class="header-link" href="/archive/" data-reactid="9">Archive</a><span style="padding:0 0.33rem;" data-reactid="10">•</span><a class="header-link" href="http://twitter.com/ben336" data-reactid="11">Twitter</a><span style="padding:0 0.33rem;" data-reactid="12">•</span><a class="header-link" href="/about/" data-reactid="13">About</a></div></div><div style="flex-shrink:2;" data-reactid="14"><span data-reactid="15"></span></div></div><div class="markdown" data-reactid="16"><!-- react-empty: 17 --><h5 style="display:block;color:rgba(100,100,100, 0.7);margin-bottom:0.3875rem;" data-reactid="18">September 19, 2016</h5><h1 style="margin-top:0;margin-bottom:1rem;" data-reactid="19">Testing with Jest Snapshots: First Impressions</h1><div class="article-body" data-reactid="20"><p>Over the past 6 months my team at work has been slowly transitioning a large Backbone application to React.  One of the main goals of the transition has been to build out unit tests as we transition components.  As part of that we switched from using Karma to using Jest for managing our tests.</p>
<p>Our new setup with Jest has several advantages over our previous setup. All Jest tests run through node using a fake DOM implementation.  We don’t need to start up a browser so tests are faster and less flaky <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.  Jest makes it possible to mock all modules by default <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>, which works well for us since our code base currently contains a large amount of code that is difficult to test for one reason or another.  Jest provides great integration with Babel, which is helpful since all of our Backbone and React code uses ES6 that we transpile for the browser.  Finally Jest provides a wonderful watch mode that runs only the tests that are relevant to the changes you’ve made and makes it easy to see the result.</p>
<p>About a month ago, Jest debuted a new feature: Snapshot testing.  It works a bit differently than a normal unit test.  Instead of executing some code and comparing the output against a value provided by a developer, the first time a test is run, the output passed into the test is saved to a “snapshot file”.  Then when the test is run in the future, the output is compared to the snapshot file.  If the output matches the file, the test passes, if the output is different then the file, the test fails and Jest prints a diff.  We’ve been using Jest snapshots for a few weeks now and I wanted to share my initial impressions.</p>
<h3>What is it like to use a snapshot test ?</h3>
<p>The process for snapshot testing is a bit different than normal tests.  Most snapshot tests look fairly simple.  Something like this example from the <a href="https://github.com/facebook/jest/tree/master/examples/snapshot">Jest repository</a>:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Link.react.js</span>
<span class="hljs-comment">// Copyright 2004-present Facebook. All Rights Reserved.</span>

<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> STATUS = {
  <span class="hljs-attr">NORMAL</span>: <span class="hljs-string">'normal'</span>,
  <span class="hljs-attr">HOVERED</span>: <span class="hljs-string">'hovered'</span>,
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Link</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{

  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>();

    <span class="hljs-keyword">this</span>._onMouseEnter = <span class="hljs-keyword">this</span>._onMouseEnter.bind(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>._onMouseLeave = <span class="hljs-keyword">this</span>._onMouseLeave.bind(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attr">class</span>: STATUS.NORMAL,
    };
  }

  _onMouseEnter() {
    <span class="hljs-keyword">this</span>.setState({<span class="hljs-attr">class</span>: STATUS.HOVERED});
  }

  _onMouseLeave() {
    <span class="hljs-keyword">this</span>.setState({<span class="hljs-attr">class</span>: STATUS.NORMAL});
  }

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{this.state.class}</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">{this.props.page</span> || '#'}
        <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">{this._onMouseEnter}</span>
        <span class="hljs-attr">onMouseLeave</span>=<span class="hljs-string">{this._onMouseLeave}</span>&gt;</span>
        {this.props.children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
    );
  }

}

<span class="hljs-comment">// Link.react-test.js  (partial)</span>
<span class="hljs-comment">// Copyright 2004-present Facebook. All Rights Reserved.</span>
<span class="hljs-comment">/* eslint-disable no-unused-vars */</span>
<span class="hljs-meta">
'use strict'</span>

<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Link <span class="hljs-keyword">from</span> <span class="hljs-string">'../Link.react'</span>;
<span class="hljs-keyword">import</span> renderer <span class="hljs-keyword">from</span> <span class="hljs-string">'react-test-renderer'</span>;

it(<span class="hljs-string">'renders correctly'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> tree = renderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">page</span>=<span class="hljs-string">"http://www.facebook.com"</span>&gt;</span>Facebook<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
  ).toJSON();
  expect(tree).toMatchSnapshot();
});

</code></pre>
<p>The first time the test is run, a snapshot file is produced.  In this case, running the previous test produces a snapshot file that looks like this:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Link.react-test.js.snap  (partial)</span>
exports[<span class="hljs-string">`test renders correctly 1`</span>] = <span class="hljs-string">`
&lt;a
  className="normal"
  href="http://www.facebook.com"
  onMouseEnter={[Function bound _onMouseEnter]}
  onMouseLeave={[Function bound _onMouseLeave]}&gt;
  Facebook
&lt;/a&gt;
`</span>;
</code></pre>
<p>This gives us a baseline for what we expect the UI to look like.  The snapshot is generated in a folder in your <code>__tests__</code> directory, so that it can be checked into source control.</p>
<p>The next time a test is run, if nothing has changed, the test passes.  However, if we change something (let’s say we add a class), the test fails and shows us a diff.</p>
<pre><code class="language-javascript"><span class="hljs-comment">// updated link render method</span>

render() {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">link-item</span> ${<span class="hljs-attr">this.state.class</span>}`}
      <span class="hljs-attr">href</span>=<span class="hljs-string">{this.props.page</span> || '#'}
      <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">{this._onMouseEnter}</span>
      <span class="hljs-attr">onMouseLeave</span>=<span class="hljs-string">{this._onMouseLeave}</span>&gt;</span>
      {this.props.children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
  );
}
</code></pre>
<pre><code class="language-diff">
# jest output

FAIL  __tests__/Link.react-test.js
 ✕ renders correctly (16ms)

● renders correctly

    Received value does not match the stored snapshot 1.

    - Snapshot
    + Received

      &lt;a
<span class="hljs-deletion">-       className="normal"</span>
<span class="hljs-addition">+       className="link-item normal"</span>
        href="http://www.facebook.com"
        onMouseEnter={[Function bound _onMouseEnter]}
        onMouseLeave={[Function bound _onMouseLeave]}&gt;
        Facebook
      &lt;/a&gt;

      at Object.&lt;anonymous&gt; (__tests__/Link.react-test.js:14:16)
</code></pre>
<p>We can then choose to accept this change by running <code>jest -u</code> to update the snapshot, or update our code to fix the regression.  If we update the snapshot file, the test will start passing again.</p>
<h3>Snapshot tests are a complement for conventional tests not a replacement</h3>
<p>The first thing that became clear to me while using snapshot testing is that they’re not for everything.  They are optimized for a different case than normal assertion-based tests.</p>
<p>Classic assertion based tests are perfect for testing clearly defined behavior that is expected to remain relatively stable.</p>
<p>Snapshot tests are great for testing less clearly defined behavior that may change often.</p>
<p>Snapshot testing is perfect for things that in the past would have raised concern for “overly brittle” tests that slow development teams down.  The classic example of this (and the main focus of discussion around Jest snapshots so far) is UI testing.</p>
<p>UI components often change in small and trivial ways.  Copy is changed, whitespace is added, a border color is modified. Generally this means that developers have to choose between detailed tests that catch any regression but require constant updates, or less detailed tests that focus on core behaviors but miss smaller regressions.</p>
<p>Snapshot tests provide a new way of approaching these problems in unit tests.  Because they are easy to write and effortless to update, and provide a clear view of what changed after each update, whether it is major or minor.</p>
<p>This isn’t without any disadvantage. Snapshot tests preserve a starting point, but don’t give any indication of developer intent to future developers.  Like any other test, if the initial snapshot passes with bugs, or doesn’t capture the full range of cases, the test won’t adequately cover those behaviors.  But unlike traditional tests, snapshot tests don’t provide specific guidance for what the original developer expected beyond the “actual behavior”.  If there are multiple sub-behaviors that interact to produce output, its not clear which of those are essential, and which are incidental.  That’s not something you want for your critical application logic, especially complicated logic with many subtle cases.  But for UI components and other application elements that are likely to change a lot over time, this is a good set of tradeoffs.</p>
<h3>Snapshot tests are more useful with a healthy code review process</h3>
<p>I’ve pointed out several times now that snapshot tests are easy to update.  One of the downsides of the current design is that they can be almost too easy to update.  When a snapshot test fails, you have the option of modifying the output so that the test passes again, or updating the snapshot to reflect the new output.  Unfortunately, Jest currently provides no granularity for this updating.  Running <code>jest -u</code> to update the snapshots will update all snapshots.  So if  a single change causes many snapshots to break, it can be easy to accidentally update all of them, and possibly difficult to work through the whole diff to find changes.</p>
<p>A robust code review process minimizes these problems.  Because snapshots are checked into source, the diffs in the snapshots are checked into source control.  Viewing diffs in a dedicated code review tool like Github, Bitbucket or Gitlab, it’s easier to see exactly what changed over many files than it might be when updating snapshots from the command line, and if you update a snapshot multiple times in a single branch, you can see the net effect on the snapshot through source control diffs better than you can through Jest.</p>
<h3>Snapshot tests work well with auto-mocking</h3>
<p>Auto-mocking has been one of Jest’s more controversial features.  Prior to version 15, Jest mocked every module used in tests by default.  To run the actual module code, it was necessary to manually unmock each module used or change Jest configurations.  Though it is now disabled by default, auto-mocking actually works very well with snapshot tests.  One problem with tests that rely on generating DOM in React is the fact that most components of any complexity are actually made up of smaller components, that often use external functions with complex logic to determine what to show.  If we fully render everything, changing any of those pieces can break tests for many components, moving us away from the concept of a “unit test”.  If we mock child components and helper functions and then test them individually though, we can focus our tests to only change based on the logic of the individual component being tested.  This is incredibly easy with Jest, and especially helpful in large code bases that don’t have complete test coverage.  Auto-mocking is considered an “advanced feature” of Jest, but it’s not hard to use.  Most mocked modules produce something non-harmful by default, and when its necessary to override, its not difficult to produce something meaningful without getting too involved.  Just add a file with the same name as the file to be mocked into a <code>__mocks__</code> folder in that directory, and give the mocked module the same interface as the mocked component.  You can either write it from scratch or use <a href="http://facebook.github.io/jest/docs/api.html#jest-genmockfrommodule-modulename">jest.genMockFromModule</a> as a starting place.</p>
<h3>Summary</h3>
<p>I’m impressed by Jest snapshots.  When combined with React, they’re providing my first non-frustrating experience unit testing UI components.  I’m excited to use them more going forward, and will be interested to see how they evolve from here.</p>
<hr>
<h3>Extra: A few miscellaneous Jest Thoughts</h3>
<ul>
<li>The UI output from Jest 15 tests is the best I’ve ever seen from a testing framework.  Aside from the nice diffs on snapshots, they do a good job explaining how output differed from expectations in assertion based tests, and communicating context for test failures, warnings and logging messages.  They also give great guidance when making configuration changes:</li>
</ul>
<div style="display:flex; justify-content:center">
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/cpojer">@cpojer</a> This is lovely, thank you! <a href="https://t.co/CX1v11CAVc">pic.twitter.com/CX1v11CAVc</a></p>&mdash; Ben McCormick (@ben336) <a href="https://twitter.com/ben336/status/772906536154894336">September 5, 2016</a></blockquote>
</div>
<ul>
<li>
<p>I’ve also been super impressed with Jest’s watch mode in Jest 15.  <code>--watch</code> makes it easy to focus on a few files or run tests on all files, and stays up to date as you change code.  If you haven’t worked with Jest in a while, the developer experience alone makes it worth trying out.</p>
</li>
<li>
<p>One potential future annoyance with snapshot tests:  The snapshot format can’t be iterated on without breaking all current tests.  Make sure not to mix functional changes with Jest updates!</p>
</li>
</ul>
<div style="display:flex; justify-content:center">
<blockquote class="twitter-tweet" data-cards="hidden" data-lang="en"><p lang="en" dir="ltr">We&#39;ll update the snapshot format sometimes in minor/major releases. When updating Jest, please update snapshots<br><br>See <a href="https://t.co/gPE63dMz8P">https://t.co/gPE63dMz8P</a></p>&mdash; Christoph Pojer (@cpojer) <a href="https://twitter.com/cpojer/status/776623521069805568">September 16, 2016</a></blockquote>
</div>
<h3>More Resources</h3>
<ul>
<li>
<p>Randy Coulman has a <a href="http://randycoulman.com/blog/2016/09/06/snapshot-testing-use-with-care/">nice article</a> on some of the reasons to be careful about embracing snapshot testing.  He makes good points about the requirement of human involvement in verifying a change in time-crunched situations and also the potential value of snapshot tests for legacy code.</p>
</li>
<li>
<p>My team uses a mix of <a href="https://github.com/airbnb/enzyme">enzyme</a> and snapshot tests for unit testing React Components.  <a href="https://github.com/trayio/enzyme-to-json?utm_content=buffer6b78b&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">This repo</a> combines them, allowing you to use enzyme to generate the snapshot output to diff against rather than the renderer provided by Jest. I personally haven’t felt the need to integrate these two tools, but if your team uses enzyme and wants consistency/fewer (used) dependencies, this could be a cool option.</p>
</li>
<li>
<p>Finally here’s <a href="https://blog.grommet.io/post/2016/09/01/how-we-landed-on-jest-snapshot-testing-for-javascript">another article</a> on how Snapshot testing convinced one team to migrate to Jest from Tape</p>
</li>
</ul>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>PhantomJS was a tremendous source of pain in our Karma setup. <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>This used to be the default setting, with Jest 15 it can be configured to work that way. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
</div><div data-reactid="21"><hr data-reactid="22"/><div class="subscribe-container" data-reactid="23"><div class="subscribe-block" data-reactid="24"><p data-reactid="25"><!-- react-text: 26 -->Thanks for taking the time to read this post!<!-- /react-text --><!-- react-text: 27 --> Software tooling<!-- /react-text --><!-- react-text: 28 --> is one of the main topics of this blog, so if you enjoyed the post, please consider subscribing by using the feed, Twitter or my mailing list.<!-- /react-text --></p><div style="margin-bottom:3.875rem;" data-reactid="29"><div id="mc_embed_signup" data-reactid="30"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="31">EMAIL</h6><form action="//benmccormick.us8.list-manage.com/subscribe/post?u=115446b80fd9d930ba091cc27&amp;id=f5b9f5acf2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="" data-reactid="32"><div id="mc_embed_signup_scroll" data-reactid="33"><div class="mc-field-group" style="padding-right:30px;" data-reactid="34"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address" data-reactid="35"/><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" data-reactid="36"/></div><div id="mce-responses" class="clear" data-reactid="37"><div class="response" id="mce-error-response" style="display:none;" data-reactid="38"></div><div class="response" id="mce-success-response" style="display:none;" data-reactid="39"></div></div><div style="position:absolute;left:-5000px;" aria-hidden="true" data-reactid="40"><input type="text" name="b_115446b80fd9d930ba091cc27_f5b9f5acf2" tabindex="-1" value="" data-reactid="41"/></div><div class="clear" data-reactid="42"></div></div></form></div><div class="rss" data-reactid="43"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="44">RSS</h6><a href="/rss/" data-reactid="45"><i class="rss-icon" data-reactid="46"><svg viewBox="0 0 10 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>rss</title><desc>Created with Sketch.</desc><defs></defs><g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="rss" fill="#000000"><path d="M2,13 L0,13 L0,11 C1.11,11 2,11.89 2,13 L2,13 Z M0,3 L0,4 C4.97,4 9,8.03 9,13 L10,13 C10,7.48 5.52,3 0,3 L0,3 Z M0,7 L0,8 C2.75,8 5,10.25 5,13 L6,13 C6,9.69 3.31,7 0,7 L0,7 Z" id="Shape"></path></g></g></svg></i><!-- react-text: 47 --> <!-- /react-text --><span data-reactid="48">RSS</span></a></div><div data-reactid="49"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="50">TWITTER</h6><div class="twitter-item" data-reactid="51"><span data-reactid="52">Site Feed: </span><a href="https://twitter.com/benmccormickorg" class="twitter-follow-button" data-show-count="false" data-reactid="53">Follow @benmccormickorg</a></div></div><div data-reactid="54"><div class="twitter-item" data-reactid="55"><span data-reactid="56">Personal Feed: </span><a href="https://twitter.com/ben336" class="twitter-follow-button" data-show-count="false" data-reactid="57">Follow @ben336</a></div></div></div></div><div class="up-next-block" data-reactid="58"><h6 style="margin:0;font-size:0.8165rem;line-height:1.55rem;letter-spacing:-0.25px;" data-reactid="59">You Might Also Like:</h6><div data-reactid="60"><h3 style="margin-top:0;margin-bottom:0.3875rem;" data-reactid="61"><a href="/2017/01/09/mobx-first-impressions/?readNext=true#title" data-reactid="62">MobX: First Impressions</a></h3><p data-reactid="63">First impression of managing data with MobX</p></div><div data-reactid="64"><hr data-reactid="65"/><h3 style="margin-top:0;margin-bottom:0.3875rem;" data-reactid="66"><a href="/2016/12/10/saving-time-with-jest/?readNext=true#title" data-reactid="67">Saving Time With Jest: Meetup Summary</a></h3><p data-reactid="68">A summary of my meetup talk on saving time with Jest</p></div><div data-reactid="69"><hr data-reactid="70"/><h3 style="margin-top:0;margin-bottom:0.3875rem;" data-reactid="71"><a href="/2015/09/09/what-can-backbone-developers-learn-from-react/?readNext=true#title" data-reactid="72">Lessons Backbone Developers Can Learn From React</a></h3><p data-reactid="73">A look at the lessons that Backbone developers can learn from React</p></div></div></div></div><hr style="margin-bottom:3.1rem;" data-reactid="74"/><div title="Testing with Jest Snapshots: First Impressions" data-reactid="75"><div id="disqus_thread" data-reactid="76"></div><noscript data-reactid="77"><span data-reactid="78"><!-- react-text: 79 -->Please enable JavaScript to view the<!-- /react-text --><a href="http://disqus.com/?ref_noscript" data-reactid="80">comments powered by Disqus.</a></span></noscript><a href="http://disqus.com" class="dsq-brlink" data-reactid="81"><!-- react-text: 82 -->Blog comments powered by <!-- /react-text --><span class="logo-disqus" data-reactid="83">Disqus</span><!-- react-text: 84 -->.<!-- /react-text --></a></div></div><span style="display:block;clear:both;" data-reactid="85"> </span></div></div><script src="/bundle.js?t=1496367811825"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-37323973-1', 'auto');
            ga('send', 'pageview');
        </script><script type="text/javascript">
              // adapted from: https://css-tricks.com/serviceworker-for-offline/
              // ServiceWorker is a progressive technology. Ignore unsupported browsers
              if ('serviceWorker' in navigator) {
              console.log('CLIENT: service worker registration in progress.');
              navigator.serviceWorker.register('/sw.js').then(function() {
                console.log('CLIENT: service worker registration complete.');
              }, function() {
                console.log('CLIENT: service worker registration failure.');
              });
              } else {
              console.log('CLIENT: service worker is not supported.');
              }
            </script></body></html>